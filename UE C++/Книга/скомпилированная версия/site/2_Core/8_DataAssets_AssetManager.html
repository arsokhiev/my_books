
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Справочник Unreal Engine">
      
      
        <meta name="author" content="aftamat4ik">
      
      
      
        <link rel="prev" href="7_Gameplay_Tags.html">
      
      
        <link rel="next" href="9_FileSystem.html">
      
      
      <link rel="icon" href="../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.3.2">
    
    
      
        <title>Работа с ассетами и данными - Справочник Unreal Engine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.30068a00.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-header__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Справочник Unreal Engine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Работа с ассетами и данными
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Главная

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1_Basics/1_First_Project.html" class="md-tabs__link">
          
  
  Основы

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="1_Delegates.html" class="md-tabs__link">
          
  
  Ключевые системы

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../3_Advanced/1_HUD.html" class="md-tabs__link">
          
  
  Продвинутая разработка

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-tabs__link">
          
  
  Решение проблем

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../5_Tips/Change_Asset_Icons.html" class="md-tabs__link">
          
  
  Советы

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-nav__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    Справочник Unreal Engine
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Главная
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Основы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Основы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/1_First_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создаем первый проект в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/2_Engine_Introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Знакомство с движком
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/3_CPP_Recommendations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Рекомендации по написанию кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/4_SimplePlugin.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создание простейшего плагина для Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/5_Macroses_Reflection_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Макросы Reflection System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/6_Logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Печать информации в лог
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/7_Pointers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Указатели
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/8_ModernCpp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возможности современного c++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/9_Working_With_Strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа со строками
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/10_Timers_In_%D0%A1%2B%2B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Таймеры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/11_Instances_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Доступ к различным сущностям
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Debug
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            Debug
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Asserts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Asserts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Console Commands
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ключевые системы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Ключевые системы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="1_Delegates.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События и Делегаты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="2_Components.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Компоненты в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="3_SubObjects.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Суб Объекты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="4_Multithreading.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Многопоточность
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="5_Function_Libraries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Библиотеки Функций для Blueprint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="6_Latent_And_Async_Actions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Latent и Async Action
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="7_Gameplay_Tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Работа с ассетами и данными
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="8_DataAssets_AssetManager.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Работа с ассетами и данными
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Подготовка к работе
  </a>
  
    <nav class="md-nav" aria-label="Подготовка к работе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Создаем модуль
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actorcomponent" class="md-nav__link">
    Создаем ActorComponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Зависимости сборки
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-assets" class="md-nav__link">
    Data Assets или ассеты данных
  </a>
  
    <nav class="md-nav" aria-label="Data Assets или ассеты данных">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dataasset-uproperty" class="md-nav__link">
    DataAsset UPROPERTY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataasset" class="md-nav__link">
    Чтение данных из DataAsset по ссылке
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assetregistry" class="md-nav__link">
    AssetRegistry или реестр ассетов
  </a>
  
    <nav class="md-nav" aria-label="AssetRegistry или реестр ассетов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Получение списка ассетов по их классу
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint-uobjecttestclass" class="md-nav__link">
    Получение списка blueprint классов, унаследованных от UObjectTestClass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assetregistrysearchable" class="md-nav__link">
    Фильтрование ассетов по значениям их параметров AssetRegistrySearchable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint" class="md-nav__link">
    Реестр ассетов в blueprint коде
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint-actor" class="md-nav__link">
    Спавн всех blueprint Actor'ов в папке
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asset-manager" class="md-nav__link">
    Asset Manager или менеджер ассетов
  </a>
  
    <nav class="md-nav" aria-label="Asset Manager или менеджер ассетов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Проблемы менеджера ассетов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asset-manager_1" class="md-nav__link">
    Основные  принципы системы Asset Manager
  </a>
  
    <nav class="md-nav" aria-label="Основные принципы системы Asset Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Переопределение менеджера ассетов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Важное дополнение
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Использование менеджера ассетов через синглтон
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Первичные и вторичные ассеты
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary-data-asset" class="md-nav__link">
    Primary Data Asset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Реализация поиска предмета по названию файла
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Асинхронная загрузка ассетов
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    Links
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="9_FileSystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с файловой системой
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="10_Anim_Instance.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anim Instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="11_SubSystems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Подсистемы
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="12.%20UObject%20Interface.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Interface или UInterface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Продвинутая разработка
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Продвинутая разработка
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/1_HUD.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HUD или Heads-up Display
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/2_UFUNCTION_Wildcard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UFUNCTION Wildcard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/3_Slate%20Runtime.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slate Runtimе, введение в Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/4_UMG.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UMG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/5_K2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/6_Registe_New_Asset_Type.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Регистрируем новый тип ассета
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/7_ACharacter_And_Enhanced%20Input.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ACharacter и Enhanced Input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/8_Gameplay_Ability_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Ability System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/9_Global_Data_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальнный доступ к данным
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_Advanced/10_Global_Event_Bus.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальная шина событий
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Решение проблем
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Решение проблем
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с кодировкой в LiveCoding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/Reset_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Сброс (Reset) проекта
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/generatedh_Problems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с файлом .generated.h
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Советы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Советы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Change_Asset_Icons.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Asset Icons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Character_And_EnhancedInput.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Character Boilerplate with Enhanced Input Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/DefaultToSelf_WorldContext.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DefaultToSelf WorldContext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Different_UPROPERTY.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Переменные разных типов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/GameInputMode.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Изменение GameInputMode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Get_UScriptStruct_FromStruct.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ::UScriptStruct из встроенной структуры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Input_Binding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События ввода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Iterate_TMap.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iterate TMap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Read_Blueprint_Properties.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Чтение параметров Blueprint класса
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Return_UObject.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возвращение UObject по ссылке из функции
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Run_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Запуск консольных команд
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Screen_Size.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Размер экрана
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Slate_Snippets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Полезные сниппеты Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Spawn_Actors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spawn, призыв объектов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Time_Measuring.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Замер времени исполнения кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Trace.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UEnum_To_String.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UEnum to FString
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UObject_Base_Class.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Base Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Variable_Type_Print_Template.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Шаблон для печати типа переменной
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/struct_operator%3D%3D.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    struct и оператор ==
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Подготовка к работе
  </a>
  
    <nav class="md-nav" aria-label="Подготовка к работе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Создаем модуль
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actorcomponent" class="md-nav__link">
    Создаем ActorComponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Зависимости сборки
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-assets" class="md-nav__link">
    Data Assets или ассеты данных
  </a>
  
    <nav class="md-nav" aria-label="Data Assets или ассеты данных">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dataasset-uproperty" class="md-nav__link">
    DataAsset UPROPERTY
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataasset" class="md-nav__link">
    Чтение данных из DataAsset по ссылке
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assetregistry" class="md-nav__link">
    AssetRegistry или реестр ассетов
  </a>
  
    <nav class="md-nav" aria-label="AssetRegistry или реестр ассетов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Получение списка ассетов по их классу
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint-uobjecttestclass" class="md-nav__link">
    Получение списка blueprint классов, унаследованных от UObjectTestClass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assetregistrysearchable" class="md-nav__link">
    Фильтрование ассетов по значениям их параметров AssetRegistrySearchable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint" class="md-nav__link">
    Реестр ассетов в blueprint коде
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint-actor" class="md-nav__link">
    Спавн всех blueprint Actor'ов в папке
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asset-manager" class="md-nav__link">
    Asset Manager или менеджер ассетов
  </a>
  
    <nav class="md-nav" aria-label="Asset Manager или менеджер ассетов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Проблемы менеджера ассетов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asset-manager_1" class="md-nav__link">
    Основные  принципы системы Asset Manager
  </a>
  
    <nav class="md-nav" aria-label="Основные принципы системы Asset Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Переопределение менеджера ассетов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Важное дополнение
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Использование менеджера ассетов через синглтон
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Первичные и вторичные ассеты
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primary-data-asset" class="md-nav__link">
    Primary Data Asset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Реализация поиска предмета по названию файла
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Асинхронная загрузка ассетов
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    Links
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="_1">Работа с ассетами и данными</h1>
<p>(Assets and Data Management)
Рассмотрим методы индексации ассетов, а так-же файлы <code>Data Asset</code>.</p>
<h2 id="_2">Подготовка к работе</h2>
<h3 id="_3">Создаем модуль</h3>
<p>Cоздадим модуль <code>DataAccess</code>.</p>
<p><a class="glightbox" href="../images/06c4fd0edbf4454b5139d9dcf621a781.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="06c4fd0edbf4454b5139d9dcf621a781.png" auto_="auto;" display="block;" margin:="margin:" src="../images/06c4fd0edbf4454b5139d9dcf621a781.png" /></a></p>
<p>После генерации модуля не забудьте выполнить команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>, чтобы файлы появились в Visual Studio.</p>
<p><a class="glightbox" href="../images/8d3c9df261421a091b3b44bd0cb4a48b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8d3c9df261421a091b3b44bd0cb4a48b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8d3c9df261421a091b3b44bd0cb4a48b.png" /></a></p>
<h3 id="actorcomponent">Создаем <code>ActorComponent</code></h3>
<p>Теперь добавим <code>ActorComponent</code>, в котором и будем писать наш код.</p>
<p>Идем <code>Tools -&gt; New C++ Class -&gt; Actor Component</code>.</p>
<p><a class="glightbox" href="../images/18025c01963dfbf9b8aa50a7c0e71515.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="18025c01963dfbf9b8aa50a7c0e71515.png" auto_="auto;" display="block;" margin:="margin:" src="../images/18025c01963dfbf9b8aa50a7c0e71515.png" /></a></p>
<p>Называем компонент <code>DataAccessComponent</code>.</p>
<p><a class="glightbox" href="../images/4ce015213a61bbebbcb09670bff20a91.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4ce015213a61bbebbcb09670bff20a91.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4ce015213a61bbebbcb09670bff20a91.png" /></a></p>
<p>Не забудьте выполнить команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>, чтобы файл компонента появился в Visual Studio.</p>
<p><a class="glightbox" href="../images/800bd7556f379abc0a12c40db033b32f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="800bd7556f379abc0a12c40db033b32f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/800bd7556f379abc0a12c40db033b32f.png" /></a></p>
<p>Теперь добавим полученный компонент к <code>BP_ThirdPersonCharacter</code>.</p>
<p><a class="glightbox" href="../images/f42ae2a754a2aa747bceb82c0ca972bb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f42ae2a754a2aa747bceb82c0ca972bb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f42ae2a754a2aa747bceb82c0ca972bb.png" /></a></p>
<h3 id="_4">Зависимости сборки</h3>
<p>Прописываем в файл <code>DataAccess.build.cs</code> следующие зависимости:
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="n">UnrealBuildTool</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DataAccess</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ModuleRules</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DataAccess</span><span class="p">(</span><span class="n">ReadOnlyTargetRules</span><span class="w"> </span><span class="n">Target</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">base</span><span class="p">(</span><span class="n">Target</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">PCHUsage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PCHUsageMode</span><span class="p">.</span><span class="n">UseExplicitOrSharedPCHs</span><span class="p">;</span>
<span class="w">        </span><span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;Core&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;CoreUObject&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;Engine&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;TestModule&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;CharactersModule&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;GameplayTags&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;InputCore&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;EnhancedInput&quot;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="n">PrivateDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;AssetRegistry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestModule&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="n">PublicIncludePaths</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;DataAccess/Public&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">PrivateIncludePaths</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;DataAccess/Private&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="data-assets">Data Assets или ассеты данных</h2>
<p><code>UDataAsset</code> - это базовый класс, для организации различного рода файловых хранилищ данных. Реализуя данный класс разработчик создает заготовку, на основе которой формируются ассеты данных.</p>
<p>Давайте рассмотрим на практике.</p>
<p>Идем <code>Tools-&gt;New C++ Class -&gt; AllClasses</code> и ищем <code>Data Asset</code>.</p>
<p><a class="glightbox" href="../images/458a8593d0f8abe133ef10ac8c328ecb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="458a8593d0f8abe133ef10ac8c328ecb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/458a8593d0f8abe133ef10ac8c328ecb.png" /></a></p>
<p>Нас интересует пока просто обычный <code>Data Asset</code>, не <code>Primary Data Asset</code>, о нем я поговорю ниже.</p>
<p>Добавляем новый <code>Data Asset</code> в модуль <code>DataAccess</code>, называем - <code>CharacterData</code>.</p>
<p><a class="glightbox" href="../images/e0d8d0c69e7e937f06c47b50d0fac4e0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e0d8d0c69e7e937f06c47b50d0fac4e0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e0d8d0c69e7e937f06c47b50d0fac4e0.png" /></a></p>
<p>Далее обновляем индексацию проекта командой <code>Tools-&gt;Refresh Visual Studio 2022 Project</code>, чтобы добавленный файл появился в <code>Solution Explorer</code>.</p>
<p><a class="glightbox" href="../images/cc418223e9708e4ce72a3561c096befe.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cc418223e9708e4ce72a3561c096befe.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cc418223e9708e4ce72a3561c096befe.png" /></a></p>
<p>В полученном классе <code>UCharacterData</code> мы можем выстроить модель данных, которая будет храниться внутри файлов <code>DataAsset</code>. Делается это через банальное добавление переменных с использованием макроса <code>UPROPERTRY</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// Packages used:</span>
<span class="c1">// &quot;GameplayTags&quot;, &quot;EnhancedInput&quot;, &quot;TestModule&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;NativeGameplayTags.h&quot;</span><span class="c1"> // gameplay tags</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputAction.h&quot;</span><span class="c1"> // enhanced input</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputMappingContext.h&quot;</span>
<span class="c1">// Item Types Enum</span>
<span class="c1">// This enum size limited by 8 maximum items since it&#39;s bitmask enum from uint8</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Bitflags</span><span class="p">,</span><span class="w"> </span><span class="n">UseEnumValuesAsMaskValuesInEditor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">))</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EItemTypes</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">NONE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">Hidden</span><span class="p">),</span>
<span class="w">    </span><span class="n">Default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">Helmet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">Gloves</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">Sword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="n">Boots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="p">};</span>
<span class="n">ENUM_CLASS_FLAGS</span><span class="p">(</span><span class="n">EItemTypes</span><span class="p">);</span>
<span class="cm">/**</span>
<span class="cm"> * Character Data Asset</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DATAACCESS_API</span><span class="w"> </span><span class="n">UCharacterData</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UDataAsset</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Input Action as parameter in Data Asset</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Input&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputAction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Input Context as parameter in Data Asset</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Input&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InputContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Gameplay tag locked category</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GameplayTags&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Locomotion.Grounded&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">GroundedLocomotionMode</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Edit Condition</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EditConditions&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">EditCondition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bVarCanBeEdited&quot;</span><span class="cm">/*, EditConditionHides*/</span><span class="p">))</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">EditConditionTestVariable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Test&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EditConditions&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InlineEditConditionToggle</span><span class="p">))</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bVarCanBeEdited</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Item Type Enum</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EditConditions|Enum&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">EItemTypes</span><span class="w"> </span><span class="n">ItemType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EItemTypes</span><span class="o">::</span><span class="n">Boots</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Bit Flags variable</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BitFlags&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Bitmask</span><span class="p">,</span><span class="w"> </span><span class="n">BitmaskEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/Script/TestModule.EItemTypes&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">ItemTypeFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StaticCast</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">EItemTypes</span><span class="o">::</span><span class="n">Helmet</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">EItemTypes</span><span class="o">::</span><span class="n">Gloves</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// enum based edit condition</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EditConditions|Enum&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">EditCondition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ItemType != EItemTypes::Sword&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">EditConditionHides</span><span class="p">))</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// BitFlag based condition</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EditConditions&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">EditCondition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ItemTypeFlags &amp; &#39;/Script/TestModule.EItemTypes::Sword&#39;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">EditConditionBitFlags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;This Editable With BitFlag&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Array Test</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Arrays&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TestIntArray</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Map. Filled in constructor</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Map&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TMap</span><span class="o">&lt;</span><span class="n">FString</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TestMap</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Test Output Function</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintPure</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Map&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TMap</span><span class="o">&lt;</span><span class="n">FString</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetTestMap</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TestMap</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
В код я перенес наиболее актуальные примеры переменных, которые так или иначе могут быть использованы на практике.</p>
<p>После добавления кода и его компиляции - самое время создать непосредственно <code>DataAsset</code> на основе класса <code>UCharacterData</code>.
Для этого идем в <code>Content Browser -&gt; Add -&gt; Miscellaneous -&gt; Data Asset</code>.</p>
<p><a class="glightbox" href="../images/8f3aa4c819acb97d59ecccd855810cfc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8f3aa4c819acb97d59ecccd855810cfc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8f3aa4c819acb97d59ecccd855810cfc.png" /></a></p>
<p>Перед вами появится меню генерации <code>Data Asset</code>, в котором необходимо будте выбрать тип, на основе которого этот ассет создается. В нашем случае это <code>CharacterData</code>.</p>
<p><a class="glightbox" href="../images/069b87c9d1560527992e277ceea7db0c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="069b87c9d1560527992e277ceea7db0c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/069b87c9d1560527992e277ceea7db0c.png" /></a></p>
<p>После создания вы увидите новый <code>DataAsset</code>, в котором будут содержаться все поля, которые мы указали в классе.</p>
<p><a class="glightbox" href="../images/0e901eed97c33b0e4bbaaf027be21fab.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0e901eed97c33b0e4bbaaf027be21fab.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0e901eed97c33b0e4bbaaf027be21fab.png" /></a></p>
<p><a class="glightbox" href="../images/2119d44533b8448b1565b290214e1b34.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2119d44533b8448b1565b290214e1b34.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2119d44533b8448b1565b290214e1b34.png" /></a></p>
<p>Особое внимание прошу обратить на параметры типа <code>EditCondition</code>. Их крайне часто применяют именно в файлах типа <code>DataAsset</code>, потому что таким образом можно обеспечить разные типы настроек для разных типов параметров.</p>
<p>В нашем примере, если выбрать для параметра <code>Item Type</code> тип <code>Helmet</code> то появится параметр <code>Armor</code>.</p>
<p><a class="glightbox" href="../images/615b15da2b791d308c03aea1688f48bb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="615b15da2b791d308c03aea1688f48bb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/615b15da2b791d308c03aea1688f48bb.png" /></a></p>
<p>Если же выбрать <code>Sword</code> то параметр пропадет.</p>
<p><a class="glightbox" href="../images/7da9dd857c56731740931f0eab5a6956.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7da9dd857c56731740931f0eab5a6956.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7da9dd857c56731740931f0eab5a6956.png" /></a></p>
<p>Вы можете крайне успешно применять похожую логику. Более подробно про <code>EditCondition</code> я уже писал в статье про макросы.</p>
<p>Рассмотрим получение ссылок на <code>DataAsset</code>.</p>
<h3 id="dataasset-uproperty"><code>DataAsset UPROPERTY</code></h3>
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">//Data asset refrence</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;VariableExperiments&quot;</span><span class="p">)</span>
<span class="n">UDataAsset</span><span class="o">*</span><span class="w"> </span><span class="n">DataAssetRefrence</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// default value</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DataAssetRefrence</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/DataAccess.CharacterData&#39;/Game/Characters/Data/DA_Character.DA_Character&#39;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">DataAssetRefrence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UKismetSystemLibrary</span><span class="o">::</span><span class="n">MakeSoftObjectPath</span><span class="p">(</span><span class="n">Path</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><a class="glightbox" href="../images/792d495586ea94dee866a28fe382db8e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="792d495586ea94dee866a28fe382db8e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/792d495586ea94dee866a28fe382db8e.png" /></a></p>
<h3 id="dataasset">Чтение данных из <code>DataAsset</code> по ссылке</h3>
<p>Делается элементарно.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CharacterData.h&quot;</span>
<span class="c1">//...</span>
<span class="n">UCharacterData</span><span class="o">*</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadObject</span><span class="o">&lt;</span><span class="n">UCharacterData</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/DataAccess.CharacterData&#39;/Game/Characters/Data/DA_Character.DA_Character&#39;&quot;</span><span class="p">));</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;GroundedLocomotionMode = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Asset</span><span class="o">-&gt;</span><span class="n">GroundedLocomotionMode</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/2e35ff6a302bbbd2950e5904eeb67626.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2e35ff6a302bbbd2950e5904eeb67626.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2e35ff6a302bbbd2950e5904eeb67626.png" /></a></p>
<h2 id="assetregistry">AssetRegistry или реестр ассетов</h2>
<p><code>AssetRegistry</code> или реестр ассетов - это интерфейс файловой системы движка Unreal Engine.
Реестр ассетов хранит ссылки на все файлы в директории проекта. Это позволяет выбирать из файловой системы, например, файлы данных, относящиеся к предметам инвентаря или к кастомизации персонажа.</p>
<p>Используя реестр можно создавать <code>ui</code> виджеты, элементы в которых появляются или удаляются автоматически, при добавлении или удалении файлов из директории проекта.</p>
<p>К примеру: можно сканировать папки с текстурами кожи или прическами, а потом выдавать результат сканирования напрямую в <code>ui</code> виджет кастомизации персонажа. Такой подход позволяет работать без использования <code>Data Table</code> и сторонних хранилищ данных. То есть вам не придется вручную всякий раз указывать файлы причесок в таблице или <code>DataAsset</code>, если виджет сам будет искать их в нужной папке.</p>
<p>Реестр ассетов относительно быстр, но при большом количестве файлов (тысячи), их фильтрование может создавать проблемы.
<code>Content Browser</code> в Unreal Engine работает, используя <code>AssetRegistry</code>.</p>
<p><a class="glightbox" href="../images/2ac2524b57c3e49ef72db1d2bf436e3d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2ac2524b57c3e49ef72db1d2bf436e3d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2ac2524b57c3e49ef72db1d2bf436e3d.png" /></a></p>
<p>Несмотря на тот факт, что реестр ассетов используется, в основном, редактором Unreal Engine, по своей сущности он является <code>runtime</code> модулем и может быть использован в других <code>runtime</code> модулях.</p>
<p>Найти модуль реестра ассетов можно по пути: <code>\Runtime\AssetRegistry\</code>.</p>
<p><a class="glightbox" href="../images/9daba809dee766f2beb1544927253bd6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9daba809dee766f2beb1544927253bd6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9daba809dee766f2beb1544927253bd6.png" /></a></p>
<p>В папке модуля нам особенно интересен сам интерфейс реестра ассетов, это интерфейс (класс) <code>IAssetRegistry</code>, найти его можно по пути <code>\Runtime\AssetRegistry\Public\AssetRegistry\IAssetRegistry.h</code>.
Данный интерфейс является классическим с++ синглтоном, не подсистемой (как написано в официальной документации), а именно просто синглтоном через <code>static</code> переменную.</p>
<p>Сам синглтон можно найти в файле <code>\Runtime\CoreUObject\Public\Misc\AssetRegistryInterface.h</code> и выглядит он так.</p>
<p><a class="glightbox" href="../images/65247d693ba23c501f1c1f7e23ca8cd8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="65247d693ba23c501f1c1f7e23ca8cd8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/65247d693ba23c501f1c1f7e23ca8cd8.png" /></a></p>
<p>В интерфейс он выводится так:</p>
<p><a class="glightbox" href="../images/f150aa7492f311d6594634c830d6e64f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f150aa7492f311d6594634c830d6e64f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f150aa7492f311d6594634c830d6e64f.png" /></a></p>
<p>Доступ к этому синглтону извне проекта можно получить обратившись к конструктору модуля. То есть к файлу <code>AssetRegistryModule.h</code>, в котором есть метод <code>Get</code>. Данный метод возвращает указатель на синглтон реестра ассетов.</p>
<p><a class="glightbox" href="../images/c7b5529e088eab32acad4281c3b17cd5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c7b5529e088eab32acad4281c3b17cd5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c7b5529e088eab32acad4281c3b17cd5.png" /></a></p>
<p>Его мы и будем использовать.</p>
<p>Однако, прежде чем писать код, надо удовлетворить зависимости между модулями.</p>
<p>Находим в Solution Explorer наш модуль <code>DataAccess</code> (создавали в главе "подготовка к работе") идем в файл <code>DataAccess.build.cs</code> и добавляем туда строчку:
<div class="highlight"><pre><span></span><code><span class="n">PrivateDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;AssetRegistry&quot;</span><span class="w"> </span><span class="p">});</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/8610381d34037241595be74be2bea544.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8610381d34037241595be74be2bea544.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8610381d34037241595be74be2bea544.png" /></a></p>
<p>Теперь модуль <code>AssetRegistry</code> будет загружаться вместе с модулем <code>DataAccess</code>. Так-же, из модуля <code>DataAccess</code> мы получаем возможность делать <code>#include</code> к файлам <code>AssetRegistry</code>.
В частности, нас интересует этот файл:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistry/AssetRegistryModule.h&quot;</span><span class="c1"> // Asset Registry</span>
</code></pre></div>
Подключаем его в файле <code>DataAccessComponent.h</code>.</p>
<p><a class="glightbox" href="../images/942969b404a1f3cdd1343d5cb1697cd2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="942969b404a1f3cdd1343d5cb1697cd2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/942969b404a1f3cdd1343d5cb1697cd2.png" /></a></p>
<p>Чаще всего реестр ассетов используют для фильтрования файлов в папках. Это и рассмотрим.</p>
<h3 id="_5">Получение списка ассетов по их классу</h3>
<p>Давайте получим список файлов в папке <code>/Game/LevelPrototyping/Meshes</code>. Эта папка содержит базовые заготовки мешей для шаблона <code>ThirdPerson</code>.</p>
<p><a class="glightbox" href="../images/6117e720412ee62b9b8fcaf585dc4d12.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6117e720412ee62b9b8fcaf585dc4d12.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6117e720412ee62b9b8fcaf585dc4d12.png" /></a></p>
<p>Все меши в папке являются <code>StaticMesh</code>.
Получение ассетов типа <code>UStaticMesh</code> из папки <code>/Game/LevelPrototyping/Meshes</code> выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistryModule.h&quot;</span><span class="c1"> // Asset Registry</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistry/ARFilter.h&quot;</span><span class="c1"> // Asset Registry Filter</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// BeginPlay</span>
<span class="n">FAssetRegistryModule</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FModuleManager</span><span class="o">::</span><span class="n">LoadModuleChecked</span><span class="o">&lt;</span><span class="n">FAssetRegistryModule</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;AssetRegistry&quot;</span><span class="p">);</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FAssetData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetData</span><span class="p">;</span><span class="w"> </span><span class="c1">// This Array will contain our assets</span>
<span class="n">FARFilter</span><span class="w"> </span><span class="n">Filter</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assets will be filtered by this</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">ClassPaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UStaticMesh</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">());</span><span class="w"> </span><span class="c1">// add class to filter</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">PackagePaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;/Game/LevelPrototyping/Meshes&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// all location to filter</span>
<span class="n">Registry</span><span class="p">.</span><span class="n">Get</span><span class="p">().</span><span class="n">GetAssets</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span><span class="w"> </span><span class="n">AssetData</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply filter and get results</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FAssetData</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// loop thru found assets</span>
<span class="w">    </span><span class="n">Asset</span><span class="p">.</span><span class="n">PrintAssetData</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
Тут, для выбора ассетов, я использовал два фильтра - по классу <code>Filter.ClassPaths</code> и по пути <code>Filter.PackagePaths</code>.
Если запустить проект - в логе можно будет увидеть отчет по каждому файлу, найденному в папке.</p>
<p><a class="glightbox" href="../images/3e020408d4a85f3773e2d7e22048598c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3e020408d4a85f3773e2d7e22048598c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3e020408d4a85f3773e2d7e22048598c.png" /></a></p>
<p>К сожалению, такой лог не очень то читабельный. Поэтому лучше использовать такой код:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistryModule.h&quot;</span><span class="c1"> // Asset Registry</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistry/ARFilter.h&quot;</span><span class="c1"> // Asset Registry Filter</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// BeginPlay</span>
<span class="c1">// get assets of class UStaticMesh in folder /Game/LevelPrototyping/Meshes</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;=== Get Assets of class UStaticMesh in folder /Game/LevelPrototyping/Meshes ===&quot;</span><span class="p">));</span>
<span class="n">FAssetRegistryModule</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FModuleManager</span><span class="o">::</span><span class="n">LoadModuleChecked</span><span class="o">&lt;</span><span class="n">FAssetRegistryModule</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;AssetRegistry&quot;</span><span class="p">);</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FAssetData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetData</span><span class="p">;</span><span class="w"> </span><span class="c1">// This Array will contain our assets</span>
<span class="n">FARFilter</span><span class="w"> </span><span class="n">Filter</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assets will be filtered by this</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">ClassPaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UStaticMesh</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">());</span><span class="w"> </span><span class="c1">// add class to filter</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">PackagePaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;/Game/LevelPrototyping/Meshes&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// all location to filter</span>
<span class="n">Registry</span><span class="p">.</span><span class="n">Get</span><span class="p">().</span><span class="n">GetAssets</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span><span class="w"> </span><span class="n">AssetData</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply filter and get results</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FAssetData</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// loop thru found assets</span>
<span class="w">    </span><span class="c1">//Asset.PrintAssetData();</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AssetName: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Asset</span><span class="p">.</span><span class="n">AssetName</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/cd7a0bcf42580713dea04f6ca4a8d16a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cd7a0bcf42580713dea04f6ca4a8d16a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cd7a0bcf42580713dea04f6ca4a8d16a.png" /></a></p>
<blockquote>
<p>Если убрать фильтр по пути, можно получить список вообще всех ассетов <code>UStaticMesh</code> в проекте.</p>
</blockquote>
<h3 id="blueprint-uobjecttestclass">Получение списка <code>blueprint</code> классов, унаследованных от <code>UObjectTestClass</code></h3>
<p>Теперь получим список <code>blueprint</code> классов, унаследованных от <code>UObjectTestClass</code>. Проблема в том, что мы не можем использовать метод <code>::StaticClass()</code> для выявления <code>blueprint</code> ассетов. Например, следующий код выдаст пустой результат при попытке найти <code>blueprint</code> класы <code>UObjectTestClass</code> в проекте.
<div class="highlight"><pre><span></span><code><span class="n">FAssetRegistryModule</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FModuleManager</span><span class="o">::</span><span class="n">LoadModuleChecked</span><span class="o">&lt;</span><span class="n">FAssetRegistryModule</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;AssetRegistry&quot;</span><span class="p">);</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FAssetData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetData</span><span class="p">;</span><span class="w"> </span><span class="c1">// This Array will contain our assets</span>
<span class="n">FARFilter</span><span class="w"> </span><span class="n">Filter</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assets will be filtered by this</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">ClassPaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UObjectTestClass</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">());</span><span class="w"> </span><span class="c1">// add class to filter</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">bRecursiveClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// to include subclasses of given class</span>
<span class="n">Registry</span><span class="p">.</span><span class="n">Get</span><span class="p">().</span><span class="n">GetAssets</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span><span class="w"> </span><span class="n">AssetData</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply filter and get results</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Found Amount = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">AssetData</span><span class="p">.</span><span class="n">Num</span><span class="p">());</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FAssetData</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// loop thru found assets</span>
<span class="w">    </span><span class="c1">//Asset.PrintAssetData();</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AssetName: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Asset</span><span class="p">.</span><span class="n">AssetName</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="p">}</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;======&quot;</span><span class="p">));</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/5fddb0c3f8a4222ef9c00a1008030365.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5fddb0c3f8a4222ef9c00a1008030365.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5fddb0c3f8a4222ef9c00a1008030365.png" /></a></p>
<p>Единственный способ получить <code>blueprint</code> классы через фильтрование сводится к применению типа <code>UBlueprint</code> в фильтре. Это выдаст вообще все <code>blueprint</code> классы, которые потом можно отфильтровать в цикле, чтобы найти нужные нам.
<div class="highlight"><pre><span></span><code><span class="c1">// module</span>
<span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Core&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CoreUObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Engine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestModule&quot;</span><span class="p">});</span>
<span class="c1">//.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistryModule.h&quot;</span><span class="c1"> // Asset Registry</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistry/ARFilter.h&quot;</span><span class="c1"> // Asset Registry Filter</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ObjectTestClass.h&quot;</span><span class="c1"> // to access UObjectTestClass</span>
<span class="c1">//...</span>
<span class="c1">// .cpp</span>
<span class="c1">//BeginPlay</span>
<span class="c1">// get blueprint assets of class UObjectTestClass</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;=== Get Blueprint Assets of class UObjectTestClass ===&quot;</span><span class="p">));</span>
<span class="n">FAssetRegistryModule</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FModuleManager</span><span class="o">::</span><span class="n">LoadModuleChecked</span><span class="o">&lt;</span><span class="n">FAssetRegistryModule</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;AssetRegistry&quot;</span><span class="p">);</span>
<span class="n">IAssetRegistry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AssetRegistry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Registry</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FAssetData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetData</span><span class="p">;</span><span class="w"> </span><span class="c1">// This Array will contain our assets</span>
<span class="n">FARFilter</span><span class="w"> </span><span class="n">Filter</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assets will be filtered by this</span>
<span class="c1">// add blueprint class to filter, it will list us all the bp classes in project</span>
<span class="c1">// UBlueprint - for blueprint classes</span>
<span class="c1">// UWidgetBlueprint  - for bp widget classes</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">ClassPaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UBlueprint</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">());</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">bRecursiveClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// to include subclasses of given class</span>
<span class="c1">// in loop we will use this set to filter only blueprints with class UObjectTestClass</span>
<span class="n">TSet</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DerivedNames</span><span class="p">;</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">BaseNames</span><span class="p">;</span>
<span class="w">    </span><span class="n">BaseNames</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UObjectTestClass</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">());</span><span class="w"> </span><span class="c1">// we will search for UObjectTestClass</span>
<span class="w">    </span><span class="c1">//BaseNames.Add(AActor::StaticClass()-&gt;GetFName());</span>
<span class="w">    </span><span class="n">TSet</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Excluded</span><span class="p">;</span>
<span class="w">    </span><span class="n">AssetRegistry</span><span class="p">.</span><span class="n">GetDerivedClassNames</span><span class="p">(</span><span class="n">BaseNames</span><span class="p">,</span><span class="w"> </span><span class="n">Excluded</span><span class="p">,</span><span class="w"> </span><span class="n">DerivedNames</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">AssetRegistry</span><span class="p">.</span><span class="n">GetAssets</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span><span class="w"> </span><span class="n">AssetData</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply filter and get results</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Found Amount = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">AssetData</span><span class="p">.</span><span class="n">Num</span><span class="p">());</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FAssetData</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// loop thru found assets</span>
<span class="w">    </span><span class="c1">//Asset.PrintAssetData();</span>
<span class="w">    </span><span class="c1">//Asset.GetClass();</span>
<span class="w">    </span><span class="c1">//Asset.GetAsset();</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">GeneratedClassPathRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Asset</span><span class="p">.</span><span class="n">TagsAndValues</span><span class="p">.</span><span class="n">FindRef</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;GeneratedClass&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">GeneratedClassPathRef</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// it&#39;s not a blueprint</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ClassObjectPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPackageName</span><span class="o">::</span><span class="n">ExportTextPathToObjectPath</span><span class="p">(</span><span class="o">*</span><span class="n">GeneratedClassPathRef</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ClassName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPackageName</span><span class="o">::</span><span class="n">ObjectPathToObjectName</span><span class="p">(</span><span class="n">ClassObjectPath</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// skip blueprints that are not in list of DerivedNames</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">DerivedNames</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="o">*</span><span class="n">ClassName</span><span class="p">))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class Path: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">ClassObjectPath</span><span class="p">);</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class Name: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">ClassName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class Name Classic: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Asset</span><span class="p">.</span><span class="n">GetClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">());</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AssetName: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Asset</span><span class="p">.</span><span class="n">AssetName</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;======&quot;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
Используя данный код я нашел все <code>blueprint</code> потомки класса <code>UObjectTestClass</code> (он всего один, на данный момент).</p>
<p><a class="glightbox" href="../images/fbf9157813070142e1ac7beffdf63acc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fbf9157813070142e1ac7beffdf63acc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fbf9157813070142e1ac7beffdf63acc.png" /></a></p>
<p><a class="glightbox" href="../images/83cf62995daa8bec141125dad868c1ae.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="83cf62995daa8bec141125dad868c1ae.png" auto_="auto;" display="block;" margin:="margin:" src="../images/83cf62995daa8bec141125dad868c1ae.png" /></a></p>
<p>Обратите внимание на лог, а именно на строчку <code>Class Name Classic</code>, которая имеет значение <code>Blueprint</code>. Таким образом показано, что вы не можете взять класс у <code>blueprint</code> асета стандартным способом, через <code>Asset.GetClass()</code>. Класс <code>blueprint</code> ассета можно получить через параметр <code>GeneratedClass</code>.
Доступ к полю <code>GeneratedClass</code> можно получить через <code>TagsAndValues</code>:
<div class="highlight"><pre><span></span><code><span class="n">Asset</span><span class="p">.</span><span class="n">TagsAndValues</span><span class="p">.</span><span class="n">FindRef</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;GeneratedClass&quot;</span><span class="p">))</span>
</code></pre></div>
Полученная строчка возвращает ту-же самую ссылку, которую вы можете получить, кликнув по ассету правой кнопкой мыши <code>-&gt; Copy Refrence</code>.</p>
<p><a class="glightbox" href="../images/95022cfb8fe42b5b7d4e357dd99105fd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="95022cfb8fe42b5b7d4e357dd99105fd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/95022cfb8fe42b5b7d4e357dd99105fd.png" /></a></p>
<p>Далее эту строчку можно использовать в стандартном цикле загрузки ассета.</p>
<p>Так-же параметр <code>GeneratedClass</code> можно получить через приведение типа:
<div class="highlight"><pre><span></span><code><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">FoundBP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UBlueprint</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Asset</span><span class="p">.</span><span class="n">GetAsset</span><span class="p">());</span>
<span class="n">FoundBP</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span>
</code></pre></div>
В этом случае код будет выглядеть так:
<div class="highlight"><pre><span></span><code><span class="c1">// module</span>
<span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Core&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CoreUObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Engine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestModule&quot;</span><span class="p">});</span>
<span class="c1">//.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistryModule.h&quot;</span><span class="c1"> // Asset Registry</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistry/ARFilter.h&quot;</span><span class="c1"> // Asset Registry Filter</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ObjectTestClass.h&quot;</span><span class="c1"> // to access UObjectTestClass</span>
<span class="c1">//...</span>
<span class="c1">// .cpp</span>
<span class="c1">//BeginPlay</span>
<span class="c1">// get blueprint assets of class UObjectTestClass, with each found loading</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;=== Get Blueprint Assets of class UObjectTestClass using Cast ===&quot;</span><span class="p">));</span>
<span class="n">FAssetRegistryModule</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FModuleManager</span><span class="o">::</span><span class="n">LoadModuleChecked</span><span class="o">&lt;</span><span class="n">FAssetRegistryModule</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;AssetRegistry&quot;</span><span class="p">);</span>
<span class="n">IAssetRegistry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AssetRegistry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Registry</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FAssetData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetData</span><span class="p">;</span><span class="w"> </span><span class="c1">// This Array will contain our assets</span>
<span class="n">FARFilter</span><span class="w"> </span><span class="n">Filter</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assets will be filtered by this</span>
<span class="c1">// add blueprint class to filter, it will list us all the bp classes in project</span>
<span class="c1">// UBlueprint - for blueprint classes</span>
<span class="c1">// UWidgetBlueprint  - for bp widget classes</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">ClassPaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UBlueprint</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">());</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">bRecursiveClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// to include subclasses of given class</span>
<span class="c1">// in loop we will use this set to filter only blueprints with class UObjectTestClass</span>
<span class="n">TSet</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DerivedNames</span><span class="p">;</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">BaseNames</span><span class="p">;</span>
<span class="w">    </span><span class="n">BaseNames</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UObjectTestClass</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">());</span><span class="w"> </span><span class="c1">// we will search for UObjectTestClass</span>
<span class="w">    </span><span class="c1">//BaseNames.Add(AActor::StaticClass()-&gt;GetFName());</span>
<span class="w">    </span><span class="n">TSet</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Excluded</span><span class="p">;</span>
<span class="w">    </span><span class="n">AssetRegistry</span><span class="p">.</span><span class="n">GetDerivedClassNames</span><span class="p">(</span><span class="n">BaseNames</span><span class="p">,</span><span class="w"> </span><span class="n">Excluded</span><span class="p">,</span><span class="w"> </span><span class="n">DerivedNames</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">AssetRegistry</span><span class="p">.</span><span class="n">GetAssets</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span><span class="w"> </span><span class="n">AssetData</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply filter and get results</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Found Amount = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">AssetData</span><span class="p">.</span><span class="n">Num</span><span class="p">());</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FAssetData</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// loop thru found assets</span>
<span class="w">    </span><span class="c1">//Asset.PrintAssetData();</span>
<span class="w">    </span><span class="c1">//Asset.GetClass();</span>
<span class="w">    </span><span class="c1">//Asset.GetAsset();</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">FoundBP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UBlueprint</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Asset</span><span class="p">.</span><span class="n">GetAsset</span><span class="p">());</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">FoundBP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// it&#39;s not a blueprint</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ClassObjectPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPackageName</span><span class="o">::</span><span class="n">ExportTextPathToObjectPath</span><span class="p">(</span><span class="o">*</span><span class="n">FoundBP</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">().</span><span class="n">ToString</span><span class="p">());</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ClassName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPackageName</span><span class="o">::</span><span class="n">ObjectPathToObjectName</span><span class="p">(</span><span class="n">ClassObjectPath</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// skip blueprints that are not in list of DerivedNames</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">DerivedNames</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="o">*</span><span class="n">ClassName</span><span class="p">))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class Object Path: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">ClassObjectPath</span><span class="p">);</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class Name: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">ClassName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class Name Classic: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Asset</span><span class="p">.</span><span class="n">GetClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">());</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AssetName: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Asset</span><span class="p">.</span><span class="n">AssetName</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;======&quot;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/be5f13415e5f3f17a3984a751ffdd1d5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="be5f13415e5f3f17a3984a751ffdd1d5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/be5f13415e5f3f17a3984a751ffdd1d5.png" /></a></p>
<p>Такой подход  можно применять как для получения списка <code>UBlueprint</code> классов, так и для классов <code>UWidgetBlueprint</code>.
Важно учитывать тот факт, что в упакованной к релизу игре нет никаких <code>UBlueprint</code> ассетов. Там есть лишь объекты типа <code>UBlueprintGeneratedClass</code>. Поэтому в цикле, при фильтрации, мы не можем использовать <code>Asset.GetClass()</code> для сравнения классов. Вместо этого необходимо использовать информацию о том, какой именно <code>UBlueprintGeneratedClass</code> будет сгенерирован системой для текущего <code>blueprint</code> ассета. Эта информация может быть получена из тега <code>GeneratedClass</code>. Я получаю ее в строчке <code>Asset.TagsAndValues.FindRef(TEXT("GeneratedClass"))</code>. Эта строчка гарантирует, что код будет работать и в запакованном проекте.</p>
<h3 id="assetregistrysearchable">Фильтрование ассетов по значениям их параметров <code>AssetRegistrySearchable</code></h3>
<p>Некоторым параметрам классов можно сообщить свойство <code>AssetRegistrySearchable</code>, чтобы сделать эти параметры доступными для поиска через реестр ассетов.</p>
<p>Например я добавил такой параметр в наш <code>UObjectTestClass</code>:
<div class="highlight"><pre><span></span><code><span class="c1">// Allow asset registry to filter assets with this field using</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;AssetRegistryMark&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">AssetRegistrySearchable</span><span class="p">)</span>
<span class="kt">int</span><span class="w"> </span><span class="n">ParameterFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/af1cfb2817ea7507a708da5e750f2cc3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="af1cfb2817ea7507a708da5e750f2cc3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/af1cfb2817ea7507a708da5e750f2cc3.png" /></a></p>
<p>Значение параметра тоже важно. Мы можем фильтровать классы и по названию параметров и по их значению.</p>
<p>Делается это так.
<div class="highlight"><pre><span></span><code><span class="c1">// module</span>
<span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Core&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CoreUObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Engine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestModule&quot;</span><span class="p">});</span>
<span class="c1">//.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistryModule.h&quot;</span><span class="c1"> // Asset Registry</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AssetRegistry/ARFilter.h&quot;</span><span class="c1"> // Asset Registry Filter</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ObjectTestClass.h&quot;</span><span class="c1"> // to access UObjectTestClass</span>
<span class="c1">//...</span>
<span class="c1">// .cpp</span>
<span class="c1">//BeginPlay</span>
<span class="c1">// get assets by AssetRegistrySearchable TagsAndValues</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;=== Get Assets by AssetRegistrySearchable TagsAndValues ===&quot;</span><span class="p">));</span>
<span class="n">FAssetRegistryModule</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FModuleManager</span><span class="o">::</span><span class="n">LoadModuleChecked</span><span class="o">&lt;</span><span class="n">FAssetRegistryModule</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;AssetRegistry&quot;</span><span class="p">);</span>
<span class="n">IAssetRegistry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AssetRegistry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Registry</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FAssetData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetData</span><span class="p">;</span><span class="w"> </span><span class="c1">// This Array will contain our assets</span>
<span class="n">FARFilter</span><span class="w"> </span><span class="n">Filter</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assets will be filtered by this</span>
<span class="n">FString</span><span class="w"> </span><span class="n">ClassPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UObjectTestClass</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">().</span><span class="n">ToString</span><span class="p">();</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class Path: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">ClassPath</span><span class="p">);</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">TagsAndValues</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;ParameterFilter&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FString</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// ParameterName / Value</span>
<span class="c1">// To Allow asset registry filter assets by property field use it this way:</span>
<span class="c1">// UPROPERTY(EditAnywhere, Category = &quot;AssetRegistryMark&quot;, AssetRegistrySearchable)</span>
<span class="c1">// int ParameterFilter = 0;</span>
<span class="n">AssetRegistry</span><span class="p">.</span><span class="n">GetAssets</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span><span class="w"> </span><span class="n">AssetData</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply filter and get results</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FAssetData</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// loop thru found assets</span>
<span class="w">    </span><span class="c1">//Asset.PrintAssetData();</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AssetName: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Asset</span><span class="p">.</span><span class="n">AssetName</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="p">}</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;======&quot;</span><span class="p">));</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/f8586bb65e6d1bb3406f5c57e6d7aa87.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f8586bb65e6d1bb3406f5c57e6d7aa87.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f8586bb65e6d1bb3406f5c57e6d7aa87.png" /></a></p>
<p>Если в строке фильтра <code>Filter.TagsAndValues.Add(FName("ParameterFilter"), FString("0"))</code> установить значение <code>FString("0")</code>, например в <code>FString("1")</code>, то код ничего не найдет.</p>
<p><a class="glightbox" href="../images/0ae0a94489790063506ebb337c3e43ad.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0ae0a94489790063506ebb337c3e43ad.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0ae0a94489790063506ebb337c3e43ad.png" /></a></p>
<p><a class="glightbox" href="../images/361f63a3b19566cf29a22044fc4712a6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="361f63a3b19566cf29a22044fc4712a6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/361f63a3b19566cf29a22044fc4712a6.png" /></a></p>
<p>Но! Если копировать <code>blueprint</code> ассет с этим параметром, зайти туда и поставить значение 1 для строки <code>ParameterFilter</code>, то файл будет найден.</p>
<p><a class="glightbox" href="../images/e5bea4f96199bceb836f2a5e3a4dadf5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e5bea4f96199bceb836f2a5e3a4dadf5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e5bea4f96199bceb836f2a5e3a4dadf5.png" /></a></p>
<p><a class="glightbox" href="../images/1fbcbf1edf32ee1378162851cc8cc2f6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1fbcbf1edf32ee1378162851cc8cc2f6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1fbcbf1edf32ee1378162851cc8cc2f6.png" /></a></p>
<p><a class="glightbox" href="../images/ae02881306375e280ec5771fe9962877.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ae02881306375e280ec5771fe9962877.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ae02881306375e280ec5771fe9962877.png" /></a></p>
<p>Используя метки типа <code>AssetRegistrySearchable</code> можно очень эффективно работать с ассетами данных <code>UPrimaryDataAsset</code> и виджетами.</p>
<h3 id="blueprint">Реестр ассетов в <code>blueprint</code> коде</h3>
<p>В <code>blueprint</code> коде есть глобальная нода <code>AssetRegistry</code>, которую можно вызвать из любого места.</p>
<p><a class="glightbox" href="../images/1a3ef94e0b651076bc85d24980b76ce5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1a3ef94e0b651076bc85d24980b76ce5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1a3ef94e0b651076bc85d24980b76ce5.png" /></a></p>
<p>Однако возможности <code>blueprint</code> интерфейса сильно ограничены. Например там нельзя создать <code>literal class name</code>, что создает проблемы при задании параметров дял структур типа <code>TopLevelAssetPath</code>.</p>
<h3 id="blueprint-actor">Спавн всех <code>blueprint</code> <code>Actor'ов</code> в папке</h3>
<p>Помимо умения искать ассеты на диске, не менее важно понимать, как их использовать.</p>
<p>Давайте заспавним перед нашим персонажем <code>blueprint</code> классы, унаследованные от <code>UObjectTestClass</code>, найденные в папке <code>/Game/Characters</code> .
<div class="highlight"><pre><span></span><code><span class="c1">// spawn all Actor blueprint assets in folder /Game/Characters</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;=== Spawn All Actor Blueprint Assets in folder /Game/Characters ===&quot;</span><span class="p">));</span>
<span class="n">FAssetRegistryModule</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Registry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FModuleManager</span><span class="o">::</span><span class="n">LoadModuleChecked</span><span class="o">&lt;</span><span class="n">FAssetRegistryModule</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;AssetRegistry&quot;</span><span class="p">);</span>
<span class="n">IAssetRegistry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AssetRegistry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Registry</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FAssetData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetData</span><span class="p">;</span><span class="w"> </span><span class="c1">// This Array will contain our assets</span>
<span class="n">FARFilter</span><span class="w"> </span><span class="n">Filter</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assets will be filtered by this</span>
<span class="c1">// add blueprint class to filter, it will list us all the bp classes in project</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">ClassPaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">UBlueprint</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">());</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">PackagePaths</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;/Game/Characters&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// only spawn actors in this area</span>
<span class="n">Filter</span><span class="p">.</span><span class="n">bRecursiveClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// to include subclasses of given class</span>
<span class="c1">// in loop we will use this set to filter only blueprints with class UObjectTestClass</span>
<span class="n">TSet</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DerivedNames</span><span class="p">;</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BaseNames</span><span class="p">;</span>
<span class="w">    </span><span class="n">BaseNames</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">AActor</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">());</span><span class="w"> </span><span class="c1">// we will search for all AActor&#39;s</span>
<span class="w">    </span><span class="n">TSet</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Excluded</span><span class="p">;</span>
<span class="w">    </span><span class="n">AssetRegistry</span><span class="p">.</span><span class="n">GetDerivedClassNames</span><span class="p">(</span><span class="n">BaseNames</span><span class="p">,</span><span class="w"> </span><span class="n">Excluded</span><span class="p">,</span><span class="w"> </span><span class="n">DerivedNames</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">AssetRegistry</span><span class="p">.</span><span class="n">GetAssets</span><span class="p">(</span><span class="n">Filter</span><span class="p">,</span><span class="w"> </span><span class="n">AssetData</span><span class="p">);</span><span class="w"> </span><span class="c1">// apply filter and get results</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Found Amount = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">AssetData</span><span class="p">.</span><span class="n">Num</span><span class="p">());</span>
<span class="kt">int</span><span class="w"> </span><span class="n">NumberSpawned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// spawned actors count</span>
<span class="k">for</span><span class="p">(</span><span class="n">FAssetData</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// loop thru found assets</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">FoundBP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UBlueprint</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Asset</span><span class="p">.</span><span class="n">GetAsset</span><span class="p">());</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">FoundBP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// it&#39;s not a blueprint</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ClassObjectPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPackageName</span><span class="o">::</span><span class="n">ExportTextPathToObjectPath</span><span class="p">(</span><span class="o">*</span><span class="n">FoundBP</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span><span class="o">-&gt;</span><span class="n">GetClassPathName</span><span class="p">().</span><span class="n">ToString</span><span class="p">());</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ClassName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPackageName</span><span class="o">::</span><span class="n">ObjectPathToObjectName</span><span class="p">(</span><span class="n">ClassObjectPath</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// skip blueprints that are not in list of DerivedNames</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">DerivedNames</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="o">*</span><span class="n">ClassName</span><span class="p">))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// spawn found actors</span>
<span class="w">    </span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetOwner</span><span class="p">();</span>
<span class="w">    </span><span class="n">FActorSpawnParameters</span><span class="w"> </span><span class="n">SpawnParams</span><span class="p">;</span>
<span class="w">    </span><span class="n">SpawnParams</span><span class="p">.</span><span class="n">Owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Owner</span><span class="p">;</span>
<span class="w">    </span><span class="n">SpawnParams</span><span class="p">.</span><span class="n">Instigator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Owner</span><span class="o">-&gt;</span><span class="n">GetInstigator</span><span class="p">();</span>
<span class="w">    </span><span class="n">SpawnParams</span><span class="p">.</span><span class="n">bNoFail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">SpawnParams</span><span class="p">.</span><span class="n">SpawnCollisionHandlingOverride</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ESpawnActorCollisionHandlingMethod</span><span class="o">::</span><span class="n">AdjustIfPossibleButAlwaysSpawn</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// spawn location</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">CLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Owner</span><span class="o">-&gt;</span><span class="n">GetActorForwardVector</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">120</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// on front of owner</span>
<span class="w">                        </span><span class="n">Owner</span><span class="o">-&gt;</span><span class="n">GetActorRightVector</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NumberSpawned</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// offset on right based on NumberSpawned to form line</span>
<span class="w">                        </span><span class="n">Owner</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">    </span><span class="n">World</span><span class="o">-&gt;</span><span class="n">SpawnActor</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FoundBP</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span><span class="p">,</span><span class="w"> </span><span class="n">CLocation</span><span class="p">,</span><span class="w"> </span><span class="n">Owner</span><span class="o">-&gt;</span><span class="n">GetActorRotation</span><span class="p">(),</span><span class="w"> </span><span class="n">SpawnParams</span><span class="p">);</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[%i] Actor Spawned: %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">NumberSpawned</span><span class="p">,</span><span class="o">*</span><span class="n">ClassObjectPath</span><span class="p">);</span>
<span class="w">    </span><span class="n">NumberSpawned</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="c1">// increment offset</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;======&quot;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
Конкретно в данный момент у меня в папке <code>/Game/Characters</code> всего два <code>AActor'а</code>.</p>
<p><a class="glightbox" href="../images/5f8990f89e8e2b0002822eb37510878b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5f8990f89e8e2b0002822eb37510878b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5f8990f89e8e2b0002822eb37510878b.png" /></a></p>
<p>Приведенный выше код заспавнит оба этих <code>Actor'а</code> перед персонажем игрока, с отступом вперед в 120 см и вправо в 100 см.</p>
<p><a class="glightbox" href="../images/536f4640bac2893590f1c31aa62cadbe.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="536f4640bac2893590f1c31aa62cadbe.png" auto_="auto;" display="block;" margin:="margin:" src="../images/536f4640bac2893590f1c31aa62cadbe.png" /></a></p>
<p><a class="glightbox" href="../images/471f72a0c3e5f987ad722ba78bc18df0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="471f72a0c3e5f987ad722ba78bc18df0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/471f72a0c3e5f987ad722ba78bc18df0.png" /></a></p>
<h2 id="asset-manager">Asset Manager или менеджер ассетов</h2>
<p>Asset Manager - это встроенная в движок Unreal система индексации ассетов в файловой системе. Данная система является надстройкой над реестром ассетов. Она предоставляет удобный набор <code>blueprint</code> функций для работы ассетов, их загрузки и выгрузки.</p>
<h3 id="_6">Проблемы менеджера ассетов</h3>
<p>Проблемы менеджера ассетов вытекают из двух вещей: непонятной документации и устаревшей лекции на ютубе по этой системе. Менеджер ассетов появился в <code>Unreal Engine 4.17</code>, а сейчас <code>Unreal Engine 5</code>. За столь длительный промежуток система преобразилась в лучшую сторону. И там, где раньше люди вручную добавляли методы асинхронной загрузки ассетов, сегодня вручную делать уже ничего не надо.</p>
<p>Все уже сделано за нас.</p>
<p><a class="glightbox" href="../images/68f642dff89c66e4ed472200fa4d037c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="68f642dff89c66e4ed472200fa4d037c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/68f642dff89c66e4ed472200fa4d037c.png" /></a></p>
<p>Но об этом почти никто не знает. Поэтому, большая часть этой статьи будет посвящена раскрытию предназначения системы <code>AssetManager</code> на примерах.</p>
<p>Наиболее подробное объяснение принципов работы <code>Asset Manager'а</code> мне удалось найти в <code>.pdf</code> файле с документацией, он приложен к книге, в секции (дополнительные материалы). Так-же скачать файл документации можно <a href="https://forums.unrealengine.com/t/no-editor-game-hanging-on-splash-screen-constructorhelpers-fobjectfinder-skeletalmesh-is-null/94356/2?u=alexanderst">на форуме Unreal Engine.</a></p>
<p>Отмечу, что приведенная выше документация мне скорее навредила, чем помогла.</p>
<p>Согласно сему мудрому(от слова муд) талмуду(тоже от слова муд), менеджер ассетов может работать лишь с классами, у которых переопределен метод <code>GetPrimaryAssetId</code>.
Хороше, подумал я, открыл класс <code>UObjectTestClass</code> (мы писали его в одной из ранних статей) и переопределил вышеуказанный метод.
<div class="highlight"><pre><span></span><code><span class="k">virtual</span><span class="w"> </span><span class="n">FPrimaryAssetId</span><span class="w"> </span><span class="nf">GetPrimaryAssetId</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">FPrimaryAssetId</span><span class="w"> </span><span class="n">AssetId</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;UObjects&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">GetFName</span><span class="p">());</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">AssetId</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Теперь я иду в <code>blueprint</code> редактор и скармливаю экземпляр этого <code>UObject</code> класса узлу <code>Get Primary Asset Id from Class</code>.
В моем понимании, этот узел долежен вызвать функцию <code>GetPrimaryAssetId</code> у класса <code>UObjectTestClass</code> и вернуть ее результаты.</p>
<p><a class="glightbox" href="../images/9af74d23e60c477906577e7616906e29.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9af74d23e60c477906577e7616906e29.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9af74d23e60c477906577e7616906e29.png" /></a></p>
<p>Но если протестировать такой код то мы ничего не получим. Вообще ничего.</p>
<p><a class="glightbox" href="../images/6560cacf623032205955f8944381d178.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6560cacf623032205955f8944381d178.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6560cacf623032205955f8944381d178.png" /></a></p>
<p>Ни сообщений об ошибке, ни предупреждений, ничего. Понимай как хочешь.</p>
<p>Причем, можно прочитать миллион статей других авторов в интернете, а я это упорно делал, но все равно не понять какого хрена этот код не работает.</p>
<p>И знаете. Если бы я не разобрался тогда, этой статьи бы вообще небыло. В какой-то момент я решил, что система <code>Asset Manager</code> вообще не работает в текущей версии Unreal Engine из-за бага или кривого переноса (кто ее знает). Но все оказалось куда интереснее.</p>
<p>На странице настроек проекта <code>Edit -&gt; Project Settings</code> можно найти пункт <code>Asset Manager</code>.</p>
<p><a class="glightbox" href="../images/4af6fbef98ce981f4d48ed580cf35d34.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4af6fbef98ce981f4d48ed580cf35d34.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4af6fbef98ce981f4d48ed580cf35d34.png" /></a></p>
<p>Открыв этот пункт меню можно увидеть настройки для сканирования ключей ассетов - <code>Primary Asset Types to Scan</code>.</p>
<p><a class="glightbox" href="../images/47bf9fd53fe26aad6b4f2a26065bbd27.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="47bf9fd53fe26aad6b4f2a26065bbd27.png" auto_="auto;" display="block;" margin:="margin:" src="../images/47bf9fd53fe26aad6b4f2a26065bbd27.png" /></a></p>
<blockquote>
<p>Классы, которые возвращают <code>GetPrimaryAssetId</code>, добавляются в <code>Asset Manager</code>, при условии, что возвращаемое значение функции <code>GetPrimaryAssetId</code> присутствует в списке ключей.</p>
</blockquote>
<p>То есть: не достаточно переопределить метод <code>GetPrimaryAssetId</code>, надо еще и сделать так, чтобы ключ, который этот метод возвращает, присутствовал в списке <code>Primary Asset Types to Scan</code>.
Об этом "незначительной" детали нет ни единого слова ни в одном из материалов, которые мне довелось изучить. Я узнал об этой особенности случайно, когда прочитал комментарий к классу <code>UPrimaryDataAsset</code>.
Приведенный выше <code>blueprint</code> код заработал, как только я добавил ключ <code>UObjects</code> в список <code>Primary Asset Types to Scan</code>, а так-же указал, что этот тип <code>Has Blueprint Classes</code>.</p>
<p><a class="glightbox" href="../images/01dfb49e5ac95b07d7e7be19ffadd91b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="01dfb49e5ac95b07d7e7be19ffadd91b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/01dfb49e5ac95b07d7e7be19ffadd91b.png" /></a></p>
<p><a class="glightbox" href="../images/87467bedf246406547bc51c3c05fbd9f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="87467bedf246406547bc51c3c05fbd9f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/87467bedf246406547bc51c3c05fbd9f.png" /></a></p>
<p><a class="glightbox" href="../images/94a5b7686856e045ace7a12e6b34c2f5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="94a5b7686856e045ace7a12e6b34c2f5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/94a5b7686856e045ace7a12e6b34c2f5.png" /></a></p>
<p>Теперь, когда нам стало понятно, как заставить <code>Asset Manager</code> работать, можно приступать к изучению его особенностей и принципов. А так-же к объяснению того, зачем он вообще нужен.</p>
<h3 id="asset-manager_1">Основные  принципы системы <code>Asset Manager</code></h3>
<p>Основная суть системы <code>Asset Manager</code> может быть изложена следующим образом: это высокоуровневый настраиваемый интерфейс индексации игровых ассетов.</p>
<p>Важно понимать, что эта система, в большей степени ориентирована на <code>blueprint</code> составляющую движка, где предоставляет удобный способ асинхронной загрузки ассетов и работы с ними.</p>
<p><a class="glightbox" href="../images/06d80d193ba9d13c9b0c5956c41932aa.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="06d80d193ba9d13c9b0c5956c41932aa.png" auto_="auto;" display="block;" margin:="margin:" src="../images/06d80d193ba9d13c9b0c5956c41932aa.png" /></a></p>
<p>Если кликнуть на параметр <code>Primary Asset Id</code>, например, у <code>blueprint</code> узла <code>Get Objects from Primary Asset Id</code> можно увидеть список присутствующих в системе первичных ассетов.</p>
<p><a class="glightbox" href="../images/d4510192d433d3728b80665dd09d0ac1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d4510192d433d3728b80665dd09d0ac1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d4510192d433d3728b80665dd09d0ac1.png" /></a></p>
<p>Это очень удобно. Бонусом идет возможность пройтись в цикле по всем первичным ассетам какой-либо категории, например - <code>UObjects</code>. Для этого используется <code>blueprint</code> узел <code>Get Primary Asset Id List</code>.</p>
<p><a class="glightbox" href="../images/cc8f249d548327f499970831c63a37b3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cc8f249d548327f499970831c63a37b3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cc8f249d548327f499970831c63a37b3.png" /></a></p>
<p><a class="glightbox" href="../images/9b70b70f09c8c610b88cfe634dcf6f63.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9b70b70f09c8c610b88cfe634dcf6f63.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9b70b70f09c8c610b88cfe634dcf6f63.png" /></a></p>
<p>С менеджером ассетов можно работать и из<code>c++</code> но основа мощного функционала этой системы вынесена именно в <code>blueprint</code> код. На стороне с++ мы можем расширить возможности класса <code>AssetManager</code>, добавив дополнительный функционал или изменив существующий.</p>
<h4 id="_7">Переопределение менеджера ассетов</h4>
<p>Класс <code>AssetManager'а</code>, который используется в системе "по умолчанию", можно переопределить в настройках движка по пути <code>Edit -&gt; Project Settings -&gt; General Settings -&gt; Default Classes -&gt; Asset Manager</code>.</p>
<p><a class="glightbox" href="../images/9a8412f0587d0f6d62bb2c3ac414150c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9a8412f0587d0f6d62bb2c3ac414150c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9a8412f0587d0f6d62bb2c3ac414150c.png" /></a></p>
<p>Сам класс менеджера ассеов можно найти по пути <code>Runtime\Engine\Classes\Engine\AssetManager.h</code>.</p>
<p><a class="glightbox" href="../images/873b2eaf9c6d006caed9fa0a2be7cfad.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="873b2eaf9c6d006caed9fa0a2be7cfad.png" auto_="auto;" display="block;" margin:="margin:" src="../images/873b2eaf9c6d006caed9fa0a2be7cfad.png" /></a></p>
<p>Переопределение этого класса позволяет создать собственные первичные типы ассетов <code>Primary Asset Types</code>, а так-же изменить или дополнить логику имеющихся в классе методов.</p>
<p>Идем в <code>Tools -&gt; New C++ Class -&gt; All Classes</code> и ищем в списке <code>AssetManager</code>.</p>
<p><a class="glightbox" href="../images/96d7281bfeb1c1098028a53cdce60859.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="96d7281bfeb1c1098028a53cdce60859.png" auto_="auto;" display="block;" margin:="margin:" src="../images/96d7281bfeb1c1098028a53cdce60859.png" /></a></p>
<p>Называем класс <code>DataModuleAssetManager</code>, размещаем его в модуле <code>DataAccess</code>.</p>
<p><a class="glightbox" href="../images/4a895558a821dd8733f68a4db8e4643d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4a895558a821dd8733f68a4db8e4643d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4a895558a821dd8733f68a4db8e4643d.png" /></a></p>
<p>После добавления класса не забудьте обновить проект через <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/dbd5586eeda28d34e7ac39e2224f5c27.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dbd5586eeda28d34e7ac39e2224f5c27.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dbd5586eeda28d34e7ac39e2224f5c27.png" /></a></p>
<p>Теперь давайте используем этот класс для добавления собственного <code>PrimaryAssetType</code>.
Делается это через <code>static const</code> переменные в теле класса. Так-же придется написать код, добавляющий эти переменные в <code>PrimaryAssetTypesToScan</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/AssetManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/AssetManagerSettings.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DataModuleAssetManager.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Custom Asset Manager class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DATAACCESS_API</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UAssetManager</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">UDataModuleAssetManager</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PostInitProperties</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Return true if PrimaryAssetTypesToScan has PrimaryAssetType == Type</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">HasAssetTypeN</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">Type</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Inventory Item Groups</span>
<span class="w">    </span><span class="c1">// item group for abilities</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">AbilityItemGroup</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// item group for equippables</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">ArmorItemGroup</span><span class="p">;</span><span class="w"> </span><span class="c1">// pauldrons, helmets..., will have stats for strength and others</span>
<span class="w">    </span><span class="c1">// item group for consumables</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">ConsumableItemGroup</span><span class="p">;</span><span class="w"> </span><span class="c1">// potions, magic scrolls..., will be stackable</span>
<span class="w">    </span><span class="c1">// item group for weapons</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">WeaponItemGroup</span><span class="p">;</span><span class="w"> </span><span class="c1">// swords, bows, shields ..., will have stats for damage</span>
<span class="w">    </span><span class="c1">// item group for buildable stuff</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">BuildableItemGroup</span><span class="p">;</span><span class="w"> </span><span class="c1">// floor, walls..., will be stackable and can be build</span>
<span class="w">    </span><span class="c1">// item group for containers</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">ContainerItemGroup</span><span class="p">;</span><span class="w"> </span><span class="c1">// containers, chests..., will have inventory size related parameters</span>
<span class="w">    </span><span class="c1">// item group for books</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">TextItemGroup</span><span class="p">;</span><span class="w"> </span><span class="c1">// will have text field, usefull for books, scrolls, letters</span>
<span class="w">    </span><span class="c1">// Returns the current AssetManager with applied type</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">Get</span><span class="p">();</span><span class="w"> </span><span class="c1">// *note override can&#39;t be applied to static functions</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Since Static Const class members can&#39;t have &quot;in class initialisation&quot;, we should initialize them in global scope</span>
<span class="c1">// it&#39;s ok, integrated Primary Asset Type - UAssetManager::MapType initialized same way</span>
<span class="c1">// this anyway will be avaivible in the constructor with it&#39;s value properly set</span>
<span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">AbilityItemGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AbilityItemGroup&quot;</span><span class="p">));</span>
<span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ArmorItemGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ArmorItemGroup&quot;</span><span class="p">));</span>
<span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ConsumableItemGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ConsumableItemGroup&quot;</span><span class="p">));</span>
<span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">WeaponItemGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;WeaponItemGroup&quot;</span><span class="p">));</span>
<span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">BuildableItemGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;BuildableItemGroup&quot;</span><span class="p">));</span>
<span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ContainerItemGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ContainerItemGroup&quot;</span><span class="p">));</span>
<span class="k">const</span><span class="w"> </span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">TextItemGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;TextItemGroup&quot;</span><span class="p">));</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UDataModuleAssetManager::PostInitProperties</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UAssetManager</span><span class="o">::</span><span class="n">PostInitProperties</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="c1">// Register our custom types in Asset Manager</span>
<span class="w">    </span><span class="c1">// GetMutableDefault can be used here instead</span>
<span class="w">    </span><span class="n">UAssetManagerSettings</span><span class="o">*</span><span class="w"> </span><span class="n">Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UAssetManagerSettings</span><span class="o">&gt;</span><span class="p">(</span><span class="n">UAssetManagerSettings</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetDefaultObject</span><span class="p">());</span>
<span class="w">    </span><span class="cm">/* my test code, leaving it for you as refrence</span>
<span class="cm">    SFName TypeName = TEXT(&quot;TestPrimaryType&quot;);</span>
<span class="cm">    for (FPrimaryAssetTypeInfo Info : Settings-&gt;PrimaryAssetTypesToScan) {</span>
<span class="cm">        if (Info.PrimaryAssetType == TypeName) {</span>
<span class="cm">            return; // don&#39;t add config if already exist</span>
<span class="cm">        }</span>
<span class="cm">    }</span>
<span class="cm">    Settings-&gt;PrimaryAssetTypesToScan.Add(FPrimaryAssetTypeInfo{TypeName ,</span>
<span class="cm">        AActor::StaticClass(),</span>
<span class="cm">        true,</span>
<span class="cm">        false,</span>
<span class="cm">        TArray&lt;FDirectoryPath&gt;( { FDirectoryPath{ TEXT(&quot;/Game/Characters&quot;) } } ),</span>
<span class="cm">        TArray&lt;FSoftObjectPath&gt;({})</span>
<span class="cm">    });*/</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">AbilityItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">AbilityItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="n">UAbilityItemGroup</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ArmorItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ArmorItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="c1">// no type yet</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ConsumableItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ConsumableItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="c1">// no type yet</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">WeaponItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">WeaponItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="c1">// no type yet</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">BuildableItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">BuildableItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="c1">// no type yet</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ContainerItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">ContainerItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="c1">// no type yet</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">TextItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">TextItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="c1">// no type yet</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// We don&#39;t need to save. Setting will appear anyway.</span>
<span class="w">    </span><span class="c1">// Benefits from not saving - setting will be removed if asset manager class is removed</span>
<span class="w">    </span><span class="c1">// if you edit any added asettings edition results will be saved automatically</span>
<span class="w">    </span><span class="c1">//Settings-&gt;SaveConfig();</span>
<span class="p">}</span>
<span class="c1">// Return true if PrimaryAssetTypesToScan has PrimaryAssetType == Type</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">UDataModuleAssetManager::HasAssetTypeN</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">Type</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UAssetManagerSettings</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSettings</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Settings</span><span class="p">.</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">PrimaryAssetType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Asset Manager singleton getter</span>
<span class="n">UDataModuleAssetManager</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">UDataModuleAssetManager::Get</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UDataModuleAssetManager</span><span class="o">*</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UDataModuleAssetManager</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">AssetManager</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">This</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">This</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Invalid AssetManager in DefaultEngine.ini, must be UDataModuleAssetManager!&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">NewObject</span><span class="o">&lt;</span><span class="n">UDataModuleAssetManager</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
После компиляции кода необходимо переопределить встроенный менеджер ассетов перейдя по пути <code>Edit -&gt; Project Settings -&gt; General Settings -&gt; Default Classes -&gt; Asset Manager</code>.</p>
<p><a class="glightbox" href="../images/4a94357583ca6ee86510fe2bd57aeaf0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4a94357583ca6ee86510fe2bd57aeaf0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4a94357583ca6ee86510fe2bd57aeaf0.png" /></a></p>
<p>Однако, переопределения не достаточно, чтобы первичные типы ассетов были зарегистрированы. Закройте движок, удалите папку <code>Binaries</code> в проекте и пересоберите его целиком.</p>
<p><a class="glightbox" href="../images/b75e31239b5537eefcce55d882246468.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b75e31239b5537eefcce55d882246468.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b75e31239b5537eefcce55d882246468.png" /></a></p>
<p>После этого на странице <code>Edit -&gt; Project Settings -&gt; Asset Manager</code> вы увидите добавленные первичные типы ассетов.</p>
<p><a class="glightbox" href="../images/7c1c4df8b46df3adb4c8c72180910449.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7c1c4df8b46df3adb4c8c72180910449.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7c1c4df8b46df3adb4c8c72180910449.png" /></a></p>
<p>В коде я указал группы предметов. Поясню почему группы. Я до этого уже разрабатывал две системы инвентаря и скажу, что не достаточно просто делить предметы по типам. Нужны еще и группы, которые объединяют между собой предметы одного типа. Например зелья маны и куски сыра будут иметь схожий функционал взаимодействия, но разные типы предметов, куски сыра это еда, а зелья маны - эликсиры. Поэтому во многих играх помимо дифференциации предметов по типам используется еще и группировка.</p>
<h4 id="_8">Важное дополнение</h4>
<p>Обратите внимание на сочетание имени ассета и его класса.
<div class="highlight"><pre><span></span><code><span class="c1">// name</span>
<span class="n">AbilityItemGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AbilityItemGroup&quot;</span><span class="p">))</span>
<span class="c1">//...</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">AbilityItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">AbilityItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="n">UAbilityItemGroup</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
</code></pre></div>
Класс <code>UAbilityItemGroup</code> и имя <code>AbilityItemGroup</code>. 
Они должны "совпадать", разумеется, без наличия буквы <code>U</code>.</p>
<p>Если имя ассета будет отличаться от типа, который используется, то <code>AssetManager</code> не будет работать корректно.</p>
<blockquote>
<p>Вы не можете использовать любые имена для названий <code>Primary Asset Types</code>. Имя должно совпадать с классом, за вычетом буквы <code>U</code>.</p>
</blockquote>
<p><a class="glightbox" href="../images/2207441.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="2207441.png" src="../images/2207441.png" /></a></p>
<h4 id="_9">Использование менеджера ассетов через синглтон</h4>
<p>Давайте используем менеджер ассетов из нашего компонента <code>UDataAccessComponent</code>. Для этого достаточно вывзвать синглтон:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/AssetManager.h&quot;</span><span class="c1"> // don&#39;t forget to include first</span>
<span class="c1">//...</span>
<span class="n">UAssetManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UAssetManager</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
</code></pre></div>
Или, в случае с пользовательским классом менеджера ассетов:
<div class="highlight"><pre><span></span><code><span class="c1">// module dependency: DataAccess</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DataModuleAssetManager.h&quot;</span><span class="c1"> // don&#39;t forget to include first</span>
<span class="c1">//...</span>
<span class="n">UDataModuleAssetManager</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
</code></pre></div>
Далее мы можем, например, получить список ассетов из определенной категории. Поскольку у меня, в данный момент, не создано ни одного <code>PrimaryDataAsset'а</code> для групп предметов, я выведу просто список карт <code>UWorld</code> в папке <code>/Game/Maps</code>. Их у меня две.</p>
<p><a class="glightbox" href="../images/d933f5674598e2f077530467d536042b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d933f5674598e2f077530467d536042b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d933f5674598e2f077530467d536042b.png" /></a></p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DataModuleAssetManager.h&quot;</span>
<span class="c1">//...</span>
<span class="c1">// BeginPlay</span>
<span class="c1">// working with asset manager from c++</span>
<span class="n">UDataModuleAssetManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Bundles</span><span class="p">{</span><span class="w"> </span><span class="s">&quot;/Game/Maps/&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FPrimaryAssetId</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">;</span>
<span class="n">Manager</span><span class="p">.</span><span class="n">GetPrimaryAssetIdList</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">MapType</span><span class="p">,</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">);</span>
<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Array Size = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">.</span><span class="n">Num</span><span class="p">());</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FPrimaryAssetId</span><span class="w"> </span><span class="n">AssetId</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FStreamableHandle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MapHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Manager</span><span class="p">.</span><span class="n">LoadPrimaryAsset</span><span class="p">(</span><span class="n">AssetId</span><span class="p">,</span><span class="w"> </span><span class="n">Bundles</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MapHandle</span><span class="o">-&gt;</span><span class="n">WaitUntilComplete</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EAsyncPackageState</span><span class="o">::</span><span class="n">Complete</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UWorld</span><span class="o">*</span><span class="w"> </span><span class="n">MapAsset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UWorld</span><span class="o">&gt;</span><span class="p">(</span><span class="n">MapHandle</span><span class="o">-&gt;</span><span class="n">GetLoadedAsset</span><span class="p">());</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Found Map Name = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">MapAsset</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">().</span><span class="n">ToString</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><a class="glightbox" href="../images/d3412371c76cfa50ec93840259fe2e6f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d3412371c76cfa50ec93840259fe2e6f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d3412371c76cfa50ec93840259fe2e6f.png" /></a></p>
<p>Учтите, что указанный выше код не сработает, пока вы не перезапустите движок.</p>
<h3 id="_10">Первичные и вторичные ассеты</h3>
<p>Основной функционал системы <code>Asset Manager</code> строится вокруг двух категорий ассетов: перивичные <code>primary</code> и вторичные <code>secondary</code>.
Первичными являются те ассеты, которые разработчик добавил в список <code>Primary Asset Types to Scan</code> на странице настроек <code>Edit-&gt;Project Settings -&gt; Asset Manager</code>.</p>
<p><a class="glightbox" href="../images/9187de690b713bf4a195ec0b80957b1f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9187de690b713bf4a195ec0b80957b1f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9187de690b713bf4a195ec0b80957b1f.png" /></a></p>
<p>Ассеты, которые не добавлены в список перивичных - считаются вторичными.</p>
<p>Старая документация говорит, что первичным ассетом может быть лишь класс, в котором переопределен метод <code>GetPrimaryAssetId</code>. К сожалению, это не так, перечитайте главу "Проблемы менеджера ассетов", в которой я рассмотрел поведение менеджера ассетов по отношению к классам, у которых реализован <code>GetPrimaryAssetId</code>. Менеджер ассетов не замечает такие классы, пока вы не добавите их, собственными руками, в список <code>Primary Asset Types to Scan</code>.
Чтобы понять, почему так происходит, рассмотрим реализацию метода <code>GetPrimaryAssetId</code> у базового, для всех ассетов, класса <code>UObject</code>. Найти код можно в файле <code>\Runtime\CoreUObject\Private\UObject\Obj.cpp</code>.</p>
<p><a class="glightbox" href="../images/f61ffc965eff7b01f76e7c82a171ebe1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f61ffc965eff7b01f76e7c82a171ebe1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f61ffc965eff7b01f76e7c82a171ebe1.png" /></a></p>
<p>Обратите особое внимание на строчку <code>FCoreUObjectDelegates::GetPrimaryAssetIdForObject.IsBound()</code>.
Это делегат, к которому подключается <code>Asset Manager</code> в том случае, если ссылка на этот ассет указана в списке <code>Primary Asset Types To Scan</code>.
К делегату привязан метод <code>DeterminePrimaryAssetIdForObject</code>, который и определяет является ли ассет первичным или нет. Найти этот метод можно по пути <code>\Runtime\Engine\Private\AssetManager.cpp</code>.</p>
<p><a class="glightbox" href="../images/fe2379800ad47fc039daa29b99a4881c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fe2379800ad47fc039daa29b99a4881c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fe2379800ad47fc039daa29b99a4881c.png" /></a></p>
<p><a class="glightbox" href="../images/24278630ae2576249c903fc239c1166b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="24278630ae2576249c903fc239c1166b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/24278630ae2576249c903fc239c1166b.png" /></a></p>
<p>В этом методе путь до объекта сравнивается со списком первичных ассетов из настроек системы. Если путь не содержится в списке - объект не является первичным.</p>
<p>Таким образом: метод <code>GetPrimaryAssetId</code>, встроенный в любой <code>UObject</code> умный и сам понимает, отмечен класс в качестве первичного или нет.</p>
<p>Исключением из этого правила является единственный класс - <code>UPrimaryDataAsset</code>, каждый файл, унаследованный от этого класса, может быть использован лишь единственным способом - как отдельная категория в списке <code>Primary Asset Types To Scan</code>.</p>
<h3 id="primary-data-asset">Primary Data Asset</h3>
<p>Данный класс представляет из себя <code>DataAsset</code>, у которого переопределен метод <code>GetPrimaryAssetId</code>. Реализация этого метода внутри класса <code>UPrimaryDataAsset</code> использует имя файла в качестве типа ассета для <code>AssetManager</code> (<code>PrimaryAssetType</code>).</p>
<p><a class="glightbox" href="../images/1d039a629f35ff80e90a7de8ecdf41c8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1d039a629f35ff80e90a7de8ecdf41c8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1d039a629f35ff80e90a7de8ecdf41c8.png" /></a></p>
<p>Для <code>DataAsset'ов</code>, созданных на основе экземпляра <code>PrimaryDataAsset</code> категория <code>PrimaryAssetType</code> равна названию файла исходного экземпляра  <code>PrimaryDataAsset</code>.
Сам класс <code>UPrimaryDataAsset</code> является <code>abstract</code>, что не позволяет разработчикам создавать ассеты, унаследованные от этого класса, напрямую.</p>
<p><a class="glightbox" href="../images/cb53302b8212621458c672c13c5344ee.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cb53302b8212621458c672c13c5344ee.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cb53302b8212621458c672c13c5344ee.png" /></a></p>
<p>Найти исходники класса можно по пути <code>Runtime\Engine\Classes\Engine\DataAsset.h</code>.
В комментарии к исходникам сказано указано следующее:
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * PrimaryDataAsset это DataAsset, который реализует метод GetPrimaryAssetId</span>
<span class="cm"> * A DataAsset that implements GetPrimaryAssetId and has asset bundle support, which allows it to be manually loaded/unloaded from the AssetManager.</span>
<span class="cm"> * Instances of native subclasses can be created directly as Data Assets and will use the name of the native class as the PrimaryAssetType.</span>
<span class="cm"> * Or, blueprint subclasses can be created with a PrimaryAssetType equal to the name of the first native class going up the hierarchy, or the highest level blueprint class.</span>
<span class="cm"> * IE, if you have UPrimaryDataAsset -&gt; UParentNativeClass -&gt; UChildNativeClass -&gt; DataOnlyBlueprintClass the type will be UChildNativeClass.</span>
<span class="cm"> * Whereas if you have UPrimaryDataAsset -&gt; ParentBlueprintClass -&gt; DataOnlyBlueprintClass the type will be ParentBlueprintClass.</span>
<span class="cm"> * To change this behavior, override GetPrimaryAssetId in your native class or copy those functions into a different native base class.</span>
<span class="cm"> */</span>
</code></pre></div>
Таким образом, мы можем задавать каждый файл, унаследованный от <code>Primary Data Asset</code> лишь в качестве отдельной категории в <code>Primary Asset Types To Scan</code>.
Поскольку <code>UPrimaryDataAsset</code> поддерживает систему <code>AssetManager</code> мы можем создать на основе связки из этих двух систем игровой инвентарь. Точнее - заготовку игрового инвентаря, поскольку интерфейс и прочие системы писать в этой статье я не буду. Инвентарь, качественный, многослотовый, это предмет не малой статьи но целой серии статей. Тут будет лишь фундамент, структура данных.</p>
<p>Для начала нам нужен базовый класс элемента инвентаря. Я не собираюсь использовать отдельно <code>.cpp</code> файлы, достаточно будет заголовочных. Открываем папку модуля <code>DataAccess/Public</code>, создаем подпапку <code>Inventory</code>.</p>
<p><a class="glightbox" href="../images/d20f2649943d2dfb462e11ca2e1bf19d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d20f2649943d2dfb462e11ca2e1bf19d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d20f2649943d2dfb462e11ca2e1bf19d.png" /></a></p>
<p>Внутри нам нужен файл <code>ItemBase.h</code>, который будет родительским для остальных категорий предметов.</p>
<p><a class="glightbox" href="../images/27794c8324edc1939e6b57169d3edd54.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="27794c8324edc1939e6b57169d3edd54.png" auto_="auto;" display="block;" margin:="margin:" src="../images/27794c8324edc1939e6b57169d3edd54.png" /></a></p>
<p>Так-же добавим файлы:
* <code>AbilityItemGroup.h</code>
* <code>ArmorItemGroup.h</code>
* <code>ConsumableItemGroup.h</code>
* <code>WeaponItemGroup.h</code>
* <code>BuildableItemGroup.h</code>
* <code>ContainerItemGroup.h</code>
* <code>TextItemGroup.h</code>
По файлу под каждую из категорий предметов.</p>
<p><a class="glightbox" href="../images/3c90308a9266943aac2c6769778e9ddb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3c90308a9266943aac2c6769778e9ddb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3c90308a9266943aac2c6769778e9ddb.png" /></a></p>
<p>Так-же, советую сделать отдельный файл под перечисления.</p>
<p>В папке модуля <code>DataAccess/Public</code> создаем подпапку <code>Enums</code>, а в ней файл - <code>Enums.h</code>.</p>
<p><a class="glightbox" href="../images/55416319919a3c00a397864ed6385b01.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="55416319919a3c00a397864ed6385b01.png" auto_="auto;" display="block;" margin:="margin:" src="../images/55416319919a3c00a397864ed6385b01.png" /></a></p>
<p>Теперь надо чтобы все файлы появились в <code>Solution Explorer</code>. Идем в Unreal Engine далее <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/137ecf41b0def23ecdbe93f087197723.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="137ecf41b0def23ecdbe93f087197723.png" auto_="auto;" display="block;" margin:="margin:" src="../images/137ecf41b0def23ecdbe93f087197723.png" /></a></p>
<p>Теперь давайте создадим перечисление для типов предметов.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// somehow my VS dosen&#39;t detect .generated.h for nested files so i have to inclde this manually to get rid of red errors</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;UObject/ObjectMacros.h&gt;</span>
<span class="c1">// UHT</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums.generated.h&quot;</span>
<span class="c1">// Inventory Item Type Enum</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EInventoryItemsEnum</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">NONE</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">Hidden</span><span class="p">,</span><span class="w"> </span><span class="n">DiplaywName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;---&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">Undefined</span><span class="p">,</span>
<span class="w">    </span><span class="n">Helmet</span><span class="p">,</span>
<span class="w">    </span><span class="n">Gloves</span><span class="p">,</span>
<span class="w">    </span><span class="n">UpperBody</span><span class="p">,</span>
<span class="w">    </span><span class="n">LowerBody</span><span class="p">,</span>
<span class="w">    </span><span class="n">Boots</span><span class="p">,</span>
<span class="w">    </span><span class="n">Cloak</span><span class="p">,</span>
<span class="w">    </span><span class="n">ShortSword</span><span class="p">,</span>
<span class="w">    </span><span class="n">LongSword</span><span class="p">,</span>
<span class="w">    </span><span class="n">Bow</span><span class="p">,</span>
<span class="w">    </span><span class="n">Shield</span><span class="p">,</span>
<span class="w">    </span><span class="n">Mace</span><span class="p">,</span>
<span class="w">    </span><span class="n">Axe</span><span class="p">,</span>
<span class="w">    </span><span class="n">Arrow</span><span class="p">,</span>
<span class="w">    </span><span class="n">Potion</span><span class="p">,</span>
<span class="w">    </span><span class="n">Scroll</span><span class="p">,</span>
<span class="w">    </span><span class="n">Book</span><span class="p">,</span>
<span class="w">    </span><span class="n">Wall</span><span class="p">,</span>
<span class="w">    </span><span class="n">Chest</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// and much more, once you need them</span>
<span class="p">};</span>
</code></pre></div>
Далее нам нужно реализовать базовый класс для каждого из предметов. Базовый класс, на начальном этапе, будет содержать всего два поля: тип предмета и его название. Для названия надо использовать параметр <code>Text</code>, потому что оно, очевидно, будет локализуемым.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/DataAsset.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;NativeGameplayTags.h&quot;</span><span class="c1"> // gameplay tags</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputAction.h&quot;</span><span class="c1"> // enhanced input</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputMappingContext.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums/Enums.h&quot;</span><span class="c1"> // ItemTypes</span>
<span class="c1">// generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ItemBase.generated.h&quot;</span>
<span class="c1">// Packages used:</span>
<span class="c1">// &quot;GameplayTags&quot;, &quot;EnhancedInput&quot;, &quot;TestModule&quot;</span>
<span class="c1">// for FText</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;ItemTextNamespace&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * ItemBase PrimaryDataAsset</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DATAACCESS_API</span><span class="w"> </span><span class="n">UItemBase</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UPrimaryDataAsset</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Item&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FText</span><span class="w"> </span><span class="n">ItemName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="n">LOCTEXT_NAMESPACE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Basic Item&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Item&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">EInventoryItemsEnum</span><span class="w"> </span><span class="n">ItemType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EInventoryItemsEnum</span><span class="o">::</span><span class="n">NONE</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
От этого класса унаследуем реализацию для класса <code>AbilityItemGroup</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/DataAsset.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;NativeGameplayTags.h&quot;</span><span class="c1"> // gameplay tags</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputAction.h&quot;</span><span class="c1"> // enhanced input</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputMappingContext.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ItemBase.h&quot;</span><span class="c1"> // base item</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums/Enums.h&quot;</span><span class="c1"> // ItemTypes</span>
<span class="c1">// generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilityItemGroup.generated.h&quot;</span>
<span class="c1">// for FText</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;ItemTextNamespace&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * ItemBase PrimaryDataAsset</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DATAACCESS_API</span><span class="w"> </span><span class="n">UAbilityItemGroup</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UItemBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Icon</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Ability&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">UTexture2D</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AbilityIcon</span><span class="p">;</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Ability&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FText</span><span class="w"> </span><span class="n">AbilityDescription</span><span class="p">;</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditDefaultsOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Ability&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Cooldown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Ability Activation key</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Input&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputAction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InputAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
Теперь надо указать этот класс в качестве первичного ассета. Идем в файл с реализацией собственного менеджера ассетов и добавляем ссылку на класс в <code>PrimaryAssetTypesToScan</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// add to includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Inventory/ItemBase.h&quot;</span><span class="c1"> // base item class</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Inventory/AbilityItemGroup.h&quot;</span>
<span class="c1">//...</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">HasAssetTypeN</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">AbilityItemGroup</span><span class="p">))</span>
<span class="w">        </span><span class="n">Settings</span><span class="o">-&gt;</span><span class="n">PrimaryAssetTypesToScan</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FPrimaryAssetTypeInfo</span><span class="p">{</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">AbilityItemGroup</span><span class="p">,</span>
<span class="w">            </span><span class="n">UAbilityItemGroup</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span>
<span class="w">            </span><span class="nb">true</span><span class="p">,</span>
<span class="w">            </span><span class="nb">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FDirectoryPath</span><span class="o">&gt;</span><span class="p">({}),</span>
<span class="w">            </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSoftObjectPath</span><span class="o">&gt;</span><span class="p">({})</span>
<span class="w">        </span><span class="p">});</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/94591dd9e4f23999d3772cab6f051bd3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="94591dd9e4f23999d3772cab6f051bd3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/94591dd9e4f23999d3772cab6f051bd3.png" /></a></p>
<p>Аналогичные действия можно проделать для каждой группы предметов. Чтобы не растягивать эту статью, я не буду описывать такие шаги.</p>
<p>Компилируем код и перезапускаем движок.</p>
<p><a class="glightbox" href="../images/86a6d288804718801807904f1ca03e91.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="86a6d288804718801807904f1ca03e91.png" auto_="auto;" display="block;" margin:="margin:" src="../images/86a6d288804718801807904f1ca03e91.png" /></a></p>
<p>Теперь можно создать ассет данных для типа <code>UAbilityItemGroup</code>.
Идем в <code>Unreal Engine -&gt; Content Browser -&gt; Add -&gt; Miscellaneous -&gt; Data Asset</code>.</p>
<p><a class="glightbox" href="../images/1c0df27d7b36f7991724fe7cd67efb46.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1c0df27d7b36f7991724fe7cd67efb46.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1c0df27d7b36f7991724fe7cd67efb46.png" /></a></p>
<p>Выбираем <code>AbilityItemGroup</code>.</p>
<p><a class="glightbox" href="../images/042eb48d7d57ca4d35067cf52d27653a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="042eb48d7d57ca4d35067cf52d27653a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/042eb48d7d57ca4d35067cf52d27653a.png" /></a></p>
<p>В результате получится новый первичный ассет данных.</p>
<p><a class="glightbox" href="../images/579a6931be0050f08ec571ad820d30e3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="579a6931be0050f08ec571ad820d30e3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/579a6931be0050f08ec571ad820d30e3.png" /></a></p>
<p><a class="glightbox" href="../images/3f148d1438985e4e4c5234384fd3f3f5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3f148d1438985e4e4c5234384fd3f3f5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3f148d1438985e4e4c5234384fd3f3f5.png" /></a></p>
<p>Я добавил этот ассет в отдельную папку <code>Characters / Data / Items / Abilities</code>. В этой папки будут создаваться все <code>Data Asset'ы</code> способностей.</p>
<p><a class="glightbox" href="../images/73456b3e86d212255dfc63ffcd9ba9b3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="73456b3e86d212255dfc63ffcd9ba9b3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/73456b3e86d212255dfc63ffcd9ba9b3.png" /></a></p>
<p>Осталось сделать так, чтобы <code>AssetManager</code> получил доступ к ассетам способностей. Идем в <code>Edit -&gt; Project Settings -&gt; Game -&gt; Asset Manager</code> и ищем категорию <code>AbilityItemGroup</code>.
Нас интересует параметр <code>Directories</code>. Добавляем туда директорию для наших способностей.</p>
<p><a class="glightbox" href="../images/ef18adb66ac6a2e1cef6a8a24da38a13.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ef18adb66ac6a2e1cef6a8a24da38a13.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ef18adb66ac6a2e1cef6a8a24da38a13.png" /></a></p>
<p>Теперь ассеты, отвечающие за способности, должны быть доступны для <code>Asset Manager'а</code>. Добавьте <code>blueprint</code> ноду <code>AsyncLoadPrimaryAsset</code>, чтобы посмотреть так ли это.</p>
<p><a class="glightbox" href="../images/5df8439ff22dc1f92b332b82ef3f37f4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5df8439ff22dc1f92b332b82ef3f37f4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5df8439ff22dc1f92b332b82ef3f37f4.png" /></a></p>
<p><a class="glightbox" href="../images/cb3194b73ee2ea366ed8adc4f1d63893.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cb3194b73ee2ea366ed8adc4f1d63893.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cb3194b73ee2ea366ed8adc4f1d63893.png" /></a></p>
<p><a class="glightbox" href="../images/655383fbb1efe7c9e85a691f255e66b2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="655383fbb1efe7c9e85a691f255e66b2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/655383fbb1efe7c9e85a691f255e66b2.png" /></a></p>
<h3 id="_11">Реализация поиска предмета по названию файла</h3>
<p>Остался последний штрих. Функция для нахождения <code>item'а</code> по его <code>fname</code>. Она позволит работать с файлами предметов так, как будто они занесены в базу данных.</p>
<p>Добавим библиотеку функций под эти цели <code>Tools -&gt; New C++ Class -&gt; BlueprintFunctionLibrary</code>, называем <code>DataAccessLibrary</code>.</p>
<p><a class="glightbox" href="../images/f1a4ac6fb3111f9883e7a23368afc7eb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f1a4ac6fb3111f9883e7a23368afc7eb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f1a4ac6fb3111f9883e7a23368afc7eb.png" /></a></p>
<p>После добавления библиотеки не забудьте выполнить команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.
Далее пишем такой код:
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/BlueprintFunctionLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DataModuleAssetManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Inventory/AbilityItemGroup.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/DataAsset.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums/Enums.h&quot;</span><span class="c1"> // ItemTypes</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DataAccessLibrary.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Data Access Function Library</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DATAACCESS_API</span><span class="w"> </span><span class="n">UDataAccessCLibrary</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UBlueprintFunctionLibrary</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// find item by PrimaryAssetName</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintPure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Inventory&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">UItemBase</span><span class="o">*</span><span class="w"> </span><span class="n">FindItemByName</span><span class="p">(</span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">AssetGroup</span><span class="p">,</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">Name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Name</span><span class="p">.</span><span class="n">IsNone</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">UDataModuleAssetManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">Manager</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FPrimaryAssetId</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">;</span><span class="w"> </span><span class="c1">// asset list container</span>
<span class="w">        </span><span class="n">Manager</span><span class="p">.</span><span class="n">GetPrimaryAssetIdList</span><span class="p">(</span><span class="n">AssetGroup</span><span class="p">,</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">);</span><span class="w"> </span><span class="c1">// get list of assets</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FPrimaryAssetId</span><span class="w"> </span><span class="n">ItemID</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ItemID</span><span class="p">.</span><span class="n">PrimaryAssetName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// will async load asset by id</span>
<span class="w">                </span><span class="n">Manager</span><span class="p">.</span><span class="n">LoadPrimaryAsset</span><span class="p">(</span><span class="n">ItemID</span><span class="p">,{})</span><span class="o">-&gt;</span><span class="n">WaitUntilComplete</span><span class="p">();</span><span class="w"> </span><span class="c1">// this is sync function</span>
<span class="w">                </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="n">Obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Manager</span><span class="p">.</span><span class="n">GetPrimaryAssetObject</span><span class="p">(</span><span class="n">ItemID</span><span class="p">);</span><span class="w"> </span><span class="c1">// this will return only objects loaded in memory</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Obj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FindInventoryItemByFName Asset not found&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">UItemBase</span><span class="o">*</span><span class="w"> </span><span class="n">ItemData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UItemBase</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Obj</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">ItemData</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FindInventoryItemByFName Find Failed!&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span><span class="w">  </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
Этот код позволит использовать функцию <code>FindItemByName</code>, которая ищет <code>PrimaryAsset</code> из выбранной категории по его параметру <code>PrimaryAssetName</code>, который, я напомню, у <code>PrimaryDataAsset'ов</code> совпадает с именем файла, то есть с <code>FName</code>.
Откроем один из тестовых файлов, например <code>PDA_FrostNova</code>.</p>
<p><a class="glightbox" href="../images/b3115dc61978f77b629c16d0be61801f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b3115dc61978f77b629c16d0be61801f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b3115dc61978f77b629c16d0be61801f.png" /></a></p>
<p>Изменим его параметр <code>Item Type</code> с <code>NONE</code> на <code>Potion</code>, для теста. Название  тоже изменим на <code>Frost Nova Item</code>.</p>
<p><a class="glightbox" href="../images/da2475111782562084a69b7d1c66282f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="da2475111782562084a69b7d1c66282f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/da2475111782562084a69b7d1c66282f.png" /></a></p>
<p>Используем нашу функцию для получения содержимого этих полей в <code>blueprnt</code> коде.</p>
<p><a class="glightbox" href="../images/bf89f492fd20b26350d8a48cd1ab0c01.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bf89f492fd20b26350d8a48cd1ab0c01.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bf89f492fd20b26350d8a48cd1ab0c01.png" /></a></p>
<p><a class="glightbox" href="../images/f399e5b4a4d8eddf9c8b04611412b011.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f399e5b4a4d8eddf9c8b04611412b011.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f399e5b4a4d8eddf9c8b04611412b011.png" /></a></p>
<p>Можно улучшить нашу функцию, добавив в нее возможность проверки на успешнось поиска.
<div class="highlight"><pre><span></span><code><span class="c1">// Enums/Enums.h</span>
<span class="c1">// Function Exit Pins Enum</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EFindItemByNameOutputs</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Then</span><span class="w">    </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Then&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">Fail</span><span class="w">    </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;On Failure&quot;</span><span class="p">)</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//DataAccessLibrary.h</span>
<span class="c1">// find item by PrimaryAssetName</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="cm">/*BlueprintPure = &quot;true&quot;,*/</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Inventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="o">=</span><span class="p">(</span><span class="n">ExpandEnumAsExecs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Outputs&quot;</span><span class="p">))</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">FindItemByName</span><span class="p">(</span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">AssetGroup</span><span class="p">,</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Outputs</span><span class="p">,</span><span class="w"> </span><span class="n">UItemBase</span><span class="o">*&amp;</span><span class="w"> </span><span class="n">ItemData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Name</span><span class="p">.</span><span class="n">IsNone</span><span class="p">()</span><span class="w"> </span><span class="p">){</span>
<span class="w">        </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UDataModuleAssetManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">Manager</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FPrimaryAssetId</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">;</span><span class="w"> </span><span class="c1">// asset list container</span>
<span class="w">    </span><span class="n">Manager</span><span class="p">.</span><span class="n">GetPrimaryAssetIdList</span><span class="p">(</span><span class="n">AssetGroup</span><span class="p">,</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">);</span><span class="w"> </span><span class="c1">// get list of assets</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FPrimaryAssetId</span><span class="w"> </span><span class="n">ItemID</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ItemID</span><span class="p">.</span><span class="n">PrimaryAssetName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// will async load asset by id</span>
<span class="w">            </span><span class="n">Manager</span><span class="p">.</span><span class="n">LoadPrimaryAsset</span><span class="p">(</span><span class="n">ItemID</span><span class="p">,{})</span><span class="o">-&gt;</span><span class="n">WaitUntilComplete</span><span class="p">();</span><span class="w"> </span><span class="c1">// this is sync function</span>
<span class="w">            </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="n">Obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Manager</span><span class="p">.</span><span class="n">GetPrimaryAssetObject</span><span class="p">(</span><span class="n">ItemID</span><span class="p">);</span><span class="w"> </span><span class="c1">// this will return only objects loaded in memory</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Obj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FindInventoryItemByFName Asset not found&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">ItemData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UItemBase</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Obj</span><span class="p">);</span>
<span class="w">            </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Then</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FindInventoryItemByFName Find Failed!&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
При такой реализации функция получает два выходных пина, которыми очень удобно пользоваться.</p>
<p><a class="glightbox" href="../images/0a97b9007564506369ad58cba0c23bfd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0a97b9007564506369ad58cba0c23bfd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0a97b9007564506369ad58cba0c23bfd.png" /></a></p>
<p><a class="glightbox" href="../images/0ce3d853e98b91fa94882772f4e3baf4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0ce3d853e98b91fa94882772f4e3baf4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0ce3d853e98b91fa94882772f4e3baf4.png" /></a></p>
<p>Моя реализация загрузки ассета - синхронна, я использую <code>WaitUntilComplete</code> чтобы блокировать поток до завершения операции. Это не всегда верное решение, но оно работает. Можно, конечно, написать асинхронное дейсвтие <code>AsyncAction</code> чтобы решить эту проблему, но есть куда более простой способ.</p>
<p>Дело в том, что в движке уже есть встроенное асинхронно действие <code>AsyncLoadPrimaryAsset</code>, которое как раз и загружает ассет. Но данное действие принимает в качестве входа параметр типа <code>FPrimaryAssetId</code>. Мы можем взять приведенную выше функцию и упростить ее, чтобы она возвращала этот самый <code>FPrimaryAssetId</code>, а потом скормить ее в асинхронный загрузчик.
<div class="highlight"><pre><span></span><code><span class="c1">// Enums/Enums.h</span>
<span class="c1">// Function Exit Pins Enum</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EFindItemByNameOutputs</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Then</span><span class="w">    </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Then&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">Fail</span><span class="w">    </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;On Failure&quot;</span><span class="p">)</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//DataAccessLibrary.h</span>
<span class="c1">// Find primary asset type of item by name</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Inventory&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ExpandEnumAsExecs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Outputs&quot;</span><span class="p">))</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">FindItemAssetId</span><span class="p">(</span><span class="n">FPrimaryAssetType</span><span class="w"> </span><span class="n">AssetGroup</span><span class="p">,</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Outputs</span><span class="p">,</span><span class="w"> </span><span class="n">FPrimaryAssetId</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ItemData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Name</span><span class="p">.</span><span class="n">IsNone</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UDataModuleAssetManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Manager</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FPrimaryAssetId</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">;</span><span class="w"> </span><span class="c1">// asset list container</span>
<span class="w">    </span><span class="n">Manager</span><span class="p">.</span><span class="n">GetPrimaryAssetIdList</span><span class="p">(</span><span class="n">AssetGroup</span><span class="p">,</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">);</span><span class="w"> </span><span class="c1">// get list of assets</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FPrimaryAssetId</span><span class="w"> </span><span class="n">ItemID</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ItemID</span><span class="p">.</span><span class="n">PrimaryAssetName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ItemData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ItemID</span><span class="p">;</span>
<span class="w">            </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Then</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Find Failed!&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">Outputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EFindItemByNameOutputs</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/7964dbae709947ec9fc3bc5ee827445a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7964dbae709947ec9fc3bc5ee827445a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7964dbae709947ec9fc3bc5ee827445a.png" /></a></p>
<p><a class="glightbox" href="../images/f8153bea4e78240469f8829fd1963a8e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f8153bea4e78240469f8829fd1963a8e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f8153bea4e78240469f8829fd1963a8e.png" /></a></p>
<p>Разумеется. для реализации полноценного инвентаря этих двух функций будет не достаточно. Но они - самые важные. Возможность быстро найти предмет по его названию крайне важна для получения информации об этом предмете.</p>
<h3 id="_12">Асинхронная загрузка ассетов</h3>
<p>Делегат, передаваемый методу <code>LoadPrimaryAsset</code> можно использовать для асинхронной загрузки ассетов, если это требуется.
<div class="highlight"><pre><span></span><code><span class="c1">// This function will run async asset loading test</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Inventory&quot;</span><span class="p">)</span>
<span class="c1">// will async load all assets in AssetGroup</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">AsyncAssetLoadTest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UDataModuleAssetManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FPrimaryAssetId</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">;</span><span class="w"> </span><span class="c1">// asset list container</span>
<span class="w">    </span><span class="c1">// async load all assets in AbilityItemGroup</span>
<span class="w">    </span><span class="n">Manager</span><span class="p">.</span><span class="n">GetPrimaryAssetIdList</span><span class="p">(</span><span class="n">UDataModuleAssetManager</span><span class="o">::</span><span class="n">AbilityItemGroup</span><span class="p">,</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FPrimaryAssetId</span><span class="w"> </span><span class="n">ItemID</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AssetIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this delegate will be called after Item is loaded</span>
<span class="w">        </span><span class="n">FStreamableDelegate</span><span class="w"> </span><span class="n">Delegate</span><span class="p">;</span>
<span class="w">        </span><span class="n">Delegate</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">FPrimaryAssetId</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">UDataModuleAssetManager</span><span class="w"> </span><span class="o">*</span><span class="n">Manager</span><span class="p">)</span><span class="o">-&gt;</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="n">Obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Manager</span><span class="o">-&gt;</span><span class="n">GetPrimaryAssetObject</span><span class="p">(</span><span class="n">ID</span><span class="p">);</span><span class="w"> </span><span class="c1">// this will return only objects loaded in memory</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Obj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Asset not found&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">UItemBase</span><span class="o">*</span><span class="w"> </span><span class="n">ItemData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UItemBase</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Obj</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// item is loaded</span>
<span class="w">            </span><span class="c1">//... do something</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;loaded item name = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">ItemData</span><span class="o">-&gt;</span><span class="n">ItemName</span><span class="p">.</span><span class="n">ToString</span><span class="p">())</span>
<span class="w">        </span><span class="p">},</span><span class="w"> </span><span class="n">ItemID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Manager</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// start async item loading</span>
<span class="w">        </span><span class="c1">//Manager.LoadPrimaryAsset(ItemID, {}, Delegate);</span>
<span class="w">        </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FStreamableHandle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DelegateHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Manager</span><span class="p">.</span><span class="n">LoadPrimaryAsset</span><span class="p">(</span><span class="n">ItemID</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="n">Delegate</span><span class="p">);</span>
<span class="w">        </span><span class="n">DelegateHandle</span><span class="o">-&gt;</span><span class="n">WaitUntilComplete</span><span class="p">();</span><span class="w"> </span><span class="c1">// lock thread and wait for the calculations</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Этот код  асинхронно, в цикле, загрузит в память все ассеты, с <code>AssetIds</code>.</p>
<p><a class="glightbox" href="../images/c6d071bfa2fd4e8e28faeeddc49e78cf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c6d071bfa2fd4e8e28faeeddc49e78cf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c6d071bfa2fd4e8e28faeeddc49e78cf.png" /></a></p>
<p><a class="glightbox" href="../images/8f0374a5779177dd7e4338d13020be9b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8f0374a5779177dd7e4338d13020be9b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8f0374a5779177dd7e4338d13020be9b.png" /></a></p>
<h2 id="links">Links</h2>
<p>https://unrealcommunity.wiki/using-the-asset-manager-qj38astq
https://www.reddit.com/r/unrealengine/comments/p7ak9z/get_all_data_assets_from_a_specified_primary_data/
https://www.tomlooman.com/unreal-engine-asset-manager-async-loading/</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            К началу
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      aftamat4ik
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "toc.follow"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>