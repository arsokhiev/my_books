
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Справочник Unreal Engine">
      
      
        <meta name="author" content="aftamat4ik">
      
      
      
        <link rel="prev" href="2_UFUNCTION_Wildcard.html">
      
      
        <link rel="next" href="4_UMG.html">
      
      
      <link rel="icon" href="../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.3.2">
    
    
      
        <title>Slate Runtimе, введение в Slate - Справочник Unreal Engine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.30068a00.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#slate-runtim-slate" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-header__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Справочник Unreal Engine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Slate Runtimе, введение в Slate
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Главная

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1_Basics/1_First_Project.html" class="md-tabs__link">
          
  
  Основы

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../2_Core/1_Delegates.html" class="md-tabs__link">
          
  
  Ключевые системы

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="1_HUD.html" class="md-tabs__link">
          
  
  Продвинутая разработка

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-tabs__link">
          
  
  Решение проблем

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../5_Tips/Change_Asset_Icons.html" class="md-tabs__link">
          
  
  Советы

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-nav__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    Справочник Unreal Engine
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Главная
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Основы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Основы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/1_First_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создаем первый проект в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/2_Engine_Introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Знакомство с движком
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/3_CPP_Recommendations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Рекомендации по написанию кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/4_SimplePlugin.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создание простейшего плагина для Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/5_Macroses_Reflection_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Макросы Reflection System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/6_Logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Печать информации в лог
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/7_Pointers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Указатели
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/8_ModernCpp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возможности современного c++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/9_Working_With_Strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа со строками
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/10_Timers_In_%D0%A1%2B%2B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Таймеры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/11_Instances_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Доступ к различным сущностям
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Debug
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            Debug
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Asserts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Asserts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Console Commands
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ключевые системы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Ключевые системы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/1_Delegates.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События и Делегаты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/2_Components.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Компоненты в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/3_SubObjects.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Суб Объекты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/4_Multithreading.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Многопоточность
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/5_Function_Libraries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Библиотеки Функций для Blueprint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/6_Latent_And_Async_Actions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Latent и Async Action
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/7_Gameplay_Tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/8_DataAssets_AssetManager.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с ассетами и данными
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/9_FileSystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с файловой системой
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/10_Anim_Instance.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anim Instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/11_SubSystems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Подсистемы
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/12.%20UObject%20Interface.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Interface или UInterface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Продвинутая разработка
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Продвинутая разработка
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="1_HUD.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HUD или Heads-up Display
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="2_UFUNCTION_Wildcard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UFUNCTION Wildcard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Slate Runtimе, введение в Slate
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="3_Slate%20Runtime.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Slate Runtimе, введение в Slate
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Материалы для ознакомления
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Подготовка к работе
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Изучение системы
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slate" class="md-nav__link">
    Виджеты Slate
  </a>
  
    <nav class="md-nav" aria-label="Виджеты Slate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slate_1" class="md-nav__link">
    Сборка интерфейса с применением Slate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slate_2" class="md-nav__link">
    Макросы инициализации виджетов Slate
  </a>
  
    <nav class="md-nav" aria-label="Макросы инициализации виджетов Slate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#snew" class="md-nav__link">
    Макрос SNew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sassignnew" class="md-nav__link">
    Макрос SAssignNew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sargumentnew" class="md-nav__link">
    Макрос SArgumentNew
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Добавление виджетов на экран
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Программируем собственный виджет
  </a>
  
    <nav class="md-nav" aria-label="Программируем собственный виджет">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Наследование
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slate_3" class="md-nav__link">
    Структура виджета Slate
  </a>
  
    <nav class="md-nav" aria-label="Структура виджета Slate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Добавление аргументов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_construct" class="md-nav__link">
    Метод _Construct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Аргументы событий
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Атрибуты
  </a>
  
    <nav class="md-nav" aria-label="Атрибуты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    Шаг 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    Шаг 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    Шаг 3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    Шаг 3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    Шаг 4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    Шаг 5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    Шаг 6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Послесловие
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Код класса на данном этапе
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Слоты виджетов
  </a>
  
    <nav class="md-nav" aria-label="Слоты виджетов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named" class="md-nav__link">
    Named слоты
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Шаблонные слоты
  </a>
  
    <nav class="md-nav" aria-label="Шаблонные слоты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Код
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    Тестирование
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    Стили оформления
  </a>
  
    <nav class="md-nav" aria-label="Стили оформления">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#widgetstyle" class="md-nav__link">
    WidgetStyle стили
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#styleset" class="md-nav__link">
    StyleSet стили
  </a>
  
    <nav class="md-nav" aria-label="StyleSet стили">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#styleset_1" class="md-nav__link">
    Использование StyleSet стилей
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swindow" class="md-nav__link">
    Системные Окна SWindow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    Закрепление материала. Пишем виджет игрового окна
  </a>
  
    <nav class="md-nav" aria-label="Закрепление материала. Пишем виджет игрового окна">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    Код Окна
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    Полный код всех классов модуля
  </a>
  
    <nav class="md-nav" aria-label="Полный код всех классов модуля">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slateruntimemoduleh" class="md-nav__link">
    SlateRuntimeModule.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateruntimemodulecpp" class="md-nav__link">
    SlateRuntimeModule.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simagebuttonwidgeth" class="md-nav__link">
    SImageButtonWidget.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simagebuttonwidgetcpp" class="md-nav__link">
    SImageButtonWidget.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateuiwidgetstyleh" class="md-nav__link">
    SlateUIWidgetStyle.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateuiwidgetstylecpp" class="md-nav__link">
    SlateUIWidgetStyle.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateruntimeplayercontrollerh" class="md-nav__link">
    SlateRuntimePlayerController.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateruntimeplayercontrollercpp" class="md-nav__link">
    SlateRuntimePlayerController.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uislatestyleseth" class="md-nav__link">
    UiSlateStyleSet.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uislatestylesetcpp" class="md-nav__link">
    UiSlateStyleSet.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sgamewindowh" class="md-nav__link">
    SGameWindow.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sgamewindowcpp" class="md-nav__link">
    SGameWindow.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gamewindowstyleseth" class="md-nav__link">
    GameWindowStyleSet.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gamewindowstylesetcpp" class="md-nav__link">
    GameWindowStyleSet.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sgamescreenwidgeth" class="md-nav__link">
    SGameScreenWidget.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sgamescreenwidgetcpp" class="md-nav__link">
    SGameScreenWidget.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    Сниппеты
  </a>
  
    <nav class="md-nav" aria-label="Сниппеты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-attribute-boilerplate" class="md-nav__link">
    Simple Attribute Boilerplate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-attribute-boilerplate" class="md-nav__link">
    Complex Attribute Boilerplate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#style-set-boilerplate" class="md-nav__link">
    Style Set Boilerplate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slate-aplayercontroller" class="md-nav__link">
    Передача в Slate класса APlayerController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateuser" class="md-nav__link">
    Получение доступа к SlateUser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    Привязка к событиям прямо внутри виджета
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slate_4" class="md-nav__link">
    Приведение типа для виджетов Slate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sconstraintcanvas" class="md-nav__link">
    Получение списка виджетов заданного типа внутри SConstraintCanvas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sconstraintcanvasfslot" class="md-nav__link">
    Получение ссылки на слот SConstraintCanvas::FSlot для текущего виджета
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sconstraintcanvas_1" class="md-nav__link">
    Получение объекта на самом первом слое в SConstraintCanvas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    Захват ввода клавиатуры
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    Вывод виджета на первый план и передача ему фокуса ввода
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="4_UMG.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UMG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="5_K2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="6_Registe_New_Asset_Type.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Регистрируем новый тип ассета
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="7_ACharacter_And_Enhanced%20Input.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ACharacter и Enhanced Input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="8_Gameplay_Ability_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Ability System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="9_Global_Data_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальнный доступ к данным
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="10_Global_Event_Bus.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальная шина событий
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Решение проблем
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Решение проблем
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с кодировкой в LiveCoding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/Reset_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Сброс (Reset) проекта
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/generatedh_Problems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с файлом .generated.h
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Советы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Советы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Change_Asset_Icons.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Asset Icons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Character_And_EnhancedInput.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Character Boilerplate with Enhanced Input Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/DefaultToSelf_WorldContext.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DefaultToSelf WorldContext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Different_UPROPERTY.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Переменные разных типов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/GameInputMode.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Изменение GameInputMode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Get_UScriptStruct_FromStruct.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ::UScriptStruct из встроенной структуры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Input_Binding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События ввода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Iterate_TMap.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iterate TMap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Read_Blueprint_Properties.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Чтение параметров Blueprint класса
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Return_UObject.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возвращение UObject по ссылке из функции
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Run_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Запуск консольных команд
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Screen_Size.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Размер экрана
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Slate_Snippets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Полезные сниппеты Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Spawn_Actors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spawn, призыв объектов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Time_Measuring.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Замер времени исполнения кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Trace.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UEnum_To_String.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UEnum to FString
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UObject_Base_Class.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Base Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Variable_Type_Print_Template.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Шаблон для печати типа переменной
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/struct_operator%3D%3D.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    struct и оператор ==
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Материалы для ознакомления
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Подготовка к работе
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Изучение системы
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slate" class="md-nav__link">
    Виджеты Slate
  </a>
  
    <nav class="md-nav" aria-label="Виджеты Slate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slate_1" class="md-nav__link">
    Сборка интерфейса с применением Slate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slate_2" class="md-nav__link">
    Макросы инициализации виджетов Slate
  </a>
  
    <nav class="md-nav" aria-label="Макросы инициализации виджетов Slate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#snew" class="md-nav__link">
    Макрос SNew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sassignnew" class="md-nav__link">
    Макрос SAssignNew
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sargumentnew" class="md-nav__link">
    Макрос SArgumentNew
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Добавление виджетов на экран
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Программируем собственный виджет
  </a>
  
    <nav class="md-nav" aria-label="Программируем собственный виджет">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Наследование
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slate_3" class="md-nav__link">
    Структура виджета Slate
  </a>
  
    <nav class="md-nav" aria-label="Структура виджета Slate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Добавление аргументов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_construct" class="md-nav__link">
    Метод _Construct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Аргументы событий
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Атрибуты
  </a>
  
    <nav class="md-nav" aria-label="Атрибуты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    Шаг 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    Шаг 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    Шаг 3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    Шаг 3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    Шаг 4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    Шаг 5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    Шаг 6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Послесловие
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Код класса на данном этапе
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Слоты виджетов
  </a>
  
    <nav class="md-nav" aria-label="Слоты виджетов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named" class="md-nav__link">
    Named слоты
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Шаблонные слоты
  </a>
  
    <nav class="md-nav" aria-label="Шаблонные слоты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Код
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    Тестирование
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    Стили оформления
  </a>
  
    <nav class="md-nav" aria-label="Стили оформления">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#widgetstyle" class="md-nav__link">
    WidgetStyle стили
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#styleset" class="md-nav__link">
    StyleSet стили
  </a>
  
    <nav class="md-nav" aria-label="StyleSet стили">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#styleset_1" class="md-nav__link">
    Использование StyleSet стилей
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swindow" class="md-nav__link">
    Системные Окна SWindow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    Закрепление материала. Пишем виджет игрового окна
  </a>
  
    <nav class="md-nav" aria-label="Закрепление материала. Пишем виджет игрового окна">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    Код Окна
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    Полный код всех классов модуля
  </a>
  
    <nav class="md-nav" aria-label="Полный код всех классов модуля">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slateruntimemoduleh" class="md-nav__link">
    SlateRuntimeModule.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateruntimemodulecpp" class="md-nav__link">
    SlateRuntimeModule.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simagebuttonwidgeth" class="md-nav__link">
    SImageButtonWidget.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simagebuttonwidgetcpp" class="md-nav__link">
    SImageButtonWidget.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateuiwidgetstyleh" class="md-nav__link">
    SlateUIWidgetStyle.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateuiwidgetstylecpp" class="md-nav__link">
    SlateUIWidgetStyle.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateruntimeplayercontrollerh" class="md-nav__link">
    SlateRuntimePlayerController.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateruntimeplayercontrollercpp" class="md-nav__link">
    SlateRuntimePlayerController.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uislatestyleseth" class="md-nav__link">
    UiSlateStyleSet.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uislatestylesetcpp" class="md-nav__link">
    UiSlateStyleSet.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sgamewindowh" class="md-nav__link">
    SGameWindow.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sgamewindowcpp" class="md-nav__link">
    SGameWindow.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gamewindowstyleseth" class="md-nav__link">
    GameWindowStyleSet.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gamewindowstylesetcpp" class="md-nav__link">
    GameWindowStyleSet.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sgamescreenwidgeth" class="md-nav__link">
    SGameScreenWidget.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sgamescreenwidgetcpp" class="md-nav__link">
    SGameScreenWidget.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    Сниппеты
  </a>
  
    <nav class="md-nav" aria-label="Сниппеты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-attribute-boilerplate" class="md-nav__link">
    Simple Attribute Boilerplate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-attribute-boilerplate" class="md-nav__link">
    Complex Attribute Boilerplate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#style-set-boilerplate" class="md-nav__link">
    Style Set Boilerplate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slate-aplayercontroller" class="md-nav__link">
    Передача в Slate класса APlayerController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slateuser" class="md-nav__link">
    Получение доступа к SlateUser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    Привязка к событиям прямо внутри виджета
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slate_4" class="md-nav__link">
    Приведение типа для виджетов Slate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sconstraintcanvas" class="md-nav__link">
    Получение списка виджетов заданного типа внутри SConstraintCanvas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sconstraintcanvasfslot" class="md-nav__link">
    Получение ссылки на слот SConstraintCanvas::FSlot для текущего виджета
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sconstraintcanvas_1" class="md-nav__link">
    Получение объекта на самом первом слое в SConstraintCanvas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    Захват ввода клавиатуры
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    Вывод виджета на первый план и передача ему фокуса ввода
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="slate-runtim-slate">Slate Runtimе, введение в Slate</h1>
<p><code>Slate</code> это выосокуровневый фреймворк отрисовки пользовательского интерфейса <code>GUI</code> интегрированный в <code>Unreal Engine</code>. Данный фреймворк выступает как более низкоуровневая альтернатива системе <code>UMG</code> виджетов. При этом сами <code>UMG</code> виджеты основаны на <code>Slate</code>.
<code>Slate</code> - один из самых сложных фреймворков с которыми я сталкивался в своей жизни. Многие механики этого фреймворка не очевидны.</p>
<p>Проблемы с изучением <code>Slate</code> были почти у всех разработчиков, касавшихся этой системы, не зависимо от уровня навыков и предыдущего опыта. Главные источники проблем этого фреймворка - декларативный дизайн и абсолютно непонятная система атрибутов, с бессмысленным пояснительным комментарием в коде движка, поставившим меня в тупик. Изучение <code>Slate</code> заняло у меня порядка 20 дней. Ничего более запутанного и сложного я за все годы работы не встречал.</p>
<h2 id="_1">Материалы для ознакомления</h2>
<p>Прежде чем приступать к работе, предлагаю вам ознакомиться с материалами по фреймворку <code>Slate</code>, которые доступны в сети интернет.</p>
<p>Для начала обратите внимание на <a href="https://docs.unrealengine.com/5.1/en-US/slate-user-interface-programming-framework-for-unreal-engine/">документацию</a> по этой системе, которая приведена на официальном сайте. Здесь вы найдете описание основных принципов <code>Slate</code>, способы интеграции фреймворка в проект и многое другое.</p>
<p>Рекомендую обратить внимание на описание инструментов которые предлагает движок Unreal Engine, для отладки <code>Slate</code> систем, в первую очередь это <a href="https://docs.unrealengine.com/5.1/en-US/using-the-slate-widget-reflector-in-unreal-engine/">WidgetReflector</a>.</p>
<p>В дополнение к официальной документации, на <code>GitHub</code> существует своеобразный вики-<a href="https://docs.unrealengine.com/5.1/en-US/using-the-slate-widget-reflector-in-unreal-engine/">репозиторий</a>, который, к сожалению, больше внимания уделяет системе <code>UMG</code>, но я все равно рекомендую вам его почитать.</p>
<h2 id="_2">Подготовка к работе</h2>
<p>Создадим отдельный модуль для классов, которые будут написаны в этой статье.</p>
<p>Назовем модуль <code>SlateRuntimeModule</code>.</p>
<p><a class="glightbox" href="../images/66249b13303aacc1edf5465e9db96f76.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="66249b13303aacc1edf5465e9db96f76.png" auto_="auto;" display="block;" margin:="margin:" src="../images/66249b13303aacc1edf5465e9db96f76.png" /></a></p>
<p>Так-же, для отображения виджетов на экране, нам нужен класс <code>PlayerController</code>.
Идем <code>Tools -&gt; New C++ Class</code> и далее <code>PlayerController</code>.</p>
<p><a class="glightbox" href="../images/1457e512872481ce39fa6b2d81c0bdf5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1457e512872481ce39fa6b2d81c0bdf5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1457e512872481ce39fa6b2d81c0bdf5.png" /></a></p>
<p>Называем  класс <code>SlateRuntimePlayerController</code>.</p>
<p><a class="glightbox" href="../images/099b51a1f4f21d57f99c5b1fbc8199de.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="099b51a1f4f21d57f99c5b1fbc8199de.png" auto_="auto;" display="block;" margin:="margin:" src="../images/099b51a1f4f21d57f99c5b1fbc8199de.png" /></a></p>
<p>После добавления файлов не забудьте выполнить команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>, чтобы изменения отобразились в <code>Solution Explorer</code>.</p>
<p><a class="glightbox" href="../images/76cd702b286c1967cf72a9701e2cbe62.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="76cd702b286c1967cf72a9701e2cbe62.png" auto_="auto;" display="block;" margin:="margin:" src="../images/76cd702b286c1967cf72a9701e2cbe62.png" /></a></p>
<p>После компиляции, необходимо добавить класс <code>SlateRuntimePlayerController</code> в <code>GameMode</code> проекта (делается это на вкладке <code>World Settings</code> в редакторе Unreal).</p>
<p><a class="glightbox" href="../images/90834157ff7b22e628405e5d993f7096.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="90834157ff7b22e628405e5d993f7096.png" auto_="auto;" display="block;" margin:="margin:" src="../images/90834157ff7b22e628405e5d993f7096.png" /></a></p>
<h2 id="_3">Изучение системы</h2>
<p>Система <code>Slate</code> состоит из двух модулей:
* <code>SlateCore</code> - ядро системы, здесь находится ключевой класс <code>SWidget</code>, а так-же логика стилей, обработки ввода, шрифтов и много чего еще. Данный модуль можно найти по пути <code>\Engine\Source\Runtime\SlateCore</code>. 
<a class="glightbox" href="../images/09f3adcb772e5441e8a7b9c6e01d05ec.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="09f3adcb772e5441e8a7b9c6e01d05ec.png" auto_="auto;" display="block;" margin:="margin:" src="../images/09f3adcb772e5441e8a7b9c6e01d05ec.png" /></a></p>
<ul>
<li><code>Slate</code> - в этом модуле хранятся основные виджеты системы, унаследованные от <code>SWidget</code>. Данный модуль можно найти по пути <code>\Engine\Source\Runtime\Slate</code>. 
<a class="glightbox" href="../images/736b8df7394a2f3626f371f7bbb5378a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="736b8df7394a2f3626f371f7bbb5378a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/736b8df7394a2f3626f371f7bbb5378a.png" /></a></li>
</ul>
<p>Для использования виджетов <code>Slate</code> надо подключать в зависимостях оба этих модуля, поскольку они взаимосвязаны.</p>
<p>Давайте подключим зависимости к нашему модулю <code>SlateRuntimeModule</code>. Откройте файл <code>.build.cs</code>.</p>
<p><a class="glightbox" href="../images/ff53a3f45cf4aeee74f881b1c07aaf8e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ff53a3f45cf4aeee74f881b1c07aaf8e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ff53a3f45cf4aeee74f881b1c07aaf8e.png" /></a></p>
<p>И добавьте туда следующую строчку:
<div class="highlight"><pre><span></span><code><span class="n">PrivateDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Slate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SlateCore&quot;</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
Добавлять ее стоит после строки <code>PublicDependencyModuleNames</code>.</p>
<p><a class="glightbox" href="../images/10298ecdae3c04ce76fdabd380c0c91a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="10298ecdae3c04ce76fdabd380c0c91a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/10298ecdae3c04ce76fdabd380c0c91a.png" /></a></p>
<h2 id="slate">Виджеты Slate</h2>
<p>Виджеты системы <code>Slate</code> можно найти в двух папках, это:
- <code>\Runtime\Slate\Public\Widgets\</code> - основной набор виджетов, кнопки, панели, картинки и так далее.</p>
<p><a class="glightbox" href="../images/8fd190afe11d4190c4778ce28a761e96.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8fd190afe11d4190c4778ce28a761e96.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8fd190afe11d4190c4778ce28a761e96.png" /></a></p>
<ul>
<li><code>\Runtime\SlateCore\Public\Widgets\</code> - базовые виджеты и их логика.</li>
</ul>
<p><a class="glightbox" href="../images/7e2ba20410f534d36299b23ac5b15fc5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7e2ba20410f534d36299b23ac5b15fc5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7e2ba20410f534d36299b23ac5b15fc5.png" /></a></p>
<p>Функционально основные виджеты <code>Slate</code> дублируют своих более высокоуровневых потомков из системы <code>UMG</code>. Поэтому, крайне полезно было бы изучить <code>UMG</code> виджеты и уже потом программировать в <code>Slate</code>.
Давайте откроем движок и создадим <code>UMG</code> виджет для наших тестов.</p>
<p>В <code>Content Browser'е</code> идем <code>Add -&gt; User Interface -&gt; Widget Blueprint</code>, чтобы создать тестовый виджет. 
<a class="glightbox" href="../images/99c1105eab4746ee1fc086b25454e07e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="99c1105eab4746ee1fc086b25454e07e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/99c1105eab4746ee1fc086b25454e07e.png" /></a></p>
<p>Я назвал его <code>UMG_TestWidget</code>. 
<a class="glightbox" href="../images/772a0ba11a985d5faf750329b6a494db.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="772a0ba11a985d5faf750329b6a494db.png" auto_="auto;" display="block;" margin:="margin:" src="../images/772a0ba11a985d5faf750329b6a494db.png" /></a></p>
<p>Если открыть созданный нами виджет то можно увидеть пустое окно редактора <code>UMG</code> с палитрой доступных виджетов в левом углу экрана.</p>
<p><a class="glightbox" href="../images/e67ac15e5ffd1fac7d06979039f9e40b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e67ac15e5ffd1fac7d06979039f9e40b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e67ac15e5ffd1fac7d06979039f9e40b.png" /></a></p>
<p>Можно перетащить в редактор некоторые из виджетов. Например: контейнер <code>Canvas</code> и кнопку в него.</p>
<p><a class="glightbox" href="../images/1e4205a7764554b6ef72a234b7e3449a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1e4205a7764554b6ef72a234b7e3449a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1e4205a7764554b6ef72a234b7e3449a.png" /></a></p>
<p>В правой части редактора находится панель <code>Details</code> с полным набором параметров выбранного виджета. Эти параметры полностью совпадают с теми, которые есть у классов <code>Slate</code>.
Если открыть класс <code>SButton</code>, то в его параметрах можно будет увидеть почти все то-же самое, что и в редакторе <code>UMG</code>.</p>
<p><a class="glightbox" href="../images/1b997990d3d62f90789f410e8c86109f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1b997990d3d62f90789f410e8c86109f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1b997990d3d62f90789f410e8c86109f.png" /></a></p>
<p>Поэтому, если вам надо понять, как работает тот или иной <code>Slate</code> виджет, вы можете использовать редактор <code>UMG</code> с тем-же самым виджетом, для понимания. И хотя имена переменных с парметрами иногда отличаются (потому что <code>UMG</code> виджеты отличаются от своих собратьев в <code>Slate</code>), их ключевой функционал и поведение совпадают.</p>
<p>Например: панель <code>Canvas</code> в <code>UMG</code> работает точно так-же как <code>SConstraintCanvas</code>, а панель <code>Overlay</code> работает как <code>SOverlay</code>.</p>
<h3 id="slate_1">Сборка интерфейса с применением <code>Slate</code></h3>
<p>Основным преимуществом <code>Slate</code> перед <code>UMG</code> (помимо производительности) является возможность быстрой сборки и вывода на экран <code>UI</code> виджетов почти из любого класса, в котором есть доступ к объекту <code>GEngine-&gt;GameViewport</code>.
Поскольку в движке уже есть готовые виджеты, система позволяет собрать из них примитивный <code>UI</code>, практически из любого класса. При этом данный <code>UI</code> сможет обрабатывать события, выводить текст и скалироваться по размеру экрана.</p>
<p>У в главе "Подготовка к работе", я уже создал класс <code>ASlateRuntimePlayerController</code>. Предлагаю использовать этот класс для сборки и вывода на экран простого интерфейса.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span><span class="c1"> // our ui is compound widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SConstraintCanvas.h&quot;</span><span class="c1"> // Slate Canvas</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span>
<span class="c1">// Begin Play</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GEngine</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// This will be called on button click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">ClickDelegate</span><span class="p">;</span>
<span class="w">    </span><span class="n">ClickDelegate</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Button Clicked!&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// Slate UI</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SConstraintCanvas</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="p">)</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="mf">0.2f</span><span class="p">,</span><span class="mf">0.8f</span><span class="p">})</span><span class="w"> </span><span class="c1">// down left</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;TestButton&quot;</span><span class="p">)))</span>
<span class="w">            </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">ClickDelegate</span><span class="p">)</span><span class="w"> </span><span class="c1">// bind click event</span>
<span class="w">            </span><span class="p">.</span><span class="n">ContentPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">10.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">15.0f</span><span class="p">})</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">;</span><span class="w"> </span><span class="c1">// end</span>
<span class="w">    </span><span class="c1">// Add Background to our Canvas with Button</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SOverlay</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BGOverlay</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span><span class="w"> </span><span class="c1">// fill whole space</span>
<span class="w">        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="c1">// Border widget works as background color sourse</span>
<span class="w">            </span><span class="c1">// will be better if you use just SImage, but as example i picked up Border</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// just demo of using Slate Brush on c++</span>
<span class="w">                </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CanvasOverlayBG&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">                </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span><span class="w"> </span><span class="c1">// draw as</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()[</span>
<span class="w">            </span><span class="n">Canvas</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">()</span><span class="w"> </span><span class="c1">// this will put canvas into overlay</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">;</span><span class="w"> </span><span class="c1">// end</span>
<span class="w">    </span><span class="c1">// Add generated UI to Veiwport</span>
<span class="w">    </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GameViewport</span><span class="o">-&gt;</span><span class="n">AddViewportWidgetForPlayer</span><span class="p">(</span><span class="n">GetLocalPlayer</span><span class="p">(),</span><span class="w"> </span><span class="n">BGOverlay</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Указанный выше код я добавил вкласс <code>ASlateRuntimePlayerController</code> в событие <code>BeginPlay</code>.</p>
<p><a class="glightbox" href="../images/546db0c273ea1893d07f56bfa1305ab5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="546db0c273ea1893d07f56bfa1305ab5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/546db0c273ea1893d07f56bfa1305ab5.png" /></a></p>
<p>При запуске проекта, в левом нижнем углу перед нами появится кнопка <code>Test Button</code> на сером фоне. Нажатие на кнопку будет печатать текст <code>Button Clicked!</code>.</p>
<p><a class="glightbox" href="../images/f02c72f74679ba9f72949ab3133c9c41.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f02c72f74679ba9f72949ab3133c9c41.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f02c72f74679ba9f72949ab3133c9c41.png" /></a></p>
<p>Можно загрузить на фон, например, текстуру.</p>
<p>Делается это так:
<div class="highlight"><pre><span></span><code><span class="n">UTexture</span><span class="o">*</span><span class="w"> </span><span class="n">Texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UTexture</span><span class="o">&gt;</span><span class="p">(</span><span class="n">StaticLoadObject</span><span class="p">(</span><span class="n">UTexture</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Texture2D&#39;/Game/Characters/Textures/2344444_original.2344444_original&#39;&quot;</span><span class="p">)));</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Texture</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Border widget works as background color sourse</span>
<span class="c1">// will be better if you use just SImage, but as example i picked up Border</span>
<span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// just demo of using Slate Brush on c++</span>
<span class="w">    </span><span class="n">Texture</span><span class="p">,</span><span class="w"> </span><span class="c1">// image path comes here</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">    </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span><span class="w"> </span><span class="c1">// draw as</span>
<span class="p">})</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/9997ef58a2382b9b76b3d08b3c1830c3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9997ef58a2382b9b76b3d08b3c1830c3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9997ef58a2382b9b76b3d08b3c1830c3.png" /></a></p>
<h3 id="slate_2">Макросы инициализации виджетов <code>Slate</code></h3>
<p>В приведенном выше коде я часто использовал макрос <code>SNew</code>. Это макрос ингициализации виджета. Есть еще два таких-же макроса(всего их три).
Давайте рассмотрим макросы инициализации виджетов <code>Slate</code>.</p>
<h4 id="snew">Макрос <code>SNew</code></h4>
<p><code>SNew( WidgetType, ... )</code>  - создает объект виджета, возвращая  <code>TSharedPtr&lt;WidgetType&gt;</code> в присвоенную переменную.
<div class="highlight"><pre><span></span><code><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ButtonSNew</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SNew Button&quot;</span><span class="p">)))</span>
<span class="w">    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">);</span>
</code></pre></div>
Благодаря декларативному синтаксису аргументов в виджетах <code>Slate</code> мы можем указывать параметры объекта, созданного через <code>SNew</code>, сразу после его инициализации.</p>
<h4 id="sassignnew">Макрос <code>SAssignNew</code></h4>
<p><code>SAssignNew( ExposeAs, WidgetType, ... )</code> - создает объект типа <code>WidgetType</code> и  присваивает указатель на этот объект параметру <code>ExposeAs</code> (типа  <code>TSharedPtr&lt;WidgetType&gt;</code>). Этот макрос позволяет создать указатель на виджет в другом месте, а потом присвоить ему значение.
<div class="highlight"><pre><span></span><code><span class="c1">// SAssignNew</span>
<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ButtonSAssignNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">SAssignNew</span><span class="p">(</span><span class="n">ButtonSAssignNew</span><span class="p">,</span><span class="w"> </span><span class="n">SButton</span><span class="p">)</span>
<span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SAssignNew Button&quot;</span><span class="p">)))</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">);</span>
</code></pre></div></p>
<h4 id="sargumentnew">Макрос <code>SArgumentNew</code></h4>
<p><code>SArgumentNew( InArgs, WidgetType, ... )</code> - позволяет предзадать аргументы для виджета в обход декларативного синтаксиса. Аргументы  передаются первым праметром - <code>InArgs</code>, а класс виджета - вторым параметром <code>WidgetType</code>. Этот макрос возвращает <code>TSharedPtr&lt;WidgetType&gt;</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// SArgumentNew</span>
<span class="n">SButton</span><span class="o">::</span><span class="n">FArguments</span><span class="w"> </span><span class="n">ButtonArgs</span><span class="p">;</span>
<span class="n">ButtonArgs</span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ButtonSArgNew Button&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">);</span>
<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ButtonSArgNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SArgumentNew</span><span class="p">(</span><span class="n">ButtonArgs</span><span class="p">,</span><span class="w"> </span><span class="n">SButton</span><span class="p">);</span>
</code></pre></div></p>
<hr />
<p>В приведенных выше фрагментах я создал 3 кнопки, которые были добавлены в тестовый код следующим образом:
<div class="highlight"><pre><span></span><code><span class="c1">// Quick UI Sample</span>
<span class="c1">// This will be called on button click</span>
<span class="n">FOnClicked</span><span class="w"> </span><span class="n">ClickDelegate</span><span class="p">;</span>
<span class="n">ClickDelegate</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Button Clicked!&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="c1">// SArgumentNew</span>
<span class="n">SButton</span><span class="o">::</span><span class="n">FArguments</span><span class="w"> </span><span class="n">ButtonArgs</span><span class="p">;</span>
<span class="n">ButtonArgs</span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ButtonSArgNew Button&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">);</span>
<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ButtonSArgNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SArgumentNew</span><span class="p">(</span><span class="n">ButtonArgs</span><span class="p">,</span><span class="w"> </span><span class="n">SButton</span><span class="p">);</span>
<span class="c1">// SNew</span>
<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ButtonSNew</span><span class="w"> </span><span class="o">=</span>
<span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SNew Button&quot;</span><span class="p">)))</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">);</span>
<span class="c1">// SAssignNew</span>
<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ButtonSAssignNew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">SAssignNew</span><span class="p">(</span><span class="n">ButtonSAssignNew</span><span class="p">,</span><span class="w"> </span><span class="n">SButton</span><span class="p">)</span>
<span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SAssignNew Button&quot;</span><span class="p">)))</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">);</span>
<span class="c1">// Slate UI</span>
<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SConstraintCanvas</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span>
<span class="n">SNew</span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="p">)</span>
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="mf">0.2f</span><span class="p">,</span><span class="mf">0.8f</span><span class="p">})</span><span class="w"> </span><span class="c1">// down left</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;TestButton&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">ClickDelegate</span><span class="p">)</span><span class="w"> </span><span class="c1">// bind click event</span>
<span class="w">        </span><span class="p">.</span><span class="n">ContentPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">10.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">15.0f</span><span class="p">})</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// ButtonSNew slot</span>
<span class="w">    </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="mf">0.5f</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">ButtonSNew</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">()</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// ButtonSAssignNew slot</span>
<span class="w">    </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="mf">0.6f</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">ButtonSAssignNew</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">()</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// ButtonSArgNew slot</span>
<span class="w">    </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="mf">0.7f</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">ButtonSArgNew</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">()</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/ac15c5b91566a42196d8487eb39f7c4c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ac15c5b91566a42196d8487eb39f7c4c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ac15c5b91566a42196d8487eb39f7c4c.png" /></a></p>
<h3 id="_4">Добавление виджетов на экран</h3>
<p>Виджеты <code>Slate</code> можно добавлять на экран везде, где доступен объект <code>GEngine-&gt;GameViewport</code>. Сначала вызывается один из макросов иницилизации виджета, например <code>SNew</code> и декларативным синтакисом создается нужная структура элементов управления.</p>
<p>Добавление полученных элементов на экран осуществляется так:
<div class="highlight"><pre><span></span><code><span class="c1">// Add generated UI to Veiwport</span>
<span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GameViewport</span><span class="o">-&gt;</span><span class="n">AddViewportWidgetForPlayer</span><span class="p">(</span><span class="n">GetLocalPlayer</span><span class="p">(),</span><span class="w"> </span><span class="n">WidgetPointer</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">(),</span><span class="w"> </span><span class="n">ZIndex</span><span class="p">);</span>
</code></pre></div>
Где:
 + <code>WidgetPointer</code>  - указатель на виджет, созданный через <code>SNew</code> и размещенный в <code>TSharedPtr</code>.
 + <code>ZIndex</code> - уровень слоя, на котором выводится виджет. Срабатывает при наложении виджетов друг на друга.</p>
<p>Теперь, когда вы знаете как пользоваться уже имеющимися в системе виджетами <code>Slate</code>, давайте изучим, как написать собственный виджет.</p>
<h2 id="_5">Программируем собственный виджет</h2>
<p>Изучим создание собственных виджетов для системы <code>Slate</code>.</p>
<h3 id="_6">Наследование</h3>
<p>Базовым классом для каждого виджета <code>Slate</code> является <code>SWidget</code>, найти его можно в файле <code>\Runtime\SlateCore\Public\Widgets\SWidget.h</code>. Однако, если мы откроем его комментарии, то увидим явное предупреждение от разработчиков:
<div class="highlight"><pre><span></span><code><span class="n">STOP</span><span class="p">.</span><span class="w"> </span><span class="n">DO</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">INHERIT</span><span class="w"> </span><span class="n">DIRECTLY</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">WIDGET</span><span class="o">!</span>
<span class="c1">// СТОП. НЕЛЬЗЯ НАСЛЕДОВАТЬ НАПРЯМУЮ ОТ WIDGET</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/aa4f077548c1d02ba6274aa78a90d70d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="aa4f077548c1d02ba6274aa78a90d70d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/aa4f077548c1d02ba6274aa78a90d70d.png" /></a></p>
<p>Наследовать виджеты <code>Slate</code> можно от следующих классов:
<code>SCompoundWidget</code> - базовый класс для элементов управления.
+ можно вложить в другие виджеты
+ может выступать контейнером для других виджетов
Большинство виджетов системы являются <code>SCompoundWidget</code>, в частности это: <code>SButton</code>, <code>SBorder</code>, <code>SSlider</code> и так далее.</p>
<p><a class="glightbox" href="../images/1cb708c79362a34751c35d96c823e9f4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1cb708c79362a34751c35d96c823e9f4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1cb708c79362a34751c35d96c823e9f4.png" /></a></p>
<p><code>SUserWidget</code> - базовый класс для виджетов, которые не планируется использовать внутри других виджетов. То есть класс для сборных виджетов, например: меню, экран загрузки, странца настроек, интерфейса игрока.
+ может выступать контейнером для других виджетов
- нельзя вложить в другие виджеты</p>
<p><a class="glightbox" href="../images/be1972be704c7f2e2459b27298810696.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="be1972be704c7f2e2459b27298810696.png" auto_="auto;" display="block;" margin:="margin:" src="../images/be1972be704c7f2e2459b27298810696.png" /></a></p>
<p><code>SLeafWidget</code> - базовый класс для виджетов, в которые не планируется ничего вкладывать. Часто используется для элементов управления движка Unral Engine.
- не может быть контейнером для других виджетов
+ можно вложить в другие виджеты
Примером <code>SLeafWidget</code> является <code>SColorGradingPicker</code>.</p>
<p><a class="glightbox" href="../images/70e57a23a3ae682df07942650c7fb2a9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="70e57a23a3ae682df07942650c7fb2a9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/70e57a23a3ae682df07942650c7fb2a9.png" /></a></p>
<h3 id="slate_3">Структура виджета <code>Slate</code></h3>
<p>Рассмотрим процесс создания виджета.</p>
<p>Идем <code>Tools -&gt; New C++ Class -&gt; Slate Widget</code>.</p>
<p><a class="glightbox" href="../images/950ff9f603fe1dd3d072c297fb1779d2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="950ff9f603fe1dd3d072c297fb1779d2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/950ff9f603fe1dd3d072c297fb1779d2.png" /></a></p>
<p>Называем виджет <code>GameScreenWidget</code>.</p>
<p><a class="glightbox" href="../images/e123ca5169336e7231dc7be33a1c14c6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e123ca5169336e7231dc7be33a1c14c6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e123ca5169336e7231dc7be33a1c14c6.png" /></a></p>
<p>В результате для нас будет сгенерирован почти готовый базовый виджет <code>Slate</code> с таким содержимым:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="cm">/** Constructs this widget with InArgs */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="o">::</span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    ChildSlot</span>
<span class="cm">    [</span>
<span class="cm">        // Populate the widget</span>
<span class="cm">    ];</span>
<span class="cm">    */</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
</code></pre></div>
В приведенном выше коде уже присутствуют все ключевые элементы, свойственные виджетам <code>Slate</code>, а именно: секция аргументов и метод <code>Construct</code>.</p>
<h4 id="_7">Добавление аргументов</h4>
<p>Аргументы могут быть переданы виджету после его создания.
<div class="highlight"><pre><span></span><code><span class="n">SNew</span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="p">)</span>
<span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">})</span>
<span class="p">[]</span>
</code></pre></div>
В приведенном выше примере все строки, указанные после макроса <code>SNew</code>, являются аргументами виджета <code>SConstraintCanvas</code>.
Аргументы задаются в секции между двумя макросами:
* <code>SLATE_BEGIN_ARGS(SWidgetClass):_Argument(DefaultValue){}</code> - открывает секцию аргументов.
* <code>SLATE_END_ARGS()</code> - закрывает секцию аргументов.</p>
<p>Макросы аргументов всегда должны указываться в <code>public</code> секции класса.</p>
<p><a class="glightbox" href="../images/6f2c90516020ae5b6edf1c26c31829a9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6f2c90516020ae5b6edf1c26c31829a9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6f2c90516020ae5b6edf1c26c31829a9.png" /></a></p>
<p>Формат:
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="o">:</span><span class="w"> </span><span class="c1">// public scope is important for args section!</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SWidgetClass</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="c1">// open arguments section</span>
<span class="w">        </span><span class="n">_Argument1</span><span class="p">(</span><span class="n">DefaultValue1</span><span class="p">)</span>
<span class="w">        </span><span class="n">_Argument2</span><span class="p">(</span><span class="n">DefaultValue2</span><span class="p">)</span>
<span class="w">        </span><span class="n">_WidgetSlotArgument</span><span class="p">()</span><span class="w"> </span><span class="c1">// widget slot without args</span>
<span class="w">        </span><span class="p">{}</span>
<span class="w">        </span><span class="c1">// argument types definition</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">FLinearColor</span><span class="p">,</span><span class="w"> </span><span class="n">Argument1</span><span class="p">)</span><span class="w"> </span><span class="c1">// Argument1 will be of type FLinearColor</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">EHorizontalAlignment</span><span class="p">,</span><span class="w"> </span><span class="n">Argument2</span><span class="p">)</span><span class="w"> </span><span class="c1">// Argument2 will be of type EHorizontalAlignment</span>
<span class="w">        </span><span class="c1">// adding any other widgets slot</span>
<span class="w">        </span><span class="n">SLATE_DEFAULT_SLOT</span><span class="p">(</span><span class="w"> </span><span class="n">FArguments</span><span class="p">,</span><span class="w"> </span><span class="n">WidgetSlotArgument</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_EVENT</span><span class="p">(</span><span class="w"> </span><span class="n">FSimpleDelegate</span><span class="p">,</span><span class="w"> </span><span class="n">OnPressed</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// use it if we want to turn class variable delegate with type FSimpleDelegate and name OnClicked into SlateEvent</span>
<span class="w">        </span><span class="c1">// ... Other Attributes</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span><span class="w"> </span><span class="c1">// close arguments section</span>

<span class="c1">// args, like Events and Slots should be declared outside of macro in private section</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="cm">/* The delegate to execute when the button is pressed */</span>
<span class="w">    </span><span class="n">FSimpleDelegate</span><span class="w"> </span><span class="n">OnPressed</span><span class="p">;</span>
</code></pre></div>
Макросы <code>SLATE_ATTRIBUTE</code>, <code>SLATE_DEFAULT_SLOT</code>, <code>SLATE_EVENT</code> являются макросами аргументов и задают, соответственно, переменную, слот для виджета и привязку события.</p>
<p>Давайте добавим нашему виджету, например, аргумент строки. Поскольку виджет у нас называется <code>GameScreen</code>, то, очевидно, строкой будет <code>CharacterName</code>. Так-же добавим атрибуты для здоровья и выносливости.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/PlayerController.h&quot;</span><span class="c1"> // Player Controller</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/DeclarativeSyntaxSupport.h&quot;</span><span class="c1"> // SNew, SLATE_SLOT_ARGUMENT</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;SGameScreenWidgetNamespace&quot; </span><span class="c1">// to use FText</span>
<span class="c1">// ...</span>
<span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Default values for arguments</span>
<span class="w">    </span><span class="n">_CharacterName</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;CharacterNameReplacer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hero&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">_CharacterHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">_CharacterStamina</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// Arguments</span>
<span class="w">    </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">FText</span><span class="p">,</span><span class="w"> </span><span class="n">CharacterName</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">CharacterHealth</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">CharacterStamina</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">APlayerController</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerController</span><span class="p">)</span><span class="w"> </span><span class="c1">// args that dosen&#39;t have default value - always should be sed during widget construction</span>
<span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="c1">//...</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/61aa944b6d14c0f447038d95b10505f7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="61aa944b6d14c0f447038d95b10505f7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/61aa944b6d14c0f447038d95b10505f7.png" /></a></p>
<h4 id="_construct">Метод <code>_Construct</code></h4>
<p>Использование аргументов доступно в методе <code>_Construct</code> - ключевом методе виджета, в котором осуществляется его сборка.</p>
<p>Получение значений аргументов доступно из парамера <code>const FArguments&amp; InArgs</code>.
Добавим в этом методе полоски здоровья и выносливости.
<div class="highlight"><pre><span></span><code><span class="c1">// .h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SConstraintCanvas.h&quot;</span><span class="c1"> // SConstraintCanvas widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Notifications/SProgressBar.h&quot;</span><span class="c1"> // SProgressBar widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Text/STextBlock.h&quot;</span><span class="c1"> // STextBlock widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/DeclarativeSyntaxSupport.h&quot;</span><span class="c1"> // SNew, SLATE_SLOT_ARGUMENT</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SlateControlledConstruction.h&quot;</span><span class="c1"> // SLATE_DECLARE_WIDGET</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;SGameScreenWidgetNamespace&quot; </span><span class="c1">// to use FText</span>
<span class="c1">// class SGameScreenWidget</span>
<span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Default values for arguments</span>
<span class="w">    </span><span class="n">_CharacterName</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;CharacterNameReplacer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hero&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">_CharacterMaxHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">_CharacterMaxStamina</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// Arguments</span>
<span class="w">    </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">FText</span><span class="p">,</span><span class="w"> </span><span class="n">CharacterName</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">CharacterMaxHealth</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">CharacterMaxStamina</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">APlayerController</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerController</span><span class="p">)</span><span class="w"> </span><span class="c1">// args that dosen&#39;t have default value - always should be sed during widget construction</span>
<span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Exposed controls</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SProgressBar</span><span class="o">&gt;</span><span class="w"> </span><span class="n">HealthProgressBar</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SProgressBar</span><span class="o">&gt;</span><span class="w"> </span><span class="n">StaminaProgressBar</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">STextBlock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CharacterName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Stats</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// sill be set in Construct</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">// .cpp</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameScreenWidget::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//ColorAttribute.Bind(*this, []()-&gt;FLinearColor{ return FLinearColor::Red; });</span>
<span class="w">    </span><span class="c1">// this is how to track viewport resize if necessary</span>
<span class="w">    </span><span class="cm">/* GEngine-&gt;GameViewport-&gt;Viewport-&gt;ViewportResizedEvent.AddLambda([this](FViewport* Viewport, uint32 Unused)-&gt;void {</span>
<span class="cm">        UE_LOG(LogTemp, Warning, TEXT(&quot;Viewport Resized!&quot;))</span>
<span class="cm">    });*/</span>
<span class="w">    </span><span class="n">FSimpleDelegate</span><span class="w"> </span><span class="n">EventArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_ButtonPressEvent</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Stats</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_CharacterMaxHealth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_CharacterMaxStamina</span><span class="p">;</span>
<span class="w">    </span><span class="n">CurrentHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">;</span><span class="w"> </span><span class="c1">// since there is no actual stat system implemented</span>
<span class="w">    </span><span class="n">CurrentStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaxStamina</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Styles</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">ButtonFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;EmbossedText&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">ButtonFont</span><span class="p">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">45</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">NormalFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;NormalFont&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">CharacterNameFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;EmbossedText&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">CharacterNameFont</span><span class="p">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// On &quot;+&quot; button click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">OnIncreaseHealth</span><span class="p">;</span>
<span class="w">    </span><span class="n">OnIncreaseHealth</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">,</span><span class="w"> </span><span class="n">EventArgs</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">EventArgs</span><span class="p">.</span><span class="n">ExecuteIfBound</span><span class="p">();</span><span class="w"> </span><span class="c1">// call argument event</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Health1P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">MaxHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1% of health</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NewHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">CurrentHealth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5.f</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">)</span><span class="w"> </span><span class="n">CurrentHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">;</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Health1P</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">Percent</span><span class="p">);</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Health Increased %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Percent</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// On &quot;-&quot; button click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">OnDecreaseHealth</span><span class="p">;</span>
<span class="w">    </span><span class="n">OnDecreaseHealth</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Health1P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">MaxHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1% of health</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NewHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">CurrentHealth</span><span class="mf">-5.f</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">)</span><span class="w"> </span><span class="n">CurrentHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">;</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Health1P</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">Percent</span><span class="p">);</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Health Decreased %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Percent</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">ChildSlot</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">5.0f</span><span class="p">)</span><span class="w"> </span><span class="c1">// offset</span>
<span class="w">                </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                    </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CharacterInfoBorder&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// here comes image path, but we need only the color of brush, image is unnecessary</span>
<span class="w">                    </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                    </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span><span class="w"> </span><span class="c1">// draw as</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SVerticalBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// health</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span><span class="w"> </span><span class="c1">// overlay text over progress bar</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">HealthProgressBar</span><span class="p">,</span><span class="w"> </span><span class="n">SProgressBar</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">FillColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Gray</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Percent</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;GameScrreen Health&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Health&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">NormalFont</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// stamina</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span><span class="w"> </span><span class="c1">// overlay text over progress bar</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">StaminaProgressBar</span><span class="p">,</span><span class="w"> </span><span class="n">SProgressBar</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">FillColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Percent</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;GameScrreen Stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Stamina&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Margin</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">})</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">NormalFont</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// character name</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">AutoHeight</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">CharacterNameBlock</span><span class="p">,</span><span class="w"> </span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Justification</span><span class="p">(</span><span class="n">ETextJustify</span><span class="o">::</span><span class="n">Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_CharacterName</span><span class="p">)</span><span class="w"> </span><span class="c1">// set character name</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">CharacterNameFont</span><span class="p">)</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="mf">2.f</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnDecreaseHealth</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnIncreaseHealth</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span><span class="w"> </span><span class="c1">// SBorder</span>
<span class="w">            </span><span class="p">]</span><span class="w"> </span><span class="c1">// SConstraint Canvas</span>
<span class="w">        </span><span class="p">]</span><span class="w"> </span><span class="c1">// ChildSlot</span>
<span class="w">    </span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/76ecb71e003991101f4d70119261894e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="76ecb71e003991101f4d70119261894e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/76ecb71e003991101f4d70119261894e.png" /></a></p>
<p>Приведенный код создает две полоски прогресс баров для выносливости и здоровья с текстовым описанием, строчку с именем персонажа, а так-же две кнопки. Нажимая на кнопки пользователь может влиять на уровень здоровья, отображаемый в полоске здоровья.</p>
<p><a class="glightbox" href="../images/bdcc866b0430282de31eb6f00ab55d24.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bdcc866b0430282de31eb6f00ab55d24.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bdcc866b0430282de31eb6f00ab55d24.png" /></a></p>
<p>Откуда я взял значения для параметра <code>Anchors</code> у <code>SConstraintCanvas</code>?
Параметр <code>.Anchors(FAnchors{0.1f, 0.1f, 0.3f, 0.3f})</code> у класса <code>SConstraintCanvas</code> работает следующим образом:
<code>.Anchors(FAnchors{FirstPointX, FirstPointY, SecondPointX, SecondPointY})</code>
Позиции <code>Anchors</code> указываются не в пикселях, а в процентах. Значение <code>0.1</code> соответствует <code>10%</code> от размера экрана.</p>
<p>Где:
<code>FirstPointX</code> - позиция первой точки по оси <code>X</code>.
<code>FirstPointY</code> - позиция первой точки по оси <code>Y</code>.
<code>SecondPointX</code> - позиция второй точки по оси <code>X</code>.
<code>SecondPointY</code> - позиция второй точки по оси <code>Y</code>.</p>
<p><a class="glightbox" href="../images/d055929971c834c318de066baa7890c6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d055929971c834c318de066baa7890c6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d055929971c834c318de066baa7890c6.png" /></a></p>
<p>Чтобы управлять прогресс баром здоровья я привязал к нему указатель используя макрос <code>SAssignNew(HealthProgressBar, SProgressBar)</code>.
Кнопки, управляющие показателем здоровья вызывают лямбда выражения, потому что так быстрее и удобнее.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/e3f96cbc3aedf07b7272bd4a46126980.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e3f96cbc3aedf07b7272bd4a46126980.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e3f96cbc3aedf07b7272bd4a46126980.png" /></a></p>
<p>При инициализации виджета мы можем изменить, например, выводимое имя персонажа, используя аргументы.
<div class="highlight"><pre><span></span><code><span class="n">SAssignNew</span><span class="p">(</span><span class="n">UIContent</span><span class="p">,</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="p">)</span>
<span class="p">.</span><span class="n">CharacterName</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Arthas&quot;</span><span class="p">))</span>
<span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/d3ed096b1af35b09a8877596462f6cfe.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d3ed096b1af35b09a8877596462f6cfe.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d3ed096b1af35b09a8877596462f6cfe.png" /></a></p>
<h4 id="_8">Аргументы событий</h4>
<p>Чтобы вывести привязку события надо использовать макрос <code>SLATE_EVENT</code> в следующем формате:
<div class="highlight"><pre><span></span><code><span class="n">SLATE_EVENT</span><span class="p">(</span><span class="n">DelegateGeneratedClass</span><span class="p">,</span><span class="w"> </span><span class="n">EventName</span><span class="p">)</span>
</code></pre></div>
В <code>Unreal Engine</code> уже есть предзаданный тип делегата - <code>FSimpleDelegate</code>, я использовал его в примере.
<div class="highlight"><pre><span></span><code><span class="c1">// Events</span>
<span class="n">SLATE_EVENT</span><span class="p">(</span><span class="n">FSimpleDelegate</span><span class="p">,</span><span class="w"> </span><span class="n">ButtonPressEvent</span><span class="p">)</span><span class="w"> </span><span class="c1">// SimpleDelegate event</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/0f761f23a8ab532c4d59eab6947cf649.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0f761f23a8ab532c4d59eab6947cf649.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0f761f23a8ab532c4d59eab6947cf649.png" /></a></p>
<p>Я вызываю данный делегат по нажатию кнопки <code>+</code>, из обработчика соответствующего нажатия. Напоминаю, что за обработку кнопки <code>+</code> в моем коде отвечает лямбда.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/e3f96cbc3aedf07b7272bd4a46126980.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e3f96cbc3aedf07b7272bd4a46126980.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e3f96cbc3aedf07b7272bd4a46126980.png" /></a></p>
<p>В нее была добавлена следующая строчка:
<div class="highlight"><pre><span></span><code><span class="n">EventArgs</span><span class="p">.</span><span class="n">ExecuteIfBound</span><span class="p">();</span><span class="w"> </span><span class="c1">// call argument event</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/044ead285674393b9b1ce008946d6812.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="044ead285674393b9b1ce008946d6812.png" auto_="auto;" display="block;" margin:="margin:" src="../images/044ead285674393b9b1ce008946d6812.png" /></a></p>
<p>Привязку события к делегату я провел в классе <code>SlateRuntimePlayerController</code>. При создании виджета я передал ему в качестве параметра делегат <code>ArgumentEvent</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// SlateRuntimePlayerController</span>
<span class="c1">// BeginPlay</span>
<span class="n">FSimpleDelegate</span><span class="w"> </span><span class="n">ArgumentEvent</span><span class="p">;</span>
<span class="n">ArgumentEvent</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([]()</span><span class="o">-&gt;</span><span class="kt">void</span><span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Argument delegate is called&quot;</span><span class="p">))</span>
<span class="p">});</span>
<span class="n">SAssignNew</span><span class="p">(</span><span class="n">UIContent</span><span class="p">,</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="p">)</span>
<span class="p">.</span><span class="n">CharacterName</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Arthas&quot;</span><span class="p">))</span>
<span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="p">.</span><span class="n">ButtonPressEvent</span><span class="p">(</span><span class="n">ArgumentEvent</span><span class="p">);</span><span class="w"> </span><span class="c1">// bind</span>
<span class="p">;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/44bd6a49220e362a48a997b8c0338f86.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="44bd6a49220e362a48a997b8c0338f86.png" auto_="auto;" display="block;" margin:="margin:" src="../images/44bd6a49220e362a48a997b8c0338f86.png" /></a></p>
<p>Теперь, нажатие кнопки <code>+</code> на экране приводит к печати сообщения <code>Argument delegate is called</code>.</p>
<p><a class="glightbox" href="../images/1afec6e82748c7fe12a81b312f45b126.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1afec6e82748c7fe12a81b312f45b126.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1afec6e82748c7fe12a81b312f45b126.png" /></a></p>
<h4 id="_9">Атрибуты</h4>
<p>У аргументов <code>Slate</code> есть одно серьезное ограничение - использовать их можно только в методе <code>Construct</code>.</p>
<p><a class="glightbox" href="../images/f9d0261dbae2804ffdae999fb35d7199.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f9d0261dbae2804ffdae999fb35d7199.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f9d0261dbae2804ffdae999fb35d7199.png" /></a></p>
<p>Если мы попытаемся получить, например, имя персонажа <code>CharacterName</code> вне метода <code>Construct</code> - у нас ничего не получится.</p>
<p><a class="glightbox" href="../images/aa7036d21f496a22f4612d0e713bd637.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="aa7036d21f496a22f4612d0e713bd637.png" auto_="auto;" display="block;" margin:="margin:" src="../images/aa7036d21f496a22f4612d0e713bd637.png" /></a></p>
<p>Только в методе <code>Construct</code> есть доступ к параметру <code>InArgs</code>, который позволяет считывать значения аргументов.</p>
<p><a class="glightbox" href="../images/f23f457349228a08566f60fbfebcf79e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f23f457349228a08566f60fbfebcf79e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f23f457349228a08566f60fbfebcf79e.png" /></a></p>
<p>Но что если аргумент должен изменяться с течением времени? Например, мы бы хотели отслеживать в реальном времени уровень здоровья персонажа и или имя персонажа. Как быть в этом случае?
На помощ приходят атрибуты. Их установка - довольно трудоемкий процесс. Но атрибуты - единственный  способ обновлять состояние виджета с течением времени.</p>
<p>Для добавления  атрибутов следуйте следующей схеме:</p>
<h5 id="1">Шаг 1</h5>
<p>Добавляем переменные типа <code>TSlateAttribute</code>. Эти переменные задаются в <code>private</code>  секции класса и хранят текущее значение атрибута. Задать их извне класса нельзя.
<div class="highlight"><pre><span></span><code><span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Attributes</span>
<span class="w">    </span><span class="c1">// Pay Attention to variable order!</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/84373e5b25f0c0201cb04a6981ebbab2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="84373e5b25f0c0201cb04a6981ebbab2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/84373e5b25f0c0201cb04a6981ebbab2.png" /></a></p>
<h5 id="2">Шаг 2</h5>
<p>Добавляем значения по умолчанию для атрибутов к конструкторе. Для ВСЕХ атрибутов. Если вы не укажите значение хоть для одного из них - код не скомпилируется.
<div class="highlight"><pre><span></span><code><span class="n">SGameScreenWidget</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="c1">// our class name is SGameScreenWidget</span>
<span class="w">    </span><span class="c1">// Define TSlateAttribute default values here</span>
<span class="w">    </span><span class="c1">// Order Matters!</span>
<span class="w">    </span><span class="c1">// for ALL of them, or will be error</span>
<span class="w">    </span><span class="n">CurrentHealthAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">MaxHealthAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">CurrentStaminaAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">MaxStaminaAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="p">{}</span>
</code></pre></div></p>
<h5 id="3">Шаг 3</h5>
<p>Добавляем макросы для входных атрибутов. Через эти макросы можно будет установить значение атрибутов при создании класса.
<div class="highlight"><pre><span></span><code><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Input Attribute default values</span>
<span class="w">    </span><span class="c1">// for all of them</span>
<span class="w">    </span><span class="c1">// Order Matters!</span>
<span class="w">    </span><span class="n">_Health</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">_MaxHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">_Stamina</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">_MaxStamina</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// Input Attributes</span>
<span class="w">    </span><span class="c1">// Order Matters!</span>
<span class="w">    </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Stamina</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStamina</span><span class="p">)</span>
<span class="n">SLATE_END_ARGS</span><span class="p">()</span>
</code></pre></div>
Макросы <code>SLATE_ATTRIBUTE</code> создают переменные типа <code>TAttrribute</code>, которые можно присвоить в наши <code>TSlateAttribute</code> через макрос <code>Assign</code>.</p>
<h5 id="3_1">Шаг 3</h5>
<p>Добавляем т.н. "сеттеры" <code>Set_</code> - методы  установки значения атрибутов, и "геттеры" <code>Get_</code> - методы получения значений атрибутов.
<div class="highlight"><pre><span></span><code><span class="c1">// Getters / Setters</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SetHealth</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CurrentHealthAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SetMaxHealth</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">MaxHealthAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SetStamina</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CurrentStaminaAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">GetStamina</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SetMaxStamina</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">MaxStaminaAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">GetMaxStamina</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
Зачем эти методы нужны? Дело в том, что значения и аргументов и атрибутов не поддаются изменению после того, как виджет <code>Slate</code> загружается в память.</p>
<p>Например я конструирую виджет <code>SGameScreenWidget</code> в контроллере и могу задать те или иные значения переменным виджета следующим образом:
<div class="highlight"><pre><span></span><code><span class="n">SAssignNew</span><span class="p">(</span><span class="n">UIContent</span><span class="p">,</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="w"> </span><span class="c1">// crate game screen widget</span>
<span class="w">    </span><span class="p">.</span><span class="n">CharacterName</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Hero&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// name</span>
<span class="w">    </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">MaxHealth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">MaxStamina</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Health</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ButtonPressEvent</span><span class="p">(</span><span class="n">ArgumentEvent</span><span class="p">);</span>
</code></pre></div>
Переменная <code>UIContent</code> получает текущее  состояние виджета. Однако я не смогу изменить значение <code>CharacterName</code> используя эту переменную, потому что у меня нет метода <code>SetCharacterName</code> (и не будет, можете сами добавить).</p>
<p><a class="glightbox" href="../images/c739324ceab64a43d6714a44b46f0bba.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c739324ceab64a43d6714a44b46f0bba.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c739324ceab64a43d6714a44b46f0bba.png" /></a></p>
<p>Зато я смогу изменить значение здоровья используя метод <code>SetHealth</code>. Можно даже привязать нажатие кнопки <code>1</code> к установке здоровья на <code>300</code> единиц так:
<div class="highlight"><pre><span></span><code><span class="c1">// Input</span>
<span class="c1">// Bind to key &quot;1&quot;</span>
<span class="n">FInputKeyBinding</span><span class="w"> </span><span class="n">KB1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FInputKeyBinding</span><span class="p">(</span><span class="n">EKeys</span><span class="o">::</span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">EInputEvent</span><span class="o">::</span><span class="n">IE_Pressed</span><span class="p">);</span>
<span class="n">KB1</span><span class="p">.</span><span class="n">KeyDelegate</span><span class="p">.</span><span class="n">GetDelegateForManualSet</span><span class="p">().</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">](){</span>
<span class="w">    </span><span class="c1">// restore health to 100%</span>
<span class="w">    </span><span class="n">UIContent</span><span class="o">-&gt;</span><span class="n">SetHealth</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Key 1 Pressed&quot;</span><span class="p">))</span>
<span class="p">});</span>
<span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">KeyBindings</span><span class="p">.</span><span class="n">Emplace</span><span class="p">(</span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">KB1</span><span class="p">));</span>
</code></pre></div></p>
<h5 id="4">Шаг 4</h5>
<p>Добавляем методы обновления значений в элементах виджета. В данном случае в прогресс баре.</p>
<p>Предположим, был вызван метод <code>UIContent-&gt;SetHealth(300)</code>, после этого надо перерисовать виджет и обновить <code>%</code> здоровья, отображаемый в прогресс баре.</p>
<p>Для этих целей для начала добавляем метод <code>UpdateHealth</code> (для параметра <code>Stamina</code> делаем аналогичный метод тоже):
<div class="highlight"><pre><span></span><code><span class="c1">// will return health in %</span>
<span class="kt">float</span><span class="w"> </span><span class="nf">GetHealthPercent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will update health percent</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UpdateHealth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HealthProgressBar</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">GetHealthPercent</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will return stamina in %</span>
<span class="kt">float</span><span class="w"> </span><span class="nf">GetStaminaPercent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetStamina</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxStamina</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will update stamina percent</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UpdateStamina</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StaminaProgressBar</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StaminaProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">GetStaminaPercent</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h5 id="5">Шаг 5</h5>
<p>Добавляем поддержку метода <code>PrivateRegisterAttributes</code>.
Теперь нам надо как-то отследить изменение атрибутов здоровья и выносливости. Как это сделать? Старый способ реализации подразумевает обычную проверку изменения атрибута в методе <code>Paint</code> или <code>Tick</code>. Но, вы вероятно понимаете насколько такой подход плох для производительности.</p>
<p>В <code>Slate</code> есть паттерн, позволяющий использовать метод метод <code>PrivateRegisterAttributes</code> для отслеживания значений атрибутов виджета.</p>
<p>Для начала добавляем макрос  <code>SLATE_DECLARE_WIDGET</code> в заголовочном файле класса <code>.h</code> следующим образом:
<div class="highlight"><pre><span></span><code><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
</code></pre></div>
Шаблон этого макроса выглядит так:
<div class="highlight"><pre><span></span><code><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">WidgetClass</span><span class="p">,</span><span class="w"> </span><span class="n">WidgetParentClass</span><span class="p">)</span>
</code></pre></div>
Где <code>WidgetClass</code> - класс виджета, а <code>WidgetParentClass</code> - родительский класс виджета.</p>
<p>Макрос задается в <code>private</code> секции класса, в заголовочном файле, сразу после определения класса.</p>
<p><a class="glightbox" href="../images/c850b1a9f723daf141dc3bf47a582c83.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c850b1a9f723daf141dc3bf47a582c83.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c850b1a9f723daf141dc3bf47a582c83.png" /></a></p>
<p>Теперь идем в файле реализации класса <code>.cpp</code> и добавляем туда макрос <code>SLATE_IMPLEMENT_WIDGET</code> и метод <code>PrivateRegisterAttributes</code>.
Делается это следующим образом:
<div class="highlight"><pre><span></span><code><span class="n">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
</code></pre></div>
В методе <code>PrivateRegisterAttributes</code> мы можем использовать макрос <code>SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</code> доля добавления события, при изменении значения переменной.</p>
<p>Делается это так:
<div class="highlight"><pre><span></span><code><span class="n">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// this will invalidate widget&#39;s paint once Health is changed</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CurrentHealthAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateHealth</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Health Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MaxHealthAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateHealth</span><span class="p">();</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CurrentStaminaAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateStamina</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Stamina Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetStamina</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MaxStaminaAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateStamina</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Stamina Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetStamina</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Тут я привязал лямбда выражение к методу <code>OnValueChanged</code>, для отслеживания изменений каждого из наших атрибутов. Изменение значений будет приводить к вызову мтеодов <code>UpdateHealth</code> и <code>UpdateStamina</code>, помимо этого кеш перерисовки виджета будет сбрасываться. За перерисовку отвечает аргумент <code>EInvalidateWidgetReason</code>.</p>
<h5 id="6">Шаг 6</h5>
<p>Теперь необходимо связать входные атрибуты с атрибутами, которые хранят значения. Делается это в методе <code>Construct</code>, где мы можем считать значения атрибутов из параметра <code>InArgs</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// assign attributes _Health and _Stamina</span>
<span class="n">SetHealth</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Health</span><span class="p">);</span>
<span class="n">SetMaxHealth</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_MaxHealth</span><span class="p">);</span>
<span class="n">SetStamina</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Stamina</span><span class="p">);</span>
<span class="n">SetMaxStamina</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_MaxStamina</span><span class="p">);</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/6855871a58bb17e21797af0d429935a2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6855871a58bb17e21797af0d429935a2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6855871a58bb17e21797af0d429935a2.png" /></a></p>
<p>Я напомню, что наши методы линейки <code>Set</code> принимают аргументы типа <code>TAttribute</code>. Входные атрибуты как раз и являются <code>TAttribute</code>, поэтому их прекрасно можно передать в данные методы.</p>
<p><a class="glightbox" href="../images/3040fbb9d3646ee6f61cc96845b49341.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3040fbb9d3646ee6f61cc96845b49341.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3040fbb9d3646ee6f61cc96845b49341.png" /></a></p>
<p><a class="glightbox" href="../images/66755f59ca1a2e70a34cfea49bdee9c1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="66755f59ca1a2e70a34cfea49bdee9c1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/66755f59ca1a2e70a34cfea49bdee9c1.png" /></a></p>
<p><a class="glightbox" href="../images/7de93b5a00fcfac4143694c26f3f55e9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7de93b5a00fcfac4143694c26f3f55e9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7de93b5a00fcfac4143694c26f3f55e9.png" /></a></p>
<h5 id="_10">Послесловие</h5>
<p>Понять атрибуты крайне непросто. У знающего читателя может возникнуть очевидный вопрос - зачем нужны атрибуты, если можно использовать обычные геттеры и сеттеры, ведь из объекта виджета есть доступ к его внутренним методам.</p>
<p>Например, запросто можно сделать так:
<div class="highlight"><pre><span></span><code><span class="n">SAssignNew</span><span class="p">(</span><span class="n">UIContent</span><span class="p">,</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="w"> </span><span class="c1">// crate game screen widget</span>
<span class="w">    </span><span class="p">.</span><span class="n">CharacterName</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Hero&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// name</span>
<span class="w">    </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">MaxHealth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">MaxStamina</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Health</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ButtonPressEvent</span><span class="p">(</span><span class="n">ArgumentEvent</span><span class="p">);</span>
<span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GameViewport</span><span class="o">-&gt;</span><span class="n">AddViewportWidgetForPlayer</span><span class="p">(</span><span class="n">GetLocalPlayer</span><span class="p">(),</span><span class="w"> </span><span class="n">UIContent</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="c1">// call inline method directly</span>
<span class="n">UIContent</span><span class="o">-&gt;</span><span class="n">UpdateHealth</span><span class="p">();</span><span class="w"> </span><span class="c1">// this will work</span>
</code></pre></div>
Тут я обращаюсь к внутреннему методу класса <code>SGameScreenWidget</code>, а  именно к методу <code>UpdateHealth</code>.</p>
<p><a class="glightbox" href="../images/53b0dd4ee65a30fc92f17328efb8400f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="53b0dd4ee65a30fc92f17328efb8400f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/53b0dd4ee65a30fc92f17328efb8400f.png" /></a></p>
<p>Дело в том, что разработчик может вызвать внутренние методы виджета по его ссылке, но сделать то-же самое во время инициализации виджета макросами <code>SNew / SAssignNew</code> не получится.</p>
<p><a class="glightbox" href="../images/df0f34c947d749770b870fca9b99793c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="df0f34c947d749770b870fca9b99793c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/df0f34c947d749770b870fca9b99793c.png" /></a></p>
<p>Вызов функционала виджета <code>Slate</code> непосредственно во время инициализации возможен лишь с применением атрибутов. Внутренние функции вызвать вы так не сможете.
<div class="highlight"><pre><span></span><code><span class="n">SAssignNew</span><span class="p">(</span><span class="n">UIContent</span><span class="p">,</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="w"> </span><span class="c1">// crate game screen widget</span>
<span class="w">    </span><span class="p">.</span><span class="n">CharacterName</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Hero&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// name</span>
<span class="w">    </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">MaxHealth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">MaxStamina</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Health</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ButtonPressEvent</span><span class="p">(</span><span class="n">ArgumentEvent</span><span class="p">);</span>
<span class="w">    </span><span class="p">.</span><span class="n">UpdateHealth</span><span class="p">()</span><span class="w"> </span><span class="c1">// this will not work!</span>
<span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GameViewport</span><span class="o">-&gt;</span><span class="n">AddViewportWidgetForPlayer</span><span class="p">(</span><span class="n">GetLocalPlayer</span><span class="p">(),</span><span class="w"> </span><span class="n">UIContent</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">UIContent</span><span class="o">-&gt;</span><span class="n">UpdateHealth</span><span class="p">();</span><span class="w"> </span><span class="c1">// this will work</span>
</code></pre></div>
Многие разработчики (большинство) избегают применения <code>TSlateAttribute</code> из за плохой документации. Надеюсь мое короткое дополнение помогло вам понять смысл этого шаблона, потому что я собираюсь использовать его крайне активно.</p>
<p>Прочитать подробнее про атрибуты и их возможности можно в исходниках движка, в файле <code>\Runtime\SlateCore\Public\Types\SlateAttribute.h</code>.</p>
<p><a class="glightbox" href="../images/9dfa55fc8eabe9f74c3202c905e59baf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9dfa55fc8eabe9f74c3202c905e59baf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9dfa55fc8eabe9f74c3202c905e59baf.png" /></a></p>
<p>Тут приведен очень длинный комментарий, к сожалению, довольно скверно написанный. А  пример кода, приведенный в этом комментарии уже не работает (потому что написан он был очень давно). (Если честно, я не уверен что он работал хоть когда-то...)
Мне пришлось разбираться самостоятельно, на что ушло много времени и сил.</p>
<p>В интернете информации про атрибуты <code>Slate</code>, в данный момент, вы не найдете. Вот когда я опубликую книгу, найдутся те, кто ее перепечатает в личные бложики… Если уж вы это делаете - хоть на тушенку мне донат киньте, мне тут в деревне жрать нечего.</p>
<p><a class="glightbox" href="../images/35bf48df045f02db9b76afa932aad231.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="35bf48df045f02db9b76afa932aad231.png" auto_="auto;" display="block;" margin:="margin:" src="../images/35bf48df045f02db9b76afa932aad231.png" /></a></p>
<h4 id="_11">Код класса на данном этапе</h4>
<p>Прилагаю полный код класса на данном этапе разработки.</p>
<p><a class="glightbox" href="../images/fe9b79efb9214f91f90d3e91ef9b19aa.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fe9b79efb9214f91f90d3e91ef9b19aa.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fe9b79efb9214f91f90d3e91ef9b19aa.png" /></a></p>
<p>Файл <code>SGameScreenWidget.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span><span class="c1"> // SCompoundWidget widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/PlayerController.h&quot;</span><span class="c1"> // Player Controller</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Layout/LayoutUtils.h&quot;</span><span class="c1"> // to be used in OnArrangeChildren</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/Attribute.h&quot;</span><span class="c1"> // TSlateAttribute</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SConstraintCanvas.h&quot;</span><span class="c1"> // SConstraintCanvas widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Notifications/SProgressBar.h&quot;</span><span class="c1"> // SProgressBar widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Text/STextBlock.h&quot;</span><span class="c1"> // STextBlock widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/DeclarativeSyntaxSupport.h&quot;</span><span class="c1"> // SNew, SLATE_SLOT_ARGUMENT</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SlateControlledConstruction.h&quot;</span><span class="c1"> // SLATE_DECLARE_WIDGET</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;SGameScreenWidgetNamespace&quot; </span><span class="c1">// to use FText</span>
<span class="cm">/**</span>
<span class="cm"> * Game Screen Widget</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// Default values for arguments</span>
<span class="w">        </span><span class="n">_CharacterName</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;CharacterNameReplacer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hero&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="c1">// Input Attribute default values</span>
<span class="w">        </span><span class="n">_Health</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">_MaxHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">_Stamina</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">_MaxStamina</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">        </span><span class="p">{}</span>
<span class="w">        </span><span class="c1">// Arguments</span>
<span class="w">        </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">FText</span><span class="p">,</span><span class="w"> </span><span class="n">CharacterName</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">APlayerController</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerController</span><span class="p">)</span><span class="w"> </span><span class="c1">// args that dosen&#39;t have default value - always should be sed during widget construction</span>
<span class="w">        </span><span class="c1">// Events</span>
<span class="w">        </span><span class="n">SLATE_EVENT</span><span class="p">(</span><span class="n">FSimpleDelegate</span><span class="p">,</span><span class="w"> </span><span class="n">ButtonPressEvent</span><span class="p">)</span><span class="w"> </span><span class="c1">// SimpleDelegate event</span>
<span class="w">        </span><span class="c1">// Input Attributes</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Stamina</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStamina</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="n">SGameScreenWidget</span><span class="p">()</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// Define TSlateAttribute default values here</span>
<span class="w">        </span><span class="n">CurrentHealthAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">MaxHealthAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">CurrentStaminaAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">MaxStaminaAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// Constructs this widget with InArgs</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getters / Setters</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetHealth</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CurrentHealthAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetMaxHealth</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">MaxHealthAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return health in %</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetHealthPercent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will update health percent</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateHealth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HealthProgressBar</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">GetHealthPercent</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetStamina</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CurrentStaminaAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetStamina</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetMaxStamina</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">MaxStaminaAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetMaxStamina</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return stamina in %</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetStaminaPercent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetStamina</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxStamina</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will update stamina percent</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateStamina</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StaminaProgressBar</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">StaminaProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">GetStaminaPercent</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// SWidget Overrides</span>
<span class="w">    </span><span class="c1">// Called every widget re-paint</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="nf">OnPaint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPaintArgs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateRect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span>
<span class="w">                            </span><span class="n">FSlateWindowElementList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span>
<span class="w">                            </span><span class="n">int32</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FWidgetStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">bool</span><span class="w"> </span><span class="n">bParentEnabled</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Recomputes the volatility of the widget.</span>
<span class="w">    </span><span class="c1">// Will force Layout recalculation, for example after adding child widgets</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ComputeVolatility</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">ComputeVolatility</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Events like OnKeyDown, OnKeyUp and all others related to keyboard won&#39;t work without this</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">SupportsKeyboardFocus</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Attributes</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Exposed controls</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SProgressBar</span><span class="o">&gt;</span><span class="w"> </span><span class="n">HealthProgressBar</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SProgressBar</span><span class="o">&gt;</span><span class="w"> </span><span class="n">StaminaProgressBar</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">STextBlock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CharacterNameBlock</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
Файл <code>SGameScreenWidget.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SGameScreenWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;SGameScreenWidgetCppNamespace&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="nf">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// this will invalidate widget&#39;s paint once Health is changed</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CurrentHealthAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateHealth</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Health Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MaxHealthAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateHealth</span><span class="p">();</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CurrentStaminaAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateStamina</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Stamina Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetStamina</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MaxStaminaAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateStamina</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Stamina Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetStamina</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameScreenWidget::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// DelegateArgument</span>
<span class="w">    </span><span class="n">FSimpleDelegate</span><span class="w"> </span><span class="n">EventArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_ButtonPressEvent</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// assign attributes _Health and _Stamina</span>
<span class="w">    </span><span class="n">SetHealth</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Health</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetMaxHealth</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_MaxHealth</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetStamina</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Stamina</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetMaxStamina</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_MaxStamina</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Styles</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">ButtonFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;EmbossedText&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">ButtonFont</span><span class="p">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">45</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">NormalFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;NormalFont&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">CharacterNameFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;EmbossedText&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">CharacterNameFont</span><span class="p">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// On &quot;+&quot; button click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">OnIncreaseHealth</span><span class="p">;</span>
<span class="w">    </span><span class="n">OnIncreaseHealth</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">EventArgs</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">EventArgs</span><span class="p">.</span><span class="n">ExecuteIfBound</span><span class="p">();</span><span class="w"> </span><span class="c1">// call argument event</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Health1P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1% of health</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NewHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5.f</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">GetMaxHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">SetHealth</span><span class="p">(</span><span class="n">NewHealth</span><span class="p">);</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">Percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Health1P</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">            </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">Percent</span><span class="p">);</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Health Increased %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">GetHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// On &quot;-&quot; button click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">OnDecreaseHealth</span><span class="p">;</span>
<span class="w">    </span><span class="n">OnDecreaseHealth</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Health1P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1% of health</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NewHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5.f</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">){</span>
<span class="w">            </span><span class="n">SetHealth</span><span class="p">(</span><span class="n">NewHealth</span><span class="p">);</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">Percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Health1P</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">            </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">Percent</span><span class="p">);</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Health Decreased %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">GetHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="n">ChildSlot</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">5.0f</span><span class="p">)</span><span class="w"> </span><span class="c1">// offset</span>
<span class="w">                </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                    </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CharacterInfoBorder&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// here comes image path, but we need only the color of brush, image is unnecessary</span>
<span class="w">                    </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                    </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span><span class="w"> </span><span class="c1">// draw as</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SVerticalBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// health</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span><span class="w"> </span><span class="c1">// overlay text over progress bar</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">HealthProgressBar</span><span class="p">,</span><span class="w"> </span><span class="n">SProgressBar</span><span class="p">)</span><span class="w"> </span><span class="c1">// Health Bar</span>
<span class="w">                            </span><span class="p">.</span><span class="n">FillColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Gray</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Percent</span><span class="p">(</span><span class="n">GetHealthPercent</span><span class="p">())</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;GameScrreen Health&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Health&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">NormalFont</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// stamina</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span><span class="w"> </span><span class="c1">// overlay text over progress bar</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">StaminaProgressBar</span><span class="p">,</span><span class="w"> </span><span class="n">SProgressBar</span><span class="p">)</span><span class="w"> </span><span class="c1">// Stamina Bar</span>
<span class="w">                            </span><span class="p">.</span><span class="n">FillColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Percent</span><span class="p">(</span><span class="n">GetStaminaPercent</span><span class="p">())</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;GameScrreen Stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Stamina&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Margin</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">})</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">NormalFont</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// character name</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">AutoHeight</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">CharacterNameBlock</span><span class="p">,</span><span class="w"> </span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Justification</span><span class="p">(</span><span class="n">ETextJustify</span><span class="o">::</span><span class="n">Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_CharacterName</span><span class="p">)</span><span class="w"> </span><span class="c1">// set character name</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">CharacterNameFont</span><span class="p">)</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="mf">2.f</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnDecreaseHealth</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnIncreaseHealth</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span><span class="w"> </span><span class="c1">// SBorder</span>
<span class="w">            </span><span class="p">]</span><span class="w"> </span><span class="c1">// SConstraint Canvas</span>
<span class="w">        </span><span class="p">]</span><span class="w"> </span><span class="c1">// ChildSlot</span>
<span class="w">    </span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">// Called every widget re-paint</span>
<span class="n">int32</span><span class="w"> </span><span class="nf">SGameScreenWidget::OnPaint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPaintArgs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateRect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span>
<span class="w">                            </span><span class="n">FSlateWindowElementList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span>
<span class="w">                            </span><span class="n">int32</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FWidgetStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">bool</span><span class="w"> </span><span class="n">bParentEnabled</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// we can call SCompoundWidget::OnPaint to paint every visible children</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="o">::</span><span class="n">OnPaint</span><span class="p">(</span><span class="n">Args</span><span class="p">,</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span><span class="w"> </span><span class="n">bParentEnabled</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
Файл <code>SlateRuntimePlayerController.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/PlayerController.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SGameScreenWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span><span class="c1"> // our ui is compound widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SWeakWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SConstraintCanvas.h&quot;</span><span class="c1"> // Slate Canvas</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span>
<span class="c1">// Mapping Context</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputMappingContext.h&quot;</span>
<span class="c1">// Enhanced Input</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EnhancedInputSubsystems.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EnhancedInputComponent.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateRuntimePlayerController.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Playe controller used to show slate UI</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">ASlateRuntimePlayerController</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">APlayerController</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// our ui root widget</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&gt;</span><span class="w"> </span><span class="n">UIContent</span><span class="p">;</span><span class="w"> </span><span class="c1">// our game ui</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">ASlateRuntimePlayerController</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// BeginPlay</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span>
<span class="w">        </span><span class="n">UTexture</span><span class="o">*</span><span class="w"> </span><span class="n">Texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UTexture</span><span class="o">&gt;</span><span class="p">(</span><span class="n">StaticLoadObject</span><span class="p">(</span><span class="n">UTexture</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Texture2D&#39;/Game/Characters/Textures/2344444_original.2344444_original&#39;&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Texture</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GEngine</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">FSimpleDelegate</span><span class="w"> </span><span class="n">ArgumentEvent</span><span class="p">;</span>
<span class="w">            </span><span class="n">ArgumentEvent</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([]()</span><span class="o">-&gt;</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SlateRuntimeController] ButtonPressEvent triggered&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">UIContent</span><span class="p">,</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="w"> </span><span class="c1">// crate game screen widget</span>
<span class="w">                </span><span class="p">.</span><span class="n">CharacterName</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Hero&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// name</span>
<span class="w">                </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">MaxHealth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">MaxStamina</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Health</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">ButtonPressEvent</span><span class="p">(</span><span class="n">ArgumentEvent</span><span class="p">);</span>
<span class="w">            </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GameViewport</span><span class="o">-&gt;</span><span class="n">AddViewportWidgetForPlayer</span><span class="p">(</span><span class="n">GetLocalPlayer</span><span class="p">(),</span><span class="w"> </span><span class="n">UIContent</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// Input</span>
<span class="w">            </span><span class="c1">// Bind to key &quot;1&quot;</span>
<span class="w">            </span><span class="n">FInputKeyBinding</span><span class="w"> </span><span class="n">KB1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FInputKeyBinding</span><span class="p">(</span><span class="n">EKeys</span><span class="o">::</span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">EInputEvent</span><span class="o">::</span><span class="n">IE_Pressed</span><span class="p">);</span>
<span class="w">            </span><span class="n">KB1</span><span class="p">.</span><span class="n">KeyDelegate</span><span class="p">.</span><span class="n">GetDelegateForManualSet</span><span class="p">().</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">](){</span>
<span class="w">                </span><span class="c1">// restore health to 100%</span>
<span class="w">                </span><span class="n">UIContent</span><span class="o">-&gt;</span><span class="n">SetHealth</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="w">                </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Key 1 Pressed&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">KeyBindings</span><span class="p">.</span><span class="n">Emplace</span><span class="p">(</span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">KB1</span><span class="p">));</span>
<span class="w">            </span><span class="cm">/*</span>
<span class="cm">            //UEnhancedInputLocalPlayerSubsystem* Subsystem = ULocalPlayer::GetSubsystem&lt;UEnhancedInputLocalPlayerSubsystem&gt;(GetLocalPlayer());</span>
<span class="cm">            // Bind to key &quot;2&quot;</span>
<span class="cm">            UEnhancedInputComponent* EnhancedInputComponent = Cast&lt;UEnhancedInputComponent&gt;(InputComponent);</span>
<span class="cm">            // Bind Actions</span>
<span class="cm">            if (EnhancedInputComponent != nullptr) {</span>
<span class="cm">                FInputKeyBinding KB2 = FInputKeyBinding(EKeys::Two, EInputEvent::IE_Pressed);</span>
<span class="cm">                KB2.KeyDelegate.GetDelegateForManualSet().BindLambda([this]() {</span>
<span class="cm">                    UE_LOG(LogTemp, Warning, TEXT(&quot;Key 2 Pressed&quot;))</span>
<span class="cm">                });</span>
<span class="cm">                EnhancedInputComponent-&gt;KeyBindings.Emplace(MoveTemp(KB2));</span>
<span class="cm">            }*/</span>
<span class="w">            </span><span class="cm">/*</span>
<span class="cm">            // Quick UI Sample</span>
<span class="cm">            // This will be called on button click</span>
<span class="cm">            FOnClicked ClickDelegate;</span>
<span class="cm">            ClickDelegate.BindLambda([]() -&gt; FReply {</span>
<span class="cm">                    UE_LOG(LogTemp, Warning, TEXT(&quot;Button Clicked!&quot;));</span>
<span class="cm">                    return FReply::Handled();</span>
<span class="cm">                });</span>
<span class="cm">            // SArgumentNew</span>
<span class="cm">            SButton::FArguments ButtonArgs;</span>
<span class="cm">            ButtonArgs.Text( FText::FromString(TEXT(&quot;ButtonSArgNew Button&quot;)) );</span>
<span class="cm">            TSharedPtr&lt;SButton&gt; ButtonSArgNew = SArgumentNew(ButtonArgs, SButton);</span>
<span class="cm">            // SNew</span>
<span class="cm">            TSharedPtr&lt;SButton&gt; ButtonSNew =</span>
<span class="cm">            SNew(SButton)</span>
<span class="cm">            .Text(FText::FromString(TEXT(&quot;SNew Button&quot;)))</span>
<span class="cm">            .HAlign(HAlign_Fill);</span>
<span class="cm">            // SAssignNew</span>
<span class="cm">            TSharedPtr&lt;SButton&gt; ButtonSAssignNew = nullptr;</span>
<span class="cm">            SAssignNew(ButtonSAssignNew, SButton)</span>
<span class="cm">            .Text(FText::FromString(TEXT(&quot;SAssignNew Button&quot;)))</span>
<span class="cm">            .HAlign(HAlign_Fill);</span>
<span class="cm">            // Slate UI</span>
<span class="cm">            TSharedPtr&lt;SConstraintCanvas&gt; Canvas =</span>
<span class="cm">            SNew(SConstraintCanvas)</span>
<span class="cm">                + SConstraintCanvas::Slot()</span>
<span class="cm">                .AutoSize(true)</span>
<span class="cm">                .Anchors(FAnchors{0.2f,0.8f}) // down left</span>
<span class="cm">                [</span>
<span class="cm">                    SNew(SButton)</span>
<span class="cm">                    .Text( FText::FromString(TEXT(&quot;TestButton&quot;)) )</span>
<span class="cm">                    .OnClicked(ClickDelegate) // bind click event</span>
<span class="cm">                    .ContentPadding(FMargin{10.0f, 15.0f})</span>
<span class="cm">                ]</span>
<span class="cm">                + SConstraintCanvas::Slot() // ButtonSNew slot</span>
<span class="cm">                .AutoSize(true)</span>
<span class="cm">                .Anchors(FAnchors{ 0.3f,0.5f })</span>
<span class="cm">                [</span>
<span class="cm">                    ButtonSNew.ToSharedRef()</span>
<span class="cm">                ]</span>
<span class="cm">                + SConstraintCanvas::Slot() // ButtonSAssignNew slot</span>
<span class="cm">                .AutoSize(true)</span>
<span class="cm">                .Anchors(FAnchors{ 0.3f,0.6f })</span>
<span class="cm">                [</span>
<span class="cm">                    ButtonSAssignNew.ToSharedRef()</span>
<span class="cm">                ]</span>
<span class="cm">                + SConstraintCanvas::Slot() // ButtonSArgNew slot</span>
<span class="cm">                .AutoSize(true)</span>
<span class="cm">                .Anchors(FAnchors{ 0.3f,0.7f })</span>
<span class="cm">                [</span>
<span class="cm">                    ButtonSArgNew.ToSharedRef()</span>
<span class="cm">                ]</span>
<span class="cm">            ;</span>
<span class="cm">            // Add Background to our Canvas with Button</span>
<span class="cm">            TSharedPtr&lt;SOverlay&gt; BGOverlay =</span>
<span class="cm">            SNew(SOverlay)</span>
<span class="cm">                + SOverlay::Slot()</span>
<span class="cm">                .HAlign(HAlign_Fill) // fill whole space</span>
<span class="cm">                .VAlign(VAlign_Fill)</span>
<span class="cm">                [</span>
<span class="cm">                    // Border widget works as background color sourse</span>
<span class="cm">                    // will be better if you use just SImage, but as example i picked up Border</span>
<span class="cm">                    SNew(SBorder)</span>
<span class="cm">                    .BorderImage(new FSlateImageBrush{ // just demo of using Slate Brush on c++</span>
<span class="cm">                        Texture, // image path comes here</span>
<span class="cm">                        FVector2D{},</span>
<span class="cm">                        FLinearColor(0.1f, 0.1f, 0.1f, 1.0f), // tint</span>
<span class="cm">                        ESlateBrushTileType::Both,</span>
<span class="cm">                        ESlateBrushImageType::FullColor // draw as</span>
<span class="cm">                    })</span>
<span class="cm">                ]</span>
<span class="cm">                + SOverlay::Slot()[</span>
<span class="cm">                    Canvas.ToSharedRef() // this will put canvas into overlay</span>
<span class="cm">                ]</span>
<span class="cm">            ;</span>
<span class="cm">            // Add generated UI to Veiwport</span>
<span class="cm">            TSharedPtr&lt;SWidget&gt; UIContainer; // ui container</span>
<span class="cm">            GEngine-&gt;GameViewport-&gt;AddViewportWidgetForPlayer(GetLocalPlayer(), BGOverlay.ToSharedRef(), 0);</span>
<span class="cm">            return;*/</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/da57cd936ea3b5443434f523d8669658.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="da57cd936ea3b5443434f523d8669658.png" auto_="auto;" display="block;" margin:="margin:" src="../images/da57cd936ea3b5443434f523d8669658.png" /></a></p>
<h3 id="_12">Слоты виджетов</h3>
<p>Слоты используются для размещения одних виджетов внутри других. Мы пользовались системой слотов в готовых виджетах, например в <code>SVerticalBox</code>. В этой главе я рассмотрю как добавить собственные слоты в виджет.</p>
<p>Есть две категории слотов:
- Именные <code>Named</code> слоты. Виджеты в такие слоты помещаются при помощи оператора <code>[]</code>. Слот этого типа может содержать в себе только один любой виджет.
- Шаблонные <code>Pattern</code> слоты. Виджеты в такие слоты добавляются при помощи оператора <code>+</code>. Слотов этого типа может быть сколько угодно внутри виджета, при условии, что все они следуют одному и тому-же шаблону.</p>
<p><a class="glightbox" href="../images/987133288e25e5ea47d14ca357e312a7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="987133288e25e5ea47d14ca357e312a7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/987133288e25e5ea47d14ca357e312a7.png" /></a></p>
<p>Давайте рассмотрим каждую категорию слотов отдельно.</p>
<h4 id="named"><code>Named</code> слоты</h4>
<p>Для демонстрации работы этого типа слота - предлагаю сделать кнопку с картинкой внутри и слотом для текста, соответственно.</p>
<p>Идем <code>Tools -&gt; New C++ Class -&gt; Slate Widget</code>.</p>
<p><a class="glightbox" href="../images/1976865b8450d2623cb6d838206d450e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1976865b8450d2623cb6d838206d450e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1976865b8450d2623cb6d838206d450e.png" /></a></p>
<p>Называем новый класс - <code>ImageButtonWidget</code>и добавляем его в модуль <code>SlateRuntimeModule</code>.</p>
<p><a class="glightbox" href="../images/39ec44983c79bbe626870839863502ea.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="39ec44983c79bbe626870839863502ea.png" auto_="auto;" display="block;" margin:="margin:" src="../images/39ec44983c79bbe626870839863502ea.png" /></a></p>
<p>Привожу код полученного класса.</p>
<p>Файл <code>SImageButtonWidget.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SScaleBox.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ImageUtils.h&quot;</span><span class="c1"> // ImportFileAsTexture2D</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // FSlateImageBrush</span>
<span class="cm">/**</span>
<span class="cm"> * Image Button</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SImageButtonWidget</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="n">_bAllowDefaultImage</span><span class="p">(</span><span class="nb">true</span><span class="p">),</span>
<span class="w">        </span><span class="n">_Image</span><span class="p">()</span>
<span class="w">        </span><span class="p">{}</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">bAllowDefaultImage</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Image</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Events</span>
<span class="w">        </span><span class="n">SLATE_EVENT</span><span class="p">(</span><span class="n">FOnClicked</span><span class="p">,</span><span class="w"> </span><span class="n">OnClicked</span><span class="p">)</span><span class="w"> </span><span class="c1">// SimpleDelegate event</span>
<span class="w">        </span><span class="c1">// Slot for content</span>
<span class="w">        </span><span class="n">SLATE_DEFAULT_SLOT</span><span class="p">(</span><span class="n">FArguments</span><span class="p">,</span><span class="w"> </span><span class="n">Content</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">SImageButtonWidget</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<span class="w">        </span><span class="c1">// attribute default values</span>
<span class="w">        </span><span class="n">bShowDefaultImage</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">        </span><span class="n">ImageBrushAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="p">{})</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="cm">/* Constructs this widget with InArgs */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetImageBrush</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">NewBrush</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewBrush</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*</span><span class="w"> </span><span class="nf">GetImageBrush</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// image attribute setter</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetDefaultImageMode</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bMode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bShowDefaultImage</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">bMode</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// image attribute getter</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">GetDefaultImageMode</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bShowDefaultImage</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will force image to update</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateImage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ImageControl</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ImageControl</span><span class="o">-&gt;</span><span class="n">SetImage</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*</span><span class="p">)</span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// to access ImageControl</span>
<span class="w">    </span><span class="n">SImage</span><span class="o">*</span><span class="w"> </span><span class="nf">GetImageControl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ImageControl</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will load default image</span>
<span class="w">    </span><span class="n">FSlateImageBrush</span><span class="w"> </span><span class="o">*</span><span class="nf">GetDefaultImageBrush</span><span class="p">(){</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">HasUObject</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">GetDefaultImageMode</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DefaultImage</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// load image if not already</span>
<span class="w">            </span><span class="n">DefaultImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FImageUtils</span><span class="o">::</span><span class="n">ImportFileAsTexture2D</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/SlateRuntimeModule/Resources/default_button_icon.png&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">            </span><span class="c1">// load image from module&#39;s resources folder</span>
<span class="w">            </span><span class="n">DefaultImage</span><span class="p">,</span>
<span class="w">            </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">128.0</span><span class="p">,</span><span class="w"> </span><span class="mf">128.0</span><span class="p">},</span>
<span class="w">            </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">,</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">            </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">NoTile</span><span class="p">,</span>
<span class="w">            </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span><span class="w"> </span><span class="c1">// draw as</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// to access ButtonControl</span>
<span class="w">    </span><span class="n">SButton</span><span class="o">*</span><span class="w"> </span><span class="nf">GetButtonControl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ButtonControl</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Called every widget re-paint</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="nf">OnPaint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPaintArgs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateRect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span>
<span class="w">        </span><span class="n">FSlateWindowElementList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span>
<span class="w">        </span><span class="n">int32</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FWidgetStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">bParentEnabled</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Attributes</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bShowDefaultImage</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">ImageBrushAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Controls</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ButtonControl</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SImage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ImageControl</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// default button image, if loaded</span>
<span class="w">    </span><span class="n">UTexture2D</span><span class="o">*</span><span class="w"> </span><span class="n">DefaultImage</span><span class="p">;</span><span class="w"> </span><span class="c1">// it&#39;s garbage collected uobject, so we need to store it&#39;s refrence</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>SImageButtonWidget.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SImageButtonWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="nf">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SImageButtonWidget</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ImageBrushAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ImageBrushAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SImageButtonWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">).</span><span class="n">UpdateImage</span><span class="p">();</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bShowDefaultImage&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bShowDefaultImage</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SImageButtonWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">).</span><span class="n">UpdateImage</span><span class="p">();</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SImageButtonWidget::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SetDefaultImageMode</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_bAllowDefaultImage</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Image</span><span class="p">.</span><span class="n">IsSet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetImageBrush</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Image</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetDefaultImageMode</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetImageBrush</span><span class="p">(</span><span class="n">GetDefaultImageBrush</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">ChildSlot</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">ButtonControl</span><span class="p">,</span><span class="w"> </span><span class="n">SButton</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_OnClicked</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">FillWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// proportions</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFitX</span><span class="p">)</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">())</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">FillWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">// will take 3 times from image slot size</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Content</span><span class="p">.</span><span class="n">Widget</span><span class="w"> </span><span class="c1">// get widgets inside content</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">// Called every widget re-paint</span>
<span class="n">int32</span><span class="w"> </span><span class="nf">SImageButtonWidget::OnPaint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPaintArgs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateRect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span>
<span class="w">    </span><span class="n">FSlateWindowElementList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FWidgetStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bParentEnabled</span>
<span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;has image %s&quot;), ImageBrushAttribute.Get()-&gt;HasUObject() ? TEXT(&quot;TRUE&quot;) : TEXT(&quot;FALSE&quot;))</span>
<span class="w">    </span><span class="c1">// we can call SCompoundWidget::OnPaint to paint every visible children</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="o">::</span><span class="n">OnPaint</span><span class="p">(</span><span class="n">Args</span><span class="p">,</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span><span class="w"> </span><span class="n">bParentEnabled</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
</code></pre></div>
Данный код создаст кнопку, со слотом <code>Content</code>.</p>
<p><a class="glightbox" href="../images/7f6447f11f591606f8be95db17c70fbd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7f6447f11f591606f8be95db17c70fbd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7f6447f11f591606f8be95db17c70fbd.png" /></a></p>
<p>Картинка в кнопке задается через аргумент <code>Image</code>.
Файл из папки проекта можно загрузить в кнопку следующим образом:
<div class="highlight"><pre><span></span><code><span class="n">SNew</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">)</span>
<span class="p">.</span><span class="n">Image</span><span class="p">(</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">        </span><span class="c1">// load image from module&#39;s resources folder</span>
<span class="w">        </span><span class="n">FImageUtils</span><span class="o">::</span><span class="n">ImportFileAsTexture2D</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/SlateRuntimeModule/Resources/test.jpg&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">128.0</span><span class="p">,</span><span class="w"> </span><span class="mf">128.0</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">))</span>
<span class="p">]</span>
</code></pre></div>
Файл берется из папки <code>/SlateRuntimeModule/Resources/</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/37c3659165e0490c7269528c37edea28.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="37c3659165e0490c7269528c37edea28.png" auto_="auto;" display="block;" margin:="margin:" src="../images/37c3659165e0490c7269528c37edea28.png" /></a></p>
<p>Причем можно загрузить как файл, так и <code>UObject</code>.
<div class="highlight"><pre><span></span><code><span class="n">SNew</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">)</span>
<span class="p">.</span><span class="n">Image</span><span class="p">(</span>
<span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// load image from module&#39;s resources folder</span>
<span class="w">    </span><span class="c1">//FImageUtils::ImportFileAsTexture2D(FPaths::GameSourceDir() + TEXT(&quot;/SlateRuntimeModule/Resources/test.jpg&quot;)),</span>
<span class="w">    </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UTexture2D</span><span class="o">&gt;</span><span class="p">(</span><span class="n">StaticLoadObject</span><span class="p">(</span><span class="n">UTexture2D</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Texture2D&#39;/Game/Characters/Textures/2344444_original.2344444_original&#39;&quot;</span><span class="p">))),</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">128.0</span><span class="p">,</span><span class="w"> </span><span class="mf">128.0</span><span class="p">}</span>
<span class="p">})</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">))</span>
<span class="p">]</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/851e0b662a96e1064bbef0e05c8cf205.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="851e0b662a96e1064bbef0e05c8cf205.png" auto_="auto;" display="block;" margin:="margin:" src="../images/851e0b662a96e1064bbef0e05c8cf205.png" /></a></p>
<p>В данном случае я загружаю вот эту картинку:</p>
<p><a class="glightbox" href="../images/b13cc0ed01540a74bd5869c0c5d961a8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b13cc0ed01540a74bd5869c0c5d961a8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b13cc0ed01540a74bd5869c0c5d961a8.png" /></a></p>
<p>Если проигнорировать параметр <code>Image</code>, то в качестве картинки будет использовано изображение "по умолчанию". В качестве такого изображения выставлена картинка из папки <code>/SlateRuntimeModule/Resources/</code>, под названием <code>default_button_icon.png</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/37c3659165e0490c7269528c37edea28.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="37c3659165e0490c7269528c37edea28.png" auto_="auto;" display="block;" margin:="margin:" src="../images/37c3659165e0490c7269528c37edea28.png" /></a></p>
<div class="highlight"><pre><span></span><code><span class="n">SNew</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">))</span>
<span class="p">]</span>
</code></pre></div>
<p><a class="glightbox" href="../images/36136cb55f0bfa38ce36a0fc9163ef3c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="36136cb55f0bfa38ce36a0fc9163ef3c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/36136cb55f0bfa38ce36a0fc9163ef3c.png" /></a></p>
<p>Содержимое добавляется в кнопку из <code>Named</code> слота, в данном случае я добавляю элемент <code>STextBlock</code> с текстом <code>Test</code>.</p>
<h4 id="_13">Шаблонные слоты</h4>
<p>Данные слоты позволяют добавлять вложенные в узел элементы на основе предзаданного шаблона (в роли которого может выступать как отдельный класс, так и подкласс или структура унаследованные от <code>TSlotBase</code>).
Размещаются шаблонные слоты внутри виджета-контейнера, который наследуют от <code>SPanel</code>.
Реализацию класса <code>SPanel</code> можно посмотреть в файле <code>\Runtime\SlateCore\Public\Widgets\SPanel.h</code>.</p>
<p><a class="glightbox" href="../images/982be932aa265b7797a1ae19ff800d97.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="982be932aa265b7797a1ae19ff800d97.png" auto_="auto;" display="block;" margin:="margin:" src="../images/982be932aa265b7797a1ae19ff800d97.png" /></a></p>
<p>Класс <code>SPanel</code> реализует набор методов для работы с шаблонными слотами, основные среди них это <code>OnArrangeChildren</code> и <code>ComputeDesiredSize</code>.
Переопределив эти методы можно указать организацию шаблонных слотов в базовом классе.</p>
<p>Примерами шаблонных слотов являются: <code>SVerticalBox</code>, <code>SConstraintCanvas</code>, <code>SUniformGridPanel.h</code>.
Реализуем собственный шаблонный слот.</p>
<p>Пусть это будет пользовательская версия класса <code>SUniformGridPanel</code>, в которой можно будет задавать оформление ячеек под инвентарь.</p>
<p>Идем <code>Tools -&gt; New C++ Class</code> и снова выбираем <code>Slate Widget</code>.</p>
<p><a class="glightbox" href="../images/f8c8b2d3fcc1f581aaecfc68cce9b204.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f8c8b2d3fcc1f581aaecfc68cce9b204.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f8c8b2d3fcc1f581aaecfc68cce9b204.png" /></a></p>
<p>Называем класс <code>BorderedUniformGrid</code>.</p>
<p><a class="glightbox" href="../images/77e22457ba3b40b09f4a053912b37dd0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="77e22457ba3b40b09f4a053912b37dd0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/77e22457ba3b40b09f4a053912b37dd0.png" /></a></p>
<p>Чтобы класс появился в <code>Solution Explorer</code>, не забудьте выполнить команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/567fc7cffb0344682637cfb15bff40a2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="567fc7cffb0344682637cfb15bff40a2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/567fc7cffb0344682637cfb15bff40a2.png" /></a></p>
<p>И так, цель - сделать собственную версию <code>UniformGrid</code>, со слотами в виде обводки <code>SBorder</code>, с возможностью автоматического заполнения слотами, а так-же с возможностью замены контента в уже добавленых слотах.</p>
<p>Давайте посмотрим на исходники класса <code>SUniformGridPanel</code>, на основе которых будет писаться наш код, найти их можно в файле <code>\Runtime\Slate\Public\Widgets\Layout\SUniformGridPanel.h</code>.</p>
<p><a class="glightbox" href="../images/d986fc160fcb0ff46f5183f605df4d24.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d986fc160fcb0ff46f5183f605df4d24.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d986fc160fcb0ff46f5183f605df4d24.png" /></a></p>
<p>В этом классе уже представлена заготовка для слота, это вложенная структура типа <code>FSlot</code>.
Если мы хотим добавить обводку к  слоту, как того требует задача, нам как-то необходимо этот слот переопределить. К сожалению, поскольку объект слота является вложенным, без почти полной переделки исходного кода не обойтись. Наследование не сработает.</p>
<p>Дело в том, что тип <code>FSlot</code> жестко указан в некоторых шаблонах(макросах) и наследование, очевидно, сломает эту логику.</p>
<p><a class="glightbox" href="../images/842654b3870ce4632ea937c8dd2955a3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="842654b3870ce4632ea937c8dd2955a3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/842654b3870ce4632ea937c8dd2955a3.png" /></a></p>
<p>Таким образом, мне придется переделать класс <code>SUniformGridPanel</code> полностью. И кода будет очень много.</p>
<p>Для начала необходимо перенести структуру слота, с собственными правками и проверить как она работает.
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">FSlot</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TSlotBase</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// TAlignmentWidgetSlotMixin&lt;FSlot&gt; - this mixin will allow for FSlot to have parameters for VAlign and HAlign</span>
<span class="w">    </span><span class="n">SLATE_SLOT_BEGIN_ARGS_OneMixin</span><span class="p">(</span><span class="n">FSlot</span><span class="p">,</span><span class="w"> </span><span class="n">TSlotBase</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_SLOT_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="n">FSlot</span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">InColumn</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">InRow</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// set default values</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">TSlotBase</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="c1">// default object content that placed into slot if no content is provided</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">).</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">,</span><span class="w"> </span><span class="n">VAlign_Fill</span><span class="p">)</span><span class="w"> </span><span class="c1">// default alignment</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Column</span><span class="p">(</span><span class="n">InColumn</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="p">(</span><span class="n">InRow</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FChildren</span><span class="o">&amp;</span><span class="w"> </span><span class="n">SlotOwner</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotArguments</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">GetAttachedWidget</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">AttachWidget</span><span class="p">(</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">)</span><span class="w"> </span><span class="c1">// Offset</span>
<span class="w">                </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                    </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SBorderedUniformGrid::FSlot&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// here comes image path, but we need only the color of brush, image is unnecessary</span>
<span class="w">                    </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                    </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">InArgs</span><span class="p">.</span><span class="n">GetAttachedWidget</span><span class="p">().</span><span class="n">ToSharedRef</span><span class="p">()</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">SetOwner</span><span class="p">(</span><span class="n">SlotOwner</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//TSlotBase&lt;FSlot&gt;::Construct(SlotOwner, MoveTemp(InArgs));</span>
<span class="w">        </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;::</span><span class="n">ConstructMixin</span><span class="p">(</span><span class="n">SlotOwner</span><span class="p">,</span><span class="w"> </span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">InArgs</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetColumn</span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">InColumn</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InColumn</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Column</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InColumn</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// since TSlateAttribute can&#39;t work with nested structs we have to invalidate layout manually</span>
<span class="w">            </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">GetColumn</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Column</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">GetRow</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Row</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetRow</span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">InRow</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InRow</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Row</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InRow</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// since TSlateAttribute can&#39;t work with nested structs we have to invalidate layout manually</span>
<span class="w">            </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// since TSlateAttribute can&#39;t work with nested structs, we have to deal with normal variables</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Column</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Row</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
Исследуя класс мне удалось выяснить, что за структуру слота "по умолчанию" отвечает первый параметр конструктора.</p>
<p><a class="glightbox" href="../images/f42fc4d69659b06c691d572e807bff90.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f42fc4d69659b06c691d572e807bff90.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f42fc4d69659b06c691d572e807bff90.png" /></a></p>
<p>Элементы, размещенные в этом параметре, будут загружаться в слотах, которые не имею никакого содержимого.</p>
<p>За оформление слотов, которые имеют внутри  себя содержимое, отвечает метод <code>Construct</code>.
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FChildren</span><span class="o">&amp;</span><span class="w"> </span><span class="n">SlotOwner</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotArguments</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">GetAttachedWidget</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">AttachWidget</span><span class="p">(</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">)</span><span class="w"> </span><span class="c1">// Offset</span>
<span class="w">            </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SBorderedUniformGrid::FSlot&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// here comes image path, but we need only the color of brush, image is unnecessary</span>
<span class="w">                </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">                </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">InArgs</span><span class="p">.</span><span class="n">GetAttachedWidget</span><span class="p">().</span><span class="n">ToSharedRef</span><span class="p">()</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">SetOwner</span><span class="p">(</span><span class="n">SlotOwner</span><span class="p">);</span>
<span class="w">    </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;::</span><span class="n">ConstructMixin</span><span class="p">(</span><span class="n">SlotOwner</span><span class="p">,</span><span class="w"> </span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">InArgs</span><span class="p">));</span><span class="w"> </span><span class="c1">// will transfer HAlignment and VAlignment</span>
<span class="p">}</span>
</code></pre></div>
Тут я разместил обертку в виде <code>SBorder</code>. Само содержимое слота выводится методом <code>InArgs.GetAttachedWidget()</code>.
Для тестов я создал код, формирующий <code>SBorderedUniformGrid</code> со слотами по диагонали.
<div class="highlight"><pre><span></span><code><span class="n">SNew</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="p">)</span>
<span class="p">.</span><span class="n">SlotPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">3.f</span><span class="p">,</span><span class="mf">4.f</span><span class="p">})</span>
<span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="p">]</span>
<span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="p">]</span>
<span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="cm">/*[</span>
<span class="cm">    SNew(SImage)</span>
<span class="cm">    .ColorAndOpacity(FLinearColor::Blue)</span>
<span class="cm">]*/</span>
<span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="p">]</span>
</code></pre></div>
Пустой параметр, без заполненного <code>Named</code> слота я просто закомментировал.</p>
<p><a class="glightbox" href="../images/221161092030167d00c7d8e6fdfba3b4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="221161092030167d00c7d8e6fdfba3b4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/221161092030167d00c7d8e6fdfba3b4.png" /></a></p>
<p>На данном этапе вывод виджета выглядит так:</p>
<p><a class="glightbox" href="../images/276f3e8e1ab89e943acdb85708d3a3a8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="276f3e8e1ab89e943acdb85708d3a3a8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/276f3e8e1ab89e943acdb85708d3a3a8.png" /></a></p>
<p>Красным выделен слот, контент для которого не указан. У него так-же нет границы. Другие слоты имеют серую границу размером в 5 пикселей. К сожалению, серый цвет границы плохо виден на фоне синего неба.</p>
<p><a class="glightbox" href="../images/f756dc199a4f9008680204a6ba8ef78c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f756dc199a4f9008680204a6ba8ef78c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f756dc199a4f9008680204a6ba8ef78c.png" /></a></p>
<p>Я сделал границу белой, чтоб было виднее.</p>
<p><a class="glightbox" href="../images/99970b558882c7d16470770d8b46c501.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="99970b558882c7d16470770d8b46c501.png" auto_="auto;" display="block;" margin:="margin:" src="../images/99970b558882c7d16470770d8b46c501.png" /></a></p>
<p><a class="glightbox" href="../images/16d3a1071483aea2ec5424c2e51ef773.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="16d3a1071483aea2ec5424c2e51ef773.png" auto_="auto;" display="block;" margin:="margin:" src="../images/16d3a1071483aea2ec5424c2e51ef773.png" /></a></p>
<p>Теперь, когда мы поняли как работает логика <code>FSlot</code>, вынесем параметры оформления границы слота в отдельную переменную. Поскольку параметров много - сделаем отдельную структуру.
<div class="highlight"><pre><span></span><code><span class="c1">// struct to hold slot border parameters</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FSlotBorderSettings</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bShowBorder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">FMargin</span><span class="w"> </span><span class="n">Padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*</span><span class="w"> </span><span class="n">BorderImageBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// oveload operator == because we need to compare default settings</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">bShowBorder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">bShowBorder</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Padding</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Padding</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">BorderImageBrush</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">BorderImageBrush</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
Эта структура будет служить параметром как для объекта слота, так и для класса <code>UniformGrid</code>. На уровне класса мы будем задавать глобальную настройку границы для всех слотов, а на уровне слота у нас будет возможность изменять границы конкретных  слотов.</p>
<p>За глобальную настройку слотов будет отвечать атрибут <code>DefaultBorderSettings</code>, который задается в корне класса <code>SBorderedUniformGrid</code>.</p>
<p><a class="glightbox" href="../images/0660729fd23832e83a0de6fc8c7b449f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0660729fd23832e83a0de6fc8c7b449f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0660729fd23832e83a0de6fc8c7b449f.png" /></a></p>
<p>Поскольку возможность изменять границу в каждом отдельном слоте - крайне важна, в слотах так-же добавлен параметр <code>inNormalBorder</code>, который является опциональным параметром конструктора. Его можно указывать и не указывать. Если этот параметр не указан - слот использует оформление границ, полученное от <code>SBorderedUniformGrid</code>.</p>
<p><a class="glightbox" href="../images/dc856b4832fa47d4c8405a3f8e4d1b08.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dc856b4832fa47d4c8405a3f8e4d1b08.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dc856b4832fa47d4c8405a3f8e4d1b08.png" /></a></p>
<h5 id="_14">Код</h5>
<p>Код класса получился достаточно … большим, поэтому я приведу его полностью.</p>
<p>Файл <code>SBorderedUniformGrid.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SPanel.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Layout/LayoutUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/Attribute.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Layout/Visibility.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlotBase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Layout/Margin.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Layout/Children.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/DeclarativeSyntaxSupport.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SBorder.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="cm">/**</span>
<span class="cm"> * Custom Uniform Grid with slots that has border</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SPanel</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="p">,</span><span class="w"> </span><span class="n">SPanel</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// struct to hold slot border parameters</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">FSlotBorderSettings</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">bShowBorder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">FMargin</span><span class="w"> </span><span class="n">Padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">};</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*</span><span class="w"> </span><span class="n">BorderImageBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// oveload operator == because we need to compare default settings</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// use simple AND</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">bShowBorder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">bShowBorder</span><span class="p">;</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Padding</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Padding</span><span class="p">;</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">BorderImageBrush</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">BorderImageBrush</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">FSlot</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TSlotBase</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span>
<span class="w">    </span><span class="c1">// *note: TAlignmentWidgetSlotMixin&lt;FSlot&gt; - this mixin will allow for FSlot to have parameters for VAlign and HAlign</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">SLATE_SLOT_BEGIN_ARGS_OneMixin</span><span class="p">(</span><span class="n">FSlot</span><span class="p">,</span><span class="w"> </span><span class="n">TSlotBase</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_SLOT_END_ARGS</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Constructor</span>
<span class="w">        </span><span class="n">FSlot</span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">InColumn</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">InRow</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">inNormalBorder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="p">{})</span>
<span class="w">        </span><span class="c1">// set default values</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">TSlotBase</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="cm">/*(inNormalBorder.bShowBorder) ? // it&#39;s just shortened if, split into lines</span>
<span class="cm">            // true</span>
<span class="cm">            SNew(SBorder)</span>
<span class="cm">            .Padding(inNormalBorder.Padding)</span>
<span class="cm">            .BorderImage(inNormalBorder.BorderImageBrush)</span>
<span class="cm">            : // else</span>
<span class="cm">            // false</span>
<span class="cm">            SNew(SBorder)</span>
<span class="cm">            .BorderImage(</span>
<span class="cm">                new FSlateImageBrush{</span>
<span class="cm">                    TEXT(&quot;BorderImage::HiddenSlot&quot;),</span>
<span class="cm">                    FVector2D{},</span>
<span class="cm">                    FLinearColor::Transparent, // hide</span>
<span class="cm">                    ESlateBrushTileType::NoTile,</span>
<span class="cm">                    ESlateBrushImageType::NoImage</span>
<span class="cm">                })*/</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">,</span><span class="w"> </span><span class="n">VAlign_Fill</span><span class="p">)</span><span class="w"> </span><span class="c1">// default alignment</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">Column</span><span class="p">(</span><span class="n">InColumn</span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="p">(</span><span class="n">InRow</span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">CurrentBorderSettings</span><span class="p">(</span><span class="n">inNormalBorder</span><span class="p">)</span>
<span class="w">        </span><span class="p">{}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FChildren</span><span class="o">&amp;</span><span class="w"> </span><span class="n">SlotOwner</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotArguments</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// InArgs.GetAttachedWidget() - is slot content</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">GetAttachedWidget</span><span class="p">())</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">BorderControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">InArgs</span><span class="p">.</span><span class="n">GetAttachedWidget</span><span class="p">().</span><span class="n">ToSharedRef</span><span class="p">()</span><span class="w"> </span><span class="c1">// put slot content into border</span>
<span class="w">                </span><span class="p">];</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// if slot dosen&#39;t have content - just make the border</span>
<span class="w">                </span><span class="n">BorderControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// put border into slot</span>
<span class="w">            </span><span class="n">AttachWidget</span><span class="p">(</span><span class="n">BorderControl</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">());</span>
<span class="w">            </span><span class="n">UpdateBorderSettings</span><span class="p">();</span>
<span class="w">            </span><span class="n">SetOwner</span><span class="p">(</span><span class="n">SlotOwner</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//TSlotBase&lt;FSlot&gt;::Construct(SlotOwner, MoveTemp(InArgs)); // - old code</span>
<span class="w">            </span><span class="n">TAlignmentWidgetSlotMixin</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;::</span><span class="n">ConstructMixin</span><span class="p">(</span><span class="n">SlotOwner</span><span class="p">,</span><span class="w"> </span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">InArgs</span><span class="p">));</span><span class="w"> </span><span class="c1">// will transfer HAlignment and VAlignment</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">SetColumn</span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">InColumn</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InColumn</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Column</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InColumn</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// since TSlateAttribute can&#39;t work with nested structs we have to invalidate layout manually</span>
<span class="w">                </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">int32</span><span class="w"> </span><span class="n">GetColumn</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Column</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">int32</span><span class="w"> </span><span class="n">GetRow</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Row</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">SetRow</span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">InRow</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InRow</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Row</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InRow</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// since TSlateAttribute can&#39;t work with nested structs we have to invalidate layout manually</span>
<span class="w">                </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">GetCurrentBorderSettings</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">CurrentBorderSettings</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">SetCurrentBorderSettings</span><span class="p">(</span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">Settings</span><span class="p">){</span>
<span class="w">            </span><span class="n">CurrentBorderSettings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Settings</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">UpdateBorderSettings</span><span class="p">(){</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">BorderControl</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;slot border updated&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">CurrentBorderSettings</span><span class="p">.</span><span class="n">bShowBorder</span><span class="p">){</span>
<span class="w">                </span><span class="n">BorderControl</span><span class="o">-&gt;</span><span class="n">SetBorderImage</span><span class="p">(</span><span class="n">CurrentBorderSettings</span><span class="p">.</span><span class="n">BorderImageBrush</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="n">BorderControl</span><span class="o">-&gt;</span><span class="n">SetPadding</span><span class="p">(</span><span class="n">CurrentBorderSettings</span><span class="p">.</span><span class="n">Padding</span><span class="p">);</span>
<span class="w">                </span><span class="n">BorderControl</span><span class="o">-&gt;</span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">EmptySettings</span><span class="p">{};</span>
<span class="w">                </span><span class="n">BorderControl</span><span class="o">-&gt;</span><span class="n">SetBorderImage</span><span class="p">(</span><span class="n">EmptySettings</span><span class="p">.</span><span class="n">BorderImageBrush</span><span class="p">);</span>
<span class="w">                </span><span class="n">BorderControl</span><span class="o">-&gt;</span><span class="n">SetPadding</span><span class="p">(</span><span class="n">EmptySettings</span><span class="p">.</span><span class="n">Padding</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">PaintAndVolatility</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//GetOwner()-&gt;GetOwner().Invalidate(EInvalidateWidgetReason::Paint);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// will return current slot&#39;s border</span>
<span class="w">        </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SBorder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetBorderControl</span><span class="p">(){</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">BorderControl</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// since TSlateAttribute can&#39;t work with nested structs, we have to deal with normal variables</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Column</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Row</span><span class="p">;</span>
<span class="w">        </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">CurrentBorderSettings</span><span class="p">;</span>
<span class="w">        </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SBorder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BorderControl</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Used by declarative syntax to create a Slot in the specified Column, Row.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlot</span><span class="o">::</span><span class="n">FSlotArguments</span><span class="w"> </span><span class="nf">Slot</span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">Column</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">Row</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">inBorder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlot</span><span class="o">::</span><span class="n">FSlotArguments</span><span class="p">(</span><span class="n">MakeUnique</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Column</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="p">,</span><span class="w"> </span><span class="n">inBorder</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// default values for arguments</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">_InitialGridSize</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">3.f</span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">_SlotPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">))</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">_MinDesiredSlotWidth</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">_MinDesiredSlotHeight</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">_DefaultBorderSettings</span><span class="p">(</span><span class="n">FSlotBorderSettings</span><span class="p">{</span>
<span class="w">                </span><span class="nb">false</span><span class="p">,</span>
<span class="w">                </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">},</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                    </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SBorderedUniformGrid::FSlotBorderSettings::Default&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">25.f</span><span class="p">,</span><span class="mf">25.f</span><span class="p">},</span>
<span class="w">                    </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">1.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// override parent defaults</span>
<span class="w">            </span><span class="n">_Visibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EVisibility</span><span class="o">::</span><span class="n">SelfHitTestInvisible</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// SBorderedUniformGrid::FSlot is template for chind slots of this widget</span>
<span class="w">        </span><span class="n">SLATE_SLOT_ARGUMENT</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlot</span><span class="p">,</span><span class="w"> </span><span class="n">Slots</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Initial col/rows in the grid</span>
<span class="w">        </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">FVector2D</span><span class="p">,</span><span class="w"> </span><span class="n">InitialGridSize</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Padding given to each slot</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">FMargin</span><span class="p">,</span><span class="w"> </span><span class="n">SlotPadding</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// The minimum desired width of the slots</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">MinDesiredSlotWidth</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// The minimum desired height of the slots</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">MinDesiredSlotHeight</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Brush for empty slot border</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">FSlotBorderSettings</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultBorderSettings</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">SBorderedUniformGrid</span><span class="p">()</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// Argument Defaults</span>
<span class="w">        </span><span class="n">ChildrenContainer</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="c1">// pass this as Owner of all child nodes</span>
<span class="w">        </span><span class="n">SlotPadding</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">FMargin</span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="mf">5.f</span><span class="p">}),</span>
<span class="w">        </span><span class="n">MinDesiredSlotWidth</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">),</span>
<span class="w">        </span><span class="n">MinDesiredSlotHeight</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>
<span class="w">        </span><span class="n">DefaultBorderSettings</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="p">{})</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="cm">/** Constructs this widget with InArgs */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// SPanel Interface</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Panels arrange their children in a space described by the AllottedGeometry parameter. The results of the arrangement</span>
<span class="cm">     * should be returned by appending a FArrangedWidget pair for every child widget. See StackPanel for an example</span>
<span class="cm">     *</span>
<span class="cm">     * @param AllottedGeometry    The geometry allotted for this widget by its parent.</span>
<span class="cm">     * @param ArrangedChildren    The array to which to add the WidgetGeometries that represent the arranged children.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnArrangeChildren</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">FArrangedChildren</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ArrangedChildren</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * A Panel&#39;s desired size in the space required to arrange of its children on the screen while respecting all of</span>
<span class="cm">     * the children&#39;s desired sizes and any layout-related options specified by the user. See StackPanel for an example.</span>
<span class="cm">     *</span>
<span class="cm">     * @return The desired size.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="nf">ComputeDesiredSize</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * All widgets must provide a way to access their children in a layout-agnostic way.</span>
<span class="cm">     * Panels store their children in Slots, which creates a dilemma. Most panels</span>
<span class="cm">     * can store their children in a TPanelChildren&lt;Slot&gt;, where the Slot class</span>
<span class="cm">     * provides layout information about the child it stores. In that case</span>
<span class="cm">     * GetChildren should simply return the TPanelChildren&lt;Slot&gt;. See StackPanel for an example.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="nf">GetChildren</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ChildrenContainer</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Add slot at column and row if not set already</span>
<span class="w">    </span><span class="n">TPanelChildren</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;::</span><span class="n">FScopedWidgetSlotArguments</span><span class="w"> </span><span class="n">AddSlot</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Column</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Row</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">inBorder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TPanelChildren</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">&gt;::</span><span class="n">FScopedWidgetSlotArguments</span><span class="p">{</span><span class="w"> </span><span class="c1">// this will construct the slot and add it to the ChildrenContainer</span>
<span class="w">            </span><span class="n">MakeUnique</span><span class="o">&lt;</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Column</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="p">,</span><span class="w"> </span><span class="n">inBorder</span><span class="p">),</span>
<span class="w">            </span><span class="n">ChildrenContainer</span><span class="p">,</span>
<span class="w">            </span><span class="n">INDEX_NONE</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Will remove slot by it&#39;s refrence</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">RemoveSlot</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">SWidget</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">SlotWidget</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">SlotWidget</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">INDEX_NONE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Will remove slot by col and row</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">RemoveSlot</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">){</span>
<span class="w">        </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">RemoveSlot</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Col</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemoveSlot</span><span class="p">(</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">Col</span><span class="p">,</span><span class="n">Row</span><span class="p">).</span><span class="n">ToSharedRef</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Will search and return slot at col / row</span>
<span class="w">    </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">GetSlotAt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ElementColumn</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ElementRow</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span>
<span class="w">                </span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetColumn</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ElementColumn</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetRow</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ElementRow</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Will search and return slot at col / row</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SWidget</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetChildAt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ElementColumn</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ElementRow</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="w">                </span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetColumn</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ElementColumn</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                </span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetRow</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ElementRow</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">GetWidget</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SWidget</span><span class="o">&gt;</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Will return slot at given index</span>
<span class="w">    </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">GetSlotAtIndex</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Will return slot at given index</span>
<span class="w">    </span><span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">SWidget</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetChildAtIndex</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Will replace one slot to another</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ReplaceSlotAt</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ElementColumn</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ElementRow</span><span class="p">,</span><span class="w"> </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SWidget</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">inBorder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemoveSlot</span><span class="p">(</span><span class="n">ElementColumn</span><span class="p">,</span><span class="w"> </span><span class="n">ElementRow</span><span class="p">);</span>
<span class="w">        </span><span class="n">AddSlot</span><span class="p">(</span><span class="n">ElementColumn</span><span class="p">,</span><span class="w"> </span><span class="n">ElementRow</span><span class="p">,</span><span class="w"> </span><span class="n">inBorder</span><span class="p">);</span>
<span class="w">        </span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlotAt</span><span class="p">(</span><span class="n">ElementColumn</span><span class="p">,</span><span class="w"> </span><span class="n">ElementRow</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetBorderControl</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetContent</span><span class="p">(</span><span class="n">InContent</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">PaintAndVolatility</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will fill grid with slots</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">FillGrid</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Amount</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ColSize</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bClear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">inBorder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">bClear</span><span class="p">){</span>
<span class="w">            </span><span class="n">ClearChildren</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">Index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">Index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Amount</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">Row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">FloorToInt</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">Index</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">ColSize</span><span class="p">);</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">Col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ColSize</span><span class="p">);</span>
<span class="w">            </span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlotAt</span><span class="p">(</span><span class="n">Col</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// no slot? Make One!</span>
<span class="w">                </span><span class="c1">// shortened if: (inBorder is {empty / has default values}) then GetDefaultBorderSettings else use InBorder;</span>
<span class="w">                </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">Settngs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inBorder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FSlotBorderSettings</span><span class="p">{}</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">GetDefaultBorderSettings</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">inBorder</span><span class="p">;</span>
<span class="w">                </span><span class="n">AddSlot</span><span class="p">(</span><span class="n">Col</span><span class="p">,</span><span class="w"> </span><span class="n">Row</span><span class="p">,</span><span class="w"> </span><span class="n">Settngs</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">Index</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Removes all slots from the panel</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ClearChildren</span><span class="p">(){</span>
<span class="w">        </span><span class="n">NumColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">NumRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// NumRows*Row + Col</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ColRow_To_Index</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Col</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Row</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NumRows</span><span class="o">*</span><span class="n">Row</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Col</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Will split Index to Col and Row depending on NumRows of the grid</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ColRow_From_Index</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Index</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Col</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">FloorToInt</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">Index</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="w"> </span><span class="n">NumRows</span><span class="p">);</span>
<span class="w">        </span><span class="n">Col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">Row</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NumRows</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Current number of rows</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">GetNumRows</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NumRows</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Current Number of columns</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">GetNumCols</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NumColumns</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Attribute Setters</span>
<span class="w">    </span><span class="c1">// Sets Padding</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetSlotPadding</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">FMargin</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InSlotPadding</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">SlotPadding</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">InSlotPadding</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Get Padding</span>
<span class="w">    </span><span class="n">FMargin</span><span class="w"> </span><span class="n">GetSlotPadding</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">SlotPadding</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will set slot width</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetMinDesiredSlotWidth</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InMinDesiredSlotWidth</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">MinDesiredSlotWidth</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">InMinDesiredSlotWidth</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Get MinDesiredSlotWidth</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">GetMinDesiredSlotWidth</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MinDesiredSlotWidth</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will set slot height</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetMinDesiredSlotHeight</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InMinDesiredSlotHeight</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">MinDesiredSlotHeight</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">InMinDesiredSlotHeight</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Get MinDesiredSlotHeight</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">GetMinDesiredSlotHeight</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MinDesiredSlotHeight</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetDefaultBorderSettings</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">FSlotBorderSettings</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Settings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DefaultBorderSettings</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">Settings</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FSlotBorderSettings</span><span class="w"> </span><span class="n">GetDefaultBorderSettings</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DefaultBorderSettings</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// we gonna attach all slots to this</span>
<span class="w">    </span><span class="c1">// TPanelChildren allows to add, remode, sort and operate on all nodes, attached to it</span>
<span class="w">    </span><span class="n">TPanelChildren</span><span class="o">&lt;</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlot</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Attributes</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">FMargin</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SlotPadding</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MinDesiredSlotWidth</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MinDesiredSlotHeight</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlotBorderSettings</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DefaultBorderSettings</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// values cache</span>
<span class="w">    </span><span class="k">mutable</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NumColumns</span><span class="p">;</span>
<span class="w">    </span><span class="k">mutable</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NumRows</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>SBorderedUniformGrid.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SBorderedUniformGrid.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="nf">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="n">SlotPadding</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="n">MinDesiredSlotWidth</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="n">MinDesiredSlotHeight</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultBorderSettings</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SBorderedUniformGrid::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SetSlotPadding</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_SlotPadding</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetMinDesiredSlotWidth</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_MinDesiredSlotWidth</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetMinDesiredSlotHeight</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_MinDesiredSlotHeight</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetDefaultBorderSettings</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_DefaultBorderSettings</span><span class="p">);</span>
<span class="w">    </span><span class="n">NumColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">NumRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//ChildrenContainer.AddSlots(MoveTemp(const_cast&lt;TArray&lt;FSlot::FSlotArguments&gt;&amp;&gt;(InArgs._Slots))); // - old code</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">FSlotsArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FSlot</span><span class="o">::</span><span class="n">FSlotArguments</span><span class="o">&gt;&amp;</span><span class="p">;</span><span class="w"> </span><span class="c1">// this is like typedef, but better</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">FBorderSettings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlotBorderSettings</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FSlotsArray</span><span class="w"> </span><span class="n">SlotsArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">FSlotsArray</span><span class="o">&gt;</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Slots</span><span class="p">);</span>
<span class="w">    </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Reserve</span><span class="p">(</span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SlotsArr</span><span class="p">.</span><span class="n">Num</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">ChildIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ChildIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">SlotsArr</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">ChildIndex</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// for slots that don&#39;t have border settings parameter override</span>
<span class="w">        </span><span class="c1">// apply default global border setting</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SlotsArr</span><span class="p">[</span><span class="n">ChildIndex</span><span class="p">].</span><span class="n">GetSlot</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCurrentBorderSettings</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FBorderSettings</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">SlotsArr</span><span class="p">[</span><span class="n">ChildIndex</span><span class="p">].</span><span class="n">GetSlot</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetCurrentBorderSettings</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_DefaultBorderSettings</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">AddSlot</span><span class="p">(</span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">SlotsArr</span><span class="p">[</span><span class="n">ChildIndex</span><span class="p">]));</span><span class="w"> </span><span class="c1">// this will call &quot;construct&quot; method on the slot as well</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// fill grid with default slots</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">SlotsAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_InitialGridSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_InitialGridSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="n">FillGrid</span><span class="p">(</span><span class="n">SlotsAmount</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_InitialGridSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">GetDefaultBorderSettings</span><span class="p">());</span>
<span class="p">}</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">ComputeDesiredSize</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="c1">// *note - this code just copied from SUniformGridPanel.cpp</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">MaxChildDesiredSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FVector2D</span><span class="o">::</span><span class="n">ZeroVector</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">SlotPaddingDesiredSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SlotPadding</span><span class="p">.</span><span class="n">Get</span><span class="p">().</span><span class="n">GetDesiredSize</span><span class="p">();</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">CachedMinDesiredSlotWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MinDesiredSlotWidth</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">CachedMinDesiredSlotHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MinDesiredSlotHeight</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="n">NumColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">NumRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">ChildIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ChildIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">ChildIndex</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FSlot</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">ChildIndex</span><span class="p">];</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Child</span><span class="p">.</span><span class="n">GetWidget</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetVisibility</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Collapsed</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// A single cell at (N,M) means our grid size is (N+1, M+1)</span>
<span class="w">            </span><span class="n">NumColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="p">(</span><span class="n">Child</span><span class="p">.</span><span class="n">GetColumn</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">NumColumns</span><span class="p">);</span>
<span class="w">            </span><span class="n">NumRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="p">(</span><span class="n">Child</span><span class="p">.</span><span class="n">GetRow</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">NumRows</span><span class="p">);</span>
<span class="w">            </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">ChildDesiredSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Child</span><span class="p">.</span><span class="n">GetWidget</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetDesiredSize</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SlotPaddingDesiredSize</span><span class="p">;</span>
<span class="w">            </span><span class="n">ChildDesiredSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="p">(</span><span class="n">ChildDesiredSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">CachedMinDesiredSlotWidth</span><span class="p">);</span>
<span class="w">            </span><span class="n">ChildDesiredSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="p">(</span><span class="n">ChildDesiredSize</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">CachedMinDesiredSlotHeight</span><span class="p">);</span>
<span class="w">            </span><span class="n">MaxChildDesiredSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="p">(</span><span class="n">MaxChildDesiredSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">ChildDesiredSize</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
<span class="w">            </span><span class="n">MaxChildDesiredSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="p">(</span><span class="n">MaxChildDesiredSize</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">ChildDesiredSize</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">(</span><span class="n">NumColumns</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MaxChildDesiredSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">NumRows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MaxChildDesiredSize</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">OnArrangeChildren</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">FArrangedChildren</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ArrangedChildren</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="c1">// *note - this code just copied from SUniformGridPanel.cpp</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CellSize</span><span class="p">(</span><span class="n">AllottedGeometry</span><span class="p">.</span><span class="n">GetLocalSize</span><span class="p">().</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">NumColumns</span><span class="p">,</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">.</span><span class="n">GetLocalSize</span><span class="p">().</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">NumRows</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FMargin</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">CurrentSlotPadding</span><span class="p">(</span><span class="n">SlotPadding</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">ChildIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ChildIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">ChildIndex</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">FSlot</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildrenContainer</span><span class="p">[</span><span class="n">ChildIndex</span><span class="p">];</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">EVisibility</span><span class="w"> </span><span class="n">ChildVisibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Child</span><span class="p">.</span><span class="n">GetWidget</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetVisibility</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ArrangedChildren</span><span class="p">.</span><span class="n">Accepts</span><span class="p">(</span><span class="n">ChildVisibility</span><span class="p">))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Do the standard arrangement of elements within a slot</span>
<span class="w">                </span><span class="c1">// Takes care of alignment and padding.</span>
<span class="w">                </span><span class="n">AlignmentArrangeResult</span><span class="w"> </span><span class="n">XAxisResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlignChild</span><span class="o">&lt;</span><span class="n">Orient_Horizontal</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CellSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Child</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentSlotPadding</span><span class="p">);</span>
<span class="w">                </span><span class="n">AlignmentArrangeResult</span><span class="w"> </span><span class="n">YAxisResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlignChild</span><span class="o">&lt;</span><span class="n">Orient_Vertical</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CellSize</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Child</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentSlotPadding</span><span class="p">);</span>
<span class="w">                </span><span class="n">ArrangedChildren</span><span class="p">.</span><span class="n">AddWidget</span><span class="p">(</span><span class="n">ChildVisibility</span><span class="p">,</span>
<span class="w">                    </span><span class="n">AllottedGeometry</span><span class="p">.</span><span class="n">MakeChild</span><span class="p">(</span><span class="n">Child</span><span class="p">.</span><span class="n">GetWidget</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">FVector2D</span><span class="p">(</span><span class="n">CellSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Child</span><span class="p">.</span><span class="n">GetColumn</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XAxisResult</span><span class="p">.</span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="n">CellSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Child</span><span class="p">.</span><span class="n">GetRow</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YAxisResult</span><span class="p">.</span><span class="n">Offset</span><span class="p">),</span>
<span class="w">                        </span><span class="n">FVector2D</span><span class="p">(</span><span class="n">XAxisResult</span><span class="p">.</span><span class="n">Size</span><span class="p">,</span><span class="w"> </span><span class="n">YAxisResult</span><span class="p">.</span><span class="n">Size</span><span class="p">)</span>
<span class="w">                    </span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
</code></pre></div>
Написанный мной класс <code>SBorderedUniformGrid</code> имеет все необходимые методы для работы со слотами.</p>
<p>Рассмотрим методы.</p>
<p>Метод <code>GetChildAt</code> позволяет находить виджет по его параметрам <code>Col</code> и  <code>Row</code>. По умолчанию <code>SUniformGridPanel</code> так делать не умеет.</p>
<p><a class="glightbox" href="../images/114f973ccf1cf41c4fef747a00c52136.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="114f973ccf1cf41c4fef747a00c52136.png" auto_="auto;" display="block;" margin:="margin:" src="../images/114f973ccf1cf41c4fef747a00c52136.png" /></a></p>
<p>Метод <code>ColRow_To_Index</code> позволяет получить индекс из параметров <code>Col / Row</code>. Добавлен и обратный ему метод получения индекса из <code>Col / Row</code> - <code>ColRow_To_Index</code>.</p>
<p><a class="glightbox" href="../images/06f3a7774e411d8376890d2833ecc7e2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="06f3a7774e411d8376890d2833ecc7e2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/06f3a7774e411d8376890d2833ecc7e2.png" /></a></p>
<p>Индекс, в данном случае, олицетворяет порядковый номер элемента в массиве. Напомню, тем кто забыл: <code>TArray</code> не поддерживает двумерные массивы, а значит инвентарь, помещаемый в грид, должен конвертироватсья из списка в двумерный массив и обратно. Эти методы позволяют осуществлять подобные трюки.</p>
<p>Метод <code>ReplaceSlotAt</code> позволяет заменить содержимое слота - другим содержимым, по желанию. Он позволит размещать предметы инвентаря в слотах.</p>
<p><a class="glightbox" href="../images/3da8cd679ebc3dcdd4d09de07727b86b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3da8cd679ebc3dcdd4d09de07727b86b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3da8cd679ebc3dcdd4d09de07727b86b.png" /></a></p>
<p>В классе есть три метода <code>RemoveSlot</code>, реализующие различные сценарии для удаления слота.</p>
<p><a class="glightbox" href="../images/0f839b5c403c9acca57f767ac3682c55.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0f839b5c403c9acca57f767ac3682c55.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0f839b5c403c9acca57f767ac3682c55.png" /></a></p>
<p>Метод <code>FillGrid</code> заполняет грид указанным количеством слотов, потому что по умолчанию грид этого делать не умеет и все его слоты пусты. Я сумел реализовать этот метод таким образом, чтобы он не удалял уже существующие слоты, добавленные через декларативный синтаксис <code>Slate</code>.</p>
<p><a class="glightbox" href="../images/8a6248fb3c7d1495ee26dbd9533ef680.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8a6248fb3c7d1495ee26dbd9533ef680.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8a6248fb3c7d1495ee26dbd9533ef680.png" /></a></p>
<h5 id="_15">Тестирование</h5>
<p>Тестирование выполняется следующим кодом:
<div class="highlight"><pre><span></span><code><span class="c1">// .h</span>
<span class="k">private</span><span class="o">:</span>
<span class="c1">// Test Exposed controls</span>
<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SBorderedUniformGrid</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BorderedGrid</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">// .cpp</span>
<span class="c1">// Construct</span>
<span class="c1">// Bind key 2 to perform Grid Panel Tests</span>
<span class="n">FInputKeyBinding</span><span class="w"> </span><span class="n">KB2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FInputKeyBinding</span><span class="p">(</span><span class="n">EKeys</span><span class="o">::</span><span class="n">Two</span><span class="p">,</span><span class="w"> </span><span class="n">EInputEvent</span><span class="o">::</span><span class="n">IE_Pressed</span><span class="p">);</span>
<span class="n">KB2</span><span class="p">.</span><span class="n">KeyDelegate</span><span class="p">.</span><span class="n">GetDelegateForManualSet</span><span class="p">().</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Slot border change Test</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BorderedGrid</span><span class="o">-&gt;</span><span class="n">GetSlotAt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">Str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetCurrentBorderSettings</span><span class="p">().</span><span class="n">BorderImageBrush</span><span class="o">-&gt;</span><span class="n">TintColor</span><span class="p">.</span><span class="n">GetSpecifiedColor</span><span class="p">().</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">    </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">SetCurrentBorderSettings</span><span class="p">({</span>
<span class="w">            </span><span class="nb">true</span><span class="p">,</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="mf">2.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                </span><span class="n">TEXT</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;SBorderedUniformGrid::greencolor&quot;</span><span class="w"> </span><span class="p">),</span>
<span class="w">                </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">UpdateBorderSettings</span><span class="p">();</span><span class="w"> </span><span class="c1">// apply changes</span>
<span class="w">    </span><span class="c1">// Widget Slot Data Replace Test</span>
<span class="w">    </span><span class="c1">// will put data into slot</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">STextBlock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TxtBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">).</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// will clear content and replace it with new data</span>
<span class="w">    </span><span class="n">BorderedGrid</span><span class="o">-&gt;</span><span class="n">ReplaceSlotAt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">TxtBlock</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nb">true</span><span class="p">,</span>
<span class="w">        </span><span class="p">{</span><span class="mf">7.f</span><span class="p">,</span><span class="mf">7.f</span><span class="p">},</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">            </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SBorderedUniformGrid::greencolor1&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="mf">1.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// will test grid filling</span>
<span class="w">    </span><span class="n">BorderedGrid</span><span class="o">-&gt;</span><span class="n">FillGrid</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlotBorderSettings</span><span class="p">{</span>
<span class="w">                </span><span class="nb">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slot Color = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Str</span><span class="p">);</span>
<span class="p">});</span>
<span class="n">InArgs</span><span class="p">.</span><span class="n">_PlayerController</span><span class="o">-&gt;</span><span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">KeyBindings</span><span class="p">.</span><span class="n">Emplace</span><span class="p">(</span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">KB2</span><span class="p">));</span>
<span class="c1">//...</span>
<span class="c1">// Generate Bordered Uniform Grid</span>
<span class="n">SAssignNew</span><span class="p">(</span><span class="n">BorderedGrid</span><span class="p">,</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="p">)</span>
<span class="p">.</span><span class="n">InitialGridSize</span><span class="p">({</span><span class="mf">3.f</span><span class="p">,</span><span class="mf">3.f</span><span class="p">})</span><span class="w"> </span><span class="c1">// fill initial slots in grix of 3 x 3</span>
<span class="p">.</span><span class="n">SlotPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">3.f</span><span class="p">,</span><span class="mf">4.f</span><span class="p">})</span>
<span class="p">.</span><span class="n">DefaultBorderSettings</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlotBorderSettings</span><span class="p">{</span>
<span class="w">    </span><span class="nb">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">},</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">        </span><span class="c1">//TEXT(&quot;SBorderedUniformGrid::Slot1&quot;),</span>
<span class="w">        </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="p">(</span><span class="n">StaticLoadObject</span><span class="p">(</span><span class="n">UMaterialInstance</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;</span><span class="p">))),</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="p">},</span>
<span class="w">        </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="w"> </span><span class="c1">// Default Slot tint color is White</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})</span>
<span class="c1">// 0</span>
<span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="p">]</span>
<span class="c1">// 1</span>
<span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// this slot has overriden border color</span>
<span class="w">    </span><span class="nb">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">            </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SBorderedUniformGrid::Slot2&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="p">},</span>
<span class="w">            </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="w"> </span><span class="c1">// this slot border color will be Red</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="p">]</span>
<span class="c1">// 2</span>
<span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// this is slot with border, but without content, but bg color is overriden</span>
<span class="w">    </span><span class="nb">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">},</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">        </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SBorderedUniformGrid::Slot3&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="p">},</span>
<span class="w">        </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Black</span><span class="w"> </span><span class="c1">// this slot will be totally black witout any content</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="cm">/*[ // no content in this slot!</span>
<span class="cm">    SNew(SImage)</span>
<span class="cm">    .ColorAndOpacity(FLinearColor::Blue)</span>
<span class="cm">]*/</span>
<span class="c1">// 3</span>
<span class="o">+</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// this is slot with border, but without content, with default bg color</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="c1">// 4</span>
<span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="p">]</span>
</code></pre></div>
Данный код создает на экране грид со слотами одинаковой размерности и разноцветной обводкой, в зависимости от параметра границы у каждого слота. Сетка размером <code>3 x 3</code> будет заполнена желтыми слотами.</p>
<p><a class="glightbox" href="../images/a09497cd024856aa680061dea4e2e5d6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a09497cd024856aa680061dea4e2e5d6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a09497cd024856aa680061dea4e2e5d6.png" /></a></p>
<p>По нажатию клавиши <code>2</code> я выполняю проверку и печать цветовой информации, которая содержится в границе слота по индекску <code>1,2</code>. После чего я меня цвет границы этого слота на зеленый.</p>
<p><a class="glightbox" href="../images/faaa4f92d62e7e0753f5a049b44dfd98.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="faaa4f92d62e7e0753f5a049b44dfd98.png" auto_="auto;" display="block;" margin:="margin:" src="../images/faaa4f92d62e7e0753f5a049b44dfd98.png" /></a></p>
<p>Далее я заменяю содержимое слота с индексом <code>0,0</code> на текст <code>Test</code>.</p>
<p><a class="glightbox" href="../images/6eee17b0d38843aa3b3c0aaf0514a02a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6eee17b0d38843aa3b3c0aaf0514a02a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6eee17b0d38843aa3b3c0aaf0514a02a.png" /></a></p>
<p><code>24</code> пустые ячейки грида, по <code>4</code> в ряд, заполняются  пустыми слотами.</p>
<p><a class="glightbox" href="../images/e9075caa496ba158ce3d923bec676c9f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e9075caa496ba158ce3d923bec676c9f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e9075caa496ba158ce3d923bec676c9f.png" /></a></p>
<p>Было:</p>
<p><a class="glightbox" href="../images/ccbed47e15b2c6c32baeee36241ca25b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ccbed47e15b2c6c32baeee36241ca25b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ccbed47e15b2c6c32baeee36241ca25b.png" /></a></p>
<p>После нажатия клавиши <code>2</code> слоты меняются так:</p>
<p><a class="glightbox" href="../images/d78e5c576260c8e2b015d45447e65b36.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d78e5c576260c8e2b015d45447e65b36.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d78e5c576260c8e2b015d45447e65b36.png" /></a></p>
<p>Сверху вы видите как заполняется сетка <code>6 x 4</code>, не затрагивая уже существующие слоты. Далее вы видите как переопределяется цвет границы у первого слота и у слота <code>3,2</code>.
Используя приведенный выше класс вы можете сделать т.н. классический игровой интвентарь. На вроде того, что был в <code>Baldur's Gate</code>.</p>
<p><a class="glightbox" href="../images/57f0e8dbf1ad4d09d305eb90a5e3eee4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="57f0e8dbf1ad4d09d305eb90a5e3eee4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/57f0e8dbf1ad4d09d305eb90a5e3eee4.png" /></a></p>
<p>Вы можете расширить класс и собрать его таким образом, чтобы он загружал данные инвентаря вашего персонажа, а потом выводил их на экран, соответственно.</p>
<p>Однако, в данный момент на экране всего-лишь квадратные непонятные фигуры, да еще и с цветом вместо текстуры, как же превратить все это в слоты инвентаря? Используем стили оформления.</p>
<h3 id="_16">Стили оформления</h3>
<p>Стили позволяют компактно разместить в одном месте постоянно используемые элементы оформления. Например, на протяжении написания предыдущего кода мы часто использовали блоки <code>FSlateImageBrush</code>, которые постоянно приходилось создавать заново, что очень сильно влияло на читаемость кода и комфорт работы с проектом.
<div class="highlight"><pre><span></span><code><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">    </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="p">(</span><span class="n">StaticLoadObject</span><span class="p">(</span><span class="n">UMaterialInstance</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;</span><span class="p">))),</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="p">},</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="w"> </span><span class="c1">// Default Slot tint color is White</span>
<span class="p">}</span>
</code></pre></div>
Я уже тогда хотел создать <code>SlateStyle</code>, но это бы не вписалось в логику статьи.</p>
<p>Стили делятся на две категории.
+ <code>WidgetStyle</code> стили. При реализации этого типа стилей, разработчик получает возможность создавать в движке файл с данными, в котором можно хранить элементы оформления игрового интерфейса. Этот тип стилей оформления должен быть использован при работе с <code>runtime ui</code>, то есть с внутриигровым интерфейсом.
+ <code>StyleSet</code> стили. Данные стили жестко привязаны к с++ коду и чтобы изменить значения в этих стилях - придется открывать исходники. Этот тип стилей используется для внутренних систем движка.</p>
<h4 id="widgetstyle"><code>WidgetStyle</code> стили</h4>
<p>Рассмотрим для начала стили, которые можно изменять из движка, не открывая исходный код.
<code>WidgetStyle</code> - это своеобразный <code>DataAsset</code>(с рядом отличий) для стилей <code>Slate</code>.
Разработчик может вынести часть информации об оформлении виджетов в отдельные файлы <code>WidgetStyle</code>, чтобы потом, изменяя их, влиять на оформление виджетов в игре.</p>
<p>Шаблон для подобного вида стилей предустановлен в <code>Unrean Engine</code>, поэтому создать файл не составит труда.</p>
<p>Идем <code>Tools -&gt; New C++ Class</code> и ищем в появившемся окне пункт  <code>Slate Widget Style</code>.</p>
<p><a class="glightbox" href="../images/5621e2ca1e9dc2d53a19db8707275a11.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5621e2ca1e9dc2d53a19db8707275a11.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5621e2ca1e9dc2d53a19db8707275a11.png" /></a></p>
<p>Я называю класс <code>SlateUIWidgetStyle</code>.</p>
<p><a class="glightbox" href="../images/b502b492115453da9b04e330101b3255.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b502b492115453da9b04e330101b3255.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b502b492115453da9b04e330101b3255.png" /></a></p>
<p>Не забудьте обновить проект командой <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/aeaaa44508ab96e2a6c4205aa4dc0baf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="aeaaa44508ab96e2a6c4205aa4dc0baf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/aeaaa44508ab96e2a6c4205aa4dc0baf.png" /></a></p>
<p>После этих операций движок создаст в папке модуля <code>SlateRuntimeModule</code> заготовку для хранения стилей оформления.</p>
<p>Внутри вы найдете два класса: <code>FSlateUIStyle</code> и <code>USlateUIWidgetStyle</code>. Оба они являются <code>UObject</code> и управляются системой сборки мусора.</p>
<p><a class="glightbox" href="../images/315e4f70290c4e8e3c8fb20fc03664cb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="315e4f70290c4e8e3c8fb20fc03664cb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/315e4f70290c4e8e3c8fb20fc03664cb.png" /></a></p>
<p>Структура <code>FSlateUIStyle</code> отвечает непосредственно за реализацию стиля. В этой структуре необходимо указывать поля, которые будет хранить файл <code>SlateWidgetStyle</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cm">/**</span>
<span class="cm"> * Main style class</span>
<span class="cm"> */</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateWidgetStyle</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Destructor</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">FSlateUIStyle</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Place here to OutBrushes all your custom style brushes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetResources</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OutBrushes</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// static const default value is set in .cpp file or below the class</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TypeName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// getter</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetTypeName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">TypeName</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// should return singletone &quot;static FSlateUIStyle&quot;</span>
<span class="w">    </span><span class="c1">// if you don&#39;t remember how static is work:</span>
<span class="w">    </span><span class="c1">// static variables defined once and exist until app is closed. they not cleared after exiting the function.</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetDefault</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="w"> </span><span class="n">Default</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Default</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Constructor</span>
<span class="n">FSlateUIStyle</span><span class="o">::</span><span class="n">FSlateUIStyle</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="c1">// Destructor</span>
<span class="n">FSlateUIStyle</span><span class="o">::~</span><span class="n">FSlateUIStyle</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="c1">// since TypeName is &quot;static const&quot;, default value of this variable can be set only in .cpp file</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="o">::</span><span class="n">TypeName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FSlateUIStyle&quot;</span><span class="p">));</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateUIStyle::GetResources</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OutBrushes</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Add any brush resources here so that Slate can correctly atlas and reference them</span>
<span class="p">}</span>
</code></pre></div>
Далее идет класс <code>USlateUIWidgetStyle</code>, который отвечает за регистрацию структуры в системе стилей. Этот класс прост и не имеет дополнительной реализации в <code>.cpp</code> файле. Изменять тут ничего не надо.
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Singletone that allows to register FSlateUIStyle int the FAppStyle</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">(</span><span class="n">hidecategories</span><span class="o">=</span><span class="n">Object</span><span class="p">,</span><span class="w"> </span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">USlateUIWidgetStyle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">USlateWidgetStyleContainerBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="cm">/** The actual data describing the widget appearance. */</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span><span class="o">=</span><span class="n">Appearance</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="o">=</span><span class="p">(</span><span class="n">ShowOnlyInnerProperties</span><span class="p">))</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="w"> </span><span class="n">WidgetStyle</span><span class="p">;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">FSlateWidgetStyle</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">GetStyle</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">FSlateWidgetStyle</span><span class="o">*</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">WidgetStyle</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
Чтобы лучше понять как все работает - скопилируйте проект с двумя этими классами. Теперь в <code>ContentBrowser</code> идем <code>Add -&gt; UserInterface -&gt; Slate Widget Style</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/8788465d499bcdec05840f85e1d1a719.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8788465d499bcdec05840f85e1d1a719.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8788465d499bcdec05840f85e1d1a719.png" /></a></p>
<p>И видим наш класс <code>SlateUIWidgetStyle</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/7c251cdea7681c2078ef47ff4fbc57c0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7c251cdea7681c2078ef47ff4fbc57c0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7c251cdea7681c2078ef47ff4fbc57c0.png" /></a></p>
<p>Можно создать несколько экземпляров этого класса, чтобы использовать их в роли контейнеров для данных оформления, но пока в этом нет смысла. Потому что мы не добавили никакой информации внутрь класса.</p>
<p>Давайте добавим в структуру с данными, а именно в <code>FSlateUIStyle</code> несколько полей с данными. Эти поля должны быть <code>blueprintable</code>, иначе ничего не получится.</p>
<p>В моем случае получилось так:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cm">/**</span>
<span class="cm"> * Main blueprintable widget style class</span>
<span class="cm"> */</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateWidgetStyle</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Destructor</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">FSlateUIStyle</span><span class="p">();</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * FSlateWidgetStyle Interface</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Place here to OutBrushes all your custom style brushes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetResources</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OutBrushes</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// static const default value is set in .cpp file or below the class</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TypeName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// should return TypeName</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetTypeName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">TypeName</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// should return singletone &quot;static FSlateUIStyle&quot;</span>
<span class="w">    </span><span class="c1">// if you don&#39;t remember how static is work:</span>
<span class="w">    </span><span class="c1">// static variables defined once and exist until app is closed. they not cleared after exiting the function.</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetDefault</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="w"> </span><span class="n">Default</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Default</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Properties</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// FontStyle</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">TextUiFontInfo</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">SetTextUiFont</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InFontInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TextUiFontInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InFontInfo</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Slot Border Brush</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">FSlateBrush</span><span class="w"> </span><span class="n">SlotBorderBrush</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">SetUpSlotBorderBrush</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">&amp;</span><span class="w"> </span><span class="n">BorderBrush</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SlotBorderBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BorderBrush</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Slot Border Mouse Over</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">FSlateColor</span><span class="w"> </span><span class="n">StaminaBarColor</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">SetStaminaBarColor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateColor</span><span class="o">&amp;</span><span class="w"> </span><span class="n">BorderBrush</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StaminaBarColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BorderBrush</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Slot Border Margin</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">FMargin</span><span class="w"> </span><span class="n">SlotBorderMargin</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">SetSlotBorderMargin</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FMargin</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InMargin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SlotBorderMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InMargin</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateUIWidgetStyle.h&quot;</span>
<span class="c1">// Constructor</span>
<span class="n">FSlateUIStyle</span><span class="o">::</span><span class="n">FSlateUIStyle</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Set Default Values Here</span>
<span class="w">    </span><span class="n">StaminaBarColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateColor</span><span class="p">{</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">SlotBorderMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// for SlotBorderBrush</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">DefaultMaterialPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaterialPointer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FSoftObjectPath</span><span class="p">(</span><span class="o">*</span><span class="n">DefaultMaterialPath</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">MaterialPointer</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SlotBorderBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="n">MaterialPointer</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">(),</span><span class="w"> </span><span class="c1">// stylesets work only with valid objects</span>
<span class="w">                                </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span><span class="w"> </span><span class="c1">// Default Slot tint color</span>
<span class="w">                            </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// set default font object</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">FontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Font&#39;/Game/UI/Bitter-Black_Font.Bitter-Black_Font&#39;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//TSharedPtr&lt;UObject&gt; LoadedFontObj = MakeShareable(LoadObject&lt;UObject&gt;(NULL, *FontPath)); // - this will work  to but i prefer soft pointers</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FontPointer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">FSoftObjectPath</span><span class="p">(</span><span class="o">*</span><span class="n">FontPath</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">FontPointer</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TextUiFontInfo</span><span class="p">.</span><span class="n">FontObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FontPointer</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">();</span><span class="w"> </span><span class="c1">// stylesets work only with valid objects</span>
<span class="w">        </span><span class="n">TextUiFontInfo</span><span class="p">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Destructor</span>
<span class="n">FSlateUIStyle</span><span class="o">::~</span><span class="n">FSlateUIStyle</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="c1">// since TypeName is &quot;static const&quot;, default value of this variable can be set only in .cpp file</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="o">::</span><span class="n">TypeName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FSlateUIStyle&quot;</span><span class="p">));</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateUIStyle::GetResources</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OutBrushes</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Add any brush resources here so that Slate can correctly atlas and reference them</span>
<span class="w">    </span><span class="n">OutBrushes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SlotBorderBrush</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Обратите внимание на метод <code>GetResources</code>. Этот метод принимает по ссылке массив <code>FSlateBrush</code>, в который разработчик должен поместить собственные кисти стилей.</p>
<p>Данные кисти будут считанны из стиля и использованы сисемой рендеринга.</p>
<p><a class="glightbox" href="../images/234b349699b278e4c0b62b75d133ffa9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="234b349699b278e4c0b62b75d133ffa9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/234b349699b278e4c0b62b75d133ffa9.png" /></a></p>
<p>Я задал передал в этом методе ссылку на кисть <code>SlotBorderBrush</code>.
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">FSlateUIStyle::GetResources</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OutBrushes</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Add any brush resources here so that Slate can correctly atlas and reference them</span>
<span class="w">    </span><span class="n">OutBrushes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SlotBorderBrush</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Теперь можно создать <code>blueprint</code> версию нашего стиля.</p>
<p>В главный каталог проекта <code>Content</code> я добавил подкатегорию <code>/UI/Styles/</code>.</p>
<p><a class="glightbox" href="../images/e4fe1a10d4785a01b15f59271f029512.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e4fe1a10d4785a01b15f59271f029512.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e4fe1a10d4785a01b15f59271f029512.png" /></a></p>
<p>Теперь повторяем описанный выше цикл операций.</p>
<p>В <code>ContentBrowser</code> идем <code>Add -&gt; UserInterface -&gt; Slate Widget Style</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/8788465d499bcdec05840f85e1d1a719.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8788465d499bcdec05840f85e1d1a719.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8788465d499bcdec05840f85e1d1a719.png" /></a></p>
<p>И видим наш класс <code>SlateUIWidgetStyle</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/7c251cdea7681c2078ef47ff4fbc57c0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7c251cdea7681c2078ef47ff4fbc57c0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7c251cdea7681c2078ef47ff4fbc57c0.png" /></a></p>
<p>Добавляем. Я назвал стиль <code>MyWidgetStyle</code>.</p>
<p><a class="glightbox" href="../images/a96aba61e245ca210be078143558fd10.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a96aba61e245ca210be078143558fd10.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a96aba61e245ca210be078143558fd10.png" /></a></p>
<p>Если открыть созданный файл, мы увидим внутри поля, которые задали ранее в структуре <code>FSlateUIStyle</code>.</p>
<p><a class="glightbox" href="../images/b9e4e07a6044395eff1dafad119fff4b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b9e4e07a6044395eff1dafad119fff4b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b9e4e07a6044395eff1dafad119fff4b.png" /></a></p>
<p>Обратите внимание, что значения полей соответствуют тем, которые мы выставили в конструкторе структуры.</p>
<p>В параметр <code>SlotBorderBrush</code> я устанавил вместо текстуры -  ссылку на материал.</p>
<p>Это простейший <code>User Interface</code> материал.</p>
<p><a class="glightbox" href="../images/a5b879cf7aa79459cab323ed97151f18.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a5b879cf7aa79459cab323ed97151f18.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a5b879cf7aa79459cab323ed97151f18.png" /></a></p>
<p>Параметр <code>TextUiFontInfo</code> отображает поле для шрифта. Шрифт, по умолчанию загружающийся в это поле, импортирован в папку проекта <code>UI</code>.</p>
<p><a class="glightbox" href="../images/7dc5e0afec4cc32120a83741542a3616.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7dc5e0afec4cc32120a83741542a3616.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7dc5e0afec4cc32120a83741542a3616.png" /></a></p>
<p>Как вы видите, ссылка на шрифт загрузилась  корректно.</p>
<p><a class="glightbox" href="../images/de71bf6352dc0079f366b0dae4555d49.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="de71bf6352dc0079f366b0dae4555d49.png" auto_="auto;" display="block;" margin:="margin:" src="../images/de71bf6352dc0079f366b0dae4555d49.png" /></a></p>
<p>Сам шрифт вы можете найти в папке <code>Дополнительно</code>, которая идет вместе с книгой. Он поддерживает как кириллицу, так и латинницу.</p>
<p>Теперь надо зарегистрировать полученный стиль в системе. Для этого используем конструктор и деструктор модуля.
<div class="highlight"><pre><span></span><code><span class="c1">// SlateRuntimeModule.h</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Modules/ModuleManager.h&quot;</span>
<span class="n">DECLARE_LOG_CATEGORY_EXTERN</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">All</span><span class="p">,</span><span class="w"> </span><span class="n">All</span><span class="p">);</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FSlateRuntimeModule</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IModuleInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="cm">/* Called when the module is loaded */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">StartupModule</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* Called when the module is unloaded */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShutdownModule</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FSlateStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">UiStyle</span><span class="p">;</span><span class="w"> </span><span class="c1">// style refrence</span>
<span class="p">};</span>
<span class="c1">// SlateRuntimeModule.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateRuntimeModule.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateUIWidgetStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Slate/SlateGameResources.h&quot;</span>
<span class="n">DEFINE_LOG_CATEGORY</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">);</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;FSlateRuntimeModule&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateRuntimeModule::StartupModule</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// register custom widget style class</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">UiStyle</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()){</span>
<span class="w">        </span><span class="n">UiStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateGameResources</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">FSlateUIStyle</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">GetTypeName</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;/Game/UI/Styles&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/Game/UI/Styles&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">RegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="n">UiStyle</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateRuntimeModule::ShutdownModule</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// unregister widget style and free memory</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">UiStyle</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">UnRegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="n">UiStyle</span><span class="p">);</span>
<span class="w">        </span><span class="n">UiStyle</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
<span class="n">IMPLEMENT_MODULE</span><span class="p">(</span><span class="n">FSlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">SlateRuntimeModule</span><span class="p">)</span>
</code></pre></div>
Обратите внимание на метод <code>FSlateGameResources::New()</code>, вкоторый я отправляю ссылку на папку со стилями - <code>"/Game/UI/Styles"</code>. Данная папка соответствует директории, в которую я добавил стиль <code>MyWidgetStyle</code>.</p>
<p><a class="glightbox" href="../images/5698e2befd8a7e368c43c852d24d13d0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5698e2befd8a7e368c43c852d24d13d0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5698e2befd8a7e368c43c852d24d13d0.png" /></a></p>
<p>Но не ожидайте, что система будет сканировать эту папку и загружать стили на "автомате".</p>
<p>Как использовать стили виджетов?
Для начала нам надо получить ссылку на файл стиля, щелкнув на нем правой кнопкой мыши <code>GetRefrence</code>.</p>
<p><a class="glightbox" href="../images/bd2e0c3340b8e9a309e2adeb489b03b5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bd2e0c3340b8e9a309e2adeb489b03b5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bd2e0c3340b8e9a309e2adeb489b03b5.png" /></a></p>
<p>В движке есть тип <code>USlateWidgetStyleAsset</code> рассчитанный на загрузку стилей. Используем его для загрузки ассета:
<div class="highlight"><pre><span></span><code><span class="c1">// Load Style from file</span>
<span class="n">USlateWidgetStyleAsset</span><span class="o">*</span><span class="w"> </span><span class="n">UiStyleFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadObject</span><span class="o">&lt;</span><span class="n">USlateWidgetStyleAsset</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/SlateCore.SlateWidgetStyleAsset&#39;/Game/UI/Styles/MyWidgetStyle.MyWidgetStyle&#39;&quot;</span><span class="p">));</span>
<span class="c1">// use style:</span>
<span class="n">SAssignNew</span><span class="p">(</span><span class="n">BorderedGrid</span><span class="p">,</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="p">)</span>
<span class="p">.</span><span class="n">MinDesiredSlotWidth</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="p">.</span><span class="n">MinDesiredSlotHeight</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="p">.</span><span class="n">InitialGridSize</span><span class="p">({</span><span class="mf">3.f</span><span class="p">,</span><span class="mf">3.f</span><span class="p">})</span><span class="w"> </span><span class="c1">// fill initial slots in grix of 3 x 3</span>
<span class="p">.</span><span class="n">SlotPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">2.f</span><span class="p">})</span>
<span class="p">.</span><span class="n">DefaultBorderSettings</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlotBorderSettings</span><span class="p">{</span>
<span class="w">    </span><span class="nb">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">},</span>
<span class="w">    </span><span class="o">&amp;</span><span class="p">(</span><span class="n">UiStyleFile</span><span class="o">-&gt;</span><span class="n">GetStyle</span><span class="o">&lt;</span><span class="n">FSlateUIStyle</span><span class="o">&gt;</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SlotBorderBrush</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>
Не забудьте изменить стиль, на который ссылаетесь.</p>
<p><a class="glightbox" href="../images/2532550f91611d1d02179d60016b1796.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2532550f91611d1d02179d60016b1796.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2532550f91611d1d02179d60016b1796.png" /></a></p>
<p><a class="glightbox" href="../images/07a1db65958ed582f88a71300a42ecc1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="07a1db65958ed582f88a71300a42ecc1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/07a1db65958ed582f88a71300a42ecc1.png" /></a></p>
<p>Применяя такой подход, можно вынести все оформление интерфейса в файлы стилей, а потом менять их по желанию.</p>
<h4 id="styleset"><code>StyleSet</code> стили</h4>
<p><code>StyleSet</code> это паттерн для реализации класса с набором <code>static</code> полей. Данный класс может быть использован разработчиком для регистрации собственных стилей <code>Slate</code> в движке <code>Unral Engine</code>.
Стили этого типа не могут быть использованы из <code>blueprint</code> кода напрямую, но часто служат прослойкой между <code>widget style</code> и виджетом <code>slate</code>.
Давайте откроем директорию нашего модуля <code>SlateRuntimeModule</code>.</p>
<p><a class="glightbox" href="../images/55c731bde0ff3b19eb78fbe53ada5a09.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="55c731bde0ff3b19eb78fbe53ada5a09.png" auto_="auto;" display="block;" margin:="margin:" src="../images/55c731bde0ff3b19eb78fbe53ada5a09.png" /></a></p>
<p>Добавляем в папку <code>Public</code> подкаталог <code>Styles</code>.</p>
<p><a class="glightbox" href="../images/9fe6072ff129ac47051d58352b1b8187.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9fe6072ff129ac47051d58352b1b8187.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9fe6072ff129ac47051d58352b1b8187.png" /></a></p>
<p>В который, в свою очередь, добавляем файл <code>UiSlateStyleSet.h</code>, который будет заголовочным файлом для нашего класса.</p>
<p><a class="glightbox" href="../images/5d1fe9ab183305fce09c714b969630fa.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5d1fe9ab183305fce09c714b969630fa.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5d1fe9ab183305fce09c714b969630fa.png" /></a></p>
<p>Теперь идем в директорию модуля <code>Private</code> и там создаем папку <code>Styles</code>, а в ней файл <code>UiSlateStyleSet.cpp</code>.</p>
<p><a class="glightbox" href="../images/5ae3498572b48cc4db0ed1eb65e0612b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5ae3498572b48cc4db0ed1eb65e0612b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5ae3498572b48cc4db0ed1eb65e0612b.png" /></a></p>
<p><a class="glightbox" href="../images/88fcb5a4aded8d4cadb9c6f0c61077af.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="88fcb5a4aded8d4cadb9c6f0c61077af.png" auto_="auto;" display="block;" margin:="margin:" src="../images/88fcb5a4aded8d4cadb9c6f0c61077af.png" /></a></p>
<p>Чтобы созданные файлы появились в <code>SolutionExplorer</code> выполняем команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/2b995f136c07481d0be13c9e5ab7655a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2b995f136c07481d0be13c9e5ab7655a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2b995f136c07481d0be13c9e5ab7655a.png" /></a></p>
<p><a class="glightbox" href="../images/705678a1e334ab45906554c8bb3718c5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="705678a1e334ab45906554c8bb3718c5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/705678a1e334ab45906554c8bb3718c5.png" /></a></p>
<p>Теперь самое время добавить код.</p>
<p>Примеров реализации <code>StyleSet</code> паттерна очень много внутри самого движка Unreal Engint. Все они сводятся к простому классу с набором <code>Static</code> методов.</p>
<p>Для примера - рассмотрим класс <code>FProfilerStyle</code> в файле <code>\Source\Developer\Profiler\Private\ProfilerStyle.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateColor.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/NameTypes.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Templates/UniquePtr.h&quot;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FProfilerStyle</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateStyleSet</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FProfilerStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">Get</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="o">~</span><span class="n">FProfilerStyle</span><span class="p">();</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">FProfilerStyle</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FProfilerStyle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Inst</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/2f67236c6a8ff196e62791ed9d1491aa.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2f67236c6a8ff196e62791ed9d1491aa.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2f67236c6a8ff196e62791ed9d1491aa.png" /></a></p>
<p>Тут есть конструктор, деструктор, а так-же метод <code>Get</code>, который инициализирует синглтон <code>Inst</code>.</p>
<p><a class="glightbox" href="../images/b68c3c842e508ba20e3181884549e08a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b68c3c842e508ba20e3181884549e08a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b68c3c842e508ba20e3181884549e08a.png" /></a></p>
<p>Данный метод вызывается в конструкторе модуля, для инициализации стилиля. В деструкторе модуля он вызывается для удаления стиля из памяти.</p>
<p><a class="glightbox" href="../images/23d6c673f3bbe614c5af12db84cf6c7f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="23d6c673f3bbe614c5af12db84cf6c7f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/23d6c673f3bbe614c5af12db84cf6c7f.png" /></a></p>
<p><a class="glightbox" href="../images/97714b4c4ed6ea7bd19f7a7b75c1ad92.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="97714b4c4ed6ea7bd19f7a7b75c1ad92.png" auto_="auto;" display="block;" margin:="margin:" src="../images/97714b4c4ed6ea7bd19f7a7b75c1ad92.png" /></a></p>
<p>Давайте реализуем этот паттерн в собственном классе.</p>
<p>Файл <code>UiSlateStyleSet.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/ISlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyleRegistry.h&quot;</span><span class="c1"> // to register our styles in</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="c1">// Core Style include files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/CoreStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateTypes.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/AppStyle.h&quot;</span>
<span class="c1">// Style set - collection of slate styles</span>
<span class="c1">// Just static class, like it&#39;s done here - FProfilerStyle</span>
<span class="c1">//\Engine\Source\Developer\Profiler\Private\ProfilerStyle.h</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FUiSlateStyleSet</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateStyleSet</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// style set name</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// here we will store our style instance in Inst variable</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">Get</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// here we will unregister our style instance</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// destructor</span>
<span class="w">    </span><span class="o">~</span><span class="n">FUiSlateStyleSet</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// this method should form relative path to assets of the plugin / module</span>
<span class="w">    </span><span class="c1">// idea taken from \Plugins\Runtime\StateTree\Source\StateTreeEditorModule\Private\StateTreeEditorStyle.cpp</span>
<span class="w">    </span><span class="c1">// (it&#39;s new Mass based Ai State Tree)</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="nf">InContent</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="o">&amp;</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ANSICHAR</span><span class="o">*</span><span class="w"> </span><span class="n">Extension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this is how it should work with plugins:</span>
<span class="w">        </span><span class="c1">//static FString ContentDir = IPluginManager::Get().FindPlugin(TEXT(&quot;StateTreeEditorModule&quot;))-&gt;GetContentDir() / TEXT(&quot;Slate&quot;);</span>
<span class="w">        </span><span class="c1">//return (ContentDir / RelativePath) + Extension;</span>
<span class="w">        </span><span class="c1">// since we work with module:</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ContentDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule/Resources/&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ContentDir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Extension</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="w">    </span><span class="n">FUiSlateStyleSet</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FUiSlateStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Inst</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>UiSlateStyleSet.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/UiSlateStyleSet.h&quot;</span>
<span class="c1">// note* static members of class should be ALVAYS initialized with default value</span>
<span class="c1">// Even if they are in the Private scope (which i did not know)</span>
<span class="c1">// static initialization should be outside of the class</span>
<span class="c1">// or you will get following error:</span>
<span class="c1">// unresolved external symbol &quot;private: static class...etc&quot;</span>
<span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FUiSlateStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="c1">// static for teh style name</span>
<span class="n">FName</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">StyleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModuleStyles&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">FUiSlateStyleSet</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">FSlateStyleSet</span><span class="p">(</span><span class="n">StyleName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// first set the Parent Style</span>
<span class="w">    </span><span class="c1">// Parent Style always loads before our style</span>
<span class="w">    </span><span class="c1">// Inheriting Parent Style will allow us to use all styles, defined in it as our own class styles</span>
<span class="w">    </span><span class="c1">// so, for example &quot;Icons.Cross&quot; defined in core style - FCoreStyle::Get().GetBrush(&quot;Icons.Cross&quot;)</span>
<span class="w">    </span><span class="c1">// will be accessible thru - FUiSlateStyleSet::Get().GetBrush(&quot;Icons.Cross&quot;)</span>
<span class="w">    </span><span class="c1">// if we inherit from the CoreStyle (and we will do so)</span>
<span class="w">    </span><span class="c1">//*note: since FCoreStyle::StyleName dosen&#39;t exist(it&#39;s very old class), instead just use string, it will work</span>
<span class="w">    </span><span class="c1">//*note2: CoreStyle can be found here - \Source\Runtime\SlateCore\Private\Styling\CoreStyle.cpp</span>
<span class="w">    </span><span class="n">SetParentStyleName</span><span class="p">(</span><span class="s">&quot;CoreStyle&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//*note: if you don&#39;t want all CoreStyle styles - use this instead:</span>
<span class="w">    </span><span class="c1">//SetParentStyleName(FAppStyle::GetAppStyleSetName());</span>
<span class="w">    </span><span class="c1">// this will allow to work with: RootToContentDir(TEXT(&quot;file_name&quot;), TEXT(&quot;.extension&quot;)) to refrence content in the &quot;Root&quot; folder</span>
<span class="w">    </span><span class="c1">// as &quot;Root&quot; we use FPaths::EngineContentDir() / TEXT(&quot;Slate&quot;), because same walue is used in CoreStyle, which is our parent style</span>
<span class="w">    </span><span class="c1">// you can find this directory in engine installataion folder - \Engine\Content\Slate</span>
<span class="w">    </span><span class="n">SetContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// this will allow to work with: RootToCoreContentDir(TEXT(&quot;file_name&quot;), TEXT(&quot;.extension&quot;)) to refrence content in the &quot;Root&quot; folder</span>
<span class="w">    </span><span class="c1">// as &quot;Root&quot; we use FPaths::EngineContentDir() / TEXT(&quot;Slate&quot;), because same walue is used in CoreStyle, which is our parent style</span>
<span class="w">    </span><span class="c1">// you can find this directory in engine installataion folder - \Engine\Content\Slate</span>
<span class="w">    </span><span class="n">SetCoreContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// --- common variables ---</span>
<span class="w">    </span><span class="c1">// we can refrence files, that are not imported into project&#39;s filesystem, using direct links</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BitterLightFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/Bitter-Light&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// will search for file Bitter-Light.ttf in Resources / Fonts folder of the module</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BitterBlackFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/Bitter-Black&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// if you refrencing assets imported inside game project - preload them first</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">MaterialPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UMaterialInstance</span><span class="o">*</span><span class="w"> </span><span class="n">SlotMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadObject</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">MaterialPath</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// --- styles ---</span>
<span class="w">    </span><span class="c1">// custom brushes</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// some custom brushes</span>
<span class="w">        </span><span class="c1">// This brush image loaded from module&#39;s Resource folder</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotImageBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBoxBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// Box Brush projection</span>
<span class="w">                                    </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InventorySlot_Icon&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// will return path of InventorySlot_Icon from modeule Resources folder</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">0.4f</span><span class="p">},</span><span class="w"> </span><span class="c1">// margins on box and border brush projections work differenty, check it in umg widgets editor</span>
<span class="w">                                    </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush loaded from folder that is set as ContentRoot</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotContentBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBorderBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// Border Brush Projection</span>
<span class="w">                                    </span><span class="n">RootToContentDir</span><span class="p">(</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Common/BoxShadow&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;.png&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="c1">// will search image in folder we set in SetContentRoot()</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">0.4f</span><span class="p">},</span><span class="w"> </span><span class="c1">// margins on box and border brush projections work differenty, check it in umg widgets editor</span>
<span class="w">                                    </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush uses material as it&#39;s value</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotMaterialBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                    </span><span class="n">SlotMaterial</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">50.f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="p">},</span>
<span class="w">                                    </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">NoTile</span><span class="w"> </span><span class="c1">// image brushes can be tiled, but since it&#39;s just material - there is no meaning of tiling at all</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// just color brush</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:Dark&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                    </span><span class="s">&quot;Brush:DarkColorBrush&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                                    </span><span class="n">FLinearColor</span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">}</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush loads font Bitter-Light.ttf from Resources folder of the module</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterLightFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// This brush loads font Bitter-Black.ttf from Resources folder of the module   </span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:BitterBlack32&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// override existing style</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this way we can make custom TextBlock</span>
<span class="w">        </span><span class="c1">// big text</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TBStyleY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:TextBlock32Big&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TBStyleY</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// basic text</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TBStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:TextBlock24&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TBStyle</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// buttons:</span>
<span class="w">        </span><span class="c1">// slightly blue</span>
<span class="w">        </span><span class="n">FSlateBrush</span><span class="w"> </span><span class="n">ButtonBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">Normal</span><span class="p">;</span>
<span class="w">        </span><span class="n">ButtonBrush</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.7f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">BStyleBlue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">ButtonBrush</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:BlueButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BStyleBlue</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// slightly green</span>
<span class="w">        </span><span class="n">ButtonBrush</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">BStyleGreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">ButtonBrush</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:GreenButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BStyleGreen</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// register style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">RegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// destructor</span>
<span class="n">FUiSlateStyleSet</span><span class="o">::~</span><span class="n">FUiSlateStyleSet</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// unregister style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">UnRegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// initialize static pointer</span>
<span class="k">const</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Inst</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// make class instance and store is as static</span>
<span class="w">        </span><span class="c1">// *note - this also calls constructor, where RegisterSlateStyle is called</span>
<span class="w">        </span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FUiSlateStyleSet</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear unique pointer</span>
<span class="w">    </span><span class="c1">// *note - this will also call destructor, where UnRegisterSlateStyle is called</span>
<span class="w">    </span><span class="n">Inst</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
В приведенном коде я уже реализовал большинство возможностей, которые вам могут понадобиться на практике. Внимательно читайте комментарии к коду, не зря же я их писал.</p>
<p>Остановимся подробнее на некоторых аспектах реализации <code>StyleSet</code>.
Класс <code>FUiSlateStyleSet</code> реализован как синглтон, в памяти может быть только однин его экземпляр. Этот экземпляр хранится в переменной <code>Inst</code>, доступ к которой "из вне" возможен только через метод <code>Get</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// initialize static pointer</span>
<span class="k">const</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">FUiSlateStyleSet::Get</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Inst</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// make class instance and store is as static</span>
<span class="w">        </span><span class="c1">// *note - this also calls constructor, where RegisterSlateStyle is called</span>
<span class="w">        </span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FUiSlateStyleSet</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
Метод <code>Get</code> создает экземпляр класса <code>new FUiSlateStyleSet()</code>  с привязкой к умному указателю <code>Inst</code>, если этот указатель ни на что не ссылается. Создание экземпляра класса, подразумевает вызов его конструктора.</p>
<p>Ключевым методом класса является его конструктор, именно в конструкторе происходит регистрация стиля в регистре, а так-же весь процесс генерации стиля.
<div class="highlight"><pre><span></span><code><span class="c1">// register style</span>
<span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">RegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</code></pre></div>
Деструктор отвечает за удаление стиля из регистра. Деструктор вызывается автоматически, при уничтожении <code>static</code> указателя <code>Inst</code>, который представляет из себя синглтон на наш стиль.</p>
<p>Метод <code>SetParentStyleName</code> позволяет присвоить текущему стилю "родительский стиль". В качестве "родительского" стиля я использую встроенный в движок по умолчанию стиль <code>CoreStyle</code>. При такой реализации стиля, мы получаем возможность обращаться к элементам родительского стиля через указатель на текущий стиль.</p>
<p>Кисти, доступные в <code>FCoreStyle</code>, например:
<div class="highlight"><pre><span></span><code><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Icons.Cross&quot;</span><span class="p">)</span>
</code></pre></div>
Становятся доступны в нашем собственном стиле <code>FUiSlateStyleSet</code>:
<div class="highlight"><pre><span></span><code><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Icons.Cross&quot;</span><span class="p">)</span>
</code></pre></div>
Методы <code>SetContentRoot</code> и <code>SetCoreContentRoot</code> позволяют указать для проекта папку, в которой хранятся его ассеты. К этой папке можно будет легко обращаться, используя две встроенные вспомогательные функции:
<div class="highlight"><pre><span></span><code><span class="n">RootToContentDir</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;file_name&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;.extension&quot;</span><span class="p">)</span>
<span class="n">RootToCoreContentDir</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;file_name&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;.extension&quot;</span><span class="p">))</span>
</code></pre></div>
Эти функции активно используются в родительском стиле, а именно в <code>CoreStyle</code>.</p>
<p><a class="glightbox" href="../images/b2d35f4b1885ca1176c79684cce4c6ab.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b2d35f4b1885ca1176c79684cce4c6ab.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b2d35f4b1885ca1176c79684cce4c6ab.png" /></a></p>
<p>Поскольку я использовал наследование от <code>CoreStyle</code>, придется указать в <code>SetContentRoot</code> и <code>SetCoreContentRoot</code> путь, в котором лежат ассеты, относящиеся к <code>CoreStyle</code>.
Делается это так:
<div class="highlight"><pre><span></span><code><span class="n">SetContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="n">SetCoreContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
</code></pre></div>
Путь, который формируется командой <code>FPaths::EngineContentDir() / TEXT("Slate")</code> указывает на папку внутри <code>Unreal Engine</code>. Вы можете найти ее, открыв место установки движка и перейдя в <code>Engine/Content/Slate</code>.</p>
<p><a class="glightbox" href="../images/3c09875c7cf46ed9362975ec24722dc9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3c09875c7cf46ed9362975ec24722dc9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3c09875c7cf46ed9362975ec24722dc9.png" /></a></p>
<p>Если вы хотите, чтобы вместо стандартного оформления и картинок, родительские стили использовали ваши собственные картинки, вы можете переопределить эти параметры и указать в них путь к собственной директории с ассетами.</p>
<p>Поскольку методы <code>RootToContentDir</code> и <code>RootToCoreContentDir</code> в нашем случае указывают на папку с содержимым движка, в код класса был добавлен метод <code>InContent</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// this method should form relative path to assets of the plugin / module</span>
<span class="c1">// idea taken from \Plugins\Runtime\StateTree\Source\StateTreeEditorModule\Private\StateTreeEditorStyle.cpp</span>
<span class="c1">// (it&#39;s new Mass based Ai State Tree)</span>
<span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="nf">InContent</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="o">&amp;</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ANSICHAR</span><span class="o">*</span><span class="w"> </span><span class="n">Extension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// this is how it should work with plugins:</span>
<span class="w">    </span><span class="c1">//static FString ContentDir = IPluginManager::Get().FindPlugin(TEXT(&quot;StateTreeEditorModule&quot;))-&gt;GetContentDir() / TEXT(&quot;Slate&quot;);</span>
<span class="w">    </span><span class="c1">//return (ContentDir / RelativePath) + Extension;</span>
<span class="w">    </span><span class="c1">// since we work with module:</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ContentDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule/Resources/&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ContentDir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Extension</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Данный метод позволяет ссылаться на ассеты, находящиеся в папке <code>Resources</code> нашего модуля <code>SlateRuntimeModule</code>. Сюда я поместил несколько картинок, а так-же два шрифта.</p>
<p><a class="glightbox" href="../images/b6e1fafeff45c5de301e57c0e5ae65e6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b6e1fafeff45c5de301e57c0e5ae65e6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b6e1fafeff45c5de301e57c0e5ae65e6.png" /></a></p>
<p><a class="glightbox" href="../images/e86df40d566bcba92eb2d312e5c69dad.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e86df40d566bcba92eb2d312e5c69dad.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e86df40d566bcba92eb2d312e5c69dad.png" /></a></p>
<p>Все эти файлы вы сможете найти вместе с книгой, в папке <code>Дополнительно</code>.
Из этих файлов я создал кисти и шрифты.</p>
<p>Кисти для  стиля создаются следующим образом:
<div class="highlight"><pre><span></span><code><span class="c1">// if you refrencing assets imported inside game project - preload them first</span>
<span class="n">FString</span><span class="w"> </span><span class="n">MaterialPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;</span><span class="p">);</span>
<span class="n">UMaterialInstance</span><span class="o">*</span><span class="w"> </span><span class="n">SlotMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadObject</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">MaterialPath</span><span class="p">);</span>
<span class="c1">// some custom brushes</span>
<span class="c1">// This brush image loaded from module&#39;s Resource folder</span>
<span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotImageBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBoxBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// Box Brush projection</span>
<span class="w">                            </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InventorySlot_Icon&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// will return path of InventorySlot_Icon from modeule Resources folder</span>
<span class="w">                            </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">0.4f</span><span class="p">},</span><span class="w"> </span><span class="c1">// margins on box and border brush projections work differenty, check it in umg widgets editor</span>
<span class="w">                            </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                        </span><span class="p">});</span>
<span class="c1">// This brush loaded from folder that is set as ContentRoot</span>
<span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotContentBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBorderBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// Border Brush Projection</span>
<span class="w">                            </span><span class="n">RootToContentDir</span><span class="p">(</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Common/BoxShadow&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;.png&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="c1">// will search image in folder we set in SetContentRoot()</span>
<span class="w">                            </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">0.4f</span><span class="p">},</span><span class="w"> </span><span class="c1">// margins on box and border brush projections work differenty, check it in umg widgets editor</span>
<span class="w">                            </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                        </span><span class="p">});</span>
<span class="c1">// This brush uses material as it&#39;s value</span>
<span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotMaterialBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                            </span><span class="n">SlotMaterial</span><span class="p">,</span>
<span class="w">                            </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">50.f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="p">},</span>
<span class="w">                            </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">,</span>
<span class="w">                            </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">NoTile</span><span class="w"> </span><span class="c1">// image brushes can be tiled, but since it&#39;s just material - there is no meaning of tiling at all</span>
<span class="w">                        </span><span class="p">});</span>
<span class="c1">// This brush will draw rounded box</span>
<span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:RoundedDark&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateRoundedBoxBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Black</span><span class="p">,</span><span class="w"> </span><span class="c1">// background</span>
<span class="w">                                </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="c1">// outline</span>
<span class="w">                                </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="c1">// outline size</span>
<span class="w">                                </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">50.f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="p">}</span><span class="w"> </span><span class="c1">// image size</span>
<span class="w">                            </span><span class="p">});</span>
<span class="c1">// just color brush</span>
<span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:Dark&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                            </span><span class="s">&quot;Brush:DarkColorBrush&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                            </span><span class="n">FLinearColor</span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">}</span>
<span class="w">                        </span><span class="p">});</span>
</code></pre></div>
При этом структуры <code>FSlateBoxBrush</code>, <code>FSlateBorderBrush</code>, <code>FSlateRoundedBoxBrush</code> и <code>FSlateImageBrush</code> отвечают за разные методы проецирования изображения. Если вы работали с <code>UMG</code>, то знаете, как они выглядят в параметрах движка.</p>
<p><a class="glightbox" href="../images/d7659f5f9b8e5b04da4136ecfbe45ecf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d7659f5f9b8e5b04da4136ecfbe45ecf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d7659f5f9b8e5b04da4136ecfbe45ecf.png" /></a></p>
<p>Изображения загружаются системой по переданным вами путям автоматически, если эти изображения не импортированы в игровой движок. Если они импортированы, то ссылаться на них надо используя <code>LoadObject</code>. Я показал этот подход на примере материала, который я использую в коде.</p>
<p><a class="glightbox" href="../images/80ebab6d206438fd5ef7644e7dc311ea.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="80ebab6d206438fd5ef7644e7dc311ea.png" auto_="auto;" display="block;" margin:="margin:" src="../images/80ebab6d206438fd5ef7644e7dc311ea.png" /></a></p>
<p>Шрифты загружаются точно так-же по путям.
<div class="highlight"><pre><span></span><code><span class="c1">// we can refrence files, that are not imported into project&#39;s filesystem, using direct links</span>
<span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BitterLightFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/Bitter-Light&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// will search for file Bitter-Light.ttf in Resources / Fonts folder of the module</span>
<span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BitterBlackFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/Bitter-Black&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span>
<span class="c1">// This brush loads font Bitter-Light.ttf from Resources folder of the module</span>
<span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterLightFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">));</span>
<span class="c1">// This brush loads font Bitter-Black.ttf from Resources folder of the module   </span>
<span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:BitterBlack32&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
</code></pre></div>
Стили можно использовать для переопределения внешнего вида виджетов, уже существующих в системе, например кнопок или блоков текста.
<div class="highlight"><pre><span></span><code><span class="c1">// override existing style</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// this way we can make custom TextBlock</span>
<span class="w">    </span><span class="c1">// big text</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TBStyleY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">        </span><span class="p">;</span>
<span class="w">    </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:TextBlock32Big&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TBStyleY</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">    </span><span class="c1">// basic text</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TBStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">        </span><span class="p">;</span>
<span class="w">    </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:TextBlock24&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TBStyle</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">    </span><span class="c1">// buttons:</span>
<span class="w">    </span><span class="c1">// slightly blue</span>
<span class="w">    </span><span class="n">FSlateBrush</span><span class="w"> </span><span class="n">ButtonBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">Normal</span><span class="p">;</span>
<span class="w">    </span><span class="n">ButtonBrush</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.7f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">BStyleBlue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">ButtonBrush</span><span class="p">)</span>
<span class="w">        </span><span class="p">;</span>
<span class="w">    </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:BlueButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BStyleBlue</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">    </span><span class="c1">// slightly green</span>
<span class="w">    </span><span class="n">ButtonBrush</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">BStyleGreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">ButtonBrush</span><span class="p">)</span>
<span class="w">        </span><span class="p">;</span>
<span class="w">    </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:GreenButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BStyleGreen</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="p">}</span>
</code></pre></div>
Переопределение оформления базовых элементов управления используется в файлах стилей чаще всего.</p>
<p>Обратите внимание, что классы, используемые для переопределения, являются т.н. <code>WidgetStyle</code>, то есть они <code>blueprintable</code>.
В данном случае это <code>FButtonStyle</code> и <code>FTextBlockStyle</code>.</p>
<p><a class="glightbox" href="../images/156b4eebf3990eb4e0579d6cae1073e3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="156b4eebf3990eb4e0579d6cae1073e3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/156b4eebf3990eb4e0579d6cae1073e3.png" /></a></p>
<p>Таким образом <code>StyleSet</code> может служить мостом, между <code>WidgetStyle</code> и оформлением виджета <code>Slate</code>.</p>
<h5 id="styleset_1">Использование <code>StyleSet</code> стилей</h5>
<p>Чтобы использовать заданные таким образом стили в виджетах, для начала надо зарегистрировать наш класс через конструктор модуля. Делается это через конструктор модуля.</p>
<p>Файл <code>SlateRuntimeModule.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/UiSlateStyleSet.h&quot;</span><span class="c1"> // StyleSet to register</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateRuntimeModule::StartupModule</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// this will initialize static variable FUiSlateStyleSet::inst in the class with object value</span>
<span class="w">    </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule module has been loaded&quot;</span><span class="p">));</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateRuntimeModule::ShutdownModule</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// this will unregister style and clear local pointer to it</span>
<span class="w">    </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule module has been unloaded&quot;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
Поскольку наш класс представляет из себя авторегистрирующийся синглтон, достаточно вызвать его метод <code>Get</code>, чтобы произошла базовая сборка класса, после запуска модуля.</p>
<p>Регистрация класса в <code>FSlateStyleRegistry</code> происходит через конструктор.</p>
<p>Синглтон удаляется через вызов <code>FUiSlateStyleSet::Shutdown()</code>.
Наконец теперь мы готовы к использованию наших стилей в проекте.
<code>StyleSet</code> стили можно использовать обращаясь к методу <code>Get</code>.
Так можно в любой момент использовать стили <code>FCoreStyle</code>:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/CoreStyle.h&quot;</span>
<span class="c1">//...</span>
<span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">NormalFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;NormalFont&quot;</span><span class="p">);</span>
<span class="c1">//</span>
<span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;SlotBorderBrush&quot;</span><span class="p">);</span>
</code></pre></div>
В случае с нашим классом код выглядит так:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/UiSlateStyleSet.h&quot;</span>
<span class="c1">//...</span>
<span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">)</span>
<span class="c1">//</span>
<span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:SlotImageBrush&quot;</span><span class="p">)</span>
</code></pre></div>
Рассмотрим код:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/UiSlateStyleSet.h&quot;</span><span class="c1"> // styles</span>
<span class="c1">//</span>
<span class="n">ChildSlot</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span>
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="p">)</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9f</span><span class="w"> </span><span class="p">})</span>
<span class="w">        </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">10.f</span><span class="p">,</span><span class="w"> </span><span class="mf">15.f</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span>
<span class="w">                </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:RoundedDark&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SVerticalBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// tooltips</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Press Key1 To make Health 100%&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Press Key2 To fill grid with slots and change slot borders in runtime&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="w"> </span><span class="p">})</span>
<span class="w">        </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">BorderedGrid</span><span class="p">,</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">MinDesiredSlotWidth</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">MinDesiredSlotHeight</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">InitialGridSize</span><span class="p">({</span><span class="mf">3.f</span><span class="p">,</span><span class="mf">3.f</span><span class="p">})</span><span class="w"> </span><span class="c1">// fill initial slots in grix of 3 x 3</span>
<span class="w">            </span><span class="p">.</span><span class="n">SlotPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">2.f</span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">DefaultBorderSettings</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlotBorderSettings</span><span class="p">{</span>
<span class="w">                </span><span class="nb">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">},</span>
<span class="w">                </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:SlotImageBrush&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="c1">//FUiSlateStyleSet::Get().GetBrush(&quot;Icons.Cross&quot;), // since our parent style is CoreStyle, we can use it&#39;s definitions here</span>
<span class="w">                </span><span class="cm">/*new FSlateImageBrush{</span>
<span class="cm">                    Cast&lt;UMaterialInstance&gt;(StaticLoadObject(UMaterialInstance::StaticClass(), NULL,</span>
<span class="cm">                    TEXT(&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;))),</span>
<span class="cm">                    FVector2D{120.f, 120.f},</span>
<span class="cm">                    FLinearColor::White // Default Slot tint color is White</span>
<span class="cm">                }*/</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="c1">// 0</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="c1">// 1</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// this slot has overriden border color</span>
<span class="w">                </span><span class="nb">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">{</span><span class="w"> </span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                    </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SBorderedUniformGrid::Slot2&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="p">},</span>
<span class="w">                    </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="w"> </span><span class="c1">// this slot border color will be Red</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="c1">// 2</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// this is slot with border, but without content, but bg color is overriden</span>
<span class="w">                </span><span class="nb">true</span><span class="p">,</span>
<span class="w">                </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">},</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                    </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SBorderedUniformGrid::Slot3&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="p">},</span>
<span class="w">                    </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Black</span><span class="w"> </span><span class="c1">// this slot will be totally black witout any content</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">            </span><span class="cm">/*[ // no content in this slot!</span>
<span class="cm">                SNew(SImage)</span>
<span class="cm">                .ColorAndOpacity(FLinearColor::Blue)</span>
<span class="cm">            ]*/</span>
<span class="w">            </span><span class="c1">// 3</span>
<span class="w">            </span><span class="o">+</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// this is slot with border, but without content, with default bg color</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">            </span><span class="c1">// 4</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">Slot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">)</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.75</span><span class="w"> </span><span class="p">})</span>
<span class="w">        </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">bAllowDefaultImage</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span>
<span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                </span><span class="c1">// load image from module&#39;s resources folder</span>
<span class="w">                </span><span class="c1">//FImageUtils::ImportFileAsTexture2D(FPaths::GameSourceDir() + TEXT(&quot;/SlateRuntimeModule/Resources/test.jpg&quot;)),</span>
<span class="w">                </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UTexture2D</span><span class="o">&gt;</span><span class="p">(</span><span class="n">StaticLoadObject</span><span class="p">(</span><span class="n">UTexture2D</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Texture2D&#39;/Game/Characters/Textures/2344444_original.2344444_original&#39;&quot;</span><span class="p">))),</span>
<span class="w">                </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">128.0</span><span class="p">,</span><span class="w"> </span><span class="mf">128.0</span><span class="p">}</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">})</span>
<span class="w">        </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">5.0f</span><span class="p">)</span><span class="w"> </span><span class="c1">// offset</span>
<span class="w">            </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CharacterInfoBorder&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// here comes image path, but we need only the color of brush, image is unnecessary</span>
<span class="w">                </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">                </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span><span class="w"> </span><span class="c1">// draw as</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SVerticalBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// health</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span><span class="w"> </span><span class="c1">// overlay text over progress bar</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">HealthProgressBar</span><span class="p">,</span><span class="w"> </span><span class="n">SProgressBar</span><span class="p">)</span><span class="w"> </span><span class="c1">// Health Bar</span>
<span class="w">                        </span><span class="p">.</span><span class="n">FillColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Gray</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Percent</span><span class="p">(</span><span class="n">GetHealthPercent</span><span class="p">())</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;GameScrreen Health&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Health&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="c1">//.Font(NormalFont)</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// stamina</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span><span class="w"> </span><span class="c1">// overlay text over progress bar</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">StaminaProgressBar</span><span class="p">,</span><span class="w"> </span><span class="n">SProgressBar</span><span class="p">)</span><span class="w"> </span><span class="c1">// Stamina Bar</span>
<span class="w">                        </span><span class="p">.</span><span class="n">FillColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Percent</span><span class="p">(</span><span class="n">GetStaminaPercent</span><span class="p">())</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;GameScrreen Stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Stamina&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Margin</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">})</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">NormalFont</span><span class="p">)</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// character name</span>
<span class="w">                </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">AutoHeight</span><span class="p">()</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">CharacterNameBlock</span><span class="p">,</span><span class="w"> </span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Justification</span><span class="p">(</span><span class="n">ETextJustify</span><span class="o">::</span><span class="n">Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_CharacterName</span><span class="p">)</span><span class="w"> </span><span class="c1">// set character name</span>
<span class="w">                    </span><span class="c1">// override font stylings:</span>
<span class="w">                    </span><span class="c1">//.Font(CharacterNameFont) // classic</span>
<span class="w">                    </span><span class="c1">//.Font(FUiSlateStyleSet::Get().GetFontStyle(&quot;Fonts:BitterBlack32&quot;)) // using font style</span>
<span class="w">                    </span><span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:TextBlock32Big&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// apply custom style</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">                </span><span class="o">+</span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="mf">2.f</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">ButtonStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:BlueButton&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:TextBlock24&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnDecreaseHealth</span><span class="p">)</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">ButtonStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:GreenButton&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:TextBlock24&quot;</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnIncreaseHealth</span><span class="p">)</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">]</span><span class="w"> </span><span class="c1">// SBorder</span>
<span class="w">        </span><span class="p">]</span><span class="w"> </span><span class="c1">// SConstraint Canvas</span>
<span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="c1">// ChildSlot</span>
<span class="p">];</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/91297572f7bef20d104c7d0179763a0c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="91297572f7bef20d104c7d0179763a0c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/91297572f7bef20d104c7d0179763a0c.png" /></a></p>
<p>Вы тоже уже начинаете ненавидеть декларативный синтаксис? Вынужден извиниться. Этот длинный список элементов был создан исключительно чтобы продемонстирировать вам работу системы с максимально возможным количеством подходов. Обычно код выглядит куда короче, хотя бы потому что добавлять элементы в грид обычно приходится в цикле... Поверьте, писать это было ничуть не легче, чем читать.</p>
<p>Пример изменения стиля шрифта:
<div class="highlight"><pre><span></span><code><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Press Key2 To fill grid with slots and change slot borders in runtime&quot;</span><span class="p">))</span>
<span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">))</span>
<span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/5c5f4ffe4a864f5fb0937e10f1ee6945.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5c5f4ffe4a864f5fb0937e10f1ee6945.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5c5f4ffe4a864f5fb0937e10f1ee6945.png" /></a></p>
<p>Пример изменения стиля границы:
<div class="highlight"><pre><span></span><code><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">10.f</span><span class="p">,</span><span class="w"> </span><span class="mf">15.f</span><span class="p">)</span>
<span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:RoundedDark&quot;</span><span class="p">))</span>
</code></pre></div>
Пример изменения стиля <code>STextBlock</code>:
<div class="highlight"><pre><span></span><code><span class="n">SAssignNew</span><span class="p">(</span><span class="n">CharacterNameBlock</span><span class="p">,</span><span class="w"> </span><span class="n">STextBlock</span><span class="p">)</span>
<span class="p">.</span><span class="n">Justification</span><span class="p">(</span><span class="n">ETextJustify</span><span class="o">::</span><span class="n">Center</span><span class="p">)</span>
<span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_CharacterName</span><span class="p">)</span><span class="w"> </span><span class="c1">// set character name</span>
<span class="c1">// override font stylings:</span>
<span class="c1">//.Font(CharacterNameFont) // classic</span>
<span class="c1">//.Font(FUiSlateStyleSet::Get().GetFontStyle(&quot;Fonts:BitterBlack32&quot;)) // using font style</span>
<span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:TextBlock32Big&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// apply custom style</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/9c2ae95ff1dbd612ef7c21e2c6193bcd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9c2ae95ff1dbd612ef7c21e2c6193bcd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9c2ae95ff1dbd612ef7c21e2c6193bcd.png" /></a></p>
<p>Пример изменения стиля кнопки:
<div class="highlight"><pre><span></span><code><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">))</span>
<span class="p">.</span><span class="n">ButtonStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:BlueButton&quot;</span><span class="p">)</span>
<span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:TextBlock24&quot;</span><span class="p">)</span>
<span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnDecreaseHealth</span><span class="p">)</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/b9908fc830883405723d2343d115be14.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b9908fc830883405723d2343d115be14.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b9908fc830883405723d2343d115be14.png" /></a></p>
<p>Оформление слотов грида задается так:
<div class="highlight"><pre><span></span><code><span class="n">SAssignNew</span><span class="p">(</span><span class="n">BorderedGrid</span><span class="p">,</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="p">)</span>
<span class="p">.</span><span class="n">MinDesiredSlotWidth</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="p">.</span><span class="n">MinDesiredSlotHeight</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="p">.</span><span class="n">InitialGridSize</span><span class="p">({</span><span class="mf">3.f</span><span class="p">,</span><span class="mf">3.f</span><span class="p">})</span><span class="w"> </span><span class="c1">// fill initial slots in grix of 3 x 3</span>
<span class="p">.</span><span class="n">SlotPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">2.f</span><span class="p">})</span>
<span class="p">.</span><span class="n">DefaultBorderSettings</span><span class="p">(</span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlotBorderSettings</span><span class="p">{</span>
<span class="w">    </span><span class="nb">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">},</span>
<span class="w">    </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:SlotImageBrush&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="c1">//FUiSlateStyleSet::Get().GetBrush(&quot;Icons.Cross&quot;), // since our parent style is CoreStyle, we can use it&#39;s definitions here</span>
<span class="w">    </span><span class="cm">/*new FSlateImageBrush{ // old code, won&#39;t delete, it works and serves as another example</span>
<span class="cm">        Cast&lt;UMaterialInstance&gt;(StaticLoadObject(UMaterialInstance::StaticClass(), NULL,</span>
<span class="cm">        TEXT(&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;))),</span>
<span class="cm">        FVector2D{120.f, 120.f},</span>
<span class="cm">        FLinearColor::White // Default Slot tint color is White</span>
<span class="cm">    }*/</span>
<span class="p">})</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/6abc7314c9fae92a1e666c07dbc4c629.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6abc7314c9fae92a1e666c07dbc4c629.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6abc7314c9fae92a1e666c07dbc4c629.png" /></a></p>
<h2 id="swindow">Системные Окна <code>SWindow</code></h2>
<p>В фреймворке <code>Slate</code> есть класс кросплатформенного окна - <code>SWindow</code>. Данное окно используется для вывода различной информации пользователю.</p>
<p>Код вызова очень прост.
<div class="highlight"><pre><span></span><code><span class="c1">// SWindow</span>
<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SWindow</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowPtr</span><span class="p">;</span>
<span class="n">SAssignNew</span><span class="p">(</span><span class="n">WindowPtr</span><span class="p">,</span><span class="w"> </span><span class="n">SWindow</span><span class="p">)</span>
<span class="p">.</span><span class="n">IsTopmostWindow</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="p">.</span><span class="n">bDragAnywhere</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="p">.</span><span class="n">ClientSize</span><span class="p">({</span><span class="w"> </span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="p">})</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">Margin</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">25.f</span><span class="p">,</span><span class="w"> </span><span class="mf">30.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Window Text&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:TextBlock24&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="p">];</span>
<span class="c1">// on Window close</span>
<span class="n">FOnWindowClosed</span><span class="w"> </span><span class="n">OnClosed</span><span class="p">;</span>
<span class="n">OnClosed</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">(</span><span class="w"> </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">SWindow</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">WPtr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Window %s Being Closed!&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">WPtr</span><span class="o">-&gt;</span><span class="n">GetTitle</span><span class="p">().</span><span class="n">ToString</span><span class="p">())</span>
<span class="p">}</span><span class="w"> </span><span class="p">);</span>
<span class="n">WindowPtr</span><span class="o">-&gt;</span><span class="n">SetOnWindowClosed</span><span class="p">(</span><span class="n">OnClosed</span><span class="p">);</span>
<span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">AddWindow</span><span class="p">(</span><span class="n">WindowPtr</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">());</span><span class="w"> </span><span class="c1">// add window to the editor</span>
</code></pre></div>
Я указал его в классе <code>ASlateRuntimePlayerController</code>.</p>
<p><a class="glightbox" href="../images/54efe7a523b098264f3b32434dc01474.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="54efe7a523b098264f3b32434dc01474.png" auto_="auto;" display="block;" margin:="margin:" src="../images/54efe7a523b098264f3b32434dc01474.png" /></a></p>
<p>При компиляции и запуске проекта, данный код откроет новое окно редактора.</p>
<p>Однако. Созданное таким образом окно - является окном редактора, а не внутриигровым.</p>
<p><a class="glightbox" href="../images/541cc91442fe1853865e811b79a261ea.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="541cc91442fe1853865e811b79a261ea.png" auto_="auto;" display="block;" margin:="margin:" src="../images/541cc91442fe1853865e811b79a261ea.png" /></a></p>
<p>Что делать, если хочется использовать окно внутри игры. Например - для инвентаря.</p>
<h2 id="_17">Закрепление материала. Пишем виджет игрового окна</h2>
<p>Предалагю закрепить знания о системе <code>Slate</code> написанием чего-нибудь крайне сложного. Пусть это будет окно. В одном из своих прошлых проектов на <code>Unreal Engine 4.27</code> я уже делал окно для рпг игры на системе <code>UMG</code>.</p>
<p><a class="glightbox" href="../images/e11431154b21dbcfde3b0efcbb6ec62d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e11431154b21dbcfde3b0efcbb6ec62d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e11431154b21dbcfde3b0efcbb6ec62d.png" /></a></p>
<p>Это не просто окно, а окно с поддержкой перетаскивания и изменения размера. Само оно имеет довольно любопытный, но в то-же время простой дизайн.</p>
<p>Окно должно быть не просто перетаскиваемым, надо сделать так, чтобы пользователь не мог вытащить это окно за пределы игрового экрана.</p>
<p>Мне, для моей собственной игры, все равно придется реализовывать код этого окна, так почему-бы не сдеать это прямо в книге.</p>
<p>Давайте повторим этот-же код, но уже на <code>Slate</code>.
Идем <code>Tools -&gt; New C++ Class -&gt; Slate Widget</code>.</p>
<p><a class="glightbox" href="../images/6585cb32b7db681fd4e8ff89113ed48c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6585cb32b7db681fd4e8ff89113ed48c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6585cb32b7db681fd4e8ff89113ed48c.png" /></a></p>
<p>Файл называем <code>GameWindow</code>.</p>
<p><a class="glightbox" href="../images/0cfeee5dd76f808d7686472295e5c118.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0cfeee5dd76f808d7686472295e5c118.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0cfeee5dd76f808d7686472295e5c118.png" /></a></p>
<p>Так-же нам понадобится файл класс стилей, в котором мы будем хранить оформление элементов окна.</p>
<p>Идем в папку <code>Styles</code> модуля, мы создавали эту папку в главе про <code>StyleSet</code> стили.</p>
<p>Добавляем файлы <code>GameWindowStyleSet.h</code> и <code>GameWindowStyleSet.cpp</code>.</p>
<p><a class="glightbox" href="../images/a3df7947648d2b5c399dda9921085d2b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a3df7947648d2b5c399dda9921085d2b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a3df7947648d2b5c399dda9921085d2b.png" /></a></p>
<p><a class="glightbox" href="../images/b1adc0d0e1d1cb94e19729bf5cfeafb7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b1adc0d0e1d1cb94e19729bf5cfeafb7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b1adc0d0e1d1cb94e19729bf5cfeafb7.png" /></a></p>
<p>После добавления файлов не забудьте выполнить команду <code>Tools -&gt; Refrehs Visual Studio 2022 Project</code>, чтобы обновить иерархию проекта.</p>
<p><a class="glightbox" href="../images/cc782c92f0347ee1d2f388a320953924.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cc782c92f0347ee1d2f388a320953924.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cc782c92f0347ee1d2f388a320953924.png" /></a></p>
<p>Самое время перейти к написанию кода для окна.</p>
<p>Сначала я закончил внешний вид она и его стилизацию.</p>
<p><a class="glightbox" href="../images/6805f85cc70c172e9610777ff2fe1430.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6805f85cc70c172e9610777ff2fe1430.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6805f85cc70c172e9610777ff2fe1430.png" /></a></p>
<p>Теперь требуются механики перетаскивания окна и изменения размера.</p>
<p>Для их реализации я переопределил ряд методов класса <code>SWidget</code>:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cm">/**</span>
<span class="cm"> * SWidget Interface</span>
<span class="cm"> */</span>
<span class="c1">// Events like OnKeyDown, OnKeyUp and all others related to keyboard won&#39;t work without this</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">SupportsKeyboardFocus</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Called after a key is pressed when this widget has focus (this event bubbles if not handled)</span>
<span class="cm"> *</span>
<span class="cm"> * @param MyGeometry The Geometry of the widget receiving the event</span>
<span class="cm"> * @param InKeyEvent  Key event</span>
<span class="cm"> * @return Returns whether the event was handled, along with other possible actions</span>
<span class="cm"> */</span>
<span class="k">virtual</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnKeyDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FKeyEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InKeyEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="cm">/**</span>
<span class="cm"> * The system calls this method to notify the widget that a mouse button was pressed within it. This event is bubbled.</span>
<span class="cm"> *</span>
<span class="cm"> * @param MyGeometry The Geometry of the widget receiving the event</span>
<span class="cm"> * @param MouseEvent Information about the input event</span>
<span class="cm"> * @return Whether the event was handled along with possible requests for the system to take action.</span>
<span class="cm"> */</span>
<span class="k">virtual</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="cm">/**</span>
<span class="cm"> * The system calls this method to notify the widget that a mouse moved within it. This event is bubbled.</span>
<span class="cm"> *</span>
<span class="cm"> * @param MyGeometry The Geometry of the widget receiving the event</span>
<span class="cm"> * @param MouseEvent Information about the input event</span>
<span class="cm"> * @return Whether the event was handled along with possible requests for the system to take action.</span>
<span class="cm"> */</span>
<span class="k">virtual</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnMouseMove</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="cm">/**</span>
<span class="cm"> * The system will use this event to notify a widget that the cursor has entered it. This event is uses a custom bubble strategy.</span>
<span class="cm"> *</span>
<span class="cm"> * @param MyGeometry The Geometry of the widget receiving the event</span>
<span class="cm"> * @param MouseEvent Information about the input event</span>
<span class="cm"> */</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnMouseEnter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="cm">/**</span>
<span class="cm"> * The system will use this event to notify a widget that the cursor has left it. This event is uses a custom bubble strategy.</span>
<span class="cm"> *</span>
<span class="cm"> * @param MouseEvent Information about the input event</span>
<span class="cm"> */</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnMouseLeave</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnKeyDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FKeyEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InKeyEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] KeyDown Key = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">InKeyEvent</span><span class="p">.</span><span class="n">GetKey</span><span class="p">().</span><span class="n">ToString</span><span class="p">())</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] Mouse Down Key = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">().</span><span class="n">ToString</span><span class="p">())</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnMouseMove</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] Mouse Moved on Pos = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetScreenSpacePosition</span><span class="p">().</span><span class="n">ToString</span><span class="p">())</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::OnMouseEnter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">IsInitialized</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Set focus to widget once mouse is entered it</span>
<span class="w">        </span><span class="n">FWidgetPath</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">;</span>
<span class="w">        </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">FindPathToWidget</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">AsShared</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Visible</span><span class="p">);</span>
<span class="w">        </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">SetUserFocus</span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControllerId</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EFocusCause</span><span class="o">::</span><span class="n">Mouse</span><span class="p">);</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] Parent Widget = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetParentWidget</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToString</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] Mouse Entered&quot;</span><span class="p">))</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::OnMouseLeave</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] Mouse Leaved&quot;</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
Данный код позволяет отслеживать вхождение мыши в окно и выход мыши за пределы окна. Так-же, в коде перехватывается пользовательский ввод.</p>
<p><a class="glightbox" href="../images/d9923b216f97429c2c4b532fe9e73582.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d9923b216f97429c2c4b532fe9e73582.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d9923b216f97429c2c4b532fe9e73582.png" /></a></p>
<h3 id="_18">Код Окна</h3>
<p>Файл <code>SGameWindow.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Text/STextBlock.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SScaleBox.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SSpacer.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ImageUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SConstraintCanvas.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/GameWindowStyleSet.h&quot;</span><span class="c1"> // Window Styles</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;SGameWindow&quot; </span><span class="c1">// to use FText</span>
<span class="cm">/**</span>
<span class="cm"> * In Game Window</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SGameWindow</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Window Size struct</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">FGameWindowSizeLimits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">MinHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">450</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">MinWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">450</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// oveload operator == because we might be need to compare structs</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameWindowSizeLimits</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// use simple AND</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">MinHeight</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">MinHeight</span><span class="p">;</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">MinWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">MinWidth</span><span class="p">;</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">MaxHeight</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">MaxHeight</span><span class="p">;</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">MaxWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">MaxWidth</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">        </span><span class="c1">// Slot for content</span>
<span class="w">        </span><span class="n">SLATE_DEFAULT_SLOT</span><span class="p">(</span><span class="n">FArguments</span><span class="p">,</span><span class="w"> </span><span class="n">Content</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Window Title input attribute</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">FText</span><span class="p">,</span><span class="w"> </span><span class="n">WindowTitle</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Window Size input attribute</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">FGameWindowSizeLimits</span><span class="p">,</span><span class="w"> </span><span class="n">WindowSizeLimits</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Local Player Attribute</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">APlayerController</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerController</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// On close button clicked</span>
<span class="w">        </span><span class="n">SLATE_EVENT</span><span class="p">(</span><span class="n">FOnClicked</span><span class="p">,</span><span class="w"> </span><span class="n">OnCloseClicked</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">SGameWindow</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Attribute Default Values</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">WindowTitleAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;SGameWindow:DefaultTitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Game Window&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">FGameWindowSizeLimits</span><span class="p">{</span><span class="w"> </span><span class="cm">/* initialize with default values */</span><span class="w"> </span><span class="p">})</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="cm">/** Constructs this widget with InArgs */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * SWidget Interface</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Events like OnKeyDown, OnKeyUp and all others related to keyboard won&#39;t work without this</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">SupportsKeyboardFocus</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//return true;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="c1">//virtual FReply OnKeyDown(const FGeometry&amp; MyGeometry, const FKeyEvent&amp; InKeyEvent) override;</span>
<span class="w">    </span><span class="c1">//virtual FReply OnMouseButtonDown(const FGeometry&amp; MyGeometry, const FPointerEvent&amp; MouseEvent) override;</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnTitleMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnTitleMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnResizeMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnResizeMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnRootMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnRootMouseLeave</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InEvent</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//virtual FReply OnMouseMove(const FGeometry&amp; MyGeometry, const FPointerEvent&amp; MouseEvent) override;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnMouseEnter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// called every frame</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Tick</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">InCurrentTime</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">InDeltaTime</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// every paint update</span>
<span class="w">    </span><span class="c1">//int32 Paint(const FPaintArgs&amp; Args, const FGeometry&amp; AllottedGeometry, const FSlateRect&amp; MyCullingRect, FSlateWindowElementList&amp; OutDrawElements, int32 LayerId, const FWidgetStyle&amp; InWidgetStyle, bool bParentEnabled) const;</span>
<span class="w">    </span><span class="c1">// organize geometry</span>
<span class="w">    </span><span class="c1">//virtual void OnArrangeChildren(const FGeometry&amp; AllottedGeometry, FArrangedChildren&amp; ArrangedChildren) const override;</span>
<span class="w">    </span><span class="c1">// Attribute Setters / Getters</span>
<span class="w">    </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetWindowTitle</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WindowTitleAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetWindowTitle</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">FText</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewTitle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowTitleAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewTitle</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetWindowSizeLimits</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">FGameWindowSizeLimits</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Limits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">Limits</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FGameWindowSizeLimits</span><span class="w"> </span><span class="nf">GetWindowSizeLimits</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// setter for PlayerControllerAttribute</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetNewPlayerController</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">LPlayer</span><span class="p">){</span>
<span class="w">        </span><span class="n">PlayerControllerAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">LPlayer</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// getter for PlayerControllerAttribute</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="nf">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return FSlateUser user object from current LocalPlayer</span>
<span class="w">    </span><span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="nf">GetSlateUser</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetUser</span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControllerId</span><span class="p">()).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return parent SConstraintCanvas slate node if our window placed inside of the canvas</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="nf">GetParentCanvas</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SConstraintCanvas</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetParentWidget</span><span class="p">().</span><span class="n">Get</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return FSlot object, related to our Window on SConstraintCanvas</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="nf">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get slot with highest z-order</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="nf">GetHighestZOrder</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will set keyboard focus to current window</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetFocusToWindow</span><span class="p">();</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Window drag mechanics</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// will initiate drag sequence</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StartWindowDrag</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will update window position on the canvas according to cursro movement</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ProcessWindowDrag</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will stop drag</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StopWindowDrag</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DragMode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">DragMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// check if we are in drag mode</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">isDrag</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DragMode</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Window resize mechanics</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// will initiate resize sequence</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StartWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will process resize</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ProcessWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will stop resize</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StopWindowResize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ResizeMode</span><span class="p">){</span>
<span class="w">            </span><span class="n">ResizeMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// check if we are in resize mode</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">isResize</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResizeMode</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will search all SGameWindow objects on the parent canvas</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">GetAllGameWindowsOnCanvas</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">        </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">            </span><span class="c1">//SConstraintCanvas::FSlot* Slot = (SConstraintCanvas::FSlot*)(&amp;ChildWingets-&gt;GetSlotAt(i));</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ChildWidget</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;SGameWindow&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">SGameWindow</span><span class="o">*</span><span class="w"> </span><span class="n">GameWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ChildWidget</span><span class="p">);</span>
<span class="w">                </span><span class="c1">//StaticCastSharedPtr</span>
<span class="w">                </span><span class="n">res</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">GameWindow</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Variables</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FGameWindowSizeLimits</span><span class="p">{}.</span><span class="n">MinHeight</span><span class="p">;</span><span class="w"> </span><span class="c1">// take min default values</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FGameWindowSizeLimits</span><span class="p">{}.</span><span class="n">MinWidth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">DragMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">ResizeMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">InitialMousePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">InitialWindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="n">FAnchors</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="n">FAnchors</span><span class="w"> </span><span class="n">TargetAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// Attributes</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">FText</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowTitleAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">FGameWindowSizeLimits</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Controls</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SBox</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowSizeBox</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">STextBlock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowTitleBlock</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CloseButton</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SWidget</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResizeWidget</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
Файл <code>SGameWindow.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SGameWindow.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="nf">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WindowTitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">WindowTitleAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">SGameWindow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">WindowWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WindowSizeLimits&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PlayerController&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SetWindowTitle</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_WindowTitle</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetWindowSizeLimits</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_WindowSizeLimits</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetNewPlayerController</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_PlayerController</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TitleSpacerSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">15.f</span><span class="p">,</span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="n">ChildSlot</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">WindowSizeBox</span><span class="p">,</span><span class="w"> </span><span class="n">SBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// SizeBox</span>
<span class="w">        </span><span class="p">.</span><span class="n">HeightOverride</span><span class="p">(</span><span class="n">CurrentHeight</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">WidthOverride</span><span class="p">(</span><span class="n">CurrentWidth</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span><span class="w"> </span><span class="c1">// window background</span>
<span class="w">            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:WindowBackground&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SVerticalBox</span><span class="p">)</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// title</span>
<span class="w">                </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">AutoHeight</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:TitleBackground&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">                        </span><span class="o">+</span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// title text area [image [spacer] TEXT [spacer] image]</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">17.f</span><span class="p">,</span><span class="w"> </span><span class="mf">10.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">                        </span><span class="p">.</span><span class="n">FillWidth</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:TitleRArrow&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SSpacer</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Size</span><span class="p">(</span><span class="n">TitleSpacerSize</span><span class="p">)</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">FillWidth</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// for big text sizes</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFit</span><span class="p">)</span>
<span class="w">                                </span><span class="p">[</span>
<span class="w">                                    </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">WindowTitleBlock</span><span class="p">,</span><span class="w"> </span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:WindowTitle&quot;</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">Justification</span><span class="p">(</span><span class="n">ETextJustify</span><span class="o">::</span><span class="n">Center</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">GetWindowTitle</span><span class="p">())</span>
<span class="w">                                </span><span class="p">]</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SSpacer</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Size</span><span class="p">(</span><span class="n">TitleSpacerSize</span><span class="p">)</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:TitleLArrow&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="c1">// \title text area</span>
<span class="w">                        </span><span class="o">+</span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// close button</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">5.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">                        </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBox</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">WidthOverride</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HeightOverride</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// scale button to fit</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFit</span><span class="p">)</span>
<span class="w">                                </span><span class="p">[</span>
<span class="w">                                    </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">CloseButton</span><span class="p">,</span><span class="w"> </span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">ButtonStyle</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:CloseButton&quot;</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_OnCloseClicked</span><span class="p">)</span><span class="w"> </span><span class="c1">// redirect event</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">ContentPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">})</span><span class="w"> </span><span class="c1">// remove content padding</span>
<span class="w">                                    </span><span class="p">[</span>
<span class="w">                                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                                        </span><span class="p">.</span><span class="n">DesiredSizeOverride</span><span class="p">(</span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">32.f</span><span class="p">,</span><span class="w"> </span><span class="mf">32.f</span><span class="p">})</span>
<span class="w">                                        </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:CloseWindowImage&quot;</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">]</span>
<span class="w">                                </span><span class="p">]</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span><span class="c1">// \title</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// content</span>
<span class="w">                </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">FillHeight</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Content</span><span class="p">.</span><span class="n">Widget</span><span class="w"> </span><span class="c1">// content goes here</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// footer</span>
<span class="w">                </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">AutoHeight</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">                </span><span class="p">[</span>

<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBox</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HeightOverride</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFit</span><span class="p">)</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:FooterImage&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// resize button</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Bottom</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Right</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBox</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HeightOverride</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">WidthOverride</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">ButtonStyle</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:ResizeButton&quot;</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">ContentPadding</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">ResizeWidget</span><span class="p">,</span><span class="w"> </span><span class="n">SImage</span><span class="p">)</span><span class="w"> </span><span class="c1">// in SButton event OnMouseDown somehow don&#39;t work, only click works, so i have to use Image to detect mousee events instead</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:ResizeImage&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span><span class="w"> </span><span class="c1">// \ resize button</span>
<span class="w">                </span><span class="p">]</span><span class="w"> </span><span class="c1">// \ footer</span>
<span class="w">            </span><span class="p">]</span><span class="w"> </span><span class="c1">// \ window background, this is why declarative syntax sucks</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">];</span>
<span class="w">    </span><span class="c1">// bind drag functionality</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">WindowTitleBlock</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowTitleBlock</span><span class="o">-&gt;</span><span class="n">SetOnMouseButtonDown</span><span class="p">(</span><span class="n">FPointerEventHandler</span><span class="o">::</span><span class="n">CreateSP</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">OnTitleMouseButtonDown</span><span class="p">));</span>
<span class="w">        </span><span class="n">WindowTitleBlock</span><span class="o">-&gt;</span><span class="n">SetOnMouseButtonUp</span><span class="p">(</span><span class="n">FPointerEventHandler</span><span class="o">::</span><span class="n">CreateSP</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">OnTitleMouseButtonUp</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// bind resize functionality</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ResizeWidget</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ResizeWidget</span><span class="o">-&gt;</span><span class="n">SetOnMouseButtonDown</span><span class="p">(</span><span class="n">FPointerEventHandler</span><span class="o">::</span><span class="n">CreateSP</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">OnResizeMouseButtonDown</span><span class="p">));</span>
<span class="w">        </span><span class="n">ResizeWidget</span><span class="o">-&gt;</span><span class="n">SetOnMouseButtonUp</span><span class="p">(</span><span class="n">FPointerEventHandler</span><span class="o">::</span><span class="n">CreateSP</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">OnResizeMouseButtonUp</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnRootMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EKeys</span><span class="o">::</span><span class="n">LeftMouseButton</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StopWindowDrag</span><span class="p">();</span>
<span class="w">        </span><span class="n">StopWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::OnRootMouseLeave</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EKeys</span><span class="o">::</span><span class="n">LeftMouseButton</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StopWindowDrag</span><span class="p">();</span>
<span class="w">        </span><span class="n">StopWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnResizeMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EKeys</span><span class="o">::</span><span class="n">LeftMouseButton</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">StartWindowResize</span><span class="p">();</span><span class="w"> </span><span class="c1">// will start resize</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnResizeMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">StopWindowResize</span><span class="p">();</span><span class="w"> </span><span class="c1">// stop resize</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="n">Result</span><span class="p">.</span><span class="n">ClearUserFocus</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnTitleMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EKeys</span><span class="o">::</span><span class="n">LeftMouseButton</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">StartWindowDrag</span><span class="p">();</span><span class="w"> </span><span class="c1">// will start drag</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnTitleMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">StopWindowDrag</span><span class="p">();</span><span class="w"> </span><span class="c1">// will stop drag</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="n">Result</span><span class="p">.</span><span class="n">ClearUserFocus</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*FReply SGameWindow::OnMouseButtonDown(const FGeometry&amp; MyGeometry, const FPointerEvent&amp; MouseEvent)</span>
<span class="cm">{</span>
<span class="cm">    UE_LOG(LogTemp, Warning, TEXT(&quot;[SGameWindow] Mouse Down Key = %s&quot;), *MouseEvent.GetEffectingButton().ToString())</span>
<span class="cm">    if (MouseEvent.GetEffectingButton() == EKeys::LeftMouseButton)</span>
<span class="cm">    {</span>
<span class="cm">        return FReply::Handled().DetectDrag(SharedThis(this), EKeys::LeftMouseButton);</span>
<span class="cm">    }</span>
<span class="cm">    return FReply::Unhandled();</span>
<span class="cm">}</span>
<span class="cm">FReply SGameWindow::OnMouseMove(const FGeometry&amp; MyGeometry, const FPointerEvent&amp; MouseEvent)</span>
<span class="cm">{</span>
<span class="cm">    return FReply::Handled();</span>
<span class="cm">}</span>
<span class="cm">FReply SGameWindow::OnKeyDown(const FGeometry&amp; MyGeometry, const FKeyEvent&amp; InKeyEvent)</span>
<span class="cm">{</span>
<span class="cm">    UE_LOG(LogTemp, Warning, TEXT(&quot;[SGameWindow] KeyDown Key = %s&quot;), *InKeyEvent.GetKey().ToString())</span>
<span class="cm">    return FReply::Handled();</span>
<span class="cm">}</span>
<span class="cm">int32 SGameWindow::Paint(const FPaintArgs&amp; Args, const FGeometry&amp; AllottedGeometry, const FSlateRect&amp; MyCullingRect, FSlateWindowElementList&amp; OutDrawElements, int32 LayerId, const FWidgetStyle&amp; InWidgetStyle, bool bParentEnabled) const</span>
<span class="cm">{</span>
<span class="cm">    return Super::OnPaint(Args, AllottedGeometry, MyCullingRect, OutDrawElements, LayerId, InWidgetStyle, bParentEnabled);</span>
<span class="cm">}</span>
<span class="cm">void SGameWindow::OnArrangeChildren(const FGeometry&amp; AllottedGeometry, FArrangedChildren&amp; ArrangedChildren) const {</span>
<span class="cm">    Super::OnArrangeChildren(AllottedGeometry, ArrangedChildren); // call parent</span>
<span class="cm">}</span>
<span class="cm">*/</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::OnMouseEnter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// don&#39;t clear focus if any of window on the canvas currently resized or dragged</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">GameWindows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetAllGameWindowsOnCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SGameWindow</span><span class="o">*</span><span class="w"> </span><span class="n">Wnd</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">GameWindows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Wnd</span><span class="o">-&gt;</span><span class="n">isDrag</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Wnd</span><span class="o">-&gt;</span><span class="n">isResize</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">SetFocusToWindow</span><span class="p">();</span><span class="w"> </span><span class="c1">// Set focus to widget once mouse is entered it</span>
<span class="w">    </span><span class="c1">// move currently working window to top of the canvas z-order</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">HOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetHighestZOrder</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HOrder</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GetCanvasSlot</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetZOrder</span><span class="p">(</span><span class="n">GetHighestZOrder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::Tick</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">InCurrentTime</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">InDeltaTime</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">ProcessWindowDrag</span><span class="p">();</span>
<span class="w">    </span><span class="n">ProcessWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">InCurrentTime</span><span class="p">,</span><span class="w"> </span><span class="n">InDeltaTime</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// will initiate resize sequence</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::StartWindowResize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isDrag</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// exit from previous state</span>
<span class="w">        </span><span class="n">StopWindowDrag</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas so we can&#39;t be dragged</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">InitialAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetAnchors</span><span class="p">();</span>
<span class="w">    </span><span class="n">TargetAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">;</span>
<span class="w">    </span><span class="n">InitialWindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowSizeBox</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// save initial cursor position</span>
<span class="w">    </span><span class="n">InitialMousePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">ResizeMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] Resize Started&quot;</span><span class="p">))</span>
<span class="p">}</span>
<span class="c1">// will update window position on the canvas according to cursro movement</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::ProcessWindowResize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isResize</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">ParentCanvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ParentCanvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// canvas size x, y in actual resolution i.t. 1024 x 860</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CanvasSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ParentCanvas</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">WindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialWindowSize</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// canvas slot position on each axis described by float number from 0.0 to 1.0</span>
<span class="w">    </span><span class="c1">// get window size in scope of 0 to 1 where 1 is full window resolution on axis</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">WinAnchorOffsetX</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">WinAnchorOffsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// depending on anchors setup we need to pick different offsets</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.5f, 0.5f }) widget offset to the corner will me WindowSize.X/2</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.3f, 0.3f, 0.6, 0.7 }) widget offset to the corner will valy from 0 on top to at bottom WindowSize.X</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// top corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetXMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span><span class="w"> </span><span class="c1">// bottom corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetYMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Mouse Delta is distance of mouse movement from drag start point to current point in 0 - 1 scope</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">MouseDelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialMousePosition</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// get current local size, since offsets set in local (not transformed) screen size</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ParentCanvas</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetLocalSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">FGameWindowSizeLimits</span><span class="w"> </span><span class="n">WindowLimits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetWindowSizeLimits</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// convert limit values to canvas space, which is from 0 to 1</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">LimitsOffsetXMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MinWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">LimitsOffsetYMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MinHeight</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">LimitsOffsetXMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MaxWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">LimitsOffsetYMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MaxHeight</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">SizeMinX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">SizeMaxX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// this is important part.</span>
<span class="w">    </span><span class="c1">// if you set window size via anchors like so: .Anchors(FAnchors{ 0.3f, 0.3f, 0.6, 0.7 })</span>
<span class="w">    </span><span class="c1">// window size on canvas sometimes becase bigger than size, set in the limits</span>
<span class="w">    </span><span class="c1">// so we sync max size in limits with current canvas window size, to fix scaling bug in this exact case</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">XSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">XSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LimitsOffsetXMax</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MaxWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XSize</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span><span class="w"> </span><span class="c1">// update maximum limit</span>
<span class="w">        </span><span class="n">SetWindowSizeLimits</span><span class="p">(</span><span class="n">WindowLimits</span><span class="p">);</span><span class="w"> </span><span class="c1">// to use boolean or to call it twise, this is a question</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">YSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">YSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LimitsOffsetYMax</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MaxHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">YSize</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span><span class="w"> </span><span class="c1">// update maximum limit</span>
<span class="w">        </span><span class="n">SetWindowSizeLimits</span><span class="p">(</span><span class="n">WindowLimits</span><span class="p">);</span><span class="w"> </span><span class="c1">// to use boolean or to call it twise, this is a question</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Check limits</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="n">SizeMaxX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SizeMinX</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LimitsOffsetXMax</span><span class="w">  </span><span class="c1">// max size limit</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">SizeMaxX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SizeMinX</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LimitsOffsetXMin</span><span class="w"> </span><span class="c1">// min size limit</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">SizeMaxX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0f</span><span class="w"> </span><span class="c1">// 1 is screen max size in canvas space</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SizeMinX</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SizeMaxX</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">SizeMinY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">SizeMaxY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="n">SizeMaxY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SizeMinY</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LimitsOffsetYMax</span><span class="w"> </span><span class="c1">// max size limit</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">SizeMaxY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SizeMinY</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LimitsOffsetYMin</span><span class="w"> </span><span class="c1">// min size limit</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">SizeMaxY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0f</span><span class="w"> </span><span class="c1">// 1 is screen max size in canvas space</span>
<span class="w">    </span><span class="p">){</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SizeMinY</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SizeMaxY</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">SetAnchors</span><span class="p">(</span><span class="n">TargetAnchors</span><span class="p">);</span>
<span class="w">    </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// will initiate drag sequence</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::StartWindowDrag</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isResize</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StopWindowResize</span><span class="p">();</span><span class="w"> </span><span class="c1">// exit from previous state</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas so we can&#39;t be dragged</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">InitialAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetAnchors</span><span class="p">();</span>
<span class="w">    </span><span class="n">TargetAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// save initial cursor position</span>
<span class="w">    </span><span class="n">InitialMousePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">DragMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will update window position on the canvas according to cursro movement</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::ProcessWindowDrag</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isDrag</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// canvas size x, y in actual resolution i.t. 1024 x 860</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CanvasSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">WindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowSizeBox</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// canvas slot position on each axis described by float number from 0.0 to 1.0</span>
<span class="w">    </span><span class="c1">// get window size in scope of 0 to 1 where 1 is full window resolution on axis</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// depending on anchors setup we need to pick different offsets</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.5f, 0.5f }) widget offset to the corner will me WindowSize.X/2</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.3f, 0.3f, 0.6, 0.7 }) widget offset to the corner will valy from 0 on top to at bottom WindowSize.X</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// top corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetXMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span><span class="w"> </span><span class="c1">// bottom corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetYMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Mouse Delta is distance of mouse movement from drag start point to current point in 0 - 1 scope</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">MouseDelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialMousePosition</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// check bounds</span>
<span class="w">    </span><span class="c1">// if our new window position on canvas &gt; than maximum possible (1) then we don&#39;t move window</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetXMax</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.f</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span><span class="w"> </span><span class="p">){</span>
<span class="w">        </span><span class="c1">// move slot by mouse delta</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetYMax</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.f</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// apply offsets</span>
<span class="w">    </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">SetAnchors</span><span class="p">(</span><span class="n">TargetAnchors</span><span class="p">);</span>
<span class="w">    </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// will return FSlot object, related to our Window on SConstraintCanvas</span>
<span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="nf">SGameWindow::GetCanvasSlot</span><span class="p">(){</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">    </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetSlotAt</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetWidget</span><span class="p">().</span><span class="n">Get</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if slot widget is our current window - then slot is our window slot</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Slot</span><span class="p">;</span><span class="w"> </span><span class="c1">// return found slot</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// nothing found</span>
<span class="p">}</span>
<span class="c1">// will return FSlot object, related to our Window on SConstraintCanvas</span>
<span class="n">int32</span><span class="w"> </span><span class="nf">SGameWindow::GetHighestZOrder</span><span class="p">(){</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">    </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetSlotAt</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetZOrder</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetZOrder</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// take care of int size limits. It&#39;s impossible to reach them, using widgets because your pc memory will fill up, but...</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will set keyboard focus to current window</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::SetFocusToWindow</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">IsInitialized</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">SupportsKeyboardFocus</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FWidgetPath</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">FindPathToWidget</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">AsShared</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Visible</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Apply user focus</span>
<span class="w">    </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">SetUserFocus</span><span class="p">(</span><span class="n">Controller</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControllerId</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EFocusCause</span><span class="o">::</span><span class="n">Mouse</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
</code></pre></div>
Стиль оформления.</p>
<p>Файл <code>GameWindowStyleSet.h</code>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/ISlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyleRegistry.h&quot;</span><span class="c1"> // to register our styles in</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="c1">// Core Style include files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/CoreStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateTypes.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/AppStyle.h&quot;</span>
<span class="c1">// Style set - collection of slate styles</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FGameWindowStyleSet</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateStyleSet</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// style set name</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// here we will store our style instance in Inst variable</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">Get</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// here we will unregister our style instance</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// destructor</span>
<span class="w">    </span><span class="o">~</span><span class="n">FGameWindowStyleSet</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// this method should form relative path to assets of the plugin / module</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="nf">InContent</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="o">&amp;</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ANSICHAR</span><span class="o">*</span><span class="w"> </span><span class="n">Extension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this is how it should work with plugins:</span>
<span class="w">        </span><span class="c1">//static FString ContentDir = IPluginManager::Get().FindPlugin(TEXT(&quot;StateTreeEditorModule&quot;))-&gt;GetContentDir() / TEXT(&quot;Slate&quot;);</span>
<span class="w">        </span><span class="c1">//return (ContentDir / RelativePath) + Extension;</span>
<span class="w">        </span><span class="c1">// since we work with module:</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ContentDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule/Resources/&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ContentDir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Extension</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="w">    </span><span class="n">FGameWindowStyleSet</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FGameWindowStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Inst</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>GameWindowStyleSet.cpp</code>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/GameWindowStyleSet.h&quot;</span>
<span class="c1">// Singletone default value</span>
<span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FGameWindowStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="c1">// Style name</span>
<span class="n">FName</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">StyleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;GameWindowStyle&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">FGameWindowStyleSet</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">FSlateStyleSet</span><span class="p">(</span><span class="n">StyleName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SetParentStyleName</span><span class="p">(</span><span class="s">&quot;CoreStyle&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">SetCoreContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// --- common variables ---</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">NizhegorodskyFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/ST-Nizhegorodsky&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// --- styles ---</span>
<span class="w">    </span><span class="c1">// custom brushes</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:CloseWindowImage&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;WindowClose_Icon&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">32.f</span><span class="p">,</span><span class="mf">32.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:FooterImage&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Line1&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">600.f</span><span class="p">,</span><span class="mf">50.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:ResizeImage&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;DragWindow&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">200.f</span><span class="p">,</span><span class="mf">200.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:TitleLArrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;UI_Arrow_L&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">32.f</span><span class="p">,</span><span class="mf">32.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:TitleRArrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;UI_Arrow_R&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">32.f</span><span class="p">,</span><span class="mf">32.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:TitleBackground&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="s">&quot;Brush:TitleBackground&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                                </span><span class="n">FLinearColor</span><span class="p">{</span><span class="w"> </span><span class="mf">0.35</span><span class="p">,</span><span class="w"> </span><span class="mf">0.27f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.084f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.084f</span><span class="w"> </span><span class="p">}</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:WindowBackground&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="s">&quot;Brush:WindowBackground&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                                </span><span class="n">FLinearColor</span><span class="p">{</span><span class="mf">0.005f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.005f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.005f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">}</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush loads font Bitter-Light.ttf from Resources folder of the module</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:WindowTitleFont&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">NizhegorodskyFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// override existing styles</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TitleTBStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">NizhegorodskyFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:WindowTitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TitleTBStyle</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// buttons:</span>
<span class="w">        </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">CloseButtonStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetWidgetStyle</span><span class="o">&lt;</span><span class="n">FButtonStyle</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SimpleButton&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">CloseButtonStyle</span><span class="p">.</span><span class="n">Pressed</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:CloseButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CloseButtonStyle</span><span class="p">);</span>
<span class="w">        </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">ResizeButtonStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetWidgetStyle</span><span class="o">&lt;</span><span class="n">FButtonStyle</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;InvisibleButton&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:ResizeButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ResizeButtonStyle</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// register style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">RegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// destructor</span>
<span class="n">FGameWindowStyleSet</span><span class="o">::~</span><span class="n">FGameWindowStyleSet</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// unregister style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">UnRegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// initialize static pointer</span>
<span class="k">const</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Inst</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// make class instance and store is as static</span>
<span class="w">        </span><span class="c1">// *note - this also calls constructor, where RegisterSlateStyle is called</span>
<span class="w">        </span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FGameWindowStyleSet</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear unique pointer</span>
<span class="w">    </span><span class="c1">// *note - this will also call destructor, where UnRegisterSlateStyle is called</span>
<span class="w">    </span><span class="n">Inst</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
Класс <code>SGameWindow</code> может работать Только внутри <code>SConstraintCanvas</code> из-за особенностей реализации механизма перетаскивания.</p>
<p><a class="glightbox" href="../images/e218dcad371b9fb558b9a98d1dcb5753.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e218dcad371b9fb558b9a98d1dcb5753.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e218dcad371b9fb558b9a98d1dcb5753.png" /></a></p>
<p>Окно поддерживает перетаскивание и может быть поверх другого окна.</p>
<p>Вытащить окно за границы экрана невозможно, за это отвечает весьма сложная логика внутри метода <code>ProcessWindowDrag</code>. Данная логика основана на том простом факте: якоря <code>SConstraintCanvas</code> находятся в пространстве между [0,0] и [1,1], где [0,0] это верхний угол экрана, а [1,1] - нижний. Для перемещения окна я двигаю его якоря <code>Anchors</code>. Если якоря переходят через одну из границ (0 или 1) то я останавливаю перемещение.
<div class="highlight"><pre><span></span><code><span class="c1">// will update window position on the canvas according to cursro movement</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::ProcessWindowDrag</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isDrag</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// canvas size x, y in actual resolution i.t. 1024 x 860</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CanvasSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">WindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowSizeBox</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// canvas slot position on each axis described by float number from 0.0 to 1.0</span>
<span class="w">    </span><span class="c1">// get window size in scope of 0 to 1 where 1 is full window resolution on axis</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// depending on anchors setup we need to pick different offsets</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.5f, 0.5f }) widget offset to the corner will me WindowSize.X/2</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.3f, 0.3f, 0.6, 0.7 }) widget offset to the corner will valy from 0 on top to at bottom WindowSize.X</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// top corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetXMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span><span class="w"> </span><span class="c1">// bottom corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetYMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Mouse Delta is distance of mouse movement from drag start point to current point in 0 - 1 scope</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">MouseDelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialMousePosition</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// check bounds</span>
<span class="w">    </span><span class="c1">// if our new window position on canvas &gt; than maximum possible (1) then we don&#39;t move window</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetXMax</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.f</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span><span class="w"> </span><span class="p">){</span>
<span class="w">        </span><span class="c1">// move slot by mouse delta</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetYMax</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.f</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// apply offsets</span>
<span class="w">    </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">SetAnchors</span><span class="p">(</span><span class="n">TargetAnchors</span><span class="p">);</span>
<span class="w">    </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/e29d4afcb50f8c3d9e71121d84a2ba3f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e29d4afcb50f8c3d9e71121d84a2ba3f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e29d4afcb50f8c3d9e71121d84a2ba3f.png" /></a></p>
<p>Перемещение окна останавливается автоматически, при касании границ экрана.</p>
<p>Схожая логика используется и при растягивании окна. Причем растягивание работает лишь в указанных рамках, к тому-же растянуть окно больше, чем текущий размер экрана - тоже не получится.</p>
<p><a class="glightbox" href="../images/9b535e82aa481cb2ead64a16bd0f4d40.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9b535e82aa481cb2ead64a16bd0f4d40.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9b535e82aa481cb2ead64a16bd0f4d40.png" /></a></p>
<p>Заголовок окна выделен отдельным шрифтом, который приложен к книге, посмотрите в папку "дополнительно". В данном случае это бесплатный шрифт <code>ST-Nizhegorodsky.ttf</code>, который поддерживает как латинницу так и кириллицу.</p>
<p><a class="glightbox" href="../images/67e7344d7e6ae2de507ad3074e250447.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="67e7344d7e6ae2de507ad3074e250447.png" auto_="auto;" display="block;" margin:="margin:" src="../images/67e7344d7e6ae2de507ad3074e250447.png" /></a></p>
<p>Границы, а так-же иконки нарисованы лично мной и взяты из моего старого проекта, их я тоже приложил к книге.</p>
<p><a class="glightbox" href="../images/5e9754d5cd51a4812feb200909f60457.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5e9754d5cd51a4812feb200909f60457.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5e9754d5cd51a4812feb200909f60457.png" /></a></p>
<p>Использование виджета окна выглядит так:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SGameWindow.h&quot;</span>
<span class="c1">//...</span>
<span class="n">SNew</span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="p">)</span>
<span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// this window size is automatic</span>
<span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">InventoryWindow</span><span class="p">,</span><span class="w"> </span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_PlayerController</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WindowTitle</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Window Test&quot;</span><span class="p">))</span>
<span class="p">]</span>
<span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="c1">// this window will be sized based on anchors</span>
<span class="c1">//.AutoSize(true)</span>
<span class="p">[</span>
<span class="w">    </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">InventoryWindow</span><span class="p">,</span><span class="w"> </span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_PlayerController</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">WindowTitle</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Window Test 1&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;This is inline text&quot;</span><span class="p">)))</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">]</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/e7cf6fa66d246e2ab682ed8db398e9e8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e7cf6fa66d246e2ab682ed8db398e9e8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e7cf6fa66d246e2ab682ed8db398e9e8.png" /></a></p>
<p>Теперь мы готовы заполнить слотами наш инвентарь и довести до ума внешний вид интерфейса.</p>
<p><a class="glightbox" href="../images/8110346d5c7132dadd4cd3c349930e5f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8110346d5c7132dadd4cd3c349930e5f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8110346d5c7132dadd4cd3c349930e5f.png" /></a></p>
<h2 id="_19">Полный код всех классов модуля</h2>
<p>Файлов много, поэтому читать будет тяжело.</p>
<p><a class="glightbox" href="../images/2de1056d6d45bf14a38fb23d13bc98d5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2de1056d6d45bf14a38fb23d13bc98d5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2de1056d6d45bf14a38fb23d13bc98d5.png" /></a></p>
<p><code>Slate</code> это одна из самых сложных и комплексных систем <code>Unreal Engine</code>.
Я крайне настоятельно советую вам смотреть этот код, загрузив тестовый проект, который поставляется вместе с книгой, в <code>Visual Studio</code>. Но, на всякий случай, если у вас нет доступа или вы книгу спиратили, потому что у вас нет денег, я приложу код и сюда тоже.</p>
<h3 id="slateruntimemoduleh"><code>SlateRuntimeModule.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Modules/ModuleManager.h&quot;</span>
<span class="n">DECLARE_LOG_CATEGORY_EXTERN</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">All</span><span class="p">,</span><span class="w"> </span><span class="n">All</span><span class="p">);</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FSlateRuntimeModule</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IModuleInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="cm">/* Called when the module is loaded */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">StartupModule</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* Called when the module is unloaded */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShutdownModule</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FSlateStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">UiStyle</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="slateruntimemodulecpp"><code>SlateRuntimeModule.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateRuntimeModule.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateUIWidgetStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/UiSlateStyleSet.h&quot;</span><span class="c1"> // StyleSet to register</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/StyleSetBoilerplate.h&quot;</span><span class="c1"> // StyleSet to register</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/GameWindowStyleSet.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Slate/SlateGameResources.h&quot;</span>
<span class="n">DEFINE_LOG_CATEGORY</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">);</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;FSlateRuntimeModule&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateRuntimeModule::StartupModule</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// register custom widget style class</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">UiStyle</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()){</span>
<span class="w">        </span><span class="n">UiStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateGameResources</span><span class="o">::</span><span class="n">New</span><span class="p">(</span><span class="n">FSlateUIStyle</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">GetTypeName</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;/Game/UI/Styles&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/Game/UI/Styles&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">RegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="n">UiStyle</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// this will initialize static variable FUiSlateStyleSet::inst in the class with object value</span>
<span class="w">    </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule module has been loaded&quot;</span><span class="p">));</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateRuntimeModule::ShutdownModule</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// unregister widget style and free memory</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">UiStyle</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">UnRegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="n">UiStyle</span><span class="p">);</span>
<span class="w">        </span><span class="n">UiStyle</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// this will unregister style and clear local pointer to it</span>
<span class="w">    </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule module has been unloaded&quot;</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
<span class="n">IMPLEMENT_MODULE</span><span class="p">(</span><span class="n">FSlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">SlateRuntimeModule</span><span class="p">)</span>
</code></pre></div>
<h3 id="simagebuttonwidgeth"><code>SImageButtonWidget.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SScaleBox.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ImageUtils.h&quot;</span><span class="c1"> // ImportFileAsTexture2D</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // FSlateImageBrush</span>
<span class="cm">/**</span>
<span class="cm"> * Image Button</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SImageButtonWidget</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="n">_bAllowDefaultImage</span><span class="p">(</span><span class="nb">true</span><span class="p">),</span>
<span class="w">        </span><span class="n">_Image</span><span class="p">()</span>
<span class="w">        </span><span class="p">{}</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">bAllowDefaultImage</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">Image</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Events</span>
<span class="w">        </span><span class="n">SLATE_EVENT</span><span class="p">(</span><span class="n">FOnClicked</span><span class="p">,</span><span class="w"> </span><span class="n">OnClicked</span><span class="p">)</span><span class="w"> </span><span class="c1">// SimpleDelegate event</span>
<span class="w">        </span><span class="c1">// Slot for content</span>
<span class="w">        </span><span class="n">SLATE_DEFAULT_SLOT</span><span class="p">(</span><span class="n">FArguments</span><span class="p">,</span><span class="w"> </span><span class="n">Content</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">SImageButtonWidget</span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<span class="w">        </span><span class="c1">// attribute default values</span>
<span class="w">        </span><span class="n">bShowDefaultImage</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">),</span>
<span class="w">        </span><span class="n">ImageBrushAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="p">{})</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="cm">/* Constructs this widget with InArgs */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetImageBrush</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">NewBrush</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewBrush</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*</span><span class="w"> </span><span class="nf">GetImageBrush</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// image attribute setter</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetDefaultImageMode</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bMode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bShowDefaultImage</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">bMode</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// image attribute getter</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">GetDefaultImageMode</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bShowDefaultImage</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will force image to update</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateImage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ImageControl</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ImageControl</span><span class="o">-&gt;</span><span class="n">SetImage</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*</span><span class="p">)</span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// to access ImageControl</span>
<span class="w">    </span><span class="n">SImage</span><span class="o">*</span><span class="w"> </span><span class="nf">GetImageControl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ImageControl</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will load default image</span>
<span class="w">    </span><span class="n">FSlateImageBrush</span><span class="w"> </span><span class="o">*</span><span class="nf">GetDefaultImageBrush</span><span class="p">(){</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">HasUObject</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">GetDefaultImageMode</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DefaultImage</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// load image if not already</span>
<span class="w">            </span><span class="n">DefaultImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FImageUtils</span><span class="o">::</span><span class="n">ImportFileAsTexture2D</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/SlateRuntimeModule/Resources/default_button_icon.png&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">            </span><span class="c1">// load image from module&#39;s resources folder</span>
<span class="w">            </span><span class="n">DefaultImage</span><span class="p">,</span>
<span class="w">            </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">128.0</span><span class="p">,</span><span class="w"> </span><span class="mf">128.0</span><span class="p">},</span>
<span class="w">            </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">,</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">            </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">NoTile</span><span class="p">,</span>
<span class="w">            </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span><span class="w"> </span><span class="c1">// draw as</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// to access ButtonControl</span>
<span class="w">    </span><span class="n">SButton</span><span class="o">*</span><span class="w"> </span><span class="nf">GetButtonControl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ButtonControl</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Called every widget re-paint</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="nf">OnPaint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPaintArgs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateRect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span>
<span class="w">        </span><span class="n">FSlateWindowElementList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span>
<span class="w">        </span><span class="n">int32</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FWidgetStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">bParentEnabled</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Attributes</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bShowDefaultImage</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">ImageBrushAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Controls</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ButtonControl</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SImage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ImageControl</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// default button image, if loaded</span>
<span class="w">    </span><span class="n">UTexture2D</span><span class="o">*</span><span class="w"> </span><span class="n">DefaultImage</span><span class="p">;</span><span class="w"> </span><span class="c1">// it&#39;s garbage collected uobject, so we need to store it&#39;s refrence</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="simagebuttonwidgetcpp"><code>SImageButtonWidget.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SImageButtonWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="nf">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SImageButtonWidget</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SImageButtonWidget</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ImageBrushAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ImageBrushAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SImageButtonWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">).</span><span class="n">UpdateImage</span><span class="p">();</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bShowDefaultImage&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bShowDefaultImage</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SImageButtonWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">).</span><span class="n">UpdateImage</span><span class="p">();</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SImageButtonWidget::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SetDefaultImageMode</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_bAllowDefaultImage</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Image</span><span class="p">.</span><span class="n">IsSet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetImageBrush</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Image</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetDefaultImageMode</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetImageBrush</span><span class="p">(</span><span class="n">GetDefaultImageBrush</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">ChildSlot</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">ButtonControl</span><span class="p">,</span><span class="w"> </span><span class="n">SButton</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_OnClicked</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">FillWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// proportions</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFitX</span><span class="p">)</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">ImageBrushAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">())</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">FillWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">// will take 3 times from image slot size</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Content</span><span class="p">.</span><span class="n">Widget</span><span class="w"> </span><span class="c1">// get widgets inside content</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">// Called every widget re-paint</span>
<span class="n">int32</span><span class="w"> </span><span class="nf">SImageButtonWidget::OnPaint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPaintArgs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateRect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span>
<span class="w">    </span><span class="n">FSlateWindowElementList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FWidgetStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bParentEnabled</span>
<span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;has image %s&quot;), ImageBrushAttribute.Get()-&gt;HasUObject() ? TEXT(&quot;TRUE&quot;) : TEXT(&quot;FALSE&quot;))</span>
<span class="w">    </span><span class="c1">// we can call SCompoundWidget::OnPaint to paint every visible children</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="o">::</span><span class="n">OnPaint</span><span class="p">(</span><span class="n">Args</span><span class="p">,</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span><span class="w"> </span><span class="n">bParentEnabled</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
</code></pre></div>
<h3 id="slateuiwidgetstyleh"><code>SlateUIWidgetStyle.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateWidgetStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateWidgetStyleContainerBase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyleRegistry.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateUIWidgetStyle.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Main blueprintable widget style class</span>
<span class="cm"> */</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateWidgetStyle</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Destructor</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">FSlateUIStyle</span><span class="p">();</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * FSlateWidgetStyle Interface</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Place here to OutBrushes all your custom style brushes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetResources</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OutBrushes</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// static const default value is set in .cpp file or below the class</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TypeName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// should return TypeName</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetTypeName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">TypeName</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// should return singletone &quot;static FSlateUIStyle&quot;</span>
<span class="w">    </span><span class="c1">// if you don&#39;t remember how static is work:</span>
<span class="w">    </span><span class="c1">// static variables defined once and exist until app is closed. they not cleared after exiting the function.</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetDefault</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="w"> </span><span class="n">Default</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Default</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Properties</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// FontStyle</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">TextUiFontInfo</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">SetTextUiFont</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InFontInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TextUiFontInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InFontInfo</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Slot Border Brush</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">FSlateBrush</span><span class="w"> </span><span class="n">SlotBorderBrush</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">SetUpSlotBorderBrush</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">&amp;</span><span class="w"> </span><span class="n">BorderBrush</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SlotBorderBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BorderBrush</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Slot Border Mouse Over</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">FSlateColor</span><span class="w"> </span><span class="n">StaminaBarColor</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">SetStaminaBarColor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateColor</span><span class="o">&amp;</span><span class="w"> </span><span class="n">BorderBrush</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StaminaBarColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BorderBrush</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Slot Border Margin</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Appearance</span><span class="p">)</span>
<span class="w">    </span><span class="n">FMargin</span><span class="w"> </span><span class="n">SlotBorderMargin</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">SetSlotBorderMargin</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FMargin</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InMargin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SlotBorderMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InMargin</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Singletone that allows to register FSlateUIStyle in the FAppStyle</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">(</span><span class="n">hidecategories</span><span class="o">=</span><span class="n">Object</span><span class="p">,</span><span class="w"> </span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">USlateUIWidgetStyle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">USlateWidgetStyleContainerBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="cm">/** The actual data describing the widget appearance. */</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">Category</span><span class="o">=</span><span class="n">Appearance</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="o">=</span><span class="p">(</span><span class="n">ShowOnlyInnerProperties</span><span class="p">))</span>
<span class="w">    </span><span class="n">FSlateUIStyle</span><span class="w"> </span><span class="n">WidgetStyle</span><span class="p">;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">FSlateWidgetStyle</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">GetStyle</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">FSlateWidgetStyle</span><span class="o">*</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">WidgetStyle</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="slateuiwidgetstylecpp"><code>SlateUIWidgetStyle.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateUIWidgetStyle.h&quot;</span>
<span class="c1">// Constructor</span>
<span class="n">FSlateUIStyle</span><span class="o">::</span><span class="n">FSlateUIStyle</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Set Default Values Here</span>
<span class="w">    </span><span class="n">StaminaBarColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateColor</span><span class="p">{</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">SlotBorderMargin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// for SlotBorderBrush</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">DefaultMaterialPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaterialPointer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FSoftObjectPath</span><span class="p">(</span><span class="o">*</span><span class="n">DefaultMaterialPath</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">MaterialPointer</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SlotBorderBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="n">MaterialPointer</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">(),</span><span class="w"> </span><span class="c1">// stylesets work only with valid objects</span>
<span class="w">                                </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="mf">120.f</span><span class="p">,</span><span class="w"> </span><span class="mf">120.f</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span><span class="w"> </span><span class="c1">// Default Slot tint color</span>
<span class="w">                            </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// set font object</span>
<span class="w">    </span><span class="c1">// font should be imported into game, or this won&#39;t work</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">FontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Font&#39;/Game/UI/Bitter-Black_Font.Bitter-Black_Font&#39;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FontPointer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">FSoftObjectPath</span><span class="p">(</span><span class="o">*</span><span class="n">FontPath</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">FontPointer</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TextUiFontInfo</span><span class="p">.</span><span class="n">FontObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FontPointer</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">();</span><span class="w"> </span><span class="c1">// font should be loaded in memory as UObject</span>
<span class="w">        </span><span class="n">TextUiFontInfo</span><span class="p">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Test font loading from drive path</span>
<span class="w">    </span><span class="c1">// dosen&#39;t work here since it&#39;s not imported</span>
<span class="w">    </span><span class="c1">// but will work in SltyleSet</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    FString FontDiscPath = FPaths::GameSourceDir() + TEXT(&quot;SlateRuntimeModule/Resources/Fonts/Bitter-Light.ttf&quot;);</span>
<span class="cm">    DiscFontInfo = FSlateFontInfo(*FontDiscPath, 16);*/</span>
<span class="p">}</span>
<span class="c1">// Destructor</span>
<span class="n">FSlateUIStyle</span><span class="o">::~</span><span class="n">FSlateUIStyle</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="c1">// since TypeName is &quot;static const&quot;, default value of this variable can be set only in .cpp file</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">FSlateUIStyle</span><span class="o">::</span><span class="n">TypeName</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FSlateUIStyle&quot;</span><span class="p">));</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateUIStyle::GetResources</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">FSlateBrush</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OutBrushes</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Add any brush resources here so that Slate can correctly atlas and reference them</span>
<span class="w">    </span><span class="n">OutBrushes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SlotBorderBrush</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="slateruntimeplayercontrollerh"><code>SlateRuntimePlayerController.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/PlayerController.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SGameScreenWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span><span class="c1"> // our ui is compound widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SWeakWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SConstraintCanvas.h&quot;</span><span class="c1"> // Slate Canvas</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span>
<span class="c1">// Mapping Context</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputMappingContext.h&quot;</span>
<span class="c1">// Enhanced Input</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EnhancedInputSubsystems.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EnhancedInputComponent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Interfaces/IMainFrameModule.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;MainFrame/Private/MainFrameModule.h&gt;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateRuntimePlayerController.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Playe controller used to show slate UI</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">ASlateRuntimePlayerController</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">APlayerController</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// our ui root widget</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&gt;</span><span class="w"> </span><span class="n">UIContent</span><span class="p">;</span><span class="w"> </span><span class="c1">// our game ui</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">ASlateRuntimePlayerController</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// BeginPlay</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span>
<span class="w">        </span><span class="n">UTexture</span><span class="o">*</span><span class="w"> </span><span class="n">Texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UTexture</span><span class="o">&gt;</span><span class="p">(</span><span class="n">StaticLoadObject</span><span class="p">(</span><span class="n">UTexture</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Texture2D&#39;/Game/Characters/Textures/2344444_original.2344444_original&#39;&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Texture</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GEngine</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">FSimpleDelegate</span><span class="w"> </span><span class="n">ArgumentEvent</span><span class="p">;</span>
<span class="w">            </span><span class="n">ArgumentEvent</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([]()</span><span class="o">-&gt;</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SlateRuntimeController] ButtonPressEvent triggered&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">UIContent</span><span class="p">,</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="w"> </span><span class="c1">// crate game screen widget</span>
<span class="w">                </span><span class="p">.</span><span class="n">CharacterName</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Hero&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// name</span>
<span class="w">                </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">MaxHealth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">MaxStamina</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Health</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">ButtonPressEvent</span><span class="p">(</span><span class="n">ArgumentEvent</span><span class="p">);</span>
<span class="w">            </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GameViewport</span><span class="o">-&gt;</span><span class="n">AddViewportWidgetForPlayer</span><span class="p">(</span><span class="n">GetLocalPlayer</span><span class="p">(),</span><span class="w"> </span><span class="n">UIContent</span><span class="p">.</span><span class="n">ToSharedRef</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">            </span><span class="cm">/*// SWindow</span>
<span class="cm">            TSharedPtr&lt;SWindow&gt; WindowPtr;</span>
<span class="cm">            SAssignNew(WindowPtr, SWindow)</span>
<span class="cm">            .IsTopmostWindow(true)</span>
<span class="cm">            .bDragAnywhere(true)</span>
<span class="cm">            .ClientSize({ 600, 300 })</span>
<span class="cm">            [</span>
<span class="cm">                SNew(STextBlock)</span>
<span class="cm">                .Margin(FMargin{ 25.f, 30.f })</span>
<span class="cm">                .Text(FText::FromString(&quot;Window Text&quot;))</span>
<span class="cm">                .TextStyle(FUiSlateStyleSet::Get(), &quot;Controls:TextBlock24&quot;)</span>
<span class="cm">                .ColorAndOpacity(FLinearColor::White)</span>
<span class="cm">            ];</span>
<span class="cm">            // on Window close</span>
<span class="cm">            FOnWindowClosed OnClosed;</span>
<span class="cm">            OnClosed.BindLambda( [](const TSharedRef&lt;SWindow&gt;&amp; WPtr) {</span>
<span class="cm">                UE_LOG(LogTemp, Warning, TEXT(&quot;Window %s Being Closed!&quot;), *WPtr-&gt;GetTitle().ToString())</span>
<span class="cm">            } );</span>
<span class="cm">            WindowPtr-&gt;SetOnWindowClosed(OnClosed);</span>
<span class="cm">            FSlateApplication::Get().AddWindow(WindowPtr.ToSharedRef()); // add window to the editor</span>
<span class="cm">            */</span>
<span class="w">            </span><span class="cm">/*IMainFrameModule&amp; MainFrameModule =</span>
<span class="cm">            FModuleManager::LoadModuleChecked&lt;IMainFrameModule&gt;(TEXT(&quot;MainFrame&quot;));</span>
<span class="cm">            FSlateApplication::Get().AddWindowAsNativeChild(WindowPtr.ToSharedRef(), MainFrameModule.GetParentWindow().ToSharedRef());</span>
<span class="cm">            */</span>
<span class="w">            </span><span class="c1">//GEngine-&gt;GameViewport-&gt;AddViewportWidgetForPlayer(GetLocalPlayer(), WindowPtr.ToSharedRef(), 1);</span>
<span class="w">            </span><span class="c1">// Input</span>
<span class="w">            </span><span class="c1">// Bind to key &quot;1&quot;</span>
<span class="w">            </span><span class="n">FInputKeyBinding</span><span class="w"> </span><span class="n">KB1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FInputKeyBinding</span><span class="p">(</span><span class="n">EKeys</span><span class="o">::</span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">EInputEvent</span><span class="o">::</span><span class="n">IE_Pressed</span><span class="p">);</span>
<span class="w">            </span><span class="n">KB1</span><span class="p">.</span><span class="n">KeyDelegate</span><span class="p">.</span><span class="n">GetDelegateForManualSet</span><span class="p">().</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">](){</span>
<span class="w">                </span><span class="c1">// restore health to 100%</span>
<span class="w">                </span><span class="n">UIContent</span><span class="o">-&gt;</span><span class="n">SetHealth</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="w">                </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Key 1 Pressed&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">KeyBindings</span><span class="p">.</span><span class="n">Emplace</span><span class="p">(</span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">KB1</span><span class="p">));</span>
<span class="w">            </span><span class="cm">/*</span>
<span class="cm">            //UEnhancedInputLocalPlayerSubsystem* Subsystem = ULocalPlayer::GetSubsystem&lt;UEnhancedInputLocalPlayerSubsystem&gt;(GetLocalPlayer());</span>
<span class="cm">            // Bind to key &quot;2&quot;</span>
<span class="cm">            UEnhancedInputComponent* EnhancedInputComponent = Cast&lt;UEnhancedInputComponent&gt;(InputComponent);</span>
<span class="cm">            // Bind Actions</span>
<span class="cm">            if (EnhancedInputComponent != nullptr) {</span>
<span class="cm">                FInputKeyBinding KB2 = FInputKeyBinding(EKeys::Two, EInputEvent::IE_Pressed);</span>
<span class="cm">                KB2.KeyDelegate.GetDelegateForManualSet().BindLambda([this]() {</span>
<span class="cm">                    UE_LOG(LogTemp, Warning, TEXT(&quot;Key 2 Pressed&quot;))</span>
<span class="cm">                });</span>
<span class="cm">                EnhancedInputComponent-&gt;KeyBindings.Emplace(MoveTemp(KB2));</span>
<span class="cm">            }*/</span>
<span class="w">            </span><span class="cm">/*</span>
<span class="cm">            // Quick UI Sample</span>
<span class="cm">            // This will be called on button click</span>
<span class="cm">            FOnClicked ClickDelegate;</span>
<span class="cm">            ClickDelegate.BindLambda([]() -&gt; FReply {</span>
<span class="cm">                    UE_LOG(LogTemp, Warning, TEXT(&quot;Button Clicked!&quot;));</span>
<span class="cm">                    return FReply::Handled();</span>
<span class="cm">                });</span>
<span class="cm">            // SArgumentNew</span>
<span class="cm">            SButton::FArguments ButtonArgs;</span>
<span class="cm">            ButtonArgs.Text( FText::FromString(TEXT(&quot;ButtonSArgNew Button&quot;)) );</span>
<span class="cm">            TSharedPtr&lt;SButton&gt; ButtonSArgNew = SArgumentNew(ButtonArgs, SButton);</span>
<span class="cm">            // SNew</span>
<span class="cm">            TSharedPtr&lt;SButton&gt; ButtonSNew =</span>
<span class="cm">            SNew(SButton)</span>
<span class="cm">            .Text(FText::FromString(TEXT(&quot;SNew Button&quot;)))</span>
<span class="cm">            .HAlign(HAlign_Fill);</span>
<span class="cm">            // SAssignNew</span>
<span class="cm">            TSharedPtr&lt;SButton&gt; ButtonSAssignNew = nullptr;</span>
<span class="cm">            SAssignNew(ButtonSAssignNew, SButton)</span>
<span class="cm">            .Text(FText::FromString(TEXT(&quot;SAssignNew Button&quot;)))</span>
<span class="cm">            .HAlign(HAlign_Fill);</span>
<span class="cm">            // Slate UI</span>
<span class="cm">            TSharedPtr&lt;SConstraintCanvas&gt; Canvas =</span>
<span class="cm">            SNew(SConstraintCanvas)</span>
<span class="cm">                + SConstraintCanvas::Slot()</span>
<span class="cm">                .AutoSize(true)</span>
<span class="cm">                .Anchors(FAnchors{0.2f,0.8f}) // down left</span>
<span class="cm">                [</span>
<span class="cm">                    SNew(SButton)</span>
<span class="cm">                    .Text( FText::FromString(TEXT(&quot;TestButton&quot;)) )</span>
<span class="cm">                    .OnClicked(ClickDelegate) // bind click event</span>
<span class="cm">                    .ContentPadding(FMargin{10.0f, 15.0f})</span>
<span class="cm">                ]</span>
<span class="cm">                + SConstraintCanvas::Slot() // ButtonSNew slot</span>
<span class="cm">                .AutoSize(true)</span>
<span class="cm">                .Anchors(FAnchors{ 0.3f,0.5f })</span>
<span class="cm">                [</span>
<span class="cm">                    ButtonSNew.ToSharedRef()</span>
<span class="cm">                ]</span>
<span class="cm">                + SConstraintCanvas::Slot() // ButtonSAssignNew slot</span>
<span class="cm">                .AutoSize(true)</span>
<span class="cm">                .Anchors(FAnchors{ 0.3f,0.6f })</span>
<span class="cm">                [</span>
<span class="cm">                    ButtonSAssignNew.ToSharedRef()</span>
<span class="cm">                ]</span>
<span class="cm">                + SConstraintCanvas::Slot() // ButtonSArgNew slot</span>
<span class="cm">                .AutoSize(true)</span>
<span class="cm">                .Anchors(FAnchors{ 0.3f,0.7f })</span>
<span class="cm">                [</span>
<span class="cm">                    ButtonSArgNew.ToSharedRef()</span>
<span class="cm">                ]</span>
<span class="cm">            ;</span>
<span class="cm">            // Add Background to our Canvas with Button</span>
<span class="cm">            TSharedPtr&lt;SOverlay&gt; BGOverlay =</span>
<span class="cm">            SNew(SOverlay)</span>
<span class="cm">                + SOverlay::Slot()</span>
<span class="cm">                .HAlign(HAlign_Fill) // fill whole space</span>
<span class="cm">                .VAlign(VAlign_Fill)</span>
<span class="cm">                [</span>
<span class="cm">                    // Border widget works as background color sourse</span>
<span class="cm">                    // will be better if you use just SImage, but as example i picked up Border</span>
<span class="cm">                    SNew(SBorder)</span>
<span class="cm">                    .BorderImage(new FSlateImageBrush{ // just demo of using Slate Brush on c++</span>
<span class="cm">                        Texture, // image path comes here</span>
<span class="cm">                        FVector2D{},</span>
<span class="cm">                        FLinearColor(0.1f, 0.1f, 0.1f, 1.0f), // tint</span>
<span class="cm">                        ESlateBrushTileType::Both,</span>
<span class="cm">                        ESlateBrushImageType::FullColor // draw as</span>
<span class="cm">                    })</span>
<span class="cm">                ]</span>
<span class="cm">                + SOverlay::Slot()[</span>
<span class="cm">                    Canvas.ToSharedRef() // this will put canvas into overlay</span>
<span class="cm">                ]</span>
<span class="cm">            ;</span>
<span class="cm">            // Add generated UI to Veiwport</span>
<span class="cm">            TSharedPtr&lt;SWidget&gt; UIContainer; // ui container</span>
<span class="cm">            GEngine-&gt;GameViewport-&gt;AddViewportWidgetForPlayer(GetLocalPlayer(), BGOverlay.ToSharedRef(), 0);</span>
<span class="cm">            return;*/</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="slateruntimeplayercontrollercpp"><code>SlateRuntimePlayerController.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateRuntimePlayerController.h&quot;</span>
<span class="c1">// BeginPlay</span>
<span class="cm">/*void ASlateRuntimePlayerController::BeginPlay()</span>
<span class="cm">{</span>
<span class="cm">    GEngine-&gt;GameViewport-&gt;AddViewportWidgetContent(</span>
<span class="cm">        SNew(SGameScreenWidget)</span>
<span class="cm">        .PossiblyNullContent(MyWidgetClass)</span>
<span class="cm">    );</span>
<span class="cm">}*/</span>
</code></pre></div>
<h3 id="uislatestyleseth"><code>UiSlateStyleSet.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/ISlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyleRegistry.h&quot;</span><span class="c1"> // to register our styles in</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="c1">// Core Style include files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/CoreStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateTypes.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/AppStyle.h&quot;</span>
<span class="c1">// Style set - collection of slate styles</span>
<span class="c1">// Just static class, like it&#39;s done here - FProfilerStyle</span>
<span class="c1">//\Engine\Source\Developer\Profiler\Private\ProfilerStyle.h</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FUiSlateStyleSet</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateStyleSet</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// style set name</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// here we will store our style instance in Inst variable</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">Get</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// here we will unregister our style instance</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// destructor</span>
<span class="w">    </span><span class="o">~</span><span class="n">FUiSlateStyleSet</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// this method should form relative path to assets of the plugin / module</span>
<span class="w">    </span><span class="c1">// idea taken from \Plugins\Runtime\StateTree\Source\StateTreeEditorModule\Private\StateTreeEditorStyle.cpp</span>
<span class="w">    </span><span class="c1">// (it&#39;s new Mass based Ai State Tree)</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="nf">InContent</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="o">&amp;</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ANSICHAR</span><span class="o">*</span><span class="w"> </span><span class="n">Extension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this is how it should work with plugins:</span>
<span class="w">        </span><span class="c1">//static FString ContentDir = IPluginManager::Get().FindPlugin(TEXT(&quot;StateTreeEditorModule&quot;))-&gt;GetContentDir() / TEXT(&quot;Slate&quot;);</span>
<span class="w">        </span><span class="c1">//return (ContentDir / RelativePath) + Extension;</span>
<span class="w">        </span><span class="c1">// since we work with module:</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ContentDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule/Resources/&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ContentDir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Extension</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="w">    </span><span class="n">FUiSlateStyleSet</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FUiSlateStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Inst</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="uislatestylesetcpp"><code>UiSlateStyleSet.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/UiSlateStyleSet.h&quot;</span>
<span class="c1">// note* static members of class should be ALVAYS initialized with default value</span>
<span class="c1">// Even if they are in the Private scope (which i did not know)</span>
<span class="c1">// static initialization should be outside of the class</span>
<span class="c1">// or you will get following error:</span>
<span class="c1">// unresolved external symbol &quot;private: static class...etc&quot;</span>
<span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FUiSlateStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="c1">// static for teh style name</span>
<span class="n">FName</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">StyleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModuleStyles&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">FUiSlateStyleSet</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">FSlateStyleSet</span><span class="p">(</span><span class="n">StyleName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// first set the Parent Style</span>
<span class="w">    </span><span class="c1">// Parent Style always loads before our style</span>
<span class="w">    </span><span class="c1">// Inheriting Parent Style will allow us to use all styles, defined in it as our own class styles</span>
<span class="w">    </span><span class="c1">// so, for example &quot;Icons.Cross&quot; defined in core style - FCoreStyle::Get().GetBrush(&quot;Icons.Cross&quot;)</span>
<span class="w">    </span><span class="c1">// will be accessible thru - FUiSlateStyleSet::Get().GetBrush(&quot;Icons.Cross&quot;)</span>
<span class="w">    </span><span class="c1">// if we inherit from the CoreStyle (and we will do so)</span>
<span class="w">    </span><span class="c1">//*note: since FCoreStyle::StyleName dosen&#39;t exist(it&#39;s very old class), instead just use string, it will work</span>
<span class="w">    </span><span class="c1">//*note2: CoreStyle can be found here - \Source\Runtime\SlateCore\Private\Styling\CoreStyle.cpp</span>
<span class="w">    </span><span class="n">SetParentStyleName</span><span class="p">(</span><span class="s">&quot;CoreStyle&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//*note: if you don&#39;t want all CoreStyle styles - use this instead:</span>
<span class="w">    </span><span class="c1">//SetParentStyleName(FAppStyle::GetAppStyleSetName());</span>
<span class="w">    </span><span class="c1">// this will allow to work with: RootToContentDir(TEXT(&quot;file_name&quot;), TEXT(&quot;.extension&quot;)) to refrence content in the &quot;Root&quot; folder</span>
<span class="w">    </span><span class="c1">// as &quot;Root&quot; we use FPaths::EngineContentDir() / TEXT(&quot;Slate&quot;), because same walue is used in CoreStyle, which is our parent style</span>
<span class="w">    </span><span class="c1">// you can find this directory in engine installataion folder - \Engine\Content\Slate</span>
<span class="w">    </span><span class="n">SetContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// this will allow to work with: RootToCoreContentDir(TEXT(&quot;file_name&quot;), TEXT(&quot;.extension&quot;)) to refrence content in the &quot;Root&quot; folder</span>
<span class="w">    </span><span class="c1">// as &quot;Root&quot; we use FPaths::EngineContentDir() / TEXT(&quot;Slate&quot;), because same walue is used in CoreStyle, which is our parent style</span>
<span class="w">    </span><span class="c1">// you can find this directory in engine installataion folder - \Engine\Content\Slate</span>
<span class="w">    </span><span class="n">SetCoreContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// --- common variables ---</span>
<span class="w">    </span><span class="c1">// we can refrence files, that are not imported into project&#39;s filesystem, using direct links</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BitterLightFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/Bitter-Light&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// will search for file Bitter-Light.ttf in Resources / Fonts folder of the module</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BitterBlackFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/Bitter-Black&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// if you refrencing assets imported inside game project - preload them first</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">MaterialPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UMaterialInstance</span><span class="o">*</span><span class="w"> </span><span class="n">SlotMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadObject</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">MaterialPath</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// --- styles ---</span>
<span class="w">    </span><span class="c1">// custom brushes</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// some custom brushes</span>
<span class="w">        </span><span class="c1">// This brush image loaded from module&#39;s Resource folder</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotImageBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBoxBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// Box Brush projection</span>
<span class="w">                                    </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InventorySlot_Icon&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// will return path of InventorySlot_Icon from modeule Resources folder</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">0.4f</span><span class="p">},</span><span class="w"> </span><span class="c1">// margins on box and border brush projections work differenty, check it in umg widgets editor</span>
<span class="w">                                    </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush loaded from folder that is set as ContentRoot</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotContentBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBorderBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// Border Brush Projection</span>
<span class="w">                                    </span><span class="n">RootToContentDir</span><span class="p">(</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Common/BoxShadow&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;.png&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="c1">// will search image in folder we set in SetContentRoot()</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">0.4f</span><span class="p">},</span><span class="w"> </span><span class="c1">// margins on box and border brush projections work differenty, check it in umg widgets editor</span>
<span class="w">                                    </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush uses material as it&#39;s value</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotMaterialBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                    </span><span class="n">SlotMaterial</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">50.f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="p">},</span>
<span class="w">                                    </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">NoTile</span><span class="w"> </span><span class="c1">// image brushes can be tiled, but since it&#39;s just material - there is no meaning of tiling at all</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:InventoryIcon&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                    </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ThreeLinesIcon&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">100.f</span><span class="p">,</span><span class="w"> </span><span class="mf">100.f</span><span class="p">},</span>
<span class="w">                                    </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">NoTile</span><span class="w"> </span><span class="c1">// image brushes can be tiled, but since it&#39;s just material - there is no meaning of tiling at all</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush will draw rounded box</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:RoundedDark&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateRoundedBoxBrush</span><span class="p">{</span>
<span class="w">                                        </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Black</span><span class="p">,</span><span class="w"> </span><span class="c1">// background</span>
<span class="w">                                        </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="c1">// outline</span>
<span class="w">                                        </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="c1">// outline size</span>
<span class="w">                                        </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">50.f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="p">}</span><span class="w"> </span><span class="c1">// image size</span>
<span class="w">                                    </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// just color brush</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:Dark&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                    </span><span class="s">&quot;Brush:DarkColorBrush&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                                    </span><span class="n">FLinearColor</span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">}</span>
<span class="w">                                </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush loads font Bitter-Light.ttf from Resources folder of the module</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterLightFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// This brush loads font Bitter-Black.ttf from Resources folder of the module   </span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:BitterBlack32&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// override existing style</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this way we can make custom TextBlock</span>
<span class="w">        </span><span class="c1">// big text</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TBStyleY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:TextBlock32Big&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TBStyleY</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// basic text</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TBStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:TextBlock24&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TBStyle</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// buttons:</span>
<span class="w">        </span><span class="c1">// slightly blue</span>
<span class="w">        </span><span class="n">FSlateBrush</span><span class="w"> </span><span class="n">ButtonBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">Normal</span><span class="p">;</span>
<span class="w">        </span><span class="n">ButtonBrush</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.7f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">BStyleBlue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">ButtonBrush</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:BlueButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BStyleBlue</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// slightly green</span>
<span class="w">        </span><span class="n">ButtonBrush</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">BStyleGreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">ButtonBrush</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:GreenButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BStyleGreen</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// register style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">RegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// destructor</span>
<span class="n">FUiSlateStyleSet</span><span class="o">::~</span><span class="n">FUiSlateStyleSet</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// unregister style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">UnRegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// initialize static pointer</span>
<span class="k">const</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Inst</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// make class instance and store is as static</span>
<span class="w">        </span><span class="c1">// *note - this also calls constructor, where RegisterSlateStyle is called</span>
<span class="w">        </span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FUiSlateStyleSet</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear unique pointer</span>
<span class="w">    </span><span class="c1">// *note - this will also call destructor, where UnRegisterSlateStyle is called</span>
<span class="w">    </span><span class="n">Inst</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="sgamewindowh"><code>SGameWindow.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Text/STextBlock.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SScaleBox.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SSpacer.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ImageUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SConstraintCanvas.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/GameWindowStyleSet.h&quot;</span><span class="c1"> // Window Styles</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;SGameWindow&quot; </span><span class="c1">// to use FText</span>
<span class="cm">/**</span>
<span class="cm"> * In Game Window</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SGameWindow</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Window Size struct</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">FGameWindowSizeLimits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">MinHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">450</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">MinWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">450</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// oveload operator == because we might be need to compare structs</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameWindowSizeLimits</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// use simple AND</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">MinHeight</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">MinHeight</span><span class="p">;</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">MinWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">MinWidth</span><span class="p">;</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">MaxHeight</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">MaxHeight</span><span class="p">;</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">MaxWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">MaxWidth</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">        </span><span class="c1">// Slot for content</span>
<span class="w">        </span><span class="n">SLATE_DEFAULT_SLOT</span><span class="p">(</span><span class="n">FArguments</span><span class="p">,</span><span class="w"> </span><span class="n">Content</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Window Title input attribute</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">FText</span><span class="p">,</span><span class="w"> </span><span class="n">WindowTitle</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Window Size input attribute</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">FGameWindowSizeLimits</span><span class="p">,</span><span class="w"> </span><span class="n">WindowSizeLimits</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Local Player Attribute</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">APlayerController</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerController</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// On close button clicked</span>
<span class="w">        </span><span class="n">SLATE_EVENT</span><span class="p">(</span><span class="n">FOnClicked</span><span class="p">,</span><span class="w"> </span><span class="n">OnCloseClicked</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Constructor</span>
<span class="w">    </span><span class="n">SGameWindow</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Attribute Default Values</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">WindowTitleAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;SGameWindow:DefaultTitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Game Window&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">FGameWindowSizeLimits</span><span class="p">{</span><span class="w"> </span><span class="cm">/* initialize with default values */</span><span class="w"> </span><span class="p">})</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="cm">/** Constructs this widget with InArgs */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * SWidget Interface</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Events like OnKeyDown, OnKeyUp and all others related to keyboard won&#39;t work without this</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">SupportsKeyboardFocus</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//return true;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="c1">//virtual FReply OnKeyDown(const FGeometry&amp; MyGeometry, const FKeyEvent&amp; InKeyEvent) override;</span>
<span class="w">    </span><span class="c1">//virtual FReply OnMouseButtonDown(const FGeometry&amp; MyGeometry, const FPointerEvent&amp; MouseEvent) override;</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnTitleMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnTitleMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnResizeMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnResizeMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnRootMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnRootMouseLeave</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InEvent</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//virtual FReply OnMouseMove(const FGeometry&amp; MyGeometry, const FPointerEvent&amp; MouseEvent) override;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnMouseEnter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// called every frame</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Tick</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">InCurrentTime</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">InDeltaTime</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// every paint update</span>
<span class="w">    </span><span class="c1">//int32 Paint(const FPaintArgs&amp; Args, const FGeometry&amp; AllottedGeometry, const FSlateRect&amp; MyCullingRect, FSlateWindowElementList&amp; OutDrawElements, int32 LayerId, const FWidgetStyle&amp; InWidgetStyle, bool bParentEnabled) const;</span>
<span class="w">    </span><span class="c1">// organize geometry</span>
<span class="w">    </span><span class="c1">//virtual void OnArrangeChildren(const FGeometry&amp; AllottedGeometry, FArrangedChildren&amp; ArrangedChildren) const override;</span>
<span class="w">    </span><span class="c1">// Attribute Setters / Getters</span>
<span class="w">    </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetWindowTitle</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WindowTitleAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetWindowTitle</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">FText</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewTitle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowTitleAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewTitle</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetWindowSizeLimits</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">FGameWindowSizeLimits</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Limits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">Limits</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FGameWindowSizeLimits</span><span class="w"> </span><span class="nf">GetWindowSizeLimits</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// setter for PlayerControllerAttribute</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetNewPlayerController</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">LPlayer</span><span class="p">){</span>
<span class="w">        </span><span class="n">PlayerControllerAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">LPlayer</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// getter for PlayerControllerAttribute</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="nf">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return FSlateUser user object from current LocalPlayer</span>
<span class="w">    </span><span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="nf">GetSlateUser</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetUser</span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControllerId</span><span class="p">()).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return parent SConstraintCanvas slate node if our window placed inside of the canvas</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="nf">GetParentCanvas</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SConstraintCanvas</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetParentWidget</span><span class="p">().</span><span class="n">Get</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return FSlot object, related to our Window on SConstraintCanvas</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="nf">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get slot with highest z-order</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="nf">GetHighestZOrder</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will set keyboard focus to current window</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetFocusToWindow</span><span class="p">();</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Window drag mechanics</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// will initiate drag sequence</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StartWindowDrag</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will update window position on the canvas according to cursro movement</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ProcessWindowDrag</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will stop drag</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StopWindowDrag</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DragMode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">DragMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// check if we are in drag mode</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">isDrag</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DragMode</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Window resize mechanics</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// will initiate resize sequence</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StartWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will process resize</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ProcessWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will stop resize</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StopWindowResize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ResizeMode</span><span class="p">){</span>
<span class="w">            </span><span class="n">ResizeMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// check if we are in resize mode</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">isResize</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ResizeMode</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will search all SGameWindow objects on the parent canvas</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">GetAllGameWindowsOnCanvas</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">        </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">            </span><span class="c1">//SConstraintCanvas::FSlot* Slot = (SConstraintCanvas::FSlot*)(&amp;ChildWingets-&gt;GetSlotAt(i));</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ChildWidget</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;SGameWindow&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">SGameWindow</span><span class="o">*</span><span class="w"> </span><span class="n">GameWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ChildWidget</span><span class="p">);</span>
<span class="w">                </span><span class="c1">//StaticCastSharedPtr</span>
<span class="w">                </span><span class="n">res</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">GameWindow</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Variables</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FGameWindowSizeLimits</span><span class="p">{}.</span><span class="n">MinHeight</span><span class="p">;</span><span class="w"> </span><span class="c1">// take min default values</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FGameWindowSizeLimits</span><span class="p">{}.</span><span class="n">MinWidth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">DragMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">ResizeMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">InitialMousePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">InitialWindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="n">FAnchors</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="n">FAnchors</span><span class="w"> </span><span class="n">TargetAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// Attributes</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">FText</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowTitleAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">FGameWindowSizeLimits</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Controls</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SBox</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowSizeBox</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">STextBlock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WindowTitleBlock</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SButton</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CloseButton</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SWidget</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResizeWidget</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h3 id="sgamewindowcpp"><code>SGameWindow.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SGameWindow.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="nf">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WindowTitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">WindowTitleAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">SGameWindow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">WindowWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WindowSizeLimits&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">WindowSizeLimitsAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PlayerController&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SetWindowTitle</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_WindowTitle</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetWindowSizeLimits</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_WindowSizeLimits</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetNewPlayerController</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_PlayerController</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TitleSpacerSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">15.f</span><span class="p">,</span><span class="mf">0.f</span><span class="p">};</span>
<span class="w">    </span><span class="n">ChildSlot</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">WindowSizeBox</span><span class="p">,</span><span class="w"> </span><span class="n">SBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// SizeBox</span>
<span class="w">        </span><span class="p">.</span><span class="n">HeightOverride</span><span class="p">(</span><span class="n">CurrentHeight</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">WidthOverride</span><span class="p">(</span><span class="n">CurrentWidth</span><span class="p">)</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span><span class="w"> </span><span class="c1">// window background</span>
<span class="w">            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:WindowBackground&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SVerticalBox</span><span class="p">)</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// title</span>
<span class="w">                </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">AutoHeight</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:TitleBackground&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">                        </span><span class="o">+</span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// title text area [image [spacer] TEXT [spacer] image]</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">17.f</span><span class="p">,</span><span class="w"> </span><span class="mf">10.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">                        </span><span class="p">.</span><span class="n">FillWidth</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:TitleRArrow&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SSpacer</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Size</span><span class="p">(</span><span class="n">TitleSpacerSize</span><span class="p">)</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">FillWidth</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// for big text sizes</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFit</span><span class="p">)</span>
<span class="w">                                </span><span class="p">[</span>
<span class="w">                                    </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">WindowTitleBlock</span><span class="p">,</span><span class="w"> </span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:WindowTitle&quot;</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">Justification</span><span class="p">(</span><span class="n">ETextJustify</span><span class="o">::</span><span class="n">Center</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">GetWindowTitle</span><span class="p">())</span>
<span class="w">                                </span><span class="p">]</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SSpacer</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Size</span><span class="p">(</span><span class="n">TitleSpacerSize</span><span class="p">)</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:TitleLArrow&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="c1">// \title text area</span>
<span class="w">                        </span><span class="o">+</span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// close button</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">5.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">                        </span><span class="p">.</span><span class="n">AutoWidth</span><span class="p">()</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBox</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">WidthOverride</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HeightOverride</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// scale button to fit</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFit</span><span class="p">)</span>
<span class="w">                                </span><span class="p">[</span>
<span class="w">                                    </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">CloseButton</span><span class="p">,</span><span class="w"> </span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">ButtonStyle</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:CloseButton&quot;</span><span class="p">)</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_OnCloseClicked</span><span class="p">)</span><span class="w"> </span><span class="c1">// redirect event</span>
<span class="w">                                    </span><span class="p">.</span><span class="n">ContentPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">})</span><span class="w"> </span><span class="c1">// remove content padding</span>
<span class="w">                                    </span><span class="p">[</span>
<span class="w">                                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                                        </span><span class="p">.</span><span class="n">DesiredSizeOverride</span><span class="p">(</span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">32.f</span><span class="p">,</span><span class="w"> </span><span class="mf">32.f</span><span class="p">})</span>
<span class="w">                                        </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:CloseWindowImage&quot;</span><span class="p">))</span>
<span class="w">                                    </span><span class="p">]</span>
<span class="w">                                </span><span class="p">]</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span><span class="c1">// \title</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// content</span>
<span class="w">                </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">FillHeight</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Content</span><span class="p">.</span><span class="n">Widget</span><span class="w"> </span><span class="c1">// content goes here</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// footer</span>
<span class="w">                </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">AutoHeight</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="w"> </span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="w"> </span><span class="p">})</span>
<span class="w">                </span><span class="p">[</span>

<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBox</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HeightOverride</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFit</span><span class="p">)</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SImage</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:FooterImage&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// resize button</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Bottom</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Right</span><span class="p">)</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBox</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HeightOverride</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">WidthOverride</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">ButtonStyle</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:ResizeButton&quot;</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">ContentPadding</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">                            </span><span class="p">[</span>
<span class="w">                                </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">ResizeWidget</span><span class="p">,</span><span class="w"> </span><span class="n">SImage</span><span class="p">)</span><span class="w"> </span><span class="c1">// in SButton event OnMouseDown somehow don&#39;t work, only click works, so i have to use Image to detect mousee events instead</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:ResizeImage&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">]</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span><span class="w"> </span><span class="c1">// \ resize button</span>
<span class="w">                </span><span class="p">]</span><span class="w"> </span><span class="c1">// \ footer</span>
<span class="w">            </span><span class="p">]</span><span class="w"> </span><span class="c1">// \ window background, this is why declarative syntax sucks</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">];</span>
<span class="w">    </span><span class="c1">// bind drag functionality</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">WindowTitleBlock</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowTitleBlock</span><span class="o">-&gt;</span><span class="n">SetOnMouseButtonDown</span><span class="p">(</span><span class="n">FPointerEventHandler</span><span class="o">::</span><span class="n">CreateSP</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">OnTitleMouseButtonDown</span><span class="p">));</span>
<span class="w">        </span><span class="n">WindowTitleBlock</span><span class="o">-&gt;</span><span class="n">SetOnMouseButtonUp</span><span class="p">(</span><span class="n">FPointerEventHandler</span><span class="o">::</span><span class="n">CreateSP</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">OnTitleMouseButtonUp</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// bind resize functionality</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ResizeWidget</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ResizeWidget</span><span class="o">-&gt;</span><span class="n">SetOnMouseButtonDown</span><span class="p">(</span><span class="n">FPointerEventHandler</span><span class="o">::</span><span class="n">CreateSP</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">OnResizeMouseButtonDown</span><span class="p">));</span>
<span class="w">        </span><span class="n">ResizeWidget</span><span class="o">-&gt;</span><span class="n">SetOnMouseButtonUp</span><span class="p">(</span><span class="n">FPointerEventHandler</span><span class="o">::</span><span class="n">CreateSP</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">OnResizeMouseButtonUp</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnRootMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EKeys</span><span class="o">::</span><span class="n">LeftMouseButton</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StopWindowDrag</span><span class="p">();</span>
<span class="w">        </span><span class="n">StopWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::OnRootMouseLeave</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EKeys</span><span class="o">::</span><span class="n">LeftMouseButton</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StopWindowDrag</span><span class="p">();</span>
<span class="w">        </span><span class="n">StopWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnResizeMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EKeys</span><span class="o">::</span><span class="n">LeftMouseButton</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">StartWindowResize</span><span class="p">();</span><span class="w"> </span><span class="c1">// will start resize</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnResizeMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">StopWindowResize</span><span class="p">();</span><span class="w"> </span><span class="c1">// stop resize</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="n">Result</span><span class="p">.</span><span class="n">ClearUserFocus</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnTitleMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EKeys</span><span class="o">::</span><span class="n">LeftMouseButton</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">StartWindowDrag</span><span class="p">();</span><span class="w"> </span><span class="c1">// will start drag</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnTitleMouseButtonUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">StopWindowDrag</span><span class="p">();</span><span class="w"> </span><span class="c1">// will stop drag</span>
<span class="w">    </span><span class="n">FReply</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="n">Result</span><span class="p">.</span><span class="n">ClearUserFocus</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*FReply SGameWindow::OnMouseButtonDown(const FGeometry&amp; MyGeometry, const FPointerEvent&amp; MouseEvent)</span>
<span class="cm">{</span>
<span class="cm">    UE_LOG(LogTemp, Warning, TEXT(&quot;[SGameWindow] Mouse Down Key = %s&quot;), *MouseEvent.GetEffectingButton().ToString())</span>
<span class="cm">    if (MouseEvent.GetEffectingButton() == EKeys::LeftMouseButton)</span>
<span class="cm">    {</span>
<span class="cm">        return FReply::Handled().DetectDrag(SharedThis(this), EKeys::LeftMouseButton);</span>
<span class="cm">    }</span>
<span class="cm">    return FReply::Unhandled();</span>
<span class="cm">}</span>
<span class="cm">FReply SGameWindow::OnMouseMove(const FGeometry&amp; MyGeometry, const FPointerEvent&amp; MouseEvent)</span>
<span class="cm">{</span>
<span class="cm">    return FReply::Handled();</span>
<span class="cm">}</span>
<span class="cm">FReply SGameWindow::OnKeyDown(const FGeometry&amp; MyGeometry, const FKeyEvent&amp; InKeyEvent)</span>
<span class="cm">{</span>
<span class="cm">    UE_LOG(LogTemp, Warning, TEXT(&quot;[SGameWindow] KeyDown Key = %s&quot;), *InKeyEvent.GetKey().ToString())</span>
<span class="cm">    return FReply::Handled();</span>
<span class="cm">}</span>
<span class="cm">int32 SGameWindow::Paint(const FPaintArgs&amp; Args, const FGeometry&amp; AllottedGeometry, const FSlateRect&amp; MyCullingRect, FSlateWindowElementList&amp; OutDrawElements, int32 LayerId, const FWidgetStyle&amp; InWidgetStyle, bool bParentEnabled) const</span>
<span class="cm">{</span>
<span class="cm">    return Super::OnPaint(Args, AllottedGeometry, MyCullingRect, OutDrawElements, LayerId, InWidgetStyle, bParentEnabled);</span>
<span class="cm">}</span>
<span class="cm">void SGameWindow::OnArrangeChildren(const FGeometry&amp; AllottedGeometry, FArrangedChildren&amp; ArrangedChildren) const {</span>
<span class="cm">    Super::OnArrangeChildren(AllottedGeometry, ArrangedChildren); // call parent</span>
<span class="cm">}</span>
<span class="cm">*/</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::OnMouseEnter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// don&#39;t clear focus if any of window on the canvas currently resized or dragged</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">GameWindows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetAllGameWindowsOnCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SGameWindow</span><span class="o">*</span><span class="w"> </span><span class="n">Wnd</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">GameWindows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Wnd</span><span class="o">-&gt;</span><span class="n">isDrag</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Wnd</span><span class="o">-&gt;</span><span class="n">isResize</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">SetFocusToWindow</span><span class="p">();</span><span class="w"> </span><span class="c1">// Set focus to widget once mouse is entered it</span>
<span class="w">    </span><span class="c1">// move currently working window to top of the canvas z-order</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">HOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetHighestZOrder</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HOrder</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GetCanvasSlot</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetZOrder</span><span class="p">(</span><span class="n">GetHighestZOrder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::Tick</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">InCurrentTime</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">InDeltaTime</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">ProcessWindowDrag</span><span class="p">();</span>
<span class="w">    </span><span class="n">ProcessWindowResize</span><span class="p">();</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">InCurrentTime</span><span class="p">,</span><span class="w"> </span><span class="n">InDeltaTime</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// will initiate resize sequence</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::StartWindowResize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isDrag</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// exit from previous state</span>
<span class="w">        </span><span class="n">StopWindowDrag</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas so we can&#39;t be dragged</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">InitialAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetAnchors</span><span class="p">();</span>
<span class="w">    </span><span class="n">TargetAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">;</span>
<span class="w">    </span><span class="n">InitialWindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowSizeBox</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// save initial cursor position</span>
<span class="w">    </span><span class="n">InitialMousePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">ResizeMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] Resize Started&quot;</span><span class="p">))</span>
<span class="p">}</span>
<span class="c1">// will update window position on the canvas according to cursro movement</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::ProcessWindowResize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isResize</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">ParentCanvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ParentCanvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// canvas size x, y in actual resolution i.t. 1024 x 860</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CanvasSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ParentCanvas</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">WindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialWindowSize</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// canvas slot position on each axis described by float number from 0.0 to 1.0</span>
<span class="w">    </span><span class="c1">// get window size in scope of 0 to 1 where 1 is full window resolution on axis</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">WinAnchorOffsetX</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">WinAnchorOffsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// depending on anchors setup we need to pick different offsets</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.5f, 0.5f }) widget offset to the corner will me WindowSize.X/2</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.3f, 0.3f, 0.6, 0.7 }) widget offset to the corner will valy from 0 on top to at bottom WindowSize.X</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// top corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetXMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span><span class="w"> </span><span class="c1">// bottom corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetYMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Mouse Delta is distance of mouse movement from drag start point to current point in 0 - 1 scope</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">MouseDelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialMousePosition</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// get current local size, since offsets set in local (not transformed) screen size</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ParentCanvas</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetLocalSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">FGameWindowSizeLimits</span><span class="w"> </span><span class="n">WindowLimits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetWindowSizeLimits</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// convert limit values to canvas space, which is from 0 to 1</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">LimitsOffsetXMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MinWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">LimitsOffsetYMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MinHeight</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">LimitsOffsetXMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MaxWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">LimitsOffsetYMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MaxHeight</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">SizeMinX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">SizeMaxX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// this is important part.</span>
<span class="w">    </span><span class="c1">// if you set window size via anchors like so: .Anchors(FAnchors{ 0.3f, 0.3f, 0.6, 0.7 })</span>
<span class="w">    </span><span class="c1">// window size on canvas sometimes becase bigger than size, set in the limits</span>
<span class="w">    </span><span class="c1">// so we sync max size in limits with current canvas window size, to fix scaling bug in this exact case</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">XSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">XSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LimitsOffsetXMax</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MaxWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XSize</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span><span class="w"> </span><span class="c1">// update maximum limit</span>
<span class="w">        </span><span class="n">SetWindowSizeLimits</span><span class="p">(</span><span class="n">WindowLimits</span><span class="p">);</span><span class="w"> </span><span class="c1">// to use boolean or to call it twise, this is a question</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">YSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">YSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LimitsOffsetYMax</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">WindowLimits</span><span class="p">.</span><span class="n">MaxHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">YSize</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CanvasLocalSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span><span class="w"> </span><span class="c1">// update maximum limit</span>
<span class="w">        </span><span class="n">SetWindowSizeLimits</span><span class="p">(</span><span class="n">WindowLimits</span><span class="p">);</span><span class="w"> </span><span class="c1">// to use boolean or to call it twise, this is a question</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Check limits</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="n">SizeMaxX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SizeMinX</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LimitsOffsetXMax</span><span class="w">  </span><span class="c1">// max size limit</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">SizeMaxX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SizeMinX</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LimitsOffsetXMin</span><span class="w"> </span><span class="c1">// min size limit</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">SizeMaxX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0f</span><span class="w"> </span><span class="c1">// 1 is screen max size in canvas space</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SizeMinX</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SizeMaxX</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">SizeMinY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">SizeMaxY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span>
<span class="w">    </span><span class="p">(</span><span class="n">SizeMaxY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SizeMinY</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LimitsOffsetYMax</span><span class="w"> </span><span class="c1">// max size limit</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">SizeMaxY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SizeMinY</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LimitsOffsetYMin</span><span class="w"> </span><span class="c1">// min size limit</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">SizeMaxY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0f</span><span class="w"> </span><span class="c1">// 1 is screen max size in canvas space</span>
<span class="w">    </span><span class="p">){</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SizeMinY</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SizeMaxY</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">SetAnchors</span><span class="p">(</span><span class="n">TargetAnchors</span><span class="p">);</span>
<span class="w">    </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// will initiate drag sequence</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::StartWindowDrag</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isResize</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">StopWindowResize</span><span class="p">();</span><span class="w"> </span><span class="c1">// exit from previous state</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas so we can&#39;t be dragged</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">InitialAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetAnchors</span><span class="p">();</span>
<span class="w">    </span><span class="n">TargetAnchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// save initial cursor position</span>
<span class="w">    </span><span class="n">InitialMousePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">DragMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will update window position on the canvas according to cursro movement</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::ProcessWindowDrag</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isDrag</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// canvas size x, y in actual resolution i.t. 1024 x 860</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CanvasSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">WindowSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowSizeBox</span><span class="o">-&gt;</span><span class="n">GetCachedGeometry</span><span class="p">().</span><span class="n">GetAbsoluteSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// canvas slot position on each axis described by float number from 0.0 to 1.0</span>
<span class="w">    </span><span class="c1">// get window size in scope of 0 to 1 where 1 is full window resolution on axis</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// depending on anchors setup we need to pick different offsets</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.5f, 0.5f }) widget offset to the corner will me WindowSize.X/2</span>
<span class="w">    </span><span class="c1">// if .Anchors(FAnchors{ 0.3f, 0.3f, 0.6, 0.7 }) widget offset to the corner will valy from 0 on top to at bottom WindowSize.X</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// top corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetXMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span><span class="w"> </span><span class="c1">// bottom corner offset</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">AnchorOffsetYMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WindowSize</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Mouse Delta is distance of mouse movement from drag start point to current point in 0 - 1 scope</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">MouseDelta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">InitialMousePosition</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CanvasSize</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// check bounds</span>
<span class="w">    </span><span class="c1">// if our new window position on canvas &gt; than maximum possible (1) then we don&#39;t move window</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetXMax</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.f</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span><span class="w"> </span><span class="p">){</span>
<span class="w">        </span><span class="c1">// move slot by mouse delta</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AnchorOffsetYMax</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.f</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AnchorOffsetY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Minimum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">        </span><span class="n">TargetAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InitialAnchors</span><span class="p">.</span><span class="n">Maximum</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// apply offsets</span>
<span class="w">    </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">SetAnchors</span><span class="p">(</span><span class="n">TargetAnchors</span><span class="p">);</span>
<span class="w">    </span><span class="n">Invalidate</span><span class="p">(</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Layout</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// will return FSlot object, related to our Window on SConstraintCanvas</span>
<span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="nf">SGameWindow::GetCanvasSlot</span><span class="p">(){</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">    </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetSlotAt</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetWidget</span><span class="p">().</span><span class="n">Get</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if slot widget is our current window - then slot is our window slot</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Slot</span><span class="p">;</span><span class="w"> </span><span class="c1">// return found slot</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// nothing found</span>
<span class="p">}</span>
<span class="c1">// will return FSlot object, related to our Window on SConstraintCanvas</span>
<span class="n">int32</span><span class="w"> </span><span class="nf">SGameWindow::GetHighestZOrder</span><span class="p">(){</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">    </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetSlotAt</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetZOrder</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetZOrder</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// take care of int size limits. It&#39;s impossible to reach them, using widgets because your pc memory will fill up, but...</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will set keyboard focus to current window</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::SetFocusToWindow</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">IsInitialized</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">SupportsKeyboardFocus</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FWidgetPath</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">FindPathToWidget</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">AsShared</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Visible</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Apply user focus</span>
<span class="w">    </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">SetUserFocus</span><span class="p">(</span><span class="n">Controller</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControllerId</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EFocusCause</span><span class="o">::</span><span class="n">Mouse</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
</code></pre></div>
<h3 id="gamewindowstyleseth"><code>GameWindowStyleSet.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/ISlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyleRegistry.h&quot;</span><span class="c1"> // to register our styles in</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="c1">// Core Style include files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/CoreStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateTypes.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/AppStyle.h&quot;</span>
<span class="c1">// Style set - collection of slate styles</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FGameWindowStyleSet</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateStyleSet</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// style set name</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// here we will store our style instance in Inst variable</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">Get</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// here we will unregister our style instance</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// destructor</span>
<span class="w">    </span><span class="o">~</span><span class="n">FGameWindowStyleSet</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// this method should form relative path to assets of the plugin / module</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="nf">InContent</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="o">&amp;</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ANSICHAR</span><span class="o">*</span><span class="w"> </span><span class="n">Extension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this is how it should work with plugins:</span>
<span class="w">        </span><span class="c1">//static FString ContentDir = IPluginManager::Get().FindPlugin(TEXT(&quot;StateTreeEditorModule&quot;))-&gt;GetContentDir() / TEXT(&quot;Slate&quot;);</span>
<span class="w">        </span><span class="c1">//return (ContentDir / RelativePath) + Extension;</span>
<span class="w">        </span><span class="c1">// since we work with module:</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ContentDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule/Resources/&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ContentDir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Extension</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="w">    </span><span class="n">FGameWindowStyleSet</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FGameWindowStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Inst</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="gamewindowstylesetcpp"><code>GameWindowStyleSet.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/GameWindowStyleSet.h&quot;</span>
<span class="c1">// Singletone default value</span>
<span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FGameWindowStyleSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="c1">// Style name</span>
<span class="n">FName</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">StyleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;GameWindowStyle&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">FGameWindowStyleSet</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">FSlateStyleSet</span><span class="p">(</span><span class="n">StyleName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SetParentStyleName</span><span class="p">(</span><span class="s">&quot;CoreStyle&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">SetCoreContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// --- common variables ---</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">NizhegorodskyFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/ST-Nizhegorodsky&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// --- styles ---</span>
<span class="w">    </span><span class="c1">// custom brushes</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:CloseWindowImage&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;WindowClose_Icon&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">32.f</span><span class="p">,</span><span class="mf">32.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:FooterImage&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Line1&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">600.f</span><span class="p">,</span><span class="mf">50.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:ResizeImage&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;DragWindow&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">200.f</span><span class="p">,</span><span class="mf">200.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:TitleLArrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;UI_Arrow_L&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">32.f</span><span class="p">,</span><span class="mf">32.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:TitleRArrow&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;UI_Arrow_R&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">{</span><span class="mf">32.f</span><span class="p">,</span><span class="mf">32.f</span><span class="p">},</span>
<span class="w">                                </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:TitleBackground&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="s">&quot;Brush:TitleBackground&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                                </span><span class="n">FLinearColor</span><span class="p">{</span><span class="w"> </span><span class="mf">0.35</span><span class="p">,</span><span class="w"> </span><span class="mf">0.27f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.084f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.084f</span><span class="w"> </span><span class="p">}</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:WindowBackground&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                </span><span class="s">&quot;Brush:WindowBackground&quot;</span><span class="p">,</span>
<span class="w">                                </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                                </span><span class="n">FLinearColor</span><span class="p">{</span><span class="mf">0.005f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.005f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.005f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">}</span>
<span class="w">                            </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush loads font Bitter-Light.ttf from Resources folder of the module</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:WindowTitleFont&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">NizhegorodskyFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// override existing styles</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TitleTBStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">NizhegorodskyFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:WindowTitle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TitleTBStyle</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// buttons:</span>
<span class="w">        </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">CloseButtonStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetWidgetStyle</span><span class="o">&lt;</span><span class="n">FButtonStyle</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;SimpleButton&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">CloseButtonStyle</span><span class="p">.</span><span class="n">Pressed</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:CloseButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CloseButtonStyle</span><span class="p">);</span>
<span class="w">        </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">ResizeButtonStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetWidgetStyle</span><span class="o">&lt;</span><span class="n">FButtonStyle</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;InvisibleButton&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:ResizeButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ResizeButtonStyle</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// register style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">RegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// destructor</span>
<span class="n">FGameWindowStyleSet</span><span class="o">::~</span><span class="n">FGameWindowStyleSet</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// unregister style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">UnRegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// initialize static pointer</span>
<span class="k">const</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Inst</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// make class instance and store is as static</span>
<span class="w">        </span><span class="c1">// *note - this also calls constructor, where RegisterSlateStyle is called</span>
<span class="w">        </span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FGameWindowStyleSet</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">FGameWindowStyleSet</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear unique pointer</span>
<span class="w">    </span><span class="c1">// *note - this will also call destructor, where UnRegisterSlateStyle is called</span>
<span class="w">    </span><span class="n">Inst</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="sgamescreenwidgeth"><code>SGameScreenWidget.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span><span class="c1"> // SCompoundWidget widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/PlayerController.h&quot;</span><span class="c1"> // Player Controller</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Layout/LayoutUtils.h&quot;</span><span class="c1"> // to be used in OnArrangeChildren</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/Attribute.h&quot;</span><span class="c1"> // TSlateAttribute</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SConstraintCanvas.h&quot;</span><span class="c1"> // SConstraintCanvas widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SUniformGridPanel.h&quot;</span><span class="c1"> // SUniformGridPanel widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Notifications/SProgressBar.h&quot;</span><span class="c1"> // SProgressBar widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Text/STextBlock.h&quot;</span><span class="c1"> // STextBlock widget</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/DeclarativeSyntaxSupport.h&quot;</span><span class="c1"> // SNew, SLATE_SLOT_ARGUMENT</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SlateControlledConstruction.h&quot;</span><span class="c1"> // SLATE_DECLARE_WIDGET</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SScaleBox.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/Layout/SScrollBox.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SGameWindow.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SImageButtonWidget.h&quot;</span><span class="c1"> // Image Button</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SBorderedUniformGrid.h&quot;</span><span class="c1"> // Bordered Grid</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;SGameScreenWidgetNamespace&quot; </span><span class="c1">// to use FText</span>
<span class="cm">/**</span>
<span class="cm"> * Game Screen Widget</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// Default values for arguments</span>
<span class="w">        </span><span class="n">_CharacterName</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;CharacterNameReplacer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hero&quot;</span><span class="p">)),</span>
<span class="w">        </span><span class="c1">// Input Attribute default values</span>
<span class="w">        </span><span class="n">_Health</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">_MaxHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">_Stamina</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">_MaxStamina</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">        </span><span class="p">{}</span>
<span class="w">        </span><span class="c1">// Arguments</span>
<span class="w">        </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">FText</span><span class="p">,</span><span class="w"> </span><span class="n">CharacterName</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ARGUMENT</span><span class="p">(</span><span class="n">APlayerController</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerController</span><span class="p">)</span><span class="w"> </span><span class="c1">// args that dosen&#39;t have default value - always should be sed during widget construction</span>
<span class="w">        </span><span class="c1">// Events</span>
<span class="w">        </span><span class="n">SLATE_EVENT</span><span class="p">(</span><span class="n">FSimpleDelegate</span><span class="p">,</span><span class="w"> </span><span class="n">ButtonPressEvent</span><span class="p">)</span><span class="w"> </span><span class="c1">// SimpleDelegate event</span>
<span class="w">        </span><span class="c1">// Input Attributes</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Stamina</span><span class="p">)</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStamina</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="n">SGameScreenWidget</span><span class="p">()</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// Define TSlateAttribute default values here</span>
<span class="w">        </span><span class="c1">// Order Matters!</span>
<span class="w">        </span><span class="c1">// for ALL of them, or will be error</span>
<span class="w">        </span><span class="n">CurrentHealthAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">MaxHealthAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">CurrentStaminaAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">        </span><span class="n">MaxStaminaAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// Constructs this widget with InArgs</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getters / Setters</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetHealth</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CurrentHealthAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetMaxHealth</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">MaxHealthAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewHealth</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return health in %</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetHealthPercent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will update health percent</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateHealth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HealthProgressBar</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">GetHealthPercent</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetStamina</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CurrentStaminaAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetStamina</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetMaxStamina</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">MaxStaminaAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">NewStamina</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetMaxStamina</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return stamina in %</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetStaminaPercent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetStamina</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxStamina</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will update stamina percent</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateStamina</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StaminaProgressBar</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">StaminaProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">GetStaminaPercent</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// SWidget Overrides</span>
<span class="w">    </span><span class="c1">// Called every widget re-paint</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="nf">OnPaint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPaintArgs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateRect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span>
<span class="w">                            </span><span class="n">FSlateWindowElementList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span>
<span class="w">                            </span><span class="n">int32</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FWidgetStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">bool</span><span class="w"> </span><span class="n">bParentEnabled</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Recomputes the volatility of the widget.</span>
<span class="w">    </span><span class="c1">// Will force Layout recalculation, for example after adding child widgets</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ComputeVolatility</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">ComputeVolatility</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Events like OnKeyDown, OnKeyUp and all others related to keyboard won&#39;t work without this</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">SupportsKeyboardFocus</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Attributes</span>
<span class="w">    </span><span class="c1">// Pay Attention to variable order!</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Exposed controls</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SProgressBar</span><span class="o">&gt;</span><span class="w"> </span><span class="n">HealthProgressBar</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SProgressBar</span><span class="o">&gt;</span><span class="w"> </span><span class="n">StaminaProgressBar</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">STextBlock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CharacterNameBlock</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SBorderedUniformGrid</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BorderedGrid</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SBorderedUniformGrid</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InventoryGrid</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InventoryWindow</span><span class="p">;</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SImageButtonWidget</span><span class="o">&gt;</span><span class="w"> </span><span class="n">InventoryButton</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h3 id="sgamescreenwidgetcpp"><code>SGameScreenWidget.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SGameScreenWidget.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/UiSlateStyleSet.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateUIWidgetStyle.h&quot;</span>
<span class="c1">// -----</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/GameplayStatics.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;SGameScreenWidgetCppNamespace&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="nf">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SGameScreenWidget</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SGameScreenWidget</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// this will invalidate widget&#39;s paint once Health is changed</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CurrentHealthAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentHealthAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateHealth</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Health Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MaxHealthAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealthAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateHealth</span><span class="p">();</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CurrentStaminaAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentStaminaAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateStamina</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Stamina Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetStamina</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MaxStaminaAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStaminaAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Track health changes</span>
<span class="w">            </span><span class="n">SGameScreenWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameScreenWidget</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">            </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">UpdateStamina</span><span class="p">();</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Stamina Changed To = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ScreenWidget</span><span class="p">.</span><span class="n">GetStamina</span><span class="p">())</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameScreenWidget::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// DelegateArgument</span>
<span class="w">    </span><span class="n">FSimpleDelegate</span><span class="w"> </span><span class="n">EventArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InArgs</span><span class="p">.</span><span class="n">_ButtonPressEvent</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// assign attributes _Health and _Stamina</span>
<span class="w">    </span><span class="n">SetHealth</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Health</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetMaxHealth</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_MaxHealth</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetStamina</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_Stamina</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetMaxStamina</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_MaxStamina</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Styles</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">ButtonFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;EmbossedText&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">ButtonFont</span><span class="p">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">45</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">NormalFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;NormalFont&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">FSlateFontInfo</span><span class="w"> </span><span class="n">CharacterNameFont</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCoreStyle</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;EmbossedText&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//FSlateFontInfo CharacterNameFont = FCoreStyle::Get().GetWidgetStyle&lt;FSlateUIStyle&gt;(&quot;CharacterNameFont&quot;).TextUiFontInfo;</span>
<span class="w">    </span><span class="n">CharacterNameFont</span><span class="p">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Load Style from file</span>
<span class="w">    </span><span class="n">USlateWidgetStyleAsset</span><span class="o">*</span><span class="w"> </span><span class="n">UiStyleFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadObject</span><span class="o">&lt;</span><span class="n">USlateWidgetStyleAsset</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/SlateCore.SlateWidgetStyleAsset&#39;/Game/UI/Styles/MyWidgetStyle.MyWidgetStyle&#39;&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// On &quot;+&quot; button click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">OnIncreaseHealth</span><span class="p">;</span>
<span class="w">    </span><span class="n">OnIncreaseHealth</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">EventArgs</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">EventArgs</span><span class="p">.</span><span class="n">ExecuteIfBound</span><span class="p">();</span><span class="w"> </span><span class="c1">// call argument event</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Health1P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1% of health</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NewHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5.f</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">GetMaxHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">SetHealth</span><span class="p">(</span><span class="n">NewHealth</span><span class="p">);</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">Percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Health1P</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">            </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">Percent</span><span class="p">);</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Health Increased %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">GetHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// On &quot;-&quot; button click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">OnDecreaseHealth</span><span class="p">;</span>
<span class="w">    </span><span class="n">OnDecreaseHealth</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Health1P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">GetMaxHealth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1% of health</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NewHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5.f</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">){</span>
<span class="w">            </span><span class="n">SetHealth</span><span class="p">(</span><span class="n">NewHealth</span><span class="p">);</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">Percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NewHealth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Health1P</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">            </span><span class="n">HealthProgressBar</span><span class="o">-&gt;</span><span class="n">SetPercent</span><span class="p">(</span><span class="n">Percent</span><span class="p">);</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameScreenWidget] Health Decreased %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">GetHealth</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// On &quot;-&quot; button click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">OnToggleInventory</span><span class="p">;</span>
<span class="w">    </span><span class="n">OnToggleInventory</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InventoryWindow</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InventoryWindow</span><span class="o">-&gt;</span><span class="n">GetVisibility</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Hidden</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">InventoryWindow</span><span class="o">-&gt;</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Visible</span><span class="p">);</span><span class="w"> </span><span class="c1">// show</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">InventoryWindow</span><span class="o">-&gt;</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Hidden</span><span class="p">);</span><span class="w"> </span><span class="c1">// hide</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// Close Inventory click</span>
<span class="w">    </span><span class="n">FOnClicked</span><span class="w"> </span><span class="n">OnCloseInventory</span><span class="p">;</span>
<span class="w">    </span><span class="n">OnCloseInventory</span><span class="p">.</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">InventoryWindow</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()){</span>
<span class="w">                </span><span class="n">InventoryWindow</span><span class="o">-&gt;</span><span class="n">SetVisibility</span><span class="p">(</span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Hidden</span><span class="p">);</span><span class="w"> </span><span class="c1">// hide</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// Bind key 2 to perform Grid Panel Tests</span>
<span class="w">    </span><span class="cm">/*FInputKeyBinding KB2 = FInputKeyBinding(EKeys::Two, EInputEvent::IE_Pressed);</span>
<span class="cm">    KB2.KeyDelegate.GetDelegateForManualSet().BindLambda([this]() {</span>
<span class="cm">            // Slot border change Test</span>
<span class="cm">            auto Slot = BorderedGrid-&gt;GetSlotAt(1, 2);</span>
<span class="cm">            if(Slot == nullptr) return;</span>
<span class="cm">            FString Str = Slot-&gt;GetCurrentBorderSettings().BorderImageBrush-&gt;TintColor.GetSpecifiedColor().ToString();</span>
<span class="cm">            Slot-&gt;SetCurrentBorderSettings({</span>
<span class="cm">                    true,</span>
<span class="cm">                    { 2.f, 2.f },</span>
<span class="cm">                    new FSlateImageBrush{</span>
<span class="cm">                        TEXT( &quot;SBorderedUniformGrid::greencolor&quot; ),</span>
<span class="cm">                        FVector2D{ 120.f, 120.f },</span>
<span class="cm">                        FLinearColor::Green</span>
<span class="cm">                    }</span>
<span class="cm">                });</span>
<span class="cm">            Slot-&gt;UpdateBorderSettings(); // apply changes</span>
<span class="cm">            // Widget Slot Data Replace Test</span>
<span class="cm">            // will put data into slot</span>
<span class="cm">            TSharedPtr&lt;STextBlock&gt; TxtBlock = SNew(STextBlock).Text(FText::FromString(&quot;Test&quot;)).ColorAndOpacity(FLinearColor::Black);</span>
<span class="cm">            // will clear content and replace it with new data</span>
<span class="cm">            BorderedGrid-&gt;ReplaceSlotAt(0,0, TxtBlock, {true,</span>
<span class="cm">                {7.f,7.f},</span>
<span class="cm">                new FSlateImageBrush{</span>
<span class="cm">                    TEXT(&quot;SBorderedUniformGrid::greencolor1&quot;),</span>
<span class="cm">                    FVector2D{ 1.f, 1.f },</span>
<span class="cm">                    FLinearColor::White</span>
<span class="cm">                }</span>
<span class="cm">            });</span>
<span class="cm">            // will test grid filling</span>
<span class="cm">            BorderedGrid-&gt;FillGrid(24, 4, false, SBorderedUniformGrid::FSlotBorderSettings{</span>
<span class="cm">                        true,</span>
<span class="cm">                        {5.f, 5.f}</span>
<span class="cm">                    });</span>
<span class="cm">            UE_LOG(LogTemp, Warning, TEXT(&quot;Slot Color = %s&quot;), *Str);</span>
<span class="cm">        });</span>
<span class="cm">    InArgs._PlayerController-&gt;InputComponent-&gt;KeyBindings.Emplace(MoveTemp(KB2));*/</span>
<span class="w">    </span><span class="n">ChildSlot</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="p">)</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// character window</span>
<span class="w">            </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="w"> </span><span class="p">})</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_PlayerController</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">WindowTitle</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Character Info&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Here will be your character info.&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// inventory</span>
<span class="w">            </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.8f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.99f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.94f</span><span class="w"> </span><span class="p">})</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">InventoryWindow</span><span class="p">,</span><span class="w"> </span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Visibility</span><span class="p">(</span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Hidden</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">PlayerController</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_PlayerController</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">OnCloseClicked</span><span class="p">(</span><span class="n">OnCloseInventory</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">WindowTitle</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Inventory&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScrollBox</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Orientation</span><span class="p">(</span><span class="n">EOrientation</span><span class="o">::</span><span class="n">Orient_Vertical</span><span class="p">)</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SScrollBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SScaleBox</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Stretch</span><span class="p">(</span><span class="n">EStretch</span><span class="o">::</span><span class="n">ScaleToFitX</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">InventoryGrid</span><span class="p">,</span><span class="w"> </span><span class="n">SBorderedUniformGrid</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">MinDesiredSlotWidth</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">MinDesiredSlotHeight</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">InitialGridSize</span><span class="p">({</span><span class="mf">7.f</span><span class="p">,</span><span class="w"> </span><span class="mf">8.f</span><span class="p">})</span><span class="w"> </span><span class="c1">// fill initial slots in grid of 7 x 8</span>
<span class="w">                            </span><span class="p">.</span><span class="n">SlotPadding</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">2.f</span><span class="p">})</span>
<span class="w">                            </span><span class="p">.</span><span class="n">DefaultBorderSettings</span><span class="p">(</span>
<span class="w">                                </span><span class="n">SBorderedUniformGrid</span><span class="o">::</span><span class="n">FSlotBorderSettings</span><span class="p">{</span>
<span class="w">                                    </span><span class="nb">true</span><span class="p">,</span>
<span class="w">                                    </span><span class="p">{</span><span class="mf">5.f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.f</span><span class="p">},</span>
<span class="w">                                    </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:SlotImageBrush&quot;</span><span class="p">),</span>
<span class="w">                                </span><span class="p">}</span>
<span class="w">                            </span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span><span class="w"> </span><span class="c1">// \SScrollBox</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// inventory button</span>
<span class="w">            </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.8f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.944f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9</span><span class="p">,</span><span class="w"> </span><span class="mf">0.99</span><span class="w"> </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">InventoryButton</span><span class="p">,</span><span class="w"> </span><span class="n">SImageButtonWidget</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">bAllowDefaultImage</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Image</span><span class="p">(</span><span class="w"> </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:InventoryIcon&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnToggleInventory</span><span class="p">)</span><span class="w"> </span><span class="c1">// toggle inventory by pressing this button</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Inventory&quot;</span><span class="p">))</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="w"> </span><span class="mf">0.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.95f</span><span class="w"> </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">10.f</span><span class="p">,</span><span class="w"> </span><span class="mf">15.f</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span>
<span class="w">                    </span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetBrush</span><span class="p">(</span><span class="s">&quot;Brushes:RoundedDark&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SVerticalBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// tooltips</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Press Key1 To make Health 100%&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;Press Key2 To fill grid with slots and change slot borders in runtime&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">.</span><span class="n">ColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="cm">/* + SConstraintCanvas::Slot()</span>
<span class="cm">            .Anchors(FAnchors{ 0.7f, 0.3f })</span>
<span class="cm">            .AutoSize(true)</span>
<span class="cm">            [</span>
<span class="cm">                SAssignNew(BorderedGrid, SBorderedUniformGrid)</span>
<span class="cm">                .MinDesiredSlotWidth(70)</span>
<span class="cm">                .MinDesiredSlotHeight(70)</span>
<span class="cm">                .InitialGridSize({3.f,3.f}) // fill initial slots in grix of 3 x 3</span>
<span class="cm">                .SlotPadding(FMargin{2.f})</span>
<span class="cm">                .DefaultBorderSettings(SBorderedUniformGrid::FSlotBorderSettings{</span>
<span class="cm">                    true,</span>
<span class="cm">                    {5.f, 5.f},</span>
<span class="cm">                    //&amp;(UiStyleFile-&gt;GetStyle&lt;FSlateUIStyle&gt;()-&gt;SlotBorderBrush)</span>
<span class="cm">                    FUiSlateStyleSet::Get().GetBrush(&quot;Brushes:SlotImageBrush&quot;),</span>
<span class="cm">                    //FUiSlateStyleSet::Get().GetBrush(&quot;Icons.Cross&quot;), // since our parent style is CoreStyle, we can use it&#39;s definitions here</span>
<span class="cm">                    /*new FSlateImageBrush{ // old code, won&#39;t delete, it works and serves as another example</span>

<span class="cm">                        Cast&lt;UMaterialInstance&gt;(StaticLoadObject(UMaterialInstance::StaticClass(), NULL,</span>
<span class="cm">                        TEXT(&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;))),</span>
<span class="cm">                        FVector2D{120.f, 120.f},</span>
<span class="cm">                        FLinearColor::White // Default Slot tint color is White</span>
<span class="cm">                    }*\/</span>
<span class="cm">                })</span>
<span class="cm">                // 0</span>
<span class="cm">                + SBorderedUniformGrid::Slot(0,0)</span>
<span class="cm">                [</span>
<span class="cm">                    SNew(SImage)</span>
<span class="cm">                    .ColorAndOpacity(FLinearColor::Blue)</span>
<span class="cm">                ]</span>
<span class="cm">                // 1</span>
<span class="cm">                + SBorderedUniformGrid::Slot(1,1, { // this slot has overriden border color</span>
<span class="cm">                    true,</span>
<span class="cm">                    { 5.f, 5.f },</span>
<span class="cm">                    new FSlateImageBrush{</span>
<span class="cm">                        TEXT(&quot;SBorderedUniformGrid::Slot2&quot;),</span>
<span class="cm">                        FVector2D{120.f, 120.f},</span>
<span class="cm">                        FLinearColor::Red // this slot border color will be Red</span>
<span class="cm">                    }</span>
<span class="cm">                })</span>
<span class="cm">                [</span>
<span class="cm">                    SNew(SImage)</span>
<span class="cm">                    .ColorAndOpacity(FLinearColor::Blue)</span>
<span class="cm">                ]</span>
<span class="cm">                // 2</span>
<span class="cm">                + SBorderedUniformGrid::Slot(1,2, { // this is slot with border, but without content, but bg color is overriden</span>
<span class="cm">                    true,</span>
<span class="cm">                    {5.f, 5.f},</span>
<span class="cm">                    new FSlateImageBrush{</span>
<span class="cm">                        TEXT(&quot;SBorderedUniformGrid::Slot3&quot;),</span>
<span class="cm">                        FVector2D{120.f, 120.f},</span>
<span class="cm">                        FLinearColor::Black // this slot will be totally black witout any content</span>
<span class="cm">                    }</span>
<span class="cm">                })</span>
<span class="cm">                .HAlign(HAlign_Fill)</span>
<span class="cm">                /*[ // no content in this slot!</span>
<span class="cm">                    SNew(SImage)</span>
<span class="cm">                    .ColorAndOpacity(FLinearColor::Blue)</span>
<span class="cm">                ]*\/</span>
<span class="cm">                // 3</span>
<span class="cm">                +SBorderedUniformGrid::Slot(2, 2) // this is slot with border, but without content, with default bg color</span>
<span class="cm">                .HAlign(HAlign_Fill)</span>
<span class="cm">                // 4</span>
<span class="cm">                + SBorderedUniformGrid::Slot(3,3)</span>
<span class="cm">                .HAlign(HAlign_Fill)</span>
<span class="cm">                [</span>
<span class="cm">                    SNew(SImage)</span>
<span class="cm">                    .ColorAndOpacity(FLinearColor::Blue)</span>
<span class="cm">                ]</span>
<span class="cm">            ]*/</span>
<span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">Anchors</span><span class="p">(</span><span class="n">FAnchors</span><span class="p">{</span><span class="mf">0.02f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.02f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.23f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.19f</span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="n">AutoSize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
<span class="w">            </span><span class="p">[</span>
<span class="w">                </span><span class="n">SNew</span><span class="p">(</span><span class="n">SBorder</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">5.0f</span><span class="p">)</span><span class="w"> </span><span class="c1">// offset</span>
<span class="w">                </span><span class="p">.</span><span class="n">BorderImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                    </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CharacterInfoBorder&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// here comes image path, but we need only the color of brush, image is unnecessary</span>
<span class="w">                    </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                    </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">),</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">Both</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ESlateBrushImageType</span><span class="o">::</span><span class="n">FullColor</span><span class="w"> </span><span class="c1">// draw as</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="n">SNew</span><span class="p">(</span><span class="n">SVerticalBox</span><span class="p">)</span><span class="w"> </span><span class="c1">// health</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span><span class="w"> </span><span class="c1">// overlay text over progress bar</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">HealthProgressBar</span><span class="p">,</span><span class="w"> </span><span class="n">SProgressBar</span><span class="p">)</span><span class="w"> </span><span class="c1">// Health Bar</span>
<span class="w">                            </span><span class="p">.</span><span class="n">FillColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Gray</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Percent</span><span class="p">(</span><span class="n">GetHealthPercent</span><span class="p">())</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;GameScrreen Health&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Health&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetFontStyle</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">))</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// stamina</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SOverlay</span><span class="p">)</span><span class="w"> </span><span class="c1">// overlay text over progress bar</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Fill</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">StaminaProgressBar</span><span class="p">,</span><span class="w"> </span><span class="n">SProgressBar</span><span class="p">)</span><span class="w"> </span><span class="c1">// Stamina Bar</span>
<span class="w">                            </span><span class="p">.</span><span class="n">FillColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Green</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Percent</span><span class="p">(</span><span class="n">GetStaminaPercent</span><span class="p">())</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SOverlay</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;GameScrreen Stamina&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Stamina&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Margin</span><span class="p">(</span><span class="n">FMargin</span><span class="p">{</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">})</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Font</span><span class="p">(</span><span class="n">NormalFont</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span><span class="w"> </span><span class="c1">// character name</span>
<span class="w">                    </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Fill</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="n">AutoHeight</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SAssignNew</span><span class="p">(</span><span class="n">CharacterNameBlock</span><span class="p">,</span><span class="w"> </span><span class="n">STextBlock</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Justification</span><span class="p">(</span><span class="n">ETextJustify</span><span class="o">::</span><span class="n">Center</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_CharacterName</span><span class="p">)</span><span class="w"> </span><span class="c1">// set character name</span>
<span class="w">                        </span><span class="c1">// override font stylings:</span>
<span class="w">                        </span><span class="c1">//.Font(CharacterNameFont) // classic</span>
<span class="w">                        </span><span class="c1">//.Font(FUiSlateStyleSet::Get().GetFontStyle(&quot;Fonts:BitterBlack32&quot;)) // using font style</span>
<span class="w">                        </span><span class="p">.</span><span class="n">TextStyle</span><span class="p">(</span><span class="n">FUiSlateStyleSet</span><span class="o">::</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;Controls:TextBlock32Big&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// apply custom style</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                    </span><span class="o">+</span><span class="n">SVerticalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                    </span><span class="p">[</span>
<span class="w">                        </span><span class="n">SNew</span><span class="p">(</span><span class="n">SHorizontalBox</span><span class="p">)</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="mf">2.f</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnDecreaseHealth</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="n">SHorizontalBox</span><span class="o">::</span><span class="n">Slot</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="n">Padding</span><span class="p">(</span><span class="mf">4.f</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="p">)</span>
<span class="w">                        </span><span class="p">[</span>
<span class="w">                            </span><span class="n">SNew</span><span class="p">(</span><span class="n">SButton</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">VAlign</span><span class="p">(</span><span class="n">VAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">HAlign</span><span class="p">(</span><span class="n">HAlign_Center</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">))</span>
<span class="w">                            </span><span class="p">.</span><span class="n">OnClicked</span><span class="p">(</span><span class="n">OnIncreaseHealth</span><span class="p">)</span>
<span class="w">                        </span><span class="p">]</span>
<span class="w">                    </span><span class="p">]</span>
<span class="w">                </span><span class="p">]</span><span class="w"> </span><span class="c1">// SBorder</span>
<span class="w">            </span><span class="p">]</span><span class="w"> </span><span class="c1">// SConstraint Canvas</span>
<span class="w">        </span><span class="p">]</span><span class="w"> </span><span class="c1">// ChildSlot</span>
<span class="w">    </span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">// Called every widget re-paint</span>
<span class="n">int32</span><span class="w"> </span><span class="nf">SGameScreenWidget::OnPaint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FPaintArgs</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Args</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateRect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span>
<span class="w">                            </span><span class="n">FSlateWindowElementList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span>
<span class="w">                            </span><span class="n">int32</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">FWidgetStyle</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span>
<span class="w">                            </span><span class="kt">bool</span><span class="w"> </span><span class="n">bParentEnabled</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// we can call Super::OnPaint to paint every visible children</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">OnPaint</span><span class="p">(</span><span class="n">Args</span><span class="p">,</span><span class="w"> </span><span class="n">AllottedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">MyCullingRect</span><span class="p">,</span><span class="w"> </span><span class="n">OutDrawElements</span><span class="p">,</span><span class="w"> </span><span class="n">LayerId</span><span class="p">,</span><span class="w"> </span><span class="n">InWidgetStyle</span><span class="p">,</span><span class="w"> </span><span class="n">bParentEnabled</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h2 id="_20">Сниппеты</h2>
<p>В ходе разработки окна я вывел несколько крайне полезных сниппетов, для работы со <code>Slate</code>.</p>
<h3 id="simple-attribute-boilerplate">Simple Attribute Boilerplate</h3>
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Slate Widget boilerplate with attribute setup</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SWidgetBoilerplate</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SWidgetBoilerplate</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="n">_NumberAttribute</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">NumberAttribute</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// constructor used to set attribute default values</span>
<span class="w">    </span><span class="n">SWidgetBoilerplate</span><span class="p">()</span><span class="o">:</span>
<span class="w">        </span><span class="n">NumberAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="cm">/** Constructs this widget with InArgs */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// attribute setter</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetNumberAttribute</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">inNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NumberAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">inNumber</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// attribute getter</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetNumberAttribute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NumberAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// attributes</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NumberAttribute</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SWidgetBoilerplate.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SWidgetBoilerplate</span><span class="o">::</span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// sync values</span>
<span class="w">    </span><span class="n">SetNumberAttribute</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_NumberAttribute</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    ChildSlot</span>
<span class="cm">    [</span>
<span class="cm">        // Populate the widget</span>
<span class="cm">    ];</span>
<span class="cm">    */</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
</code></pre></div>
<h3 id="complex-attribute-boilerplate">Complex Attribute Boilerplate</h3>
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Widgets/SCompoundWidget.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Slate Widget boilerplate with attribute setup</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLATERUNTIMEMODULE_API</span><span class="w"> </span><span class="n">SWidgetBoilerplate</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SWidgetBoilerplate</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SWidgetBoilerplate</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="n">_NumberAttribute</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">        </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">NumberAttribute</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// constructor used to set attribute default values</span>
<span class="w">    </span><span class="n">SWidgetBoilerplate</span><span class="p">()</span><span class="o">:</span>
<span class="w">        </span><span class="n">NumberAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="cm">/** Constructs this widget with InArgs */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// attribute setter</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetNumberAttribute</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">inNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NumberAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">inNumber</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// attribute getter</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetNumberAttribute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">NumberAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// updater</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateNumberAttribute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">AttributeValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetNumberAttribute</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// do something with value</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// attributes</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NumberAttribute</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SWidgetBoilerplate.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateOptMacros.h&quot;</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="nf">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SWidgetBoilerplate</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SWidgetBoilerplate</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NumberAttribute&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">NumberAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">OnValueChanged</span><span class="p">(</span><span class="n">FSlateAttributeDescriptor</span><span class="o">::</span><span class="n">FAttributeValueChangedDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">([](</span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Widget</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">SWidgetBoilerplate</span><span class="o">&amp;</span><span class="w"> </span><span class="n">inWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SWidgetBoilerplate</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">Widget</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// do something with widget</span>
<span class="w">                </span><span class="n">inWidget</span><span class="p">.</span><span class="n">UpdateNumberAttribute</span><span class="p">();</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="c1">// or simple, since our</span>
<span class="w">    </span><span class="c1">// TSlateAttribute&lt;float,EInvalidateWidgetReason::Paint&gt; NumberAttribute</span>
<span class="w">    </span><span class="c1">// and SLATE_ATTRIBUTE(float, NumberAttribute)</span>
<span class="w">    </span><span class="c1">// share same name</span>
<span class="w">    </span><span class="c1">//SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION(AttributeInitializer, NumberAttribute, EInvalidateWidgetReason::Paint);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SWidgetBoilerplate::Construct</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FArguments</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InArgs</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// sync values</span>
<span class="w">    </span><span class="n">SetNumberAttribute</span><span class="p">(</span><span class="n">InArgs</span><span class="p">.</span><span class="n">_NumberAttribute</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    ChildSlot</span>
<span class="cm">    [</span>
<span class="cm">        // Populate the widget</span>
<span class="cm">    ];</span>
<span class="cm">    */</span>
<span class="p">}</span>
<span class="n">END_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
</code></pre></div>
<h3 id="style-set-boilerplate">Style Set Boilerplate</h3>
<p><div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/ISlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateStyleRegistry.h&quot;</span><span class="c1"> // to register our styles in</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Brushes/SlateImageBrush.h&quot;</span><span class="c1"> // Image Brush</span>
<span class="c1">// Core Style include files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/CoreStyle.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/SlateTypes.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styling/AppStyle.h&quot;</span>
<span class="c1">// Style set - collection of slate styles</span>
<span class="c1">// Just static class, like it&#39;s done here - FProfilerStyle</span>
<span class="c1">//\Engine\Source\Developer\Profiler\Private\ProfilerStyle.h</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FStyleSetBoilerplate</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">FSlateStyleSet</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// style set name</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// here we will store our style instance in Inst variable</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FStyleSetBoilerplate</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">Get</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// here we will unregister our style instance</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// destructor</span>
<span class="w">    </span><span class="o">~</span><span class="n">FStyleSetBoilerplate</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// this method should form relative path to assets of the plugin / module</span>
<span class="w">    </span><span class="c1">// idea taken from \Plugins\Runtime\StateTree\Source\StateTreeEditorModule\Private\StateTreeEditorStyle.cpp</span>
<span class="w">    </span><span class="c1">// (it&#39;s new Mass based Ai State Tree)</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="nf">InContent</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="o">&amp;</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ANSICHAR</span><span class="o">*</span><span class="w"> </span><span class="n">Extension</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this is how it should work with plugins:</span>
<span class="w">        </span><span class="c1">//static FString ContentDir = IPluginManager::Get().FindPlugin(TEXT(&quot;StateTreeEditorModule&quot;))-&gt;GetContentDir() / TEXT(&quot;Slate&quot;);</span>
<span class="w">        </span><span class="c1">//return (ContentDir / RelativePath) + Extension;</span>
<span class="w">        </span><span class="c1">// since we work with module:</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">ContentDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPaths</span><span class="o">::</span><span class="n">GameSourceDir</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateRuntimeModule/Resources/&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ContentDir</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">RelativePath</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Extension</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="w">    </span><span class="n">FStyleSetBoilerplate</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FStyleSetBoilerplate</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Inst</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/StyleSetBoilerplate.h&quot;</span>
<span class="c1">// note* static members of class should be ALVAYS initialized with default value</span>
<span class="c1">// Even if they are in the Private scope (which i did not know)</span>
<span class="c1">// static initialization should be outside of the class</span>
<span class="c1">// or you will get following error:</span>
<span class="c1">// unresolved external symbol &quot;private: static class...etc&quot;</span>
<span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FStyleSetBoilerplate</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="c1">// static for teh style name</span>
<span class="n">FName</span><span class="w"> </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">StyleName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SlateModuleBoilerplateStyles&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="c1">// here we gonna make our styles and load variable Inst</span>
<span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">FStyleSetBoilerplate</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">FSlateStyleSet</span><span class="p">(</span><span class="n">StyleName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// first set the Parent Style</span>
<span class="w">    </span><span class="c1">// Parent Style always loads before our style</span>
<span class="w">    </span><span class="c1">// Inheriting Parent Style will allow us to use all styles, defined in it as our own class styles</span>
<span class="w">    </span><span class="c1">// so, for example &quot;Icons.Cross&quot; defined in core style - FCoreStyle::Get().GetBrush(&quot;Icons.Cross&quot;)</span>
<span class="w">    </span><span class="c1">// will be accessible thru - FStyleSetBoilerplate::Get().GetBrush(&quot;Icons.Cross&quot;)</span>
<span class="w">    </span><span class="c1">// if we inherit from the CoreStyle (and we will do so)</span>
<span class="w">    </span><span class="c1">//*note: since FCoreStyle::StyleName dosen&#39;t exist(it&#39;s very old class), instead just use string, it will work</span>
<span class="w">    </span><span class="c1">//*note2: CoreStyle can be found here - \Source\Runtime\SlateCore\Private\Styling\CoreStyle.cpp</span>
<span class="w">    </span><span class="n">SetParentStyleName</span><span class="p">(</span><span class="s">&quot;CoreStyle&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//*note: if you don&#39;t want all CoreStyle styles - use this instead:</span>
<span class="w">    </span><span class="c1">//SetParentStyleName(FAppStyle::GetAppStyleSetName());</span>
<span class="w">    </span><span class="c1">// this will allow to work with: RootToContentDir(TEXT(&quot;file_name&quot;), TEXT(&quot;.extension&quot;)) to refrence content in the &quot;Root&quot; folder</span>
<span class="w">    </span><span class="c1">// as &quot;Root&quot; we use FPaths::EngineContentDir() / TEXT(&quot;Slate&quot;), because same walue is used in CoreStyle, which is our parent style</span>
<span class="w">    </span><span class="c1">// you can find this directory in engine installataion folder - \Engine\Content\Slate</span>
<span class="w">    </span><span class="n">SetContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// this will allow to work with: RootToCoreContentDir(TEXT(&quot;file_name&quot;), TEXT(&quot;.extension&quot;)) to refrence content in the &quot;Root&quot; folder</span>
<span class="w">    </span><span class="c1">// as &quot;Root&quot; we use FPaths::EngineContentDir() / TEXT(&quot;Slate&quot;), because same walue is used in CoreStyle, which is our parent style</span>
<span class="w">    </span><span class="c1">// you can find this directory in engine installataion folder - \Engine\Content\Slate</span>
<span class="w">    </span><span class="n">SetCoreContentRoot</span><span class="p">(</span><span class="n">FPaths</span><span class="o">::</span><span class="n">EngineContentDir</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Slate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// --- common variables ---</span>
<span class="w">    </span><span class="c1">// we can refrence files, that are not imported into project&#39;s filesystem, using direct links</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BitterLightFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/Bitter-Light&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// will search for file Bitter-Light.ttf in Resources / Fonts folder of the module</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BitterBlackFontPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fonts/Bitter-Black&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.ttf&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// if you refrencing assets imported inside game project - preload them first</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">MaterialPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Game/Characters/UI/UiMaterial_Inst.UiMaterial_Inst&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UMaterialInstance</span><span class="o">*</span><span class="w"> </span><span class="n">SlotMaterial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadObject</span><span class="o">&lt;</span><span class="n">UMaterialInstance</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">MaterialPath</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// --- styles ---</span>
<span class="w">    </span><span class="c1">// custom brushes</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// some custom brushes</span>
<span class="w">        </span><span class="c1">// This brush image loaded from module&#39;s Resource folder</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotImageBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBoxBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// Box Brush projection</span>
<span class="w">                                    </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InventorySlot_Icon&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// will return path of InventorySlot_Icon from modeule Resources folder</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">0.4f</span><span class="p">},</span><span class="w"> </span><span class="c1">// margins on box and border brush projections work differenty, check it in umg widgets editor</span>
<span class="w">                                    </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush loaded from folder that is set as ContentRoot</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotContentBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateBorderBrush</span><span class="p">{</span><span class="w"> </span><span class="c1">// Border Brush Projection</span>
<span class="w">                                    </span><span class="n">RootToContentDir</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Common/BoxShadow&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;.png&quot;</span><span class="p">)),</span><span class="w"> </span><span class="c1">// will search image in folder we set in SetContentRoot()</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">0.4f</span><span class="p">},</span><span class="w"> </span><span class="c1">// margins on box and border brush projections work differenty, check it in umg widgets editor</span>
<span class="w">                                    </span><span class="n">FSlateColor</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span><span class="w"> </span><span class="c1">// tint</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush uses material as it&#39;s value</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:SlotMaterialBrush&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                    </span><span class="n">SlotMaterial</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">50.f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="p">},</span>
<span class="w">                                    </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">NoTile</span><span class="w"> </span><span class="c1">// image brushes can be tiled, but since it&#39;s just material - there is no meaning of tiling at all</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:InventoryIcon&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                    </span><span class="o">*</span><span class="n">InContent</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ThreeLinesIcon&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;.png&quot;</span><span class="p">),</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">100.f</span><span class="p">,</span><span class="w"> </span><span class="mf">100.f</span><span class="p">},</span>
<span class="w">                                    </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">ESlateBrushTileType</span><span class="o">::</span><span class="n">NoTile</span><span class="w"> </span><span class="c1">// image brushes can be tiled, but since it&#39;s just material - there is no meaning of tiling at all</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush will draw rounded box</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:RoundedDark&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateRoundedBoxBrush</span><span class="p">{</span>
<span class="w">                                        </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Black</span><span class="p">,</span><span class="w"> </span><span class="c1">// background</span>
<span class="w">                                        </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="c1">// outline</span>
<span class="w">                                        </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="c1">// outline size</span>
<span class="w">                                        </span><span class="n">FVector2D</span><span class="p">{</span><span class="mf">50.f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="p">}</span><span class="w"> </span><span class="c1">// image size</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// just color brush</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Brushes:Dark&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FSlateImageBrush</span><span class="p">{</span>
<span class="w">                                    </span><span class="s">&quot;Brush:DarkColorBrush&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">FVector2D</span><span class="p">{},</span>
<span class="w">                                    </span><span class="n">FLinearColor</span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7f</span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// This brush loads font Bitter-Light.ttf from Resources folder of the module</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:BitterLight16&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterLightFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// This brush loads font Bitter-Black.ttf from Resources folder of the module   </span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Fonts:BitterBlack32&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// override existing style</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// this way we can make custom TextBlock</span>
<span class="w">        </span><span class="c1">// big text</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TBStyleY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:TextBlock32Big&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TBStyleY</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// basic text</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="w"> </span><span class="n">TBStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTextBlockStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">FSlateFontInfo</span><span class="p">(</span><span class="n">BitterBlackFontPath</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetColorAndOpacity</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">White</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:TextBlock24&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">TBStyle</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// buttons:</span>
<span class="w">        </span><span class="c1">// slightly blue</span>
<span class="w">        </span><span class="n">FSlateBrush</span><span class="w"> </span><span class="n">ButtonBrush</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">Normal</span><span class="p">;</span>
<span class="w">        </span><span class="n">ButtonBrush</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.7f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">BStyleBlue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">ButtonBrush</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:BlueButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BStyleBlue</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">        </span><span class="c1">// slightly green</span>
<span class="w">        </span><span class="n">ButtonBrush</span><span class="p">.</span><span class="n">TintColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="w"> </span><span class="n">BStyleGreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FButtonStyle</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">SetNormal</span><span class="p">(</span><span class="n">ButtonBrush</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="n">Set</span><span class="p">(</span><span class="s">&quot;Controls:GreenButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BStyleGreen</span><span class="p">);</span><span class="w"> </span><span class="c1">// store style</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// register style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">RegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// destructor</span>
<span class="n">FStyleSetBoilerplate</span><span class="o">::~</span><span class="n">FStyleSetBoilerplate</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// unregister style</span>
<span class="w">    </span><span class="n">FSlateStyleRegistry</span><span class="o">::</span><span class="n">UnRegisterSlateStyle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">GetStyleSetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StyleName</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// initialize static pointer</span>
<span class="k">const</span><span class="w"> </span><span class="n">FStyleSetBoilerplate</span><span class="o">&amp;</span><span class="w"> </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">Get</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Inst</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// make class instance and store is as static</span>
<span class="w">        </span><span class="c1">// *note - this also calls constructor, where RegisterSlateStyle is called</span>
<span class="w">        </span><span class="n">Inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TUniquePtr</span><span class="o">&lt;</span><span class="n">FStyleSetBoilerplate</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FStyleSetBoilerplate</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">Inst</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear unique pointer</span>
<span class="w">    </span><span class="c1">// *note - this will also call destructor, where UnRegisterSlateStyle is called</span>
<span class="w">    </span><span class="n">Inst</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
Регистрация осуществляется в конструкторе модуля, удаление - в деструкторе модуля.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Modules/ModuleManager.h&quot;</span>
<span class="n">DECLARE_LOG_CATEGORY_EXTERN</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">All</span><span class="p">,</span><span class="w"> </span><span class="n">All</span><span class="p">);</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FSlateRuntimeModule</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IModuleInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="cm">/* Called when the module is loaded */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">StartupModule</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* Called when the module is unloaded */</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShutdownModule</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;SlateRuntimeModule.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Styles/StyleSetBoilerplate.h&quot;</span><span class="c1"> // StyleSet to register</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Slate/SlateGameResources.h&quot;</span>
<span class="n">DEFINE_LOG_CATEGORY</span><span class="p">(</span><span class="n">SlateRuntimeModule</span><span class="p">);</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;FSlateRuntimeModule&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateRuntimeModule::StartupModule</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// register style set</span>
<span class="w">    </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">Get</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">FSlateRuntimeModule::ShutdownModule</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// unregister style set</span>
<span class="w">    </span><span class="n">FStyleSetBoilerplate</span><span class="o">::</span><span class="n">Shutdown</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
<span class="n">IMPLEMENT_MODULE</span><span class="p">(</span><span class="n">FSlateRuntimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">SlateRuntimeModule</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="slate-aplayercontroller">Передача в <code>Slate</code> класса <code>APlayerController</code></h3>
<p>Делается через атрибуты.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SClassConstructor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SCompoundWidget</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_DECLARE_WIDGET</span><span class="p">(</span><span class="n">SClassConstructor</span><span class="p">,</span><span class="w"> </span><span class="n">SCompoundWidget</span><span class="p">)</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">SLATE_BEGIN_ARGS</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// Local Player Attribute</span>
<span class="w">    </span><span class="n">SLATE_ATTRIBUTE</span><span class="p">(</span><span class="n">APlayerController</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerController</span><span class="p">)</span>
<span class="w">    </span><span class="n">SLATE_END_ARGS</span><span class="p">()</span>
<span class="w">    </span><span class="n">SClassConstructor</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Attribute Default Values</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">        </span><span class="p">{}</span>
<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// setter for PlayerControllerAttribute</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetNewPlayerController</span><span class="p">(</span><span class="n">TAttribute</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">LPlayer</span><span class="p">){</span>
<span class="w">        </span><span class="n">PlayerControllerAttribute</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">LPlayer</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// getter for PlayerControllerAttribute</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// will return FSlateUser user object from current LocalPlayer</span>
<span class="w">    </span><span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetUser</span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControllerId</span><span class="p">()).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TSlateAttribute</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="n">BEGIN_SLATE_FUNCTION_BUILD_OPTIMIZATION</span>
<span class="n">SLATE_IMPLEMENT_WIDGET</span><span class="p">(</span><span class="n">SGameWindow</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SGameWindow</span><span class="o">::</span><span class="n">PrivateRegisterAttributes</span><span class="p">(</span><span class="n">FSlateAttributeInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AttributeInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SLATE_ADD_MEMBER_ATTRIBUTE_DEFINITION_WITH_NAME</span><span class="p">(</span><span class="n">AttributeInitializer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PlayerController&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PlayerControllerAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">EInvalidateWidgetReason</span><span class="o">::</span><span class="n">Paint</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="slateuser">Получение доступа к <code>SlateUser</code></h3>
<p>Объект <code>FSlateUser</code> позволяет получить доступ к положению курсора, что бывает Очень важно при перетаскивании объектов по экрану.
<div class="highlight"><pre><span></span><code><span class="c1">// will return FSlateUser user object from current LocalPlayer</span>
<span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="nf">GetSlateUser</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">GetUser</span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControllerId</span><span class="p">()).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Получение позиции курсора в виджете:
<div class="highlight"><pre><span></span><code><span class="n">FSlateUser</span><span class="o">*</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSlateUser</span><span class="p">();</span>
<span class="n">InitialMousePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="o">-&gt;</span><span class="n">GetCursorPosition</span><span class="p">();</span>
</code></pre></div></p>
<h3 id="_21">Привязка к событиям прямо внутри виджета</h3>
<p>Иногда надо отследить то или иное нажатие клавиши в определенных состояниях интерфейса. Если у нас есть доступ к объекту <code>APlayerController</code>, то проблем не возникнет:
<div class="highlight"><pre><span></span><code><span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnTitleMouseButtonDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Unhandled</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[SGameWindow] Title Mouse Button Down Key = %s&quot;), *MouseEvent.GetEffectingButton().ToString())</span>
<span class="w">    </span><span class="c1">// Bind to same key event &quot;key Released&quot; to stop window drag</span>
<span class="w">    </span><span class="c1">// this is necessary if user released &quot;drag mouse button&quot; outside of the window title</span>
<span class="w">    </span><span class="n">FInputKeyBinding</span><span class="w"> </span><span class="n">ReleasedBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FInputKeyBinding</span><span class="p">(</span><span class="n">MouseEvent</span><span class="p">.</span><span class="n">GetEffectingButton</span><span class="p">(),</span><span class="w"> </span><span class="n">EInputEvent</span><span class="o">::</span><span class="n">IE_Released</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//ReleasedBinding.KeyDelegate.GetDelegateForManualSet().BindRaw(this,&amp;SGameWindow::StopWindowDrag);</span>
<span class="w">    </span><span class="n">ReleasedBinding</span><span class="p">.</span><span class="n">KeyDelegate</span><span class="p">.</span><span class="n">GetDelegateForManualSet</span><span class="p">().</span><span class="n">BindLambda</span><span class="p">([</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">StopWindowDrag</span><span class="p">();</span><span class="w"> </span><span class="c1">// stop drag</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="n">Controller</span><span class="o">-&gt;</span><span class="n">InputComponent</span><span class="o">-&gt;</span><span class="n">KeyBindings</span><span class="p">.</span><span class="n">Emplace</span><span class="p">(</span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">ReleasedBinding</span><span class="p">));</span>
<span class="w">    </span><span class="n">StartWindowDrag</span><span class="p">();</span><span class="w"> </span><span class="c1">// will start drag</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="slate_4">Приведение типа для виджетов <code>Slate</code></h3>
<p>Делается через <code>static_cast</code> или <code>StaticCastSharedPtr / StaticCastSharedRef</code>. Поскольку операция <code>static_cast</code> не является типобезопасной, у каждого виджета есть метод <code>GetType</code>.
Вариант 1:
<div class="highlight"><pre><span></span><code><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ChildWidget</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;SGameWindow&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SGameWindow</span><span class="o">*</span><span class="w"> </span><span class="n">GameWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ChildWidget</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">GameWindow</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Вариант 2:
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;SGameWindow&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GameWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StaticCastSharedRef</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">GameWindow</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="sconstraintcanvas">Получение списка виджетов заданного типа внутри <code>SConstraintCanvas</code></h3>
<p>На примере <code>SGameWindow</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// will search all SGameWindow objects on the parent canvas</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">GetAllGameWindowsOnCanvas</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">    </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="c1">//SConstraintCanvas::FSlot* Slot = (SConstraintCanvas::FSlot*)(&amp;ChildWingets-&gt;GetSlotAt(i));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ChildWidget</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;SGameWindow&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">SGameWindow</span><span class="o">*</span><span class="w"> </span><span class="n">GameWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ChildWidget</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//StaticCastSharedPtr</span>
<span class="w">            </span><span class="n">res</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">GameWindow</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="sconstraintcanvasfslot">Получение ссылки на слот <code>SConstraintCanvas::FSlot</code> для текущего виджета</h3>
<p>Доступ к слоту, в котором находится текущий виджет, может быть использован для изменения якорей <code>Anchors</code> этого слота
<div class="highlight"><pre><span></span><code><span class="c1">// will return FSlot object, related to our Window on SConstraintCanvas</span>
<span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="nf">SGameWindow::GetCanvasSlot</span><span class="p">(){</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">    </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetSlotAt</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetWidget</span><span class="p">().</span><span class="n">Get</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if slot widget is our current window - then slot is our window slot</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Slot</span><span class="p">;</span><span class="w"> </span><span class="c1">// return found slot</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// nothing found</span>
<span class="p">}</span>
</code></pre></div>
Якоря меняются так:
<div class="highlight"><pre><span></span><code><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCanvasSlot</span><span class="p">();</span>
<span class="n">Slot</span><span class="o">-&gt;</span><span class="n">SetAnchors</span><span class="p">(</span><span class="n">TargetAnchors</span><span class="p">);</span>
</code></pre></div></p>
<h3 id="sconstraintcanvas_1">Получение объекта на самом первом слое в <code>SConstraintCanvas</code></h3>
<p>Иногда надо узнать, какой объект находится выше всех остальных по <code>ZOrder</code>. Делается это так:
<div class="highlight"><pre><span></span><code><span class="c1">// will return FSlot object, related to our Window on SConstraintCanvas</span>
<span class="n">int32</span><span class="w"> </span><span class="nf">SGameWindow::GetHighestZOrder</span><span class="p">(){</span>
<span class="w">    </span><span class="n">SConstraintCanvas</span><span class="o">*</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetParentCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Canvas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// we are not in the canvas</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// in loop check every canvas slot widget</span>
<span class="w">    </span><span class="n">FChildren</span><span class="o">*</span><span class="w"> </span><span class="n">ChildWingets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">GetChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SWidget</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ChildWidget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetChildAt</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="w"> </span><span class="n">Slot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SConstraintCanvas</span><span class="o">::</span><span class="n">FSlot</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ChildWingets</span><span class="o">-&gt;</span><span class="n">GetSlotAt</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetZOrder</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slot</span><span class="o">-&gt;</span><span class="n">GetZOrder</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// take care of int size limits. It&#39;s impossible to reach them, using widgets because your pc memory will fill up, but...</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HighestZOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HighestZOrder</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_22">Захват ввода клавиатуры</h3>
<p>Для начала надо переопределить метод <code>SupportsKeyboardFocus</code>:
<div class="highlight"><pre><span></span><code><span class="c1">// Events like OnKeyDown, OnKeyUp and all others related to keyboard won&#39;t work without this</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">SupportsKeyboardFocus</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
Далее мы можем переопределить метод <code>OnKeyDown</code>:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="k">virtual</span><span class="w"> </span><span class="n">FReply</span><span class="w"> </span><span class="nf">OnKeyDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FKeyEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InKeyEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="n">FReply</span><span class="w"> </span><span class="nf">SGameWindow::OnKeyDown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FKeyEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">InKeyEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[SGameWindow] KeyDown Key = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">InKeyEvent</span><span class="p">.</span><span class="n">GetKey</span><span class="p">().</span><span class="n">ToString</span><span class="p">())</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FReply</span><span class="o">::</span><span class="n">Handled</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
Теперь, если щелкнуть на виджете и начать печатать - вывод клавиатуры будет захвачен.</p>
<p><a class="glightbox" href="../images/c774ea00b1fce97048ba765ecee3cb9b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c774ea00b1fce97048ba765ecee3cb9b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c774ea00b1fce97048ba765ecee3cb9b.png" /></a></p>
<h3 id="_23">Вывод виджета на первый план и передача ему фокуса ввода</h3>
<p>Захват фокуса ввода делается так:
<div class="highlight"><pre><span></span><code><span class="c1">// will set keyboard focus to current window</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::SetFocusToWindow</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Controller</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FWidgetPath</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">;</span>
<span class="w">    </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">FindPathToWidget</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">AsShared</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Visible</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Apply user focus</span>
<span class="w">    </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">SetUserFocus</span><span class="p">(</span><span class="n">Controller</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControllerId</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EFocusCause</span><span class="o">::</span><span class="n">Mouse</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Тут используется метод <code>FindPathToWidget</code>, который задает переменную <code>PathToWidget</code>.
<div class="highlight"><pre><span></span><code><span class="n">FWidgetPath</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">;</span>
<span class="n">FSlateApplication</span><span class="o">::</span><span class="n">Get</span><span class="p">().</span><span class="n">FindPathToWidget</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">AsShared</span><span class="p">(),</span><span class="w"> </span><span class="n">PathToWidget</span><span class="p">,</span><span class="w"> </span><span class="n">EVisibility</span><span class="o">::</span><span class="n">Visible</span><span class="p">);</span>
</code></pre></div>
Выведение виджета на первый план, с передачей ему фокуса ввода, в моем случае, осуществляется по событию <code>OnMouseEnter</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnMouseEnter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">SGameWindow::OnMouseEnter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGeometry</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyGeometry</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FPointerEvent</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MouseEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// don&#39;t clear focus if any of window on the canvas currently resized or dragged</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">SGameWindow</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">GameWindows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetAllGameWindowsOnCanvas</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">SGameWindow</span><span class="o">*</span><span class="w"> </span><span class="n">Wnd</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">GameWindows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Wnd</span><span class="o">-&gt;</span><span class="n">isDrag</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Wnd</span><span class="o">-&gt;</span><span class="n">isResize</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// set focus to window under mouse cursor</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FSlateApplication</span><span class="o">::</span><span class="n">IsInitialized</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">SupportsKeyboardFocus</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetFocusToWindow</span><span class="p">();</span><span class="w"> </span><span class="c1">// Set focus to widget once mouse is entered it</span>
<span class="w">        </span><span class="c1">//UE_LOG(LogTemp, Error, TEXT(&quot;[SGameWindow] Parent Widget = %s&quot;), *this-&gt;GetParentWidget()-&gt;ToString())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// move currently working window to top of the canvas z-order</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">HOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetHighestZOrder</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HOrder</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GetCanvasSlot</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetZOrder</span><span class="p">(</span><span class="n">GetHighestZOrder</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Error, TEXT(&quot;[SGameWindow] Mouse Entered&quot;))</span>
<span class="p">}</span>
</code></pre></div></p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            К началу
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      aftamat4ik
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "toc.follow"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>