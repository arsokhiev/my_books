
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Справочник Unreal Engine">
      
      
        <meta name="author" content="aftamat4ik">
      
      
      
        <link rel="prev" href="7_ACharacter_And_Enhanced%20Input.html">
      
      
        <link rel="next" href="9_Global_Data_Access.html">
      
      
      <link rel="icon" href="../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.3.2">
    
    
      
        <title>Gameplay Ability System - Справочник Unreal Engine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.30068a00.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gameplay-ability-system" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-header__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Справочник Unreal Engine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gameplay Ability System
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Главная

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1_Basics/1_First_Project.html" class="md-tabs__link">
          
  
  Основы

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../2_Core/1_Delegates.html" class="md-tabs__link">
          
  
  Ключевые системы

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="1_HUD.html" class="md-tabs__link">
          
  
  Продвинутая разработка

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-tabs__link">
          
  
  Решение проблем

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../5_Tips/Change_Asset_Icons.html" class="md-tabs__link">
          
  
  Советы

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-nav__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    Справочник Unreal Engine
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Главная
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Основы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Основы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/1_First_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создаем первый проект в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/2_Engine_Introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Знакомство с движком
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/3_CPP_Recommendations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Рекомендации по написанию кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/4_SimplePlugin.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создание простейшего плагина для Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/5_Macroses_Reflection_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Макросы Reflection System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/6_Logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Печать информации в лог
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/7_Pointers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Указатели
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/8_ModernCpp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возможности современного c++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/9_Working_With_Strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа со строками
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/10_Timers_In_%D0%A1%2B%2B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Таймеры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/11_Instances_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Доступ к различным сущностям
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Debug
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            Debug
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Asserts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Asserts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Console Commands
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ключевые системы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Ключевые системы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/1_Delegates.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События и Делегаты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/2_Components.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Компоненты в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/3_SubObjects.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Суб Объекты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/4_Multithreading.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Многопоточность
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/5_Function_Libraries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Библиотеки Функций для Blueprint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/6_Latent_And_Async_Actions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Latent и Async Action
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/7_Gameplay_Tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/8_DataAssets_AssetManager.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с ассетами и данными
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/9_FileSystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с файловой системой
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/10_Anim_Instance.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anim Instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/11_SubSystems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Подсистемы
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/12.%20UObject%20Interface.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Interface или UInterface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Продвинутая разработка
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Продвинутая разработка
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="1_HUD.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HUD или Heads-up Display
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="2_UFUNCTION_Wildcard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UFUNCTION Wildcard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="3_Slate%20Runtime.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slate Runtimе, введение в Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="4_UMG.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UMG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="5_K2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="6_Registe_New_Asset_Type.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Регистрируем новый тип ассета
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="7_ACharacter_And_Enhanced%20Input.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ACharacter и Enhanced Input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Gameplay Ability System
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="8_Gameplay_Ability_System.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Gameplay Ability System
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Подготовка к работе
  </a>
  
    <nav class="md-nav" aria-label="Подготовка к работе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Создаем новый проект
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Включаем требуемые плагины
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    Включаем поддержку c++
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Добавляем зависимости
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attributeset" class="md-nav__link">
    Добавляем AttributeSet
  </a>
  
    <nav class="md-nav" aria-label="Добавляем AttributeSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributeset_1" class="md-nav__link">
    Введение в AttributeSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Создаем класс
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attribute_accessors" class="md-nav__link">
    Добавляем макрос ATTRIBUTE_ACCESSORS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Введение в Аттрибуты
  </a>
  
    <nav class="md-nav" aria-label="Введение в Аттрибуты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Шаги для добавления аттрибута
  </a>
  
    <nav class="md-nav" aria-label="Шаги для добавления аттрибута">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    Шаг 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    Шаг 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    Шаг 3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    Шаг 4
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basevalue-currentvalue" class="md-nav__link">
    BaseValue и CurrentValue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Максимальные и минимальные значения атрибутов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Репликация вторичных аттрибутов
  </a>
  
    <nav class="md-nav" aria-label="Репликация вторичных аттрибутов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postgameplayeffectexecute" class="md-nav__link">
    PostGameplayEffectExecute
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Код
  </a>
  
    <nav class="md-nav" aria-label="Код">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#characterattributeseth" class="md-nav__link">
    CharacterAttributeSet.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#characterattributesetcpp" class="md-nav__link">
    CharacterAttributeSet.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Создаем класс персонажа
  </a>
  
    <nav class="md-nav" aria-label="Создаем класс персонажа">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Добавляем стартовый код персонажа
  </a>
  
    <nav class="md-nav" aria-label="Добавляем стартовый код персонажа">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corecharacterh" class="md-nav__link">
    CoreCharacter.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corecharactercpp" class="md-nav__link">
    CoreCharacter.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint" class="md-nav__link">
    Создаем blueprint персонажа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gas" class="md-nav__link">
    Подключение GAS
  </a>
  
    <nav class="md-nav" aria-label="Подключение GAS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#abilitysystemcomponent-attributeset" class="md-nav__link">
    Добавляем переменные AbilitySystemComponent и AttributeSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attributeset_2" class="md-nav__link">
    Создаем суб объект для AttributeSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abilitysystemcomponent" class="md-nav__link">
    Создем суб объект для AbilitySystemComponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iabilitysysteminterface" class="md-nav__link">
    Реализуем IAbilitySystemInterface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#owner-actor-avataractor" class="md-nav__link">
    Owner Actor и AvatarActor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onrep_playerstate-possessedby" class="md-nav__link">
    Переопределяем методы OnRep_PlayerState и PossessedBy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Код персонажа на данном этапе
  </a>
  
    <nav class="md-nav" aria-label="Код персонажа на данном этапе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corecharacterh_1" class="md-nav__link">
    CoreCharacter.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corecharactercpp_1" class="md-nav__link">
    CoreCharacter.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Проверка работоспособности
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#showdebug-abilitysystem" class="md-nav__link">
    Отладка, showdebug AbilitySystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ability-system-component" class="md-nav__link">
    Обработка ввода в Ability System Component
  </a>
  
    <nav class="md-nav" aria-label="Обработка ввода в Ability System Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enum" class="md-nav__link">
    Создаем Enum со слотами ввода
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ability-system-component_1" class="md-nav__link">
    Привязка Ability System Component к слотам способностей
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gameplayability" class="md-nav__link">
    Переопределяем GameplayAbility
  </a>
  
    <nav class="md-nav" aria-label="Переопределяем GameplayAbility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jump-ability" class="md-nav__link">
    Jump Ability
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inputaction" class="md-nav__link">
    Создаем и регистрируем дополнительные InputAction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint_1" class="md-nav__link">
    Запускаем событие в слоте используя blueprint код
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    Настраиваем вызов способностей через с++
  </a>
  
    <nav class="md-nav" aria-label="Настраиваем вызов способностей через с++">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sprint-ability" class="md-nav__link">
    Sprint Ability
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirm-cancel" class="md-nav__link">
    Добавляем действия Confirm и Cancel
  </a>
  
    <nav class="md-nav" aria-label="Добавляем действия Confirm и Cancel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    Классический способ привязки
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhancedinput" class="md-nav__link">
    Привязка действий с применением плагина EnhancedInput
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirmable-fire-ability" class="md-nav__link">
    Проверка, Confirmable Fire Ability
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    Добавление способностей и эффектов "по умолчанию"
  </a>
  
    <nav class="md-nav" aria-label="Добавление способностей и эффектов "по умолчанию"">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-asset" class="md-nav__link">
    Создаем Data Asset для способностей и эффектов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#characterabilitiesdatah" class="md-nav__link">
    Файл CharacterAbilitiesData.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataasset" class="md-nav__link">
    Применяем DataAsset к персонажу
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    Фоновые способности / пассивные способности
  </a>
  
    <nav class="md-nav" aria-label="Фоновые способности / пассивные способности">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coregameplayabilityh" class="md-nav__link">
    CoreGameplayAbility.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coregameplayabilitycpp" class="md-nav__link">
    CoreGameplayAbility.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    Создаем фоновую способность
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    Отслеживание изменений в аттрибутах
  </a>
  
    <nav class="md-nav" aria-label="Отслеживание изменений в аттрибутах">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blueprintimplementableevent" class="md-nav__link">
    Отслеживаем аттрибуты через BlueprintImplementableEvent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-task" class="md-nav__link">
    Использование Async Task для отслеживания аттрибутов
  </a>
  
    <nav class="md-nav" aria-label="Использование Async Task для отслеживания аттрибутов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributechangedasyncactionh" class="md-nav__link">
    AttributeChangedAsyncAction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attributechangedasyncactioncpp" class="md-nav__link">
    AttributeChangedAsyncAction.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cooldownchangedasyncactionh" class="md-nav__link">
    CooldownChangedAsyncAction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cooldownchangedasyncactionh_1" class="md-nav__link">
    CooldownChangedAsyncAction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effectstackchangedasyncactionh" class="md-nav__link">
    EffectStackChangedAsyncAction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effectstackchangedasyncactioncpp" class="md-nav__link">
    EffectStackChangedAsyncAction.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gui" class="md-nav__link">
    Добавляем GUI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gameplayeffects" class="md-nav__link">
    GameplayEffects
  </a>
  
    <nav class="md-nav" aria-label="GameplayEffects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    Эффект, периодически расходующий выносливость при беге
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effect-cost" class="md-nav__link">
    Расход выносливости за счет Effect Cost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    Эффект, переопределяющий начальные значения характеристик
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    Эффект пассивного восстановления здоровья и выносливости
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    Стаки эффектов, стаки брони
  </a>
  
    <nav class="md-nav" aria-label="Стаки эффектов, стаки брони">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    Добавляем эффект стаков брони
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    Пишем способность, добавляющую стаки брони
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    Добавляем индикатор брони в интерфейс
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    Проверка
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gameplay-effect" class="md-nav__link">
    Передача информации в Gameplay Effect
  </a>
  
    <nav class="md-nav" aria-label="Передача информации в Gameplay Effect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-by-caller-magnitude" class="md-nav__link">
    Зоны урона и восстановления здоровья Set By Caller Magnitude
  </a>
  
    <nav class="md-nav" aria-label="Зоны урона и восстановления здоровья Set By Caller Magnitude">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    Добавляем  эффект нанесения урона здоровью
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    Пишем логику смерти персонажа
  </a>
  
    <nav class="md-nav" aria-label="Пишем логику смерти персонажа">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#physics-asset" class="md-nav__link">
    Исправляем Physics Asset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-ge_death" class="md-nav__link">
    Добавляем эффект, обнуляющий статы персонажа - GE_Death
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    Удаляем эффекты и способности при смерти персонажа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragdoll" class="md-nav__link">
    Добавляем функционал включения / выключения Ragdoll
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ga_death" class="md-nav__link">
    Добавляем способность GA_Death
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mod-magnitude-calculation" class="md-nav__link">
    Вычисляем модификатор эффекта по собственной формуле, Mod Magnitude Calculation
  </a>
  
    <nav class="md-nav" aria-label="Вычисляем модификатор эффекта по собственной формуле, Mod Magnitude Calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    Введение
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    Создаем заголовочный файл для класса
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    Базовый шаблон класса
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#damagemodmagnitudecalculationh" class="md-nav__link">
    DamageModMagnitudeCalculation.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    Проверка
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effect-execution-calculation" class="md-nav__link">
    Effect Execution Calculation, обработчик эффекта
  </a>
  
    <nav class="md-nav" aria-label="Effect Execution Calculation, обработчик эффекта">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    Создаем заголовочный файл для класса
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    Базовый шаблон класса
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#damagemodmagnitudecalculationh_1" class="md-nav__link">
    DamageModMagnitudeCalculation.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    Проверка
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    Сложные эффекты
  </a>
  
    <nav class="md-nav" aria-label="Сложные эффекты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    Примитивная логика стрельбы и нанесения урона
  </a>
  
    <nav class="md-nav" aria-label="Примитивная логика стрельбы и нанесения урона">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#impact-effect" class="md-nav__link">
    Добавляем Impact Effect на персонажа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    Добавляем прожектайл
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ga_firebullet" class="md-nav__link">
    Добавляем способность GA_FireBullet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    Создаем бота с примитивным ии
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npc" class="md-nav__link">
    Создаем виджет полоски здоровья для NPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    Применение урона
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meteor" class="md-nav__link">
    Способность Meteor
  </a>
  
    <nav class="md-nav" aria-label="Способность Meteor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    Добавляем слот под нашу способность
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gameplay-ability-target-actor" class="md-nav__link">
    Добавляем Gameplay Ability Target Actor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    Добавляем эффект, наносящий урон целям
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    Создаем метеор
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    Добавляем способность, применяющую метеор
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    Исправляем интерфейс
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ge_meteorcost" class="md-nav__link">
    Добавляем эффект GE_MeteorCost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ge_meteorcooldown" class="md-nav__link">
    Добавляем GE_MeteorCooldown
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="9_Global_Data_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальнный доступ к данным
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="10_Global_Event_Bus.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальная шина событий
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Решение проблем
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Решение проблем
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с кодировкой в LiveCoding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/Reset_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Сброс (Reset) проекта
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/generatedh_Problems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с файлом .generated.h
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Советы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Советы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Change_Asset_Icons.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Asset Icons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Character_And_EnhancedInput.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Character Boilerplate with Enhanced Input Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/DefaultToSelf_WorldContext.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DefaultToSelf WorldContext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Different_UPROPERTY.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Переменные разных типов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/GameInputMode.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Изменение GameInputMode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Get_UScriptStruct_FromStruct.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ::UScriptStruct из встроенной структуры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Input_Binding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События ввода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Iterate_TMap.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iterate TMap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Read_Blueprint_Properties.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Чтение параметров Blueprint класса
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Return_UObject.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возвращение UObject по ссылке из функции
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Run_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Запуск консольных команд
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Screen_Size.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Размер экрана
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Slate_Snippets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Полезные сниппеты Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Spawn_Actors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spawn, призыв объектов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Time_Measuring.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Замер времени исполнения кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Trace.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UEnum_To_String.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UEnum to FString
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UObject_Base_Class.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Base Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Variable_Type_Print_Template.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Шаблон для печати типа переменной
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/struct_operator%3D%3D.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    struct и оператор ==
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Подготовка к работе
  </a>
  
    <nav class="md-nav" aria-label="Подготовка к работе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Создаем новый проект
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Включаем требуемые плагины
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    Включаем поддержку c++
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Добавляем зависимости
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attributeset" class="md-nav__link">
    Добавляем AttributeSet
  </a>
  
    <nav class="md-nav" aria-label="Добавляем AttributeSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributeset_1" class="md-nav__link">
    Введение в AttributeSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Создаем класс
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attribute_accessors" class="md-nav__link">
    Добавляем макрос ATTRIBUTE_ACCESSORS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Введение в Аттрибуты
  </a>
  
    <nav class="md-nav" aria-label="Введение в Аттрибуты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Шаги для добавления аттрибута
  </a>
  
    <nav class="md-nav" aria-label="Шаги для добавления аттрибута">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    Шаг 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    Шаг 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    Шаг 3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    Шаг 4
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basevalue-currentvalue" class="md-nav__link">
    BaseValue и CurrentValue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Максимальные и минимальные значения атрибутов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Репликация вторичных аттрибутов
  </a>
  
    <nav class="md-nav" aria-label="Репликация вторичных аттрибутов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postgameplayeffectexecute" class="md-nav__link">
    PostGameplayEffectExecute
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Код
  </a>
  
    <nav class="md-nav" aria-label="Код">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#characterattributeseth" class="md-nav__link">
    CharacterAttributeSet.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#characterattributesetcpp" class="md-nav__link">
    CharacterAttributeSet.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Создаем класс персонажа
  </a>
  
    <nav class="md-nav" aria-label="Создаем класс персонажа">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Добавляем стартовый код персонажа
  </a>
  
    <nav class="md-nav" aria-label="Добавляем стартовый код персонажа">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corecharacterh" class="md-nav__link">
    CoreCharacter.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corecharactercpp" class="md-nav__link">
    CoreCharacter.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint" class="md-nav__link">
    Создаем blueprint персонажа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gas" class="md-nav__link">
    Подключение GAS
  </a>
  
    <nav class="md-nav" aria-label="Подключение GAS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#abilitysystemcomponent-attributeset" class="md-nav__link">
    Добавляем переменные AbilitySystemComponent и AttributeSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attributeset_2" class="md-nav__link">
    Создаем суб объект для AttributeSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#abilitysystemcomponent" class="md-nav__link">
    Создем суб объект для AbilitySystemComponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iabilitysysteminterface" class="md-nav__link">
    Реализуем IAbilitySystemInterface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#owner-actor-avataractor" class="md-nav__link">
    Owner Actor и AvatarActor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onrep_playerstate-possessedby" class="md-nav__link">
    Переопределяем методы OnRep_PlayerState и PossessedBy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Код персонажа на данном этапе
  </a>
  
    <nav class="md-nav" aria-label="Код персонажа на данном этапе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#corecharacterh_1" class="md-nav__link">
    CoreCharacter.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corecharactercpp_1" class="md-nav__link">
    CoreCharacter.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Проверка работоспособности
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#showdebug-abilitysystem" class="md-nav__link">
    Отладка, showdebug AbilitySystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ability-system-component" class="md-nav__link">
    Обработка ввода в Ability System Component
  </a>
  
    <nav class="md-nav" aria-label="Обработка ввода в Ability System Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enum" class="md-nav__link">
    Создаем Enum со слотами ввода
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ability-system-component_1" class="md-nav__link">
    Привязка Ability System Component к слотам способностей
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gameplayability" class="md-nav__link">
    Переопределяем GameplayAbility
  </a>
  
    <nav class="md-nav" aria-label="Переопределяем GameplayAbility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jump-ability" class="md-nav__link">
    Jump Ability
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inputaction" class="md-nav__link">
    Создаем и регистрируем дополнительные InputAction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint_1" class="md-nav__link">
    Запускаем событие в слоте используя blueprint код
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    Настраиваем вызов способностей через с++
  </a>
  
    <nav class="md-nav" aria-label="Настраиваем вызов способностей через с++">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sprint-ability" class="md-nav__link">
    Sprint Ability
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirm-cancel" class="md-nav__link">
    Добавляем действия Confirm и Cancel
  </a>
  
    <nav class="md-nav" aria-label="Добавляем действия Confirm и Cancel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    Классический способ привязки
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhancedinput" class="md-nav__link">
    Привязка действий с применением плагина EnhancedInput
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirmable-fire-ability" class="md-nav__link">
    Проверка, Confirmable Fire Ability
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    Добавление способностей и эффектов "по умолчанию"
  </a>
  
    <nav class="md-nav" aria-label="Добавление способностей и эффектов "по умолчанию"">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-asset" class="md-nav__link">
    Создаем Data Asset для способностей и эффектов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#characterabilitiesdatah" class="md-nav__link">
    Файл CharacterAbilitiesData.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataasset" class="md-nav__link">
    Применяем DataAsset к персонажу
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    Фоновые способности / пассивные способности
  </a>
  
    <nav class="md-nav" aria-label="Фоновые способности / пассивные способности">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coregameplayabilityh" class="md-nav__link">
    CoreGameplayAbility.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coregameplayabilitycpp" class="md-nav__link">
    CoreGameplayAbility.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    Создаем фоновую способность
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    Отслеживание изменений в аттрибутах
  </a>
  
    <nav class="md-nav" aria-label="Отслеживание изменений в аттрибутах">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blueprintimplementableevent" class="md-nav__link">
    Отслеживаем аттрибуты через BlueprintImplementableEvent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-task" class="md-nav__link">
    Использование Async Task для отслеживания аттрибутов
  </a>
  
    <nav class="md-nav" aria-label="Использование Async Task для отслеживания аттрибутов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributechangedasyncactionh" class="md-nav__link">
    AttributeChangedAsyncAction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attributechangedasyncactioncpp" class="md-nav__link">
    AttributeChangedAsyncAction.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cooldownchangedasyncactionh" class="md-nav__link">
    CooldownChangedAsyncAction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cooldownchangedasyncactionh_1" class="md-nav__link">
    CooldownChangedAsyncAction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effectstackchangedasyncactionh" class="md-nav__link">
    EffectStackChangedAsyncAction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effectstackchangedasyncactioncpp" class="md-nav__link">
    EffectStackChangedAsyncAction.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gui" class="md-nav__link">
    Добавляем GUI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gameplayeffects" class="md-nav__link">
    GameplayEffects
  </a>
  
    <nav class="md-nav" aria-label="GameplayEffects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    Эффект, периодически расходующий выносливость при беге
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effect-cost" class="md-nav__link">
    Расход выносливости за счет Effect Cost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    Эффект, переопределяющий начальные значения характеристик
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    Эффект пассивного восстановления здоровья и выносливости
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    Стаки эффектов, стаки брони
  </a>
  
    <nav class="md-nav" aria-label="Стаки эффектов, стаки брони">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    Добавляем эффект стаков брони
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    Пишем способность, добавляющую стаки брони
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    Добавляем индикатор брони в интерфейс
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    Проверка
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gameplay-effect" class="md-nav__link">
    Передача информации в Gameplay Effect
  </a>
  
    <nav class="md-nav" aria-label="Передача информации в Gameplay Effect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-by-caller-magnitude" class="md-nav__link">
    Зоны урона и восстановления здоровья Set By Caller Magnitude
  </a>
  
    <nav class="md-nav" aria-label="Зоны урона и восстановления здоровья Set By Caller Magnitude">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    Добавляем  эффект нанесения урона здоровью
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    Пишем логику смерти персонажа
  </a>
  
    <nav class="md-nav" aria-label="Пишем логику смерти персонажа">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#physics-asset" class="md-nav__link">
    Исправляем Physics Asset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-ge_death" class="md-nav__link">
    Добавляем эффект, обнуляющий статы персонажа - GE_Death
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    Удаляем эффекты и способности при смерти персонажа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragdoll" class="md-nav__link">
    Добавляем функционал включения / выключения Ragdoll
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ga_death" class="md-nav__link">
    Добавляем способность GA_Death
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mod-magnitude-calculation" class="md-nav__link">
    Вычисляем модификатор эффекта по собственной формуле, Mod Magnitude Calculation
  </a>
  
    <nav class="md-nav" aria-label="Вычисляем модификатор эффекта по собственной формуле, Mod Magnitude Calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    Введение
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    Создаем заголовочный файл для класса
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    Базовый шаблон класса
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#damagemodmagnitudecalculationh" class="md-nav__link">
    DamageModMagnitudeCalculation.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    Проверка
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effect-execution-calculation" class="md-nav__link">
    Effect Execution Calculation, обработчик эффекта
  </a>
  
    <nav class="md-nav" aria-label="Effect Execution Calculation, обработчик эффекта">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    Создаем заголовочный файл для класса
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    Базовый шаблон класса
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#damagemodmagnitudecalculationh_1" class="md-nav__link">
    DamageModMagnitudeCalculation.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    Проверка
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    Сложные эффекты
  </a>
  
    <nav class="md-nav" aria-label="Сложные эффекты">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    Примитивная логика стрельбы и нанесения урона
  </a>
  
    <nav class="md-nav" aria-label="Примитивная логика стрельбы и нанесения урона">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#impact-effect" class="md-nav__link">
    Добавляем Impact Effect на персонажа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    Добавляем прожектайл
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ga_firebullet" class="md-nav__link">
    Добавляем способность GA_FireBullet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    Создаем бота с примитивным ии
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npc" class="md-nav__link">
    Создаем виджет полоски здоровья для NPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    Применение урона
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meteor" class="md-nav__link">
    Способность Meteor
  </a>
  
    <nav class="md-nav" aria-label="Способность Meteor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    Добавляем слот под нашу способность
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gameplay-ability-target-actor" class="md-nav__link">
    Добавляем Gameplay Ability Target Actor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    Добавляем эффект, наносящий урон целям
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    Создаем метеор
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    Добавляем способность, применяющую метеор
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    Исправляем интерфейс
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ge_meteorcost" class="md-nav__link">
    Добавляем эффект GE_MeteorCost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ge_meteorcooldown" class="md-nav__link">
    Добавляем GE_MeteorCooldown
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="gameplay-ability-system">Gameplay Ability System</h1>
<p><code>Gameplay Ability System</code> или <code>GAS</code> - это встроенный в <code>Unreal Engine</code> высокоуровневый фреймворк, упрощающий разработку игровой логики. На его основе разработчик может реализовать удобный функционал управления способностями, характеристиками и эффектами игровых объектов, в том числе - персонажей.</p>
<p>Все крупные <code>AAA</code> игры на <code>Unreal Engine</code> построены вокруг системы <code>GAS</code>. Среди таких: <code>Borderlands</code>, <code>Fortnite</code>, <code>PUBG</code>, <code>Tower of Fantasy</code> и  так далее.</p>
<p><a class="glightbox" href="../images/f6b716c32504b734f29211b81a03601b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f6b716c32504b734f29211b81a03601b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f6b716c32504b734f29211b81a03601b.png" /></a></p>
<p><a class="glightbox" href="../images/01ad3ee952ff2e129fe560278fbf79f4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="01ad3ee952ff2e129fe560278fbf79f4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/01ad3ee952ff2e129fe560278fbf79f4.png" /></a></p>
<p><a class="glightbox" href="../images/7e017f664bb744114ee19b6eee93c350.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7e017f664bb744114ee19b6eee93c350.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7e017f664bb744114ee19b6eee93c350.png" /></a></p>
<p>Основное, что должен уметь программист под <code>Unreal Engine</code> относится к установке и настройке системы <code>GAS</code>. Благо сделать это достаточно просто и пусть размер статьи вас не пугает. <code>GAS</code> мы установим и настроим уже во второй главе. Все остальное посвящено неочевидным моментам работы с системой.</p>
<p>Фреймворк <code>GAS</code> предлагает абсолютно уникальный опыт по совмещению <code>с++</code> и <code>blueprint</code> кода. Установить и настроить его корректно надо всего один раз. Достаточно лишь определиться с набором характеристик, которые будут использоваться в вашей игре, а так-же с клавишами ввода - и каркас вашей игры будет готов. Всю остальную логику вы сможете писать исключительно на <code>blueprint</code>.
Никакие плагины, никакие платные ассеты не заменят для вас полноценно установленную и настроенную систему <code>Gameplay Abilities</code>.
На <code>Guthub</code> есть отличный репозиторий с примером проекта для <code>GAS</code> - <a href="https://github.com/tranek/GASDocumentation">GAS Documentation</a>. Он немного устарел и относится к <code>Unreal Engine 5.1</code>, а так-же не поддерживает <code>Enhanced Input</code>. В этой статье я исправлю недочеты старого проекта и постараюсь сделать повествование максимально доступным даже для того, кто не читал всю мою книгу, а открыл только эту статью.</p>
<h2 id="_1">Подготовка к работе</h2>
<p>Мы будем работать с абсолютно новым проектом.</p>
<h3 id="_2">Создаем новый проект</h3>
<p>В <code>Epic Games Launcher</code> запускаем выбранный нами игровой движок. В моем случае это <code>Unreal Engine 5.1</code>.</p>
<p><a class="glightbox" href="../images/c39ecebb2e876a4f9ec2bcbbb6e7ef18.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c39ecebb2e876a4f9ec2bcbbb6e7ef18.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c39ecebb2e876a4f9ec2bcbbb6e7ef18.png" /></a></p>
<p>В появившемся окне переходим на вкладку <code>Games</code> и выбираем пункт <code>ThirdPerson</code>.
Называем будущий проект <code>GASBase</code>, выбираем место сохранения проекта. В настройках проекта выставляете <code>Blueprint</code> и галочку на <code>StarterContent</code>, он нам тоже понадобится.</p>
<p>Почему я создаю <code>Blueprint</code> проект? Потому что основные способности и эффекты, которые вы будете создавать для системы <code>GAS</code> реализованы в виде <code>Blueprint</code>. К тому-же из <code>blueprint</code> проекта в разы проще вести отладку игровой логики.</p>
<p><a class="glightbox" href="../images/114dc1b5f9237f20e950cbfb1730f877.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="114dc1b5f9237f20e950cbfb1730f877.png" auto_="auto;" display="block;" margin:="margin:" src="../images/114dc1b5f9237f20e950cbfb1730f877.png" /></a></p>
<h3 id="_3">Включаем требуемые плагины</h3>
<p>После создания и запуска, проекта перейдите на вкладку <code>Edit -&gt; Plugins</code>.
Для работы с <code>Visual Studio</code> необходимо установить плагин <code>Visual Studio Integration Tools</code>. Скачайте его с <a href="https://www.unrealengine.com/marketplace/en-US/product/visual-studio-integration-tool">официального маркетплейса</a>, это бесплатный плагин.</p>
<p>Активируйте плагины <code>Visual Studio Integration</code> и <code>Visual Studio Integration Tools</code>.</p>
<p><a class="glightbox" href="../images/46fd48b54ccc4252a215552cf814835c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="46fd48b54ccc4252a215552cf814835c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/46fd48b54ccc4252a215552cf814835c.png" /></a></p>
<p>Фреймворк <code>GAS</code> реализован в плагине <code>Gameplay Abilities</code>, который поставляется вместе с <code>Unreal Engine</code>. Найти его можно в подкатегории <code>Gameplay</code>. Активируйте.</p>
<p><a class="glightbox" href="../images/b67514883be165b480947905942b5c1e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b67514883be165b480947905942b5c1e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b67514883be165b480947905942b5c1e.png" /></a></p>
<p>Если у вас не включен плагин <code>EnhancedInput</code> - включите его.</p>
<p><a class="glightbox" href="../images/1dab3060bdce572efa5139b46d04ef2d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1dab3060bdce572efa5139b46d04ef2d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1dab3060bdce572efa5139b46d04ef2d.png" /></a></p>
<p>После активации плагинов - перезапускаем движок.</p>
<p><a class="glightbox" href="../images/6f95ff1896a71a6b342e30ccf2cbaf43.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6f95ff1896a71a6b342e30ccf2cbaf43.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6f95ff1896a71a6b342e30ccf2cbaf43.png" /></a></p>
<h3 id="c">Включаем поддержку <code>c++</code></h3>
<p>Поскольку мы создали <code>Blueprint</code> проект - поддержку <code>с++</code> в нем придется включать вручную. Для этого необходимо добавить в проект любой <code>с++</code> класс из редактора.</p>
<p>Предлагаю создать <code>BlueprintFunctionLibrary</code>.
Идем в меню <code>Tools -&gt; New C++ Class</code>, в появившемся окне выбираем пункт <code>BlueprintFunctionLibrary</code>.</p>
<p><a class="glightbox" href="../images/4a093624b6f27c85f3d82f126fb43f82.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4a093624b6f27c85f3d82f126fb43f82.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4a093624b6f27c85f3d82f126fb43f82.png" /></a></p>
<p><a class="glightbox" href="../images/439ba41ed61e26b4ffc4c42081441e83.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="439ba41ed61e26b4ffc4c42081441e83.png" auto_="auto;" display="block;" margin:="margin:" src="../images/439ba41ed61e26b4ffc4c42081441e83.png" /></a></p>
<p>Называем наш класс <code>CoreProjectFunctionLibrary</code>. Размещаем его в подпапке <code>Library</code>.</p>
<p><a class="glightbox" href="../images/e15d095e8f45ebc3a2c0e6a27769f1c5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e15d095e8f45ebc3a2c0e6a27769f1c5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e15d095e8f45ebc3a2c0e6a27769f1c5.png" /></a></p>
<p>После нажатия кнопки <code>CreateClass</code> движок откроет перед вами окно с вопросом, желаете ли вы запуска <code>Visual Studio</code>. Жмем - <code>No</code>.</p>
<p><a class="glightbox" href="../images/e952e0627683b5183c41ce15ad16b0f3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e952e0627683b5183c41ce15ad16b0f3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e952e0627683b5183c41ce15ad16b0f3.png" /></a></p>
<p>Закрываем движок.</p>
<p>Переоткрываем проект с пересборкой модулей. Для этого нажимаем на файл <code>GASBase.uproject</code> в папке проекта. После чего перед вами появится всплывающее окно, с вопросом - желаете ли вы пересобрать проект. Жмете <code>Да</code> / <code>Yes</code>.</p>
<p><a class="glightbox" href="../images/6afe809824005f20ce06b79a88034a66.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6afe809824005f20ce06b79a88034a66.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6afe809824005f20ce06b79a88034a66.png" /></a></p>
<h3 id="_4">Добавляем зависимости</h3>
<p>Если все сделано правильно, то, после запуска движка, в меню <code>Tools</code> появятся новые пункты - <code>Refresh Visual Studio 2022 Project</code> и <code>Open Visual Studio 2022</code>.</p>
<p><a class="glightbox" href="../images/242d8da89a9e4eb027cefc93b0edea81.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="242d8da89a9e4eb027cefc93b0edea81.png" auto_="auto;" display="block;" margin:="margin:" src="../images/242d8da89a9e4eb027cefc93b0edea81.png" /></a></p>
<p>Выбираем <code>Open Visual Studio 2022</code>.
В <code>Solution Explorer</code> открывавем папку <code>Source -&gt; GASBase</code>. Это главный модуль игры. Тут есть файл с расширением <code>.build.cs</code>, в моем случае он называется <code>GASBase.Build.cs</code>.</p>
<p><a class="glightbox" href="../images/07a73edb0da5b7c2dda0a249edf53a4b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="07a73edb0da5b7c2dda0a249edf53a4b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/07a73edb0da5b7c2dda0a249edf53a4b.png" /></a></p>
<p>В этом файле необходимо указать зависимости нашего проекта.</p>
<p>Система <code>GAS</code> рекомендует включать следующие зависимости: <code>GameplayAbilities</code>, <code>GameplayTags</code> и <code>GameplayTasks</code>. Я так-же добавлю к ним <code>InputCore</code>, <code>EnhancedInput</code>, <code>SlateCore</code> и <code>Slate</code>.
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="n">UnrealBuildTool</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">GASBase</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ModuleRules</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">GASBase</span><span class="p">(</span><span class="n">ReadOnlyTargetRules</span><span class="w"> </span><span class="n">Target</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">base</span><span class="p">(</span><span class="n">Target</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">PCHUsage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PCHUsageMode</span><span class="p">.</span><span class="n">UseExplicitOrSharedPCHs</span><span class="p">;</span>
<span class="w">        </span><span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;Core&quot;</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CoreUObject&quot;</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Engine&quot;</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;InputCore&quot;</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;EnhancedInput&quot;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="n">PrivateDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;GameplayAbilities&quot;</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GameplayTags&quot;</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GameplayTasks&quot;</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SlateCore&quot;</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Slate&quot;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/4fd1d537f452be82d6784d7fcbb09cb5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4fd1d537f452be82d6784d7fcbb09cb5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4fd1d537f452be82d6784d7fcbb09cb5.png" /></a></p>
<p>Пересобираем проект с помощью <code>LiveCoding</code> сочетанием клавиш <code>Ctrl + Alt + F11</code>.</p>
<p><a class="glightbox" href="../images/9b3454b505c597226dee66e4459621ec.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9b3454b505c597226dee66e4459621ec.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9b3454b505c597226dee66e4459621ec.png" /></a></p>
<p>Если все скомпилировалось успешно - мы готовы к работе.</p>
<h2 id="attributeset">Добавляем <code>AttributeSet</code></h2>
<h3 id="attributeset_1">Введение в <code>AttributeSet</code></h3>
<p><code>AttributeSet</code> это класс, в котором разработчик должен задать аттрибуты для работы с системой <code>GAS</code>. Про аттрибуты мы поговорим чуть ниже, в этой главе, а пока просто создадим класс и заполним его базовым набором инструкций.</p>
<h3 id="_5">Создаем класс</h3>
<p>Выполняем команду <code>Tools -&gt; New C++ Class -&gt; All Classes</code> ищем в списке <code>AttributeSet</code>.</p>
<p><a class="glightbox" href="../images/39c93a7bbeb3bc336b976fc659fd62ee.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="39c93a7bbeb3bc336b976fc659fd62ee.png" auto_="auto;" display="block;" margin:="margin:" src="../images/39c93a7bbeb3bc336b976fc659fd62ee.png" /></a></p>
<p>Называем новый класс <code>CharacterAttributeSet</code> и добавляем его в модуль <code>GASModule</code>, в папку <code>Attributes</code>.</p>
<p><a class="glightbox" href="../images/5974dde8c78f2d174b3fd6a856b77841.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5974dde8c78f2d174b3fd6a856b77841.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5974dde8c78f2d174b3fd6a856b77841.png" /></a></p>
<p><a class="glightbox" href="../images/602aa13ad7f1228d8f5a1005cadec033.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="602aa13ad7f1228d8f5a1005cadec033.png" auto_="auto;" display="block;" margin:="margin:" src="../images/602aa13ad7f1228d8f5a1005cadec033.png" /></a></p>
<p>Открываем файл <code>CharacterAttributeSet.h</code>.</p>
<h3 id="attribute_accessors">Добавляем макрос <code>ATTRIBUTE_ACCESSORS</code></h3>
<p>Каждый класс <code>AttributeSet</code> должен содержать макрос <code>ATTRIBUTE_ACCESSORS</code> со следующим определением:
<div class="highlight"><pre><span></span><code><span class="c1">// Uses macros from AttributeSet.h</span>
<span class="cp">#define ATTRIBUTE_ACCESSORS(ClassName, PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_PROPERTY_GETTER(ClassName, PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_GETTER(PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_SETTER(PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_INITTER(PropertyName)</span>
</code></pre></div>
Рекомендации по использованию данного макроса могут быть найдены в исходных файлах движка -  <code>\Engine\Plugins\Runtime\GameplayAbilities\Source\GameplayAbilities\Public\AttributeSet.h</code>.</p>
<p><a class="glightbox" href="../images/1c03e0b66f368b684d98bd315047085b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1c03e0b66f368b684d98bd315047085b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1c03e0b66f368b684d98bd315047085b.png" /></a></p>
<p>Добавляем макрос <code>ATTRIBUTE_ACCESSORS</code> в <code>CharacterAttributeSet</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//CharacterAttributeSet.h</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AttributeSet.h&quot;</span><span class="c1"> // core</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Net/UnrealNetwork.h&quot;</span><span class="c1"> // DOREPLIFETIME_CONDITION_NOTIFY macro</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayEffectExtension.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CharacterAttributeSet.generated.h&quot;</span>
<span class="c1">// Uses macros from AttributeSet.h</span>
<span class="cp">#define ATTRIBUTE_ACCESSORS(ClassName, PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_PROPERTY_GETTER(ClassName, PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_GETTER(PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_SETTER(PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_INITTER(PropertyName)</span>
<span class="cm">/**</span>
<span class="cm"> * Character related attributes</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UAttributeSet</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="cm">/* Attributes will be here */</span>
<span class="p">};</span>
</code></pre></div>
Самое время добавить аттрибуты.</p>
<h3 id="_6">Введение в Аттрибуты</h3>
<p>Аттрибут - это переменная, которая используется разработчиком, для описания игровых характеристик персонажа. Аттрибутами являются: здоровье, выносливость, броня, скорость передвижения.</p>
<p>Пример аттрибута, отвечающего за здоровье персонажа:
<div class="highlight"><pre><span></span><code><span class="c1">// Current Health</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_Health</span><span class="p">)</span>
<span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Health</span><span class="p">;</span>
<span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UGameCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">)</span>
</code></pre></div>
Аттрибут описывается структурой <code>FGameplayAttributeData</code>. Данная структура может быть найдена в файле <code>\Engine\Plugins\Runtime\GameplayAbilities\Source\GameplayAbilities\Public\AttributeSet.h</code>.</p>
<p><a class="glightbox" href="../images/81eef4cce767fddafc5c700c74e2d9ea.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="81eef4cce767fddafc5c700c74e2d9ea.png" auto_="auto;" display="block;" margin:="margin:" src="../images/81eef4cce767fddafc5c700c74e2d9ea.png" /></a></p>
<h4 id="_7">Шаги для добавления аттрибута</h4>
<p>Рассмотрим формулу, по которой добавляется почти каждый аттрибут.</p>
<p>В коде используются следующие заголовочные файлы:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AttributeSet.h&quot;</span><span class="c1"> // core</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Net/UnrealNetwork.h&quot;</span><span class="c1"> // DOREPLIFETIME_CONDITION_NOTIFY macro</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayEffectExtension.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
</code></pre></div></p>
<h5 id="1">Шаг 1</h5>
<p>Добавляем аттрибут.
<div class="highlight"><pre><span></span><code><span class="c1">// Current Health</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_Health</span><span class="p">)</span>
<span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Health</span><span class="p">;</span>
<span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">)</span>
</code></pre></div></p>
<h5 id="2">Шаг 2</h5>
<p>Задаем значение "по умолчанию" в конструкторе класса.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// Set Attribute Default Values in Constructor</span>
<span class="n">UCharacterAttributeSet</span><span class="p">();</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Set Attribute Default Values in Constructor</span>
<span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">UCharacterAttributeSet</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<h5 id="3">Шаг 3</h5>
<p>Создаем метод сетевой репликации аттрибута. Это надо делать только для основных аттрибутов, например для здоровья. Если аттрибут влияет на другие аттрибуты, но сам не предоставляет дополнительной логики - например регенерация здоровья - делать для него репликацию не нужно.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// Current Health</span>
<span class="c1">// make ReplicatedUsing = OnRep_Health</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_Health</span><span class="p">)</span>
<span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Health</span><span class="p">;</span>
<span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">)</span>
<span class="c1">// Attributes replication live time</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">GetLifetimeReplicatedProps</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FLifetimeProperty</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">OutLifetimeProps</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">// Health replication</span>
<span class="n">UFUNCTION</span><span class="p">()</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnRep_Health</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Attributes replication live time</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCharacterAttributeSet::GetLifetimeReplicatedProps</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FLifetimeProperty</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">OutLifetimeProps</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetLifetimeReplicatedProps</span><span class="p">(</span><span class="n">OutLifetimeProps</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Health</span>
<span class="w">    </span><span class="c1">// do same for all attributes:</span>
<span class="w">    </span><span class="n">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="n">COND_None</span><span class="p">,</span><span class="w"> </span><span class="n">REPNOTIFY_Always</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Health Replication</span>
<span class="c1">// for all attributes this method has same pattern</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCharacterAttributeSet::OnRep_Health</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GAMEPLAYATTRIBUTE_REPNOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h5 id="4">Шаг 4</h5>
<p>Фиксируем изменение аттрибута в определенных рамках, чтобы избежать нарушения игровой логики.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cm">/**</span>
<span class="cm"> * BASE and CURRENT value attribute change</span>
<span class="cm"> * BASE attribute values are NOT Modified by the Gameplay Effects</span>
<span class="cm"> * CURRENT attribute value is BASE value +- Gameplay Effect modifiers</span>
<span class="cm"> */</span>
<span class="cm">/**</span>
<span class="cm"> * CURRENT attribute value change notifies :</span>
<span class="cm"> */</span>
<span class="c1">// Called just before any modification happens to an attribute. This is lower level than PreAttributeModify/PostAttribute modify.</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PreAttributeChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="cm">/**</span>
<span class="cm"> * BASE attribute value change notifies :</span>
<span class="cm"> */</span>
<span class="c1">// Called just before any modification happens to an attribute&#39;s base value when an attribute aggregator exists</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PreAttributeBaseChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">// Clamp attributes to keep their values in range</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ClampAttributeOnChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AffectedAttribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Called just before any modification happens to an attribute&#39;s base value when an attribute aggregator exists</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCharacterAttributeSet::PreAttributeBaseChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PreAttributeBaseChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">ClampAttributeOnChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Called just before any modification happens to an attribute. This is lower level than PreAttributeModify/PostAttribute modify.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCharacterAttributeSet::PreAttributeChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PreAttributeChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">ClampAttributeOnChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Clamp attributes to keep their values in range</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCharacterAttributeSet::ClampAttributeOnChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AffectedAttribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AffectedAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetHealthAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxHealth</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Эта последовательность шагов повторяется для почти каждого из создаваемых аттрибутов.</p>
<hr />
<h4 id="basevalue-currentvalue"><code>BaseValue</code> и <code>CurrentValue</code></h4>
<p>Каждый аттрибут имеет два значения:</p>
<ol>
<li><code>BaseValue</code> - значение аттрибута, без модификаций.</li>
<li><code>CurrentValue</code> - значение аттрибута, который модифицирован наложенными эффектами.</li>
</ol>
<p>Предположим, есть аттрибут скорости передвижения персонажа - <code>Speed</code>.
Изначальное значение аттрибута равно:<code>Speed = 600</code>. Если наложить на персонажа эффект ускорения, увеличивающий <code>Speed</code> на <code>50</code> единиц, то внутри аттрибута мы буедем иметь следующие значения: <code>BaseValue = 600</code>, <code>CurrentValue = 650</code>.
Когда все эффекты снимаются с персонажа или их время действия истекает <code>CurrentValue</code> принимает значение, которое хранится в <code>BaseValue</code>.</p>
<h4 id="_8">Максимальные и минимальные значения атрибутов</h4>
<p>Макисмальные и минимальные значения аттрибута должны задаваться в виде отдельных аттрибутов. Необходимость такого разделения связана с сетевой составляющей системы.</p>
<p>Если минимальным значением аттрибута всегда является <code>0</code>, а максимальным, например, <code>100</code> и менять эти значения вы не собираетесь в будущем - можете отдельные аттрибуты под эти значения не создавать.</p>
<p>Рассмотрим реализацию аттрибута здоровья.</p>
<p>Поскольку с повышением уровня персонажа предполагается увеличение его запаса здоровья, максимальное значение здоровья должно быть задано в виде отдельного аттрибута.
<div class="highlight"><pre><span></span><code><span class="c1">// Current Health</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_Health</span><span class="p">)</span>
<span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Health</span><span class="p">;</span>
<span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UGameCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">)</span>
<span class="c1">// MaxHealth is its own attribute since GameplayEffects may modify it</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_MaxHealth</span><span class="p">)</span>
<span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">;</span>
<span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UGameCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">)</span>
</code></pre></div>
Для фиксации значения аттрибута в границах от минимума до максимума используют вспомогательный метод <code>ClampAttributeOnChange</code> который выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// Clamp attributes to keep their values in range</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ClampAttributeOnChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AffectedAttribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AffectedAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetHealthAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxHealth</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cm">/* add more if necessary */</span>
<span class="p">}</span>
</code></pre></div>
Для каждого аттрибута, который необходимо фиксировать в определенных рамках, используется дополнительное условие внутри метода <code>ClampAttributeOnChange</code>.
Данный метод вызывается в <code>PreAttributeChange</code> и <code>PreAttributeBaseChange</code>. Это гарантирует, что аттрибут с наложенными на него эффектами и без эффектов - всегда останется в заданных границах.
<div class="highlight"><pre><span></span><code><span class="c1">// Called just before any modification happens to an attribute. This is lower level than PreAttributeModify/PostAttribute modify.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">PreAttributeChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PreAttributeChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">ClampAttributeOnChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Called just before any modification happens to an attribute&#39;s base value when an attribute aggregator exists</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">PreAttributeBaseChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PreAttributeBaseChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">ClampAttributeOnChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="_9">Репликация вторичных аттрибутов</h4>
<p>Аттрибуты, которые не имеют сетевой репликации и используются для обновления других аттрибутов считаются "вторичными" аттрибутами. К примеру, таким аттрибутом является <code>HealthRegenRate</code>, скорость восстановления здоровья. Этому  аттрибуту не нужна сетевая репликация, потому что показатель здоровья, на который этот аттрибут влияет - и без того реплицируется по сети, а значит мы избавляемся от лишней нагрузки.
<div class="highlight"><pre><span></span><code><span class="c1">// Health Regen Rate</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">)</span>
<span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">HealthRegenRate</span><span class="p">;</span>
<span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">HealthRegenRate</span><span class="p">)</span>
</code></pre></div></p>
<h5 id="postgameplayeffectexecute"><code>PostGameplayEffectExecute</code></h5>
<p>Данный метод вызывается после применения всех модификаторов эффекта к <code>BaseValue</code> аттрибута.</p>
<p>Логика нанесения урона обычно выполняется с использованием соответствующих эффектов урона. В методе <code>PostGameplayEffectExecute</code> вы можете проверить - убил урон персонажа или нет.</p>
<p>Так-же, используя данный метод можно "аккумулировать" урон, нанесенный персонажу. Это бывает полезно в сетевых играх, где соединение не всегда достаточно надежное и время применения эффектов урона на игроках между клиентами - разное. В этом случае вы можете использовать стакающийся эффект урона, например такой:</p>
<p><a class="glightbox" href="../images/dbd42ca544120429d175f13d0a2af221.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dbd42ca544120429d175f13d0a2af221.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dbd42ca544120429d175f13d0a2af221.png" /></a></p>
<p>При стрельбе очередями в шутерах крайне накладно обрабатывать каждое попадание на сервере. Куда удобнее будет реализовать такой стакающийся эффект, который затем будет обработан через <code>PostGameplayEffectExecute</code>.
Тут мы немного забегаем вперед, но я все-же покажу как такой подход работает.</p>
<p>У нас есть нпц-цель.</p>
<p><a class="glightbox" href="../images/9a998f5f255cc38b2ed891a73c855119.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9a998f5f255cc38b2ed891a73c855119.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9a998f5f255cc38b2ed891a73c855119.png" /></a></p>
<p>В лог печатается урон, который будет нанесен здоровью за текущий тик:</p>
<p><a class="glightbox" href="../images/7670d5ddfa47ecad649a55a382e70498.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7670d5ddfa47ecad649a55a382e70498.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7670d5ddfa47ecad649a55a382e70498.png" /></a></p>
<p>При множественном наложении эффектов урона - их значение возрастает и они накладываются на здоровье все "разом".</p>
<p>Именно для такой <code>batched</code> обработки изменений от всех эффектов стоит использовать <code>PostGameplayEffectExecute</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cm">/**</span>
<span class="cm"> * Gameplay Effects execution</span>
<span class="cm"> */</span>
<span class="w"> </span><span class="c1">// Called just before a GameplayEffect is executed to modify the base value of an attribute</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PostGameplayEffectExecute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">FGameplayEffectModCallbackData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Called just before a GameplayEffect is executed to modify the base value of an attribute</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCharacterAttributeSet::PostGameplayEffectExecute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectModCallbackData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PostGameplayEffectExecute</span><span class="p">(</span><span class="n">Data</span><span class="p">);</span>
<span class="w">    </span><span class="n">FGameplayEffectContextHandle</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">EffectSpec</span><span class="p">.</span><span class="n">GetContext</span><span class="p">();</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">Source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">.</span><span class="n">GetOriginalInstigatorAbilitySystemComponent</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Get the Target actor, which should be our owner</span>
<span class="w">    </span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">TargetActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">TargetController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">TargetAbilitySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AvatarActor</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">TargetActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AvatarActor</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">TargetAbilitySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">TargetController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">PlayerController</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Get the Source actor</span>
<span class="w">    </span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">SourceActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">SourceController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">SourceAbilitySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Source</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AvatarActor</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">SourceActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AvatarActor</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SourceAbilitySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SourceController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">PlayerController</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// damage application</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">EvaluatedData</span><span class="p">.</span><span class="n">Attribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetHealthAttribute</span><span class="p">()</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">EvaluatedData</span><span class="p">.</span><span class="n">ModifierOp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGameplayModOp</span><span class="o">::</span><span class="n">Additive</span><span class="w"> </span><span class="c1">// modifier with Add value set</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// get clamped damage to prevent very big damage numbers, just in case</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">LocalDamageDone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetAppliedDamage</span><span class="p">();</span>
<span class="w">        </span><span class="n">SetAppliedDamage</span><span class="p">(</span><span class="mf">0.f</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear damage attribute to prevent multiple applications</span>
<span class="w">        </span><span class="c1">// *note, damage can be - or +</span>
<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LocalDamageDone</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;LocalDamageDone = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">LocalDamageDone</span><span class="p">)</span>
<span class="w">            </span><span class="c1">// Apply the health change and then clamp it</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">LocalDamageDone</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxHealth</span><span class="p">());</span>
<span class="w">            </span><span class="c1">// update health</span>
<span class="w">            </span><span class="n">SetHealth</span><span class="p">(</span><span class="n">NewValue</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_10">Код</h3>
<h4 id="characterattributeseth"><code>CharacterAttributeSet.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AttributeSet.h&quot;</span><span class="c1"> // core</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Net/UnrealNetwork.h&quot;</span><span class="c1"> // DOREPLIFETIME_CONDITION_NOTIFY macro</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayEffectExtension.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CharacterAttributeSet.generated.h&quot;</span>
<span class="c1">// Uses macros from AttributeSet.h</span>
<span class="cp">#define ATTRIBUTE_ACCESSORS(ClassName, PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_PROPERTY_GETTER(ClassName, PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_GETTER(PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_SETTER(PropertyName) \</span>
<span class="cp">    GAMEPLAYATTRIBUTE_VALUE_INITTER(PropertyName)</span>
<span class="cm">/**</span>
<span class="cm"> * Character related attributes</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UAttributeSet</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Set Attribute Default Values in Constructor</span>
<span class="w">    </span><span class="n">UCharacterAttributeSet</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Current Health</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_Health</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Health</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// MaxHealth is its own attribute since GameplayEffects may modify it</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_MaxHealth</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Health Regen Rate</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">HealthRegenRate</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">HealthRegenRate</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Current stamina Capped by MaxStamina.</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_Stamina</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Stamina</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Stamina</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// MaxStamina is its own attribute since GameplayEffects may modify it</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_MaxStamina</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">MaxStamina</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStamina</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Stamina Regen Rate</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">StaminaRegenRate</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">StaminaRegenRate</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Current Mana, used to execute special abilities. Capped by MaxMana.</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_Mana</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Mana</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Mana</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// MaxMana is its own attribute since GameplayEffects may modify it</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_MaxMana</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">MaxMana</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxMana</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Mana Regen Rate</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">ManaRegenRate</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">ManaRegenRate</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Current Armor</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ReplicatedUsing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnRep_Armor</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Armor</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Armor</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Applied Damage to the character on current update</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">AppliedDamage</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">AppliedDamage</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Current character&#39;s strength</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Attributes&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FGameplayAttributeData</span><span class="w"> </span><span class="n">Strength</span><span class="p">;</span>
<span class="w">    </span><span class="n">ATTRIBUTE_ACCESSORS</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Strength</span><span class="p">)</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * BASE and CURRENT value attribute change</span>
<span class="cm">     * BASE attribute values are NOT Modified by the Gameplay Effects</span>
<span class="cm">     * CURRENT attribute value is BASE value +- Gameplay Effect modifiers</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * CURRENT attribute value change notifies :</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Called just before any modification happens to an attribute. This is lower level than PreAttributeModify/PostAttribute modify.</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">PreAttributeChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Called just after any modification happens to an attribute.</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PostAttributeChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * BASE attribute value change notifies :</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Called just before any modification happens to an attribute&#39;s base value when an attribute aggregator exists</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PreAttributeBaseChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Called just after any modification happens to an attribute&#39;s base value when an attribute aggregator exists</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PostAttributeBaseChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Gameplay Effects execution</span>
<span class="cm">     */</span>
<span class="w">     </span><span class="c1">// Called just before a GameplayEffect is executed to modify the base value of an attribute</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PostGameplayEffectExecute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">FGameplayEffectModCallbackData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Called just before modifying the value of an attribute.</span>
<span class="w">    </span><span class="c1">// AttributeSet can make additional modifications here. Return true to continue, or false to throw out the modification</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">PreGameplayEffectExecute</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">FGameplayEffectModCallbackData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Clamp attributes to keep their values in range</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">ClampAttributeOnChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AffectedAttribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Replication</span>
<span class="w">    </span><span class="c1">// Attributes replication live time</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetLifetimeReplicatedProps</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FLifetimeProperty</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">OutLifetimeProps</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">()</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnRep_Health</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">()</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnRep_MaxHealth</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">()</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnRep_Stamina</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">()</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnRep_MaxStamina</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">()</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnRep_Mana</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">()</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnRep_MaxMana</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">()</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">OnRep_Armor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="characterattributesetcpp"><code>CharacterAttributeSet.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Attributes/CharacterAttributeSet.h&quot;</span>
<span class="c1">// Set Attribute Default Values in Constructor</span>
<span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">UCharacterAttributeSet</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">MaxHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">HealthRegenRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">Stamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">MaxStamina</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">StaminaRegenRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">Mana</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">MaxMana</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">ManaRegenRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">AppliedDamage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">    </span><span class="n">Armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/**</span>
<span class="cm"> * CURRENT attribute value change notifies :</span>
<span class="cm"> */</span>
<span class="c1">// Called just before any modification happens to an attribute. This is lower level than PreAttributeModify/PostAttribute modify.</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">PreAttributeChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PreAttributeChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">ClampAttributeOnChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Called just after any modification happens to an attribute</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">PostAttributeChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PostAttributeChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/**</span>
<span class="cm"> * BASE attribute value change notifies :</span>
<span class="cm"> */</span>
<span class="c1">// Called just before any modification happens to an attribute&#39;s base value when an attribute aggregator exists</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">PreAttributeBaseChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PreAttributeBaseChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">ClampAttributeOnChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Called just after any modification happens to an attribute&#39;s base value when an attribute aggregator exists.</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">PostAttributeBaseChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PostAttributeBaseChange</span><span class="p">(</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/**</span>
<span class="cm"> * Gameplay Effects execution</span>
<span class="cm"> */</span>
<span class="c1">// Called just before a GameplayEffect is executed to modify the base value of an attribute</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">PostGameplayEffectExecute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectModCallbackData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PostGameplayEffectExecute</span><span class="p">(</span><span class="n">Data</span><span class="p">);</span>
<span class="w">    </span><span class="n">FGameplayEffectContextHandle</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">EffectSpec</span><span class="p">.</span><span class="n">GetContext</span><span class="p">();</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">Source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">.</span><span class="n">GetOriginalInstigatorAbilitySystemComponent</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Get the Target actor, which should be our owner</span>
<span class="w">    </span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">TargetActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">TargetController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">TargetAbilitySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AvatarActor</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">TargetActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AvatarActor</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">TargetAbilitySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">TargetController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">PlayerController</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Get the Source actor</span>
<span class="w">    </span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">SourceActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">SourceController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">SourceAbilitySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Source</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="p">.</span><span class="n">IsValid</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AvatarActor</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">SourceActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AvatarActor</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SourceAbilitySystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">AbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">SourceController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Source</span><span class="o">-&gt;</span><span class="n">AbilityActorInfo</span><span class="o">-&gt;</span><span class="n">PlayerController</span><span class="p">.</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// damage application</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">EvaluatedData</span><span class="p">.</span><span class="n">Attribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetHealthAttribute</span><span class="p">()</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">EvaluatedData</span><span class="p">.</span><span class="n">ModifierOp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGameplayModOp</span><span class="o">::</span><span class="n">Additive</span><span class="w"> </span><span class="c1">// modifier with Add value set</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// get clamped damage to prevent very big damage numbers, just in case</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">LocalDamageDone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetAppliedDamage</span><span class="p">();</span>
<span class="w">        </span><span class="n">SetAppliedDamage</span><span class="p">(</span><span class="mf">0.f</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear damage attribute to prevent multiple applications</span>
<span class="w">        </span><span class="c1">// *note, damage can be - or +</span>
<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LocalDamageDone</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;LocalDamageDone = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">LocalDamageDone</span><span class="p">)</span>
<span class="w">            </span><span class="c1">// Apply the health change and then clamp it</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">GetHealth</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">LocalDamageDone</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxHealth</span><span class="p">());</span>
<span class="w">            </span><span class="c1">// update health</span>
<span class="w">            </span><span class="n">SetHealth</span><span class="p">(</span><span class="n">NewValue</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Clamp attributes to keep their values in range</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">ClampAttributeOnChange</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="o">&amp;</span><span class="w"> </span><span class="n">AffectedAttribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">NewValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// health</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AffectedAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetHealthAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxHealth</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// health regen rate</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AffectedAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetHealthRegenRateAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxHealth</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// stamina</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AffectedAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetStaminaAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxStamina</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// stamina regen rate</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AffectedAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetStaminaRegenRateAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxStamina</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// mana</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AffectedAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetManaAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxMana</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// mana regen rate</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AffectedAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GetManaRegenRateAttribute</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NewValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GetMaxMana</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Attributes replication live time</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">GetLifetimeReplicatedProps</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FLifetimeProperty</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">OutLifetimeProps</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetLifetimeReplicatedProps</span><span class="p">(</span><span class="n">OutLifetimeProps</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Health</span>
<span class="w">    </span><span class="n">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="n">COND_None</span><span class="p">,</span><span class="w"> </span><span class="n">REPNOTIFY_Always</span><span class="p">);</span>
<span class="w">    </span><span class="n">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">,</span><span class="w"> </span><span class="n">COND_None</span><span class="p">,</span><span class="w"> </span><span class="n">REPNOTIFY_Always</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Stamina</span>
<span class="w">    </span><span class="n">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Stamina</span><span class="p">,</span><span class="w"> </span><span class="n">COND_None</span><span class="p">,</span><span class="w"> </span><span class="n">REPNOTIFY_Always</span><span class="p">);</span>
<span class="w">    </span><span class="n">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStamina</span><span class="p">,</span><span class="w"> </span><span class="n">COND_None</span><span class="p">,</span><span class="w"> </span><span class="n">REPNOTIFY_Always</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Mana</span>
<span class="w">    </span><span class="n">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Mana</span><span class="p">,</span><span class="w"> </span><span class="n">COND_None</span><span class="p">,</span><span class="w"> </span><span class="n">REPNOTIFY_Always</span><span class="p">);</span>
<span class="w">    </span><span class="n">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxMana</span><span class="p">,</span><span class="w"> </span><span class="n">COND_None</span><span class="p">,</span><span class="w"> </span><span class="n">REPNOTIFY_Always</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Armor</span>
<span class="w">    </span><span class="n">DOREPLIFETIME_CONDITION_NOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Armor</span><span class="p">,</span><span class="w"> </span><span class="n">COND_None</span><span class="p">,</span><span class="w"> </span><span class="n">REPNOTIFY_Always</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Health Replication</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">OnRep_Health</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GAMEPLAYATTRIBUTE_REPNOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">OnRep_MaxHealth</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GAMEPLAYATTRIBUTE_REPNOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxHealth</span><span class="p">,</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Stamina Replication</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">OnRep_Stamina</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GAMEPLAYATTRIBUTE_REPNOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Stamina</span><span class="p">,</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">OnRep_MaxStamina</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GAMEPLAYATTRIBUTE_REPNOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxStamina</span><span class="p">,</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Mana Replication</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">OnRep_Mana</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GAMEPLAYATTRIBUTE_REPNOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Mana</span><span class="p">,</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">OnRep_MaxMana</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GAMEPLAYATTRIBUTE_REPNOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">MaxMana</span><span class="p">,</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Armor Replication</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UCharacterAttributeSet</span><span class="o">::</span><span class="n">OnRep_Armor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAttributeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Old</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GAMEPLAYATTRIBUTE_REPNOTIFY</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Armor</span><span class="p">,</span><span class="w"> </span><span class="n">Old</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_11">Создаем класс персонажа</h2>
<p>Добавим класс персонажа и зарегистрируем его в системе <code>GAS</code> через <code>Ability System Component</code>.
Выполняем команду <code>Tools -&gt; New C++ Class</code> и в появившемся окне выбираем класс - <code>Character</code>.</p>
<p><a class="glightbox" href="../images/9ad556c6be7d0c8e3b0f1a866e8fab53.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9ad556c6be7d0c8e3b0f1a866e8fab53.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9ad556c6be7d0c8e3b0f1a866e8fab53.png" /></a></p>
<p>Называем будущий класс <code>CoreCharacter</code> и размещаем его в папке <code>Characters</code>.</p>
<p><a class="glightbox" href="../images/31a69b8d1f8ed429122c240d2fcfe683.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="31a69b8d1f8ed429122c240d2fcfe683.png" auto_="auto;" display="block;" margin:="margin:" src="../images/31a69b8d1f8ed429122c240d2fcfe683.png" /></a></p>
<p><a class="glightbox" href="../images/15ab243cfbb9d3a2bc29ef7ac3bd2994.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="15ab243cfbb9d3a2bc29ef7ac3bd2994.png" auto_="auto;" display="block;" margin:="margin:" src="../images/15ab243cfbb9d3a2bc29ef7ac3bd2994.png" /></a></p>
<h3 id="_12">Добавляем стартовый код персонажа</h3>
<p>В одной из предыдущих глав я создал базовую заготовку для класса <code>Character</code>, которая уже поддерживает <code>EnhancedInput</code>. Используем эту заготовку в нашем проекте.</p>
<h4 id="corecharacterh"><code>CoreCharacter.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// Enhanced Input</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputMappingContext.h&quot;</span><span class="c1"> // Mapping Context</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EnhancedInputSubsystems.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EnhancedInputComponent.h&quot;</span>
<span class="c1">// Kismet</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/GameplayStatics.h&quot;</span>
<span class="c1">// Capsule Component</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Components/CapsuleComponent.h&quot;</span>
<span class="c1">// Character Movement</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/CharacterMovementComponent.h&quot;</span>
<span class="c1">// Camera</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Camera/CameraComponent.h&quot;</span>
<span class="c1">// Spring Arm</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/SpringArmComponent.h&quot;</span>
<span class="c1">// generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreCharacter.generated.h&quot;</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ACoreCharacter</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ACharacter</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Sets default values for this character&#39;s properties</span>
<span class="w">    </span><span class="n">ACoreCharacter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/** =======================================================</span>
<span class="cm">     * Sub Objects</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Spring Arm</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">VisibleAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Camera</span><span class="p">)</span>
<span class="w">    </span><span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">USpringArmComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CameraBoom</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Camera</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">VisibleAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Camera</span><span class="p">)</span>
<span class="w">    </span><span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">UCameraComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FollowCamera</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** =======================================================</span>
<span class="cm">     * Variables</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// MappingContext</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Input</span><span class="p">)</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MappingContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Called when the game starts or when spawned</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Movement Input</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Move</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Camera Input</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Rotate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Sprint</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StartSprint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// End Sprint</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">EndSprint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// will bind new mapping context</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Input&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">BindContext</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">OnController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Called every frame</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Called to bind functionality to input</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetupPlayerInputComponent</span><span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Once character posessed</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PossessedBy</span><span class="p">(</span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">NewController</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="corecharactercpp"><code>CoreCharacter.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Characters/CoreCharacter.h&quot;</span>
<span class="c1">// Sets default values</span>
<span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">ACoreCharacter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// SpringArm for the camera</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">USpringArmComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CameraBoom&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">SetRelativeLocation</span><span class="p">(</span><span class="n">FVector3d</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">8.492264f</span><span class="p">));</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">SetupAttachment</span><span class="p">(</span><span class="n">RootComponent</span><span class="p">);</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">TargetArmLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400.0f</span><span class="p">;</span><span class="w"> </span><span class="c1">// The camera follows at this distance behind the character</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">bUsePawnControlRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Rotate the arm based on the controller</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">bInheritPitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">bInheritYaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">bInheritRoll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Camera</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UCameraComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FollowCamera&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">SetupAttachment</span><span class="p">(</span><span class="n">CameraBoom</span><span class="p">,</span><span class="w"> </span><span class="n">USpringArmComponent</span><span class="o">::</span><span class="n">SocketName</span><span class="p">);</span><span class="w"> </span><span class="c1">// Attach the camera to the end of the boom and let the boom adjust to match the controller orientation</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">bUsePawnControlRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Camera does not rotate relative to arm</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">Deactivate</span><span class="p">();</span><span class="w"> </span><span class="c1">// Deactivate camera by default to prevent performance issues</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Default Rotation Settings</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">bUseControllerRotationPitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">bUseControllerRotationYaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">bUseControllerRotationRoll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Set Character Movement values</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UCharacterMovementComponent</span><span class="o">*</span><span class="w"> </span><span class="n">CharMoveComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCharacterMovement</span><span class="p">();</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">bOrientRotationToMovement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// will force character to rotate towards velocity direction</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">RotationRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotator</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">500.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span><span class="w"> </span><span class="c1">// with rotation rate</span>
<span class="w">        </span><span class="c1">// Speed values</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">JumpZVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">700.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">AirControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.35f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">MaxWalkSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">250.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">MinAnalogWalkSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">BrakingDecelerationWalking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2000.f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Set Capsule Size</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UCapsuleComponent</span><span class="o">*</span><span class="w"> </span><span class="n">CapsuleComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCapsuleComponent</span><span class="p">();</span>
<span class="w">        </span><span class="n">CapsuleComp</span><span class="o">-&gt;</span><span class="n">InitCapsuleSize</span><span class="p">(</span><span class="mf">35.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">90.0f</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Load Default Skeletal Mesh</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">USkeletalMeshComponent</span><span class="o">*</span><span class="w"> </span><span class="n">MeshComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetMesh</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">GetSkeletalMeshAsset</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// set refrence here</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">MannequinAsset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.SkeletalMesh&#39;/Game/Assets/Mannequins/Meshes/SKM_Quinn.SKM_Quinn&#39;&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">USkeletalMesh</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SKMesh</span><span class="p">(</span><span class="n">MannequinAsset</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">SKMesh</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetSkeletalMesh</span><span class="p">(</span><span class="n">SKMesh</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// Load ainm instance as well</span>
<span class="w">            </span><span class="c1">// since we loading blueprint class, add _C at the end of the asset refrence</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">AnimationInstanceAsset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.AnimBlueprint&#39;/Game/Assets/Mannequins/Animations/ABP_Quinn.ABP_Quinn_C&#39;&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">TSoftClassPtr</span><span class="o">&lt;</span><span class="n">UAnimInstance</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CAnimInst</span><span class="p">(</span><span class="n">AnimationInstanceAsset</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">CAnimInst</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetAnimationMode</span><span class="p">(</span><span class="n">EAnimationMode</span><span class="o">::</span><span class="n">AnimationBlueprint</span><span class="p">);</span>
<span class="w">                </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetAnimInstanceClass</span><span class="p">(</span><span class="n">CAnimInst</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// Apply default parameters to the mesh</span>
<span class="w">            </span><span class="c1">// Relative Location</span>
<span class="w">            </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetRelativeLocation</span><span class="p">(</span><span class="n">FVector3d</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-89.0f</span><span class="p">));</span>
<span class="w">            </span><span class="c1">// Relative Rotation</span>
<span class="w">            </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetRelativeRotation</span><span class="p">(</span><span class="n">FRotator</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">270.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Load Default Mapping Context</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MappingContext</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/EnhancedInput.InputMappingContext&#39;/Game/Blueprints/Input/IMC_Default.IMC_Default&#39;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">MappingContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UKismetSystemLibrary</span><span class="o">::</span><span class="n">MakeSoftObjectPath</span><span class="p">(</span><span class="n">Path</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Called when the game starts or when spawned</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// bind input context to player controller</span>
<span class="w">    </span><span class="c1">// Important to be called in BeginPlay, since SetupPlayerInputComponent dosen&#39;t get called for AI&#39;s</span>
<span class="w">    </span><span class="n">BindContext</span><span class="p">(</span><span class="n">MappingContext</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">());</span>
<span class="p">}</span>
<span class="c1">// will bind new mapping context</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">BindContext</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">OnController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MappingContext</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// only because i don&#39;t want to crash app with check()</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetController</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">OnController</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PlayerController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get enhanced input component&#39;s subsystem</span>
<span class="w">    </span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">*</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">::</span><span class="n">GetSubsystem</span><span class="o">&lt;</span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">&gt;</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// input component</span>
<span class="w">    </span><span class="n">UEnhancedInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">EnhancedInputComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UEnhancedInputComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">InputComponent</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;ClearActionBindings(); // clear all bindings if necessary</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">ClearBindingsForObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear bindings only from this object</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// register mapping context</span>
<span class="w">        </span><span class="n">EiSubsystem</span><span class="o">-&gt;</span><span class="n">AddMappingContext</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="n">InputPriority</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// iterate over all mappings and put every unique action into the Map</span>
<span class="w">    </span><span class="c1">// since actions occur in the map multiple times, for every key binding</span>
<span class="w">    </span><span class="n">TMap</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">Actions</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FEnhancedActionKeyMapping</span><span class="w"> </span><span class="n">Mapping</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">GetMappings</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FName</span><span class="w"> </span><span class="n">ActionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Actions</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">ActionName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ActionName</span><span class="p">,</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Action Name = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// now differentiate actions in the loop and assign them according to the names</span>
<span class="w">    </span><span class="c1">// make sure to give action names accordingly</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TPair</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">ActionInfo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Actions</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">AName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Jumping</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// use integrated jump</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACharacter</span><span class="o">::</span><span class="n">Jump</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACharacter</span><span class="o">::</span><span class="n">StopJumping</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Moving</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Move&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Move</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Sprinting</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Sprint&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">StartSprint</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">EndSprint</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Looking around</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Look&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Rotate</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// On Possessed</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">PossessedBy</span><span class="p">(</span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">NewController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PossessedBy</span><span class="p">(</span><span class="n">NewController</span><span class="p">);</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewController</span><span class="o">-&gt;</span><span class="n">IsLocalPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Enable Camera only when character posessed by player</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsPlayer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">Activate</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Start Sprint</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">StartSprint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UCharacterMovementComponent</span><span class="o">*</span><span class="w"> </span><span class="n">CharMoveComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCharacterMovement</span><span class="p">();</span>
<span class="w">    </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">MaxWalkSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500.f</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// End Sprint</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">EndSprint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UCharacterMovementComponent</span><span class="o">*</span><span class="w"> </span><span class="n">CharMoveComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCharacterMovement</span><span class="p">();</span>
<span class="w">    </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">MaxWalkSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">250.f</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Movement Input</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Move</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// input is a Vector2D</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">MovementVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">FVector2D</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetController</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// find out which way is forward</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FRotator</span><span class="w"> </span><span class="n">Rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControlRotation</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FRotator</span><span class="w"> </span><span class="nf">YawRotation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Rotation</span><span class="p">.</span><span class="n">Yaw</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// get forward vector</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ForwardDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotationMatrix</span><span class="p">(</span><span class="n">YawRotation</span><span class="p">).</span><span class="n">GetUnitAxis</span><span class="p">(</span><span class="n">EAxis</span><span class="o">::</span><span class="n">X</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// get right vector</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">RightDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotationMatrix</span><span class="p">(</span><span class="n">YawRotation</span><span class="p">).</span><span class="n">GetUnitAxis</span><span class="p">(</span><span class="n">EAxis</span><span class="o">::</span><span class="n">Y</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// add movement</span>
<span class="w">        </span><span class="n">AddMovementInput</span><span class="p">(</span><span class="n">ForwardDirection</span><span class="p">,</span><span class="w"> </span><span class="n">MovementVector</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">        </span><span class="n">AddMovementInput</span><span class="p">(</span><span class="n">RightDirection</span><span class="p">,</span><span class="w"> </span><span class="n">MovementVector</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Roation Input</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Rotate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// input is a Vector2D</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">LookAxisVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">FVector2D</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">AddControllerYawInput</span><span class="p">(</span><span class="n">LookAxisVector</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
<span class="w">    </span><span class="n">AddControllerPitchInput</span><span class="p">(</span><span class="n">LookAxisVector</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Called every frame</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span><span class="n">DeltaTime</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* nothing */</span>
<span class="p">}</span>
<span class="c1">// Called to bind functionality to input</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="n">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="n">PlayerInputComponent</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="blueprint">Создаем <code>blueprint</code> персонажа</h3>
<p>В <code>Content Browser</code> нажмите на кнопку <code>Add -&gt; Blueprint Class</code>.</p>
<p><a class="glightbox" href="../images/12d7deb7b62d2f9406c264e0b60ea0c4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="12d7deb7b62d2f9406c264e0b60ea0c4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/12d7deb7b62d2f9406c264e0b60ea0c4.png" /></a></p>
<p>В окне выбора класса, на вкладке <code>All Classes</code> найдите пункт <code>CoreCharacter</code>.</p>
<p><a class="glightbox" href="../images/1b5a1a3c681266fd24ffaac629964453.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1b5a1a3c681266fd24ffaac629964453.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1b5a1a3c681266fd24ffaac629964453.png" /></a></p>
<p>Добавляем <code>blueprint</code> и называем его <code>BP_CoreCharacter</code>.</p>
<p><a class="glightbox" href="../images/7e521b349a600d06b0036173fad7aa8f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7e521b349a600d06b0036173fad7aa8f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7e521b349a600d06b0036173fad7aa8f.png" /></a></p>
<p>В созданном классе уже установлен базовый меш и подключены основные элементы управления.</p>
<p><a class="glightbox" href="../images/5c6b6d1af8f8b645d60ef1d86b3c232d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5c6b6d1af8f8b645d60ef1d86b3c232d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5c6b6d1af8f8b645d60ef1d86b3c232d.png" /></a></p>
<p>Если меш персонажа пуст - проверьте конструктор класса <code>ACoreCharacter</code>. В нем указаны ссылки на основные установленные "по умолчанию" ассеты.</p>
<p><a class="glightbox" href="../images/62c5b5efc6c66e3a8f7df43e4463a2a6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="62c5b5efc6c66e3a8f7df43e4463a2a6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/62c5b5efc6c66e3a8f7df43e4463a2a6.png" /></a></p>
<p>Добавим созданный нами класс в <code>GameMode</code>. В проекте <code>ThirdPerson</code> уже есть класс <code>GameMode</code>, который называется <code>BP_ThirdPersonGameMode</code>.</p>
<p><a class="glightbox" href="../images/aca983194e4ac06a3f1e0d425fd2975f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="aca983194e4ac06a3f1e0d425fd2975f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/aca983194e4ac06a3f1e0d425fd2975f.png" /></a></p>
<p>Открываем его. Устанавливаем ссылку на нашего персонажа в параметр <code>Default Pawn Class</code>.</p>
<p><a class="glightbox" href="../images/899d027ee6340a79057225148fe5d681.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="899d027ee6340a79057225148fe5d681.png" auto_="auto;" display="block;" margin:="margin:" src="../images/899d027ee6340a79057225148fe5d681.png" /></a></p>
<p>Запускаем проект и проверяем работу системы.</p>
<p><a class="glightbox" href="../images/db1ff50a00ed3d4bf9e7f8e18ffba7d2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="db1ff50a00ed3d4bf9e7f8e18ffba7d2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/db1ff50a00ed3d4bf9e7f8e18ffba7d2.png" /></a></p>
<h3 id="gas">Подключение <code>GAS</code></h3>
<p>Подключим систему <code>Gameplay Ability System</code> к созданному персонажу.</p>
<p>Для работы с <code>GAS</code>, персонаж или любой <code>UObject</code> должен иметь два суб объекта: <code>AbilitySystemComponent</code> и <code>AttributeSet</code>. Займемся их созданием.</p>
<h4 id="abilitysystemcomponent-attributeset">Добавляем переменные <code>AbilitySystemComponent</code> и <code>AttributeSet</code></h4>
<p>В заголовочном файле, в <code>public</code> секции добавляем два указателя:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// GAS</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemInterface.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Attributes/CharacterAttributeSet.h&quot;</span><span class="c1"> // custom attributes</span>
<span class="k">public</span><span class="o">:</span>
<span class="cm">/** =======================================================</span>
<span class="cm"> * GAS</span>
<span class="cm"> */</span>
<span class="c1">// Gameplay Ability Component SubObject</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">VisibleAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="o">=</span><span class="s">&quot;Gameplay Abilities&quot;</span><span class="p">)</span>
<span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">UAbilitySystemComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">;</span>
<span class="c1">// Attribute Set Subobject</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">VisibleAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Gameplay Abilities&quot;</span><span class="p">)</span>
<span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">UCharacterAttributeSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AttributeSet</span><span class="p">;</span><span class="w"> </span><span class="c1">// our custom attribute set refrence</span>
</code></pre></div></p>
<h4 id="attributeset_2">Создаем суб объект для <code>AttributeSet</code></h4>
<p>Рекомендуется первым создать суб объект для <code>AttributeSet</code>. Делается это в конструкторке класса персонажа.
<div class="highlight"><pre><span></span><code><span class="c1">//.cpp</span>
<span class="c1">//constructor</span>
<span class="c1">// Attribute Set</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AttributeSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UCharacterAttributeSet</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Attribute Set&quot;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
Суб объект <code>AttributeSet</code> будет автоматически подхвачен <code>AbilitySystemComponent</code> в момент создания. Таким образом система будет знать о атрибутах, которые ей передаются.</p>
<h4 id="abilitysystemcomponent">Создем суб объект для <code>AbilitySystemComponent</code></h4>
<p>Теперь необходимо создать суб объект для компонента <code>UAbilitySystemComponent</code>. Делается это так-же в конструкторе.
<div class="highlight"><pre><span></span><code><span class="c1">//.cpp</span>
<span class="c1">//constructor</span>
<span class="c1">// Gameplay Ability System</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UAbilitySystemComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AbilitySystemComponent&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">SetIsReplicated</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// make GAS component states replicated</span>
<span class="w">    </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">SetReplicationMode</span><span class="p">(</span><span class="n">EGameplayEffectReplicationMode</span><span class="o">::</span><span class="n">Full</span><span class="p">);</span><span class="w"> </span><span class="c1">// will replicate only necessary info</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/034e8625bc9e05d638557bd5d0008178.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="034e8625bc9e05d638557bd5d0008178.png" auto_="auto;" display="block;" margin:="margin:" src="../images/034e8625bc9e05d638557bd5d0008178.png" /></a></p>
<p>Для созданного суб объекта надо включить сетевую репликацию методами <code>SetReplicationMode</code> и <code>SetIsReplicated</code>. При этом <code>EGameplayEffectReplicationMode</code> должен быть установлен в соответствии со следующими правилами:
<div class="highlight"><pre><span></span><code><span class="n">EGameplayEffectReplicationMode</span><span class="o">::</span><span class="n">Minimal</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Only</span><span class="w"> </span><span class="n">replicate</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">gameplay</span><span class="w"> </span><span class="n">effect</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="w"> </span><span class="n">Note</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Owned</span><span class="w"> </span><span class="n">AbilitySystemComponents</span><span class="w"> </span><span class="p">(</span><span class="n">Use</span><span class="w"> </span><span class="n">Mixed</span><span class="w"> </span><span class="n">instead</span><span class="p">).</span>
<span class="n">EGameplayEffectReplicationMode</span><span class="o">::</span><span class="n">Mixed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Only</span><span class="w"> </span><span class="n">replicate</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">gameplay</span><span class="w"> </span><span class="n">effect</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">simulated</span><span class="w"> </span><span class="n">proxies</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">owners</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">autonomous</span><span class="w"> </span><span class="n">proxies</span>
<span class="n">EGameplayEffectReplicationMode</span><span class="o">::</span><span class="n">Full</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Replicate</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="n">gameplay</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">all</span>
</code></pre></div>
В зависимости от режима репликации меняется нагрузка на сеть.</p>
<h4 id="iabilitysysteminterface">Реализуем <code>IAbilitySystemInterface</code></h4>
<p>Интерфейс <code>IAbilitySystemInterface</code> содержит метод <code>GetAbilitySystemComponent</code> который разработчик обязан переопределить. В этом методе необходимо вернуть указатель на активный <code>AbilitySystemComponent</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">//...</span>
<span class="c1">// inherit class from IAbilitySystemInterface</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ACharacter</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IAbilitySystemInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="w">    </span><span class="c1">// Begin IAbilitySystemInterface</span>
<span class="w">    </span><span class="c1">// GAS component registration</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="nf">GetAbilitySystemComponent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// End IAbilitySystemInterface</span>
<span class="p">}</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// GAS component registration</span>
<span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">GetAbilitySystemComponent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="owner-actor-avataractor"><code>Owner Actor</code> и <code>AvatarActor</code></h4>
<p>Компоненту <code>ASC</code> необходимо передать информацию о двух объектах: <code>OwnerActor</code> и с <code>AvatarActor</code>.
<code>OwnerActor</code> - объект, к которому привязан <code>AbilitySystemComponent</code>. В нашем случае это персонаж.
<code>AvatarActor</code> - объект, который является визуальным представлением <code>Owner'а</code>. В нашем случае это тоже персонаж.</p>
<p>Таким образом, инициализация <code>AbilitySystemComponent</code>, в нашем случае, выглядит так:
<div class="highlight"><pre><span></span><code><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="cm">/* Owner Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Avatar Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
</code></pre></div>
Поскольку <code>Unreal Engine</code> позволяет добавлять суб объекты к любым объектам, разработчик может создать <code>AbilitySystemComponent</code>, например, внутри <code>APlayerState</code>.
Тогда передача информации о владельце и аватаре будет выглядеть так:
<div class="highlight"><pre><span></span><code><span class="n">AGDPlayerState</span><span class="o">*</span><span class="w"> </span><span class="n">PS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPlayerState</span><span class="o">&lt;</span><span class="n">AGDPlayerState</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PS</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Init ASC with PS (Owner) and our new Pawn (AvatarActor)</span>
<span class="w">    </span><span class="n">PS</span><span class="o">-&gt;</span><span class="n">GetAbilitySystemComponent</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="n">PS</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Переданные в <code>ASC</code> указатели на <code>OwnerActor</code> и <code>AvatarActor</code>, будут доступны разработчику внутри <code>GameplayAbility</code> в качестве <code>blueprint</code> нод: <code>Get Owning Actor from Actor Info</code>, и <code>Get Avatar Actor from Actor Info</code>.</p>
<p><a class="glightbox" href="../images/978044ebc2300c5204eed7cade833f7b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="978044ebc2300c5204eed7cade833f7b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/978044ebc2300c5204eed7cade833f7b.png" /></a></p>
<h4 id="onrep_playerstate-possessedby">Переопределяем методы <code>OnRep_PlayerState</code> и <code>PossessedBy</code></h4>
<p>Привязка компонента <code>AbilitySystemComponent</code> к <code>OwnerActor</code> и <code>AvatarActor</code> должна быть проведена как на сервере, так и на клиенте. Для этих целей необходимо реализовать методы <code>OnRep_PlayerState</code> и <code>PossessedBy</code>.
Метод <code>OnRep_PlayerState</code> будет использоваться для инициализации <code>ASC</code> на сервере.</p>
<p>Метод <code>PossessedBy</code> будет использоваться для инициализации <code>ASC</code> на клиенте.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// PlayerState Replication Notification Callback</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnRep_PlayerState</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">// Once character posessed</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PossessedBy</span><span class="p">(</span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">NewController</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// On Possessed</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::PossessedBy</span><span class="p">(</span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">NewController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PossessedBy</span><span class="p">(</span><span class="n">NewController</span><span class="p">);</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewController</span><span class="o">-&gt;</span><span class="n">IsLocalPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Enable Camera only when character posessed by player</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsPlayer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">Activate</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// init GAS actor info</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="cm">/* Owner Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Avatar Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// PlayerState Replication Notification Callback</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::OnRep_PlayerState</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">OnRep_PlayerState</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// init GAS actor info</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="cm">/* Owner Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Avatar Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="_13">Код персонажа на данном этапе</h3>
<h4 id="corecharacterh_1"><code>CoreCharacter.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// GAS</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemInterface.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Attributes/CharacterAttributeSet.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Abilities/CoreGameplayAbility.h&quot;</span>
<span class="c1">// Enhanced Input</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputMappingContext.h&quot;</span><span class="c1"> // Mapping Context</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EnhancedInputSubsystems.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EnhancedInputComponent.h&quot;</span>
<span class="c1">// Kismet</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/GameplayStatics.h&quot;</span>
<span class="c1">// Capsule Component</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Components/CapsuleComponent.h&quot;</span>
<span class="c1">// Character Movement</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/CharacterMovementComponent.h&quot;</span>
<span class="c1">// Camera</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Camera/CameraComponent.h&quot;</span>
<span class="c1">// Spring Arm</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/SpringArmComponent.h&quot;</span>
<span class="c1">// generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreCharacter.generated.h&quot;</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ACoreCharacter</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ACharacter</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IAbilitySystemInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Sets default values for this character&#39;s properties</span>
<span class="w">    </span><span class="n">ACoreCharacter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/** =======================================================</span>
<span class="cm">     * Sub Objects</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Spring Arm</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">VisibleAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Camera</span><span class="p">)</span>
<span class="w">    </span><span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">USpringArmComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CameraBoom</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Camera</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">VisibleAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Camera</span><span class="p">)</span>
<span class="w">    </span><span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">UCameraComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FollowCamera</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/** =======================================================</span>
<span class="cm">     * GAS</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// Gameplay Ability Component SubObject</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">VisibleAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="o">=</span><span class="s">&quot;Gameplay Abilities&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">UAbilitySystemComponent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Attribute Set Subobject</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">VisibleAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Gameplay Abilities&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TObjectPtr</span><span class="o">&lt;</span><span class="n">UCharacterAttributeSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AttributeSet</span><span class="p">;</span><span class="w"> </span><span class="c1">// our custom attribute set refrence</span>
<span class="w">    </span><span class="cm">/** =======================================================</span>
<span class="cm">     * Variables</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// MappingContext</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Input</span><span class="p">)</span>
<span class="w">    </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MappingContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Begin IAbilitySystemInterface</span>
<span class="w">    </span><span class="c1">// GAS component registration</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="nf">GetAbilitySystemComponent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// End IAbilitySystemInterface</span>
<span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Called when the game starts or when spawned</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Movement Input</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Move</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Camera Input</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Rotate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Sprint</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">StartSprint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// End Sprint</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">EndSprint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// will bind new mapping context</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Input&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">BindContext</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">OnController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Called every frame</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Called to bind functionality to input</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetupPlayerInputComponent</span><span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Once character posessed</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PossessedBy</span><span class="p">(</span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">NewController</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// PlayerState Replication Notification Callback</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnRep_PlayerState</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="corecharactercpp_1"><code>CoreCharacter.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Characters/CoreCharacter.h&quot;</span>
<span class="c1">// Sets default values</span>
<span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">ACoreCharacter</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Attribute Set</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">AttributeSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UCharacterAttributeSet</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Attribute Set&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Gameplay Ability System</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UAbilitySystemComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;AbilitySystemComponent&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">SetIsReplicated</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// make GAS component states replicated</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">SetReplicationMode</span><span class="p">(</span><span class="n">EGameplayEffectReplicationMode</span><span class="o">::</span><span class="n">Full</span><span class="p">);</span><span class="w"> </span><span class="c1">// will replicate only necessary info</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// SpringArm for the camera</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">USpringArmComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CameraBoom&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">SetRelativeLocation</span><span class="p">(</span><span class="n">FVector3d</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">8.492264f</span><span class="p">));</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">SetupAttachment</span><span class="p">(</span><span class="n">RootComponent</span><span class="p">);</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">TargetArmLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400.0f</span><span class="p">;</span><span class="w"> </span><span class="c1">// The camera follows at this distance behind the character</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">bUsePawnControlRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Rotate the arm based on the controller</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">bInheritPitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">bInheritYaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">CameraBoom</span><span class="o">-&gt;</span><span class="n">bInheritRoll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Camera</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UCameraComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FollowCamera&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">SetupAttachment</span><span class="p">(</span><span class="n">CameraBoom</span><span class="p">,</span><span class="w"> </span><span class="n">USpringArmComponent</span><span class="o">::</span><span class="n">SocketName</span><span class="p">);</span><span class="w"> </span><span class="c1">// Attach the camera to the end of the boom and let the boom adjust to match the controller orientation</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">bUsePawnControlRotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Camera does not rotate relative to arm</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">Deactivate</span><span class="p">();</span><span class="w"> </span><span class="c1">// Deactivate camera by default to prevent performance issues</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Default Rotation Settings</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">bUseControllerRotationPitch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">bUseControllerRotationYaw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">bUseControllerRotationRoll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Set Character Movement values</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UCharacterMovementComponent</span><span class="o">*</span><span class="w"> </span><span class="n">CharMoveComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCharacterMovement</span><span class="p">();</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">bOrientRotationToMovement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// will force character to rotate towards velocity direction</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">RotationRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotator</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">500.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span><span class="w"> </span><span class="c1">// with rotation rate</span>
<span class="w">        </span><span class="c1">// Speed values</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">JumpZVelocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">700.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">AirControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.35f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">MaxWalkSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">250.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">MinAnalogWalkSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">BrakingDecelerationWalking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2000.f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Set Capsule Size</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UCapsuleComponent</span><span class="o">*</span><span class="w"> </span><span class="n">CapsuleComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCapsuleComponent</span><span class="p">();</span>
<span class="w">        </span><span class="n">CapsuleComp</span><span class="o">-&gt;</span><span class="n">InitCapsuleSize</span><span class="p">(</span><span class="mf">35.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">90.0f</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Load Default Skeletal Mesh</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">USkeletalMeshComponent</span><span class="o">*</span><span class="w"> </span><span class="n">MeshComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetMesh</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">GetSkeletalMeshAsset</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// set refrence here</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">MannequinAsset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.SkeletalMesh&#39;/Game/Assets/Mannequins/Meshes/SKM_Quinn.SKM_Quinn&#39;&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">USkeletalMesh</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SKMesh</span><span class="p">(</span><span class="n">MannequinAsset</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">SKMesh</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetSkeletalMesh</span><span class="p">(</span><span class="n">SKMesh</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// Load ainm instance as well</span>
<span class="w">            </span><span class="c1">// since we loading blueprint class, add _C at the end of the asset refrence</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">AnimationInstanceAsset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.AnimBlueprint&#39;/Game/Assets/Mannequins/Animations/ABP_Quinn.ABP_Quinn_C&#39;&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">TSoftClassPtr</span><span class="o">&lt;</span><span class="n">UAnimInstance</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CAnimInst</span><span class="p">(</span><span class="n">AnimationInstanceAsset</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">CAnimInst</span><span class="p">.</span><span class="n">IsNull</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetAnimationMode</span><span class="p">(</span><span class="n">EAnimationMode</span><span class="o">::</span><span class="n">AnimationBlueprint</span><span class="p">);</span>
<span class="w">                </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetAnimInstanceClass</span><span class="p">(</span><span class="n">CAnimInst</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// Apply default parameters to the mesh</span>
<span class="w">            </span><span class="c1">// Relative Location</span>
<span class="w">            </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetRelativeLocation</span><span class="p">(</span><span class="n">FVector3d</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-89.0f</span><span class="p">));</span>
<span class="w">            </span><span class="c1">// Relative Rotation</span>
<span class="w">            </span><span class="n">MeshComp</span><span class="o">-&gt;</span><span class="n">SetRelativeRotation</span><span class="p">(</span><span class="n">FRotator</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">270.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Load Default Mapping Context</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MappingContext</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/EnhancedInput.InputMappingContext&#39;/Game/Blueprints/Input/IMC_Default.IMC_Default&#39;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">MappingContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UKismetSystemLibrary</span><span class="o">::</span><span class="n">MakeSoftObjectPath</span><span class="p">(</span><span class="n">Path</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Called when the game starts or when spawned</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// bind input context to player controller</span>
<span class="w">    </span><span class="c1">// Important to be called in BeginPlay, since SetupPlayerInputComponent dosen&#39;t get called for AI&#39;s</span>
<span class="w">    </span><span class="n">BindContext</span><span class="p">(</span><span class="n">MappingContext</span><span class="p">.</span><span class="n">LoadSynchronous</span><span class="p">());</span>
<span class="p">}</span>
<span class="c1">// On Possessed</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">PossessedBy</span><span class="p">(</span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">NewController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PossessedBy</span><span class="p">(</span><span class="n">NewController</span><span class="p">);</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewController</span><span class="o">-&gt;</span><span class="n">IsLocalPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Enable Camera only when character posessed by player</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsPlayer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">Activate</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// init GAS actor info</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="cm">/* Owner Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Avatar Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// PlayerState Replication Notification Callback</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">OnRep_PlayerState</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">OnRep_PlayerState</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// init GAS actor info</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="cm">/* Owner Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Avatar Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Called every frame</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">Tick</span><span class="p">(</span><span class="n">DeltaTime</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* nothing */</span>
<span class="p">}</span>
<span class="cm">/**===============================================</span>
<span class="cm"> * GAS</span>
<span class="cm"> */</span>
<span class="c1">// GAS component registration</span>
<span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">GetAbilitySystemComponent</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/**===============================================</span>
<span class="cm"> * Input</span>
<span class="cm"> */</span>
<span class="c1">// will bind new mapping context</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">BindContext</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">OnController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MappingContext</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// only because i don&#39;t want to crash app with check()</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetController</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">OnController</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PlayerController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get enhanced input component&#39;s subsystem</span>
<span class="w">    </span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">*</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">::</span><span class="n">GetSubsystem</span><span class="o">&lt;</span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">&gt;</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// input component</span>
<span class="w">    </span><span class="n">UEnhancedInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">EnhancedInputComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UEnhancedInputComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">InputComponent</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;ClearActionBindings(); // clear all bindings if necessary</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">ClearBindingsForObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear bindings only from this object</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// register mapping context</span>
<span class="w">        </span><span class="n">EiSubsystem</span><span class="o">-&gt;</span><span class="n">AddMappingContext</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="n">InputPriority</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// iterate over all mappings and put every unique action into the Map</span>
<span class="w">    </span><span class="c1">// since actions occur in the map multiple times, for every key binding</span>
<span class="w">    </span><span class="n">TMap</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">Actions</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FEnhancedActionKeyMapping</span><span class="w"> </span><span class="n">Mapping</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">GetMappings</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FName</span><span class="w"> </span><span class="n">ActionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Actions</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">ActionName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ActionName</span><span class="p">,</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Action Name = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// now differentiate actions in the loop and assign them according to the names</span>
<span class="w">    </span><span class="c1">// make sure to give action names accordingly</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TPair</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">ActionInfo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Actions</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">AName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Jumping</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// use integrated jump</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACharacter</span><span class="o">::</span><span class="n">Jump</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACharacter</span><span class="o">::</span><span class="n">StopJumping</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Moving</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Move&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Move</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Sprinting</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Sprint&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">StartSprint</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">EndSprint</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Looking around</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Look&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Rotate</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Called to bind functionality to input</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="n">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="n">PlayerInputComponent</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Start Sprint</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">StartSprint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UCharacterMovementComponent</span><span class="o">*</span><span class="w"> </span><span class="n">CharMoveComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCharacterMovement</span><span class="p">();</span>
<span class="w">    </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">MaxWalkSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500.f</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// End Sprint</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">EndSprint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UCharacterMovementComponent</span><span class="o">*</span><span class="w"> </span><span class="n">CharMoveComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCharacterMovement</span><span class="p">();</span>
<span class="w">    </span><span class="n">CharMoveComp</span><span class="o">-&gt;</span><span class="n">MaxWalkSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">250.f</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Movement Input</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Move</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// input is a Vector2D</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">MovementVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">FVector2D</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetController</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// find out which way is forward</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FRotator</span><span class="w"> </span><span class="n">Rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetControlRotation</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FRotator</span><span class="w"> </span><span class="nf">YawRotation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Rotation</span><span class="p">.</span><span class="n">Yaw</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// get forward vector</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ForwardDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotationMatrix</span><span class="p">(</span><span class="n">YawRotation</span><span class="p">).</span><span class="n">GetUnitAxis</span><span class="p">(</span><span class="n">EAxis</span><span class="o">::</span><span class="n">X</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// get right vector</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">RightDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotationMatrix</span><span class="p">(</span><span class="n">YawRotation</span><span class="p">).</span><span class="n">GetUnitAxis</span><span class="p">(</span><span class="n">EAxis</span><span class="o">::</span><span class="n">Y</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// add movement</span>
<span class="w">        </span><span class="n">AddMovementInput</span><span class="p">(</span><span class="n">ForwardDirection</span><span class="p">,</span><span class="w"> </span><span class="n">MovementVector</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">        </span><span class="n">AddMovementInput</span><span class="p">(</span><span class="n">RightDirection</span><span class="p">,</span><span class="w"> </span><span class="n">MovementVector</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Roation Input</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Rotate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// input is a Vector2D</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">LookAxisVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Value</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">FVector2D</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">AddControllerYawInput</span><span class="p">(</span><span class="n">LookAxisVector</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
<span class="w">    </span><span class="n">AddControllerPitchInput</span><span class="p">(</span><span class="n">LookAxisVector</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="_14">Проверка работоспособности</h4>
<p>Поздравляю. Система <code>GAS</code> установлена, правда в весьма базовой комплектации. Осталось проверить, работает ли она.</p>
<p>Откройте созданный ранее <code>blueprint</code> класс - <code>BP_CoreCharacter</code>.</p>
<p><a class="glightbox" href="../images/e054f80e0d1be23ba035f52449897b7d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e054f80e0d1be23ba035f52449897b7d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e054f80e0d1be23ba035f52449897b7d.png" /></a></p>
<p>В списке компонентов этого класса должен появиться <code>Ability System Component</code>, который мы задали.</p>
<p><a class="glightbox" href="../images/d80492d39fce7281e55602a7d86cb281.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d80492d39fce7281e55602a7d86cb281.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d80492d39fce7281e55602a7d86cb281.png" /></a></p>
<p>Этот компонент можно протестировать. Для этого создадим первый <code>Gameplay Ability</code>.
В <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; Blueprint Class</code>.</p>
<p><a class="glightbox" href="../images/5250e93e6f34aba13ebf13b8bfd238ce.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5250e93e6f34aba13ebf13b8bfd238ce.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5250e93e6f34aba13ebf13b8bfd238ce.png" /></a></p>
<p>В появившемся окне выбираем подкатегорию <code>All</code> и ищем класс <code>GameplayAbility</code>.</p>
<p><a class="glightbox" href="../images/83f91797d6c93e0dc42dbd18d596ab90.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="83f91797d6c93e0dc42dbd18d596ab90.png" auto_="auto;" display="block;" margin:="margin:" src="../images/83f91797d6c93e0dc42dbd18d596ab90.png" /></a></p>
<p>Создаем файл и называем <code>GA_TestAbility</code>.</p>
<p><a class="glightbox" href="../images/52b5b10796e0911751fd0bc2e3509508.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="52b5b10796e0911751fd0bc2e3509508.png" auto_="auto;" display="block;" margin:="margin:" src="../images/52b5b10796e0911751fd0bc2e3509508.png" /></a></p>
<p>Пишем внутри <code>GA_TestAbility</code> код, который просто выводит сообщение <code>AbilityActivated</code>. В конце логики, очень важно вызвать ноду <code>EndAbility</code>, иначе способность так и будет висеть в памяти.</p>
<p><a class="glightbox" href="../images/2e827e8388cea57dd306d497db28b352.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2e827e8388cea57dd306d497db28b352.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2e827e8388cea57dd306d497db28b352.png" /></a></p>
<p>Далее, в классе <code>BP_CoreCharacter</code> добавляем ноды <code>GiveAbility</code> и <code>TryActivateAbility</code>. В ноде <code>GiveAbility</code> укажите класс способности - <code>GA_TestAbility</code>. Я привязал вызов обоих нод к нажатию кнопки <code>1</code>.</p>
<p><a class="glightbox" href="../images/49c2a05203ea7f42553e247853ae5f89.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="49c2a05203ea7f42553e247853ae5f89.png" auto_="auto;" display="block;" margin:="margin:" src="../images/49c2a05203ea7f42553e247853ae5f89.png" /></a></p>
<p>При нажатии клавиши <code>1</code> на экране появляется сообщение <code>AbilityActivated</code>.</p>
<p><a class="glightbox" href="../images/5589382ac197327325826533d31f5ea7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5589382ac197327325826533d31f5ea7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5589382ac197327325826533d31f5ea7.png" /></a></p>
<p>Способность работает.</p>
<h3 id="showdebug-abilitysystem">Отладка, <code>showdebug AbilitySystem</code></h3>
<p>Команда <code>showdebug AbilitySystem</code> позволяет отобразить отладочную информацию с текущими характеристиками персонажа, а так-же его тегами, способностями и эффектами.</p>
<p>Запустите проект, нажмите на клавишу тильды - <code>~</code> и отправьте в появившееся поле ввода команду:
<div class="highlight"><pre><span></span><code><span class="n">showdebug</span><span class="w"> </span><span class="n">AbilitySystem</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/90987b36d6b28954a29584e54e387b33.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="90987b36d6b28954a29584e54e387b33.png" auto_="auto;" display="block;" margin:="margin:" src="../images/90987b36d6b28954a29584e54e387b33.png" /></a></p>
<p>Если все установлено правильно, мы увидим имя нашего персонажа, а так-же информацию о его характеристиках в виде отладочной информации.</p>
<p><a class="glightbox" href="../images/2d4eea425adb51275611906d1d05e202.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2d4eea425adb51275611906d1d05e202.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2d4eea425adb51275611906d1d05e202.png" /></a></p>
<h3 id="ability-system-component">Обработка ввода в <code>Ability System Component</code></h3>
<p>Способности, добавленные в <code>ASC</code> можно вызвать по нажатию клавиш и их сочетаний.</p>
<p>Подобный подход подразумевает, что разработчику уже известно, какие именно события ввода будет использовать игра.</p>
<p>Из известного набора событий  создается набор слотов в виде перечисления <code>Enum</code>, выполненного по специальной формуле. Первые три пункта <code>Enum</code> отводятся под слоты: <code>None</code>, <code>Confirm</code> и <code>Cancel</code>, про обработку событий <code>Confirm</code> и <code>Cancel</code> мы поговорим в отдельной главе. Остальные пункты перечисления разработчик может добавлять по своему усмотрению.
<div class="highlight"><pre><span></span><code><span class="c1">// Ability Input Action</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EAbilityInput</span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">Confirm</span><span class="p">,</span>
<span class="w">    </span><span class="n">Cancel</span><span class="p">,</span>
<span class="w">    </span><span class="cm">/* Other Items */</span>
<span class="p">};</span>
</code></pre></div></p>
<h4 id="enum">Создаем <code>Enum</code> со слотами ввода</h4>
<p>Предлагаю добавить под наш <code>Enum</code> отдельный файл. Идем в папку проекта <code>/Source/GASBase/Public</code>. Добавляем подпапку <code>Enums</code>.</p>
<p><a class="glightbox" href="../images/c10990c803f7b70c821480999298ec4d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c10990c803f7b70c821480999298ec4d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c10990c803f7b70c821480999298ec4d.png" /></a></p>
<p>Внутри папки <code>Enums</code> добавляем пустой текстовый файл <code>AbilityInputEnum.h</code>.</p>
<p><a class="glightbox" href="../images/a59490b2cf35dacffaa7beb6ddd054b3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a59490b2cf35dacffaa7beb6ddd054b3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a59490b2cf35dacffaa7beb6ddd054b3.png" /></a></p>
<p>Чтобы созданный файл зарегистрировался в проекте - выполняем команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/f7ab6f9356cbf7e36f707fa79222df19.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f7ab6f9356cbf7e36f707fa79222df19.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f7ab6f9356cbf7e36f707fa79222df19.png" /></a></p>
<p><a class="glightbox" href="../images/65a94196ea1c19410bb185ebf1a50ffc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="65a94196ea1c19410bb185ebf1a50ffc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/65a94196ea1c19410bb185ebf1a50ffc.png" /></a></p>
<p>Добавляем код, описывающий слоты ввода.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// somehow my VS dosen&#39;t detect .generated.h for nested files so i have to inclde this manyally to get rid of red errors</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span>
<span class="c1">// UHT</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilityInputEnum.generated.h&quot;</span>
<span class="c1">// Ability Action</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EAbilityInput</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">None</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Confirm</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Cancel</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot1</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Fire Slot&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot2</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Aim Slot&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot3</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Sprint Slot&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot4</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Jump Slot&quot;</span><span class="p">)</span>
<span class="p">};</span>
</code></pre></div>
На данном этапе нам достаточно всего <code>4</code> слотов под способности.</p>
<h4 id="ability-system-component_1">Привязка <code>Ability System Component</code> к слотам способностей</h4>
<p>Чтобы <code>ASC</code> начал отправлять события ввода к слотам способностей, необходимо вызвать метод <code>BindAbilityActivationToInputComponent</code> следующим образом:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums/AbilityInputEnum.h&quot;</span>
<span class="c1">// register ability inputs</span>
<span class="c1">// https://forums.unrealengine.com/t/somebody-know-ftoplevelassetpath-of-5-1/734537/3</span>
<span class="c1">// Format is: /Script/ModuleName that owns this enum, EnumName</span>
<span class="c1">// if format is wrong - engine will crash because of assertion error</span>
<span class="c1">// My Module name is GASBase</span>
<span class="c1">// My Enum name is EAbilityInput</span>
<span class="n">FTopLevelAssetPath</span><span class="w"> </span><span class="n">EnumAssetPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;/Script/GASBase&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;EAbilityInput&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">BindAbilityActivationToInputComponent</span><span class="p">(</span><span class="n">InputComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayAbilityInputBinds</span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">EnumAssetPath</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Confirm</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Cancel</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
Привязку <code>Ability System Component</code> к слотам надо выполнять как на сервере, так и на клиенте, поэтому необходимо обернуть приведенный выше код в отдельный метод. У меня это <code>BindASCInput</code>. Данный метод должен быть вызван в <code>SetupPlayerInputComponent</code> на клиенте и в <code>OnRep_PlayerState</code> на сервере.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums/AbilityInputEnum.h&quot;</span>
<span class="c1">//...</span>
<span class="c1">// Called to bind functionality to input</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetupPlayerInputComponent</span><span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">// PlayerState Replication Notification Callback</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnRep_PlayerState</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">// Will bind GAS input</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">BindASCInput</span><span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bGasInputBound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// true if gas is already bound. prevents multiple initialisations</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Called to bind functionality to input</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::SetupPlayerInputComponent</span><span class="p">(</span><span class="n">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">SetupPlayerInputComponent</span><span class="p">(</span><span class="n">PlayerInputComponent</span><span class="p">);</span>
<span class="w">    </span><span class="n">BindASCInput</span><span class="p">(</span><span class="n">PlayerInputComponent</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// PlayerState Replication Notification Callback</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::OnRep_PlayerState</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">OnRep_PlayerState</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// init GAS actor info</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="cm">/* Owner Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Avatar Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">BindASCInput</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// Will bind GAS input</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::BindASCInput</span><span class="p">(</span><span class="n">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="w"> </span><span class="cm">/* = NULL */</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// if we already bound - just return</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bGasInputBound</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">IC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">InputComponent</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">PlayerInputComponent</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// if ASC not ready</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">IC</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bGasInputBound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// register ability inputs</span>
<span class="w">    </span><span class="c1">// https://forums.unrealengine.com/t/somebody-know-ftoplevelassetpath-of-5-1/734537/3</span>
<span class="w">    </span><span class="c1">// Format is: /Script/ModuleName that owns this enum, EnumName</span>
<span class="w">    </span><span class="c1">// if format is wrong - engine will crash because of assertion error</span>
<span class="w">    </span><span class="c1">// My Module name is GASBase</span>
<span class="w">    </span><span class="c1">// My Enum name is EAbilityInput</span>
<span class="w">    </span><span class="n">FTopLevelAssetPath</span><span class="w"> </span><span class="n">EnumAssetPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;/Script/GASBase&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;EAbilityInput&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">BindAbilityActivationToInputComponent</span><span class="p">(</span><span class="n">IC</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayAbilityInputBinds</span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">EnumAssetPath</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Confirm</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Cancel</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="n">bGasInputBound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Обратите внимание, что в параметре <code>FGameplayAbilityInputBinds</code> я передаю две пустые текстовые метки - <code>TEXT(""), TEXT("")</code>. В <code>Unreal Engine 4.27</code> и ниже, они использовались для указания событий <code>Confirm</code> и <code>Cancel</code>. В <code>Unreal Engine 5</code> появился плагин <code>EnhancedInput</code>, поэтому данные метки стоит пропускать.</p>
<p><a class="glightbox" href="../images/c25a98347a0035adab90709eae79cd93.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c25a98347a0035adab90709eae79cd93.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c25a98347a0035adab90709eae79cd93.png" /></a></p>
<p>Мы рассмотрим привязку действий <code>Confirm</code> и <code>Cancel</code> в одной из следующих глав, а пока просто передавайте пустые строки. Это совершенно нормально, в коде метода <code>FGameplayAbilityInputBinds</code> есть проверка для этого случая.</p>
<p><a class="glightbox" href="../images/4091442a24345180114c3a5c1fea887f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4091442a24345180114c3a5c1fea887f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4091442a24345180114c3a5c1fea887f.png" /></a></p>
<h4 id="gameplayability">Переопределяем <code>GameplayAbility</code></h4>
<p>Мы привязали <code>ASC</code> к слотам, заданным в <code>Enum</code>.
Необходимо переопределить класс <code>GameplayAbility</code> и добавить в него поддержку слотов ввода.</p>
<p>Выполняем команду <code>Tools -&gt; New C++ Class</code>, в появившемся окне переходим на вкладку <code>All Classes</code> и ищем класс <code>GameplayAbility</code>.</p>
<p><a class="glightbox" href="../images/0d52a3d3882ce4e41741ce1b98a798f4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0d52a3d3882ce4e41741ce1b98a798f4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0d52a3d3882ce4e41741ce1b98a798f4.png" /></a></p>
<p>Называем класс <code>CoreGameplayAbility</code> и добавляем его в папку <code>Abilities</code>.</p>
<p><a class="glightbox" href="../images/5d6f34aa9c0bb7e087a512539858be14.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5d6f34aa9c0bb7e087a512539858be14.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5d6f34aa9c0bb7e087a512539858be14.png" /></a></p>
<p>Чтобы созданный файл появился в <code>Solution Explorer</code> - выполните команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/6745235e667ff8d8738c7caddb1b7342.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6745235e667ff8d8738c7caddb1b7342.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6745235e667ff8d8738c7caddb1b7342.png" /></a></p>
<p>Откройте файл <code>CoreGameplayAbility.h</code>. Все что нам надо - добавить в него одну переменную типа <code>EAbilityInput</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Abilities/GameplayAbility.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums/AbilityInputEnum.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreGameplayAbility.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Base Ability class with ActionSlot support</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">UCoreGameplayAbility</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UGameplayAbility</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Ability Action</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Default&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">EAbilityInput</span><span class="w"> </span><span class="n">AbilitySlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">None</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
Скомпилируйте код.</p>
<h5 id="jump-ability"><code>Jump Ability</code></h5>
<p>Посмотрим, как выглядит способность, которую мы создали. Для этого в <code>Content Browser</code> нажмите на кнопку <code>Add -&gt; Blueprint Class</code>.</p>
<p><a class="glightbox" href="../images/013695c069bc61afa49be3f733a7667c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="013695c069bc61afa49be3f733a7667c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/013695c069bc61afa49be3f733a7667c.png" /></a></p>
<p>Во вкладке <code>All Classes</code> найдите <code>CoreGameplayAbility</code> и создайте <code>blueprint</code>. Я назвал его <code>GA_JumpAbility</code>.</p>
<p><a class="glightbox" href="../images/7604138d23439342ffa3bcd37bcdd36a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7604138d23439342ffa3bcd37bcdd36a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7604138d23439342ffa3bcd37bcdd36a.png" /></a></p>
<p>Открываем созданный <code>blueprint</code>.
В правом верхнем углу панели <code>Details</code> вы можете увидеть параметр <code>AbilitySlot</code>.
Установите в слот значение <code>Jump</code>.</p>
<p><a class="glightbox" href="../images/c0f619a590e07b79281ce2c02da9b41c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c0f619a590e07b79281ce2c02da9b41c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c0f619a590e07b79281ce2c02da9b41c.png" /></a></p>
<p>Добавляем логику прыжка в код класса.</p>
<p><a class="glightbox" href="../images/ad299e63f56c60bc12c2a1d5440ac9d5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ad299e63f56c60bc12c2a1d5440ac9d5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ad299e63f56c60bc12c2a1d5440ac9d5.png" /></a></p>
<p><a class="glightbox" href="../images/2266cf3ca12c94b54ac4bfd9c5970594.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2266cf3ca12c94b54ac4bfd9c5970594.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2266cf3ca12c94b54ac4bfd9c5970594.png" /></a></p>
<p>Устанавливаем для способности тег - <code>Locomotion.Jump</code>. Он должен быть установлен как для <code>Ability Tags</code>, так и для <code>Activation Owned Tags</code>.</p>
<p><a class="glightbox" href="../images/2104d5bac617d4b9914f244fe78f094e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2104d5bac617d4b9914f244fe78f094e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2104d5bac617d4b9914f244fe78f094e.png" /></a></p>
<p>Способность готова. Теперь ее необходимо привязать к нажатию соответствующей клавиши.</p>
<h4 id="inputaction">Создаем и регистрируем дополнительные <code>InputAction</code></h4>
<p>Создадим недостающие<code>InputAction</code>.
Для этого в <code>Content Browser</code> нажмите на кнопку <code>Add -&gt; Input -&gt; Input Action</code>.</p>
<p><a class="glightbox" href="../images/037f6272da593d550733a33ede3aa799.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="037f6272da593d550733a33ede3aa799.png" auto_="auto;" display="block;" margin:="margin:" src="../images/037f6272da593d550733a33ede3aa799.png" /></a></p>
<p>Нужны следующие <code>Input Action</code> для наших слотов: <code>IA_Sprint</code>, <code>IA_Fire</code>, <code>IA_Aim</code>, <code>IA_Jump</code>. Все события должны иметь тип <code>bool</code>.</p>
<p><a class="glightbox" href="../images/8d10f8709fbb6259f9a53cd7ebf7d874.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8d10f8709fbb6259f9a53cd7ebf7d874.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8d10f8709fbb6259f9a53cd7ebf7d874.png" /></a></p>
<p>Каждое действие должно быть добавлено в контекст ввода, с привязкой к соответствующей клавише. Откройте стандартный контекст ввода <code>IMC_Default</code>.</p>
<p><a class="glightbox" href="../images/b5419a7ce870007e138324383142b9da.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b5419a7ce870007e138324383142b9da.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b5419a7ce870007e138324383142b9da.png" /></a></p>
<p>Добавьте созданные нами действия в контекст, а так-же присвойте им соответствующие клавиши ввода.</p>
<p><a class="glightbox" href="../images/2d22b0bab649038b49ade0e36c349ade.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2d22b0bab649038b49ade0e36c349ade.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2d22b0bab649038b49ade0e36c349ade.png" /></a></p>
<h4 id="blueprint_1">Запускаем событие в слоте используя <code>blueprint</code> код</h4>
<p>При запуске проекта слоты способностей пусты. Мы еще не реализовали логику автоматического добавления способностей. Поэтому, для тестирования, добавим <code>Gameplay Action</code> в нужный слот по событию <code>BeginPlay</code>, внутри класса персонажа <code>BP_CoreCharacter</code>.</p>
<p><a class="glightbox" href="../images/ded6ee874c2564ce59a24ac25e7a38f1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ded6ee874c2564ce59a24ac25e7a38f1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ded6ee874c2564ce59a24ac25e7a38f1.png" /></a></p>
<p>У ноды <code>GiveAbility</code> есть параметр <code>InputID</code>. Именно сюда надо задать номер слота, при активации которого автоматически будет срабатывать способность.</p>
<p>Откуда взять <code>Input ID</code>?
Поскольку мы передали слоты <code>EAbilityInput</code> в <code>GAS</code>, именно из <code>EAbilityInput</code> надо брать<code>Input ID</code>.
Добавляем в <code>blueprint</code> код новую ноду типа <code>Literal EAbilityInput</code>. В этой ноде устанавливаем слот для способности на <code>Jump</code>.
Соединяем ноду <code>Literal EAbilityInput</code> c пином <code>InputId</code> через приведение типа <code>Enum -&gt; Int(byte)</code>.</p>
<p><a class="glightbox" href="../images/5b71d7575ed93b127d9b494ec6d4f6cf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5b71d7575ed93b127d9b494ec6d4f6cf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5b71d7575ed93b127d9b494ec6d4f6cf.png" /></a></p>
<p>Теперь необходимо настроить логику вызова события из слота. Сделать это можно как в <code>c++</code> (о чем мы поговорим ниже), так и из <code>blueprint</code>. Добавляем на сцену две ноды, от компонента <code>AbilitySystemComponent</code>, а именно: <code>FindAll Abilities with InputID</code> и <code>TryActivateAbility</code>.
По событию <code>IA_Jump</code> необходимо вызвать ноду <code>FindAll Abilities with InputID</code> и передать номер слота в параметр <code>Input Id</code>.</p>
<p><a class="glightbox" href="../images/9aba20004ba12bcdda31c99f3f9a44cf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9aba20004ba12bcdda31c99f3f9a44cf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9aba20004ba12bcdda31c99f3f9a44cf.png" /></a></p>
<p>Запустите проект и нажмите клавишу пробела. Она отвечает за событие <code>Jump</code>. Персонаж прыгает, а на экране появляется отладочный текст.</p>
<p><a class="glightbox" href="../images/60cc928692603ff36faec8122116955d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="60cc928692603ff36faec8122116955d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/60cc928692603ff36faec8122116955d.png" /></a></p>
<p>Однако, у такого подохода есть весьма серьезный недостаток.</p>
<p>Если мы добавим ноду <code>Wait Input Release</code> в конец нашего <code>blueprint</code> скрипта следующим образом:</p>
<p><a class="glightbox" href="../images/f6f5e07f5db214e7182aea104b0d8f08.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f6f5e07f5db214e7182aea104b0d8f08.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f6f5e07f5db214e7182aea104b0d8f08.png" /></a></p>
<p>То, запустив проект, увидим, что она не работает.</p>
<p>Нода <code>Wait Input Release</code> ждет, пока разработчик отпустит привязанную клавишу. Поскольку мы не привязывали наши клавиши ввода через метод <code>AbilityLocalInputPressed</code> - нода <code>Wait Input Release</code> не работает.</p>
<p><a class="glightbox" href="../images/5117219ed3646e17f5d88010f23cd9be.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5117219ed3646e17f5d88010f23cd9be.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5117219ed3646e17f5d88010f23cd9be.png" /></a></p>
<p>Сообщение <code>Ability Stopped!</code> не появляется. Так происходит, потому что нода <code>Wait Input Release</code> не работает. А не работает она, потому что активировать способности надо  через <code>AbilityLocalInputPressed</code> и <code>AbilityLocalInputReleased</code>. К сожалению, данные методы не доступны в <code>blueprint</code>, поэтому привяжем их через <code>с++</code>.</p>
<h4 id="_15">Настраиваем вызов способностей через <code>с++</code></h4>
<p>Привязка слотов <code>InputId</code> к клавишам ввода осуществляется в методе <code>AbilityLocalInputPressed</code>, который может быть вызван исключительно в <code>c++</code>.
Добавляем в код персонажа метод <code>SendAbilityLocalInput</code>, который который служит оберткой для вызова <code>AbilityLocalInputPressed</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// Will send input value to local Gas Component</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SendAbilityLocalInput</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">InputId</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Will send input value to local Gas Component</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AGameBaseCharacter::SendAbilityLocalInput</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">InputId</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Value</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">AbilityLocalInputPressed</span><span class="p">(</span><span class="n">InputId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">AbilityLocalInputReleased</span><span class="p">(</span><span class="n">InputId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Теперь идем в метод
Изменяем секцию <code>Jumping</code> следующим образом:
<div class="highlight"><pre><span></span><code><span class="c1">// Jumping</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// use integrated jump</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Triggered, this, &amp;ACharacter::Jump);</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Completed, this, &amp;ACharacter::StopJumping);</span>
<span class="p">}</span>
</code></pre></div>
Как вы видите, я передаю в метод <code>SendAbilityLocalInput</code> два события. Одно - для начала прыжка <code>ETriggerEvent::Triggered</code>, второе - для окончания прыжка <code>ETriggerEvent::Completed</code>.
Если скомпилировать код с этим изменением мы увидим, что логика работает корректно.</p>
<p><a class="glightbox" href="../images/7408d35390fc835f7a1028d562675f57.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7408d35390fc835f7a1028d562675f57.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7408d35390fc835f7a1028d562675f57.png" /></a></p>
<p>Нода <code>WaitInputRelease</code> корректно отслеживает событие <code>ETriggerEvent::Completed</code>.</p>
<p><a class="glightbox" href="../images/63cf7aee3fb04128472cc8b75595629c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="63cf7aee3fb04128472cc8b75595629c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/63cf7aee3fb04128472cc8b75595629c.png" /></a></p>
<p>Создадим <code>GameplayAbility</code> для бега.</p>
<p>Для начала регистрируем слот.
<div class="highlight"><pre><span></span><code><span class="c1">// Sprinting</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Sprint&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Triggered, this, &amp;ACoreCharacter::StartSprint);</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Completed, this, &amp;ACoreCharacter::EndSprint);</span>
<span class="p">}</span>
</code></pre></div>
Компилируем код.</p>
<h5 id="sprint-ability"><code>Sprint Ability</code></h5>
<p>В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Blueprint Class</code>. В качестве класса выбираем <code>CoreGameplayAbility</code>.</p>
<p><a class="glightbox" href="../images/2bf5734b3f42a6b67062fc3a6a4b89ad.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2bf5734b3f42a6b67062fc3a6a4b89ad.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2bf5734b3f42a6b67062fc3a6a4b89ad.png" /></a></p>
<p>Называем новый ассет - <code>GA_Sprint</code>.</p>
<p><a class="glightbox" href="../images/319fc872b61296b5bc2fb2fe1689fa4a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="319fc872b61296b5bc2fb2fe1689fa4a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/319fc872b61296b5bc2fb2fe1689fa4a.png" /></a></p>
<p>Открываем ассет и добавляем в него <code>blueprin</code> код, управляющий параметром <code>MaxWalkSpeed</code>.</p>
<p><a class="glightbox" href="../images/1525edc956a2bf1f573f159ce3b20ba7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1525edc956a2bf1f573f159ce3b20ba7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1525edc956a2bf1f573f159ce3b20ba7.png" /></a></p>
<p>Созданное событие надо добавить в соответствующий слот персонажа. Для этого в методе <code>BeginPlay</code> класса <code>BP_CoreCharacter</code> добавляем еще одну ноду <code>GiveAbility</code>, с указанием на <code>GA_Sprint</code>.</p>
<p><a class="glightbox" href="../images/573848573cb0f9146d93b699b0908b6d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="573848573cb0f9146d93b699b0908b6d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/573848573cb0f9146d93b699b0908b6d.png" /></a></p>
<p>Теперь, если запустить проект, мы увидим, что персонаж получил возможность бегать за счет использования <code>GameplayAbility</code>.</p>
<p><a class="glightbox" href="../images/a879a1bca085f162e3aa49506e5133ec.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a879a1bca085f162e3aa49506e5133ec.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a879a1bca085f162e3aa49506e5133ec.png" /></a></p>
<p>Как вы видите, слоты заработали.</p>
<p>Для каждого из слотов способностей, в методе <code>BindContext</code> необходимо добавлять отдельное условие. Для всех четырех  слотов код выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// Will send input value to local Gas Component</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::SendAbilityLocalInput</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FInputActionValue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">InputId</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Value</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">AbilityLocalInputPressed</span><span class="p">(</span><span class="n">InputId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">AbilityLocalInputReleased</span><span class="p">(</span><span class="n">InputId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ...</span>
<span class="c1">// BindContext</span>
<span class="c1">// Jumping</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Fire</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fire&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot1</span><span class="p">);</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot1</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Aim</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Aim&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot2</span><span class="p">);</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot2</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Sprinting</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Sprint&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Итоговый код метода <code>BindContext</code> выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// will bind new mapping context</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::BindContext</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">OnController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MappingContext</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// only because i don&#39;t want to crash app with check()</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetController</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">OnController</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PlayerController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get enhanced input component&#39;s subsystem</span>
<span class="w">    </span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">*</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">::</span><span class="n">GetSubsystem</span><span class="o">&lt;</span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">&gt;</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// input component</span>
<span class="w">    </span><span class="n">UEnhancedInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">EnhancedInputComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UEnhancedInputComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">InputComponent</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;ClearActionBindings(); // clear all bindings if necessary</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">ClearBindingsForObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear bindings only from this object</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// register mapping context</span>
<span class="w">        </span><span class="n">EiSubsystem</span><span class="o">-&gt;</span><span class="n">AddMappingContext</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="n">InputPriority</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// iterate over all mappings and put every unique action into the Map</span>
<span class="w">    </span><span class="c1">// since actions occur in the map multiple times, for every key binding</span>
<span class="w">    </span><span class="n">TMap</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">Actions</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FEnhancedActionKeyMapping</span><span class="w"> </span><span class="n">Mapping</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">GetMappings</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FName</span><span class="w"> </span><span class="n">ActionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Actions</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">ActionName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ActionName</span><span class="p">,</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Action Name = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// now differentiate actions in the loop and assign them according to the names</span>
<span class="w">    </span><span class="c1">// make sure to give action names accordingly</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TPair</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">ActionInfo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Actions</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">AName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Jumping</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// use integrated jump</span>
<span class="w">            </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Triggered, this, &amp;ACharacter::Jump);</span>
<span class="w">            </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Completed, this, &amp;ACharacter::StopJumping);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Fire</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fire&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot1</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Aim</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Aim&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot2</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot2</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Moving</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Move&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Move</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Sprinting</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Sprint&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Triggered, this, &amp;ACoreCharacter::StartSprint);</span>
<span class="w">            </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Completed, this, &amp;ACoreCharacter::EndSprint);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Looking around</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Look&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Rotate</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
На данном этапе старые функции обработки <code>StartSprint</code> и <code>EndSprint</code> можно убрать. Все способности должны работать исключительно через <code>GameplayAbility</code>. Стандартная обработка ввода остается лишь для камеры и движения персонажа.</p>
<h4 id="confirm-cancel">Добавляем действия <code>Confirm</code> и <code>Cancel</code></h4>
<p>Для инициализации слотов событий используется метод <code>BindAbilityActivationToInputComponent</code>. Мы вызывали этот метод в одной из предыдущих глав следующим образом:
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums/AbilityInputEnum.h&quot;</span>
<span class="c1">// register ability inputs</span>
<span class="c1">// https://forums.unrealengine.com/t/somebody-know-ftoplevelassetpath-of-5-1/734537/3</span>
<span class="c1">// Format is: /Script/ModuleName that owns this enum, EnumName</span>
<span class="c1">// if format is wrong - engine will crash because of assertion error</span>
<span class="c1">// My Module name is GASBase</span>
<span class="c1">// My Enum name is EAbilityInput</span>
<span class="n">FTopLevelAssetPath</span><span class="w"> </span><span class="n">EnumAssetPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;/Script/GASBase&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;EAbilityInput&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">BindAbilityActivationToInputComponent</span><span class="p">(</span><span class="n">InputComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayAbilityInputBinds</span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">EnumAssetPath</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Confirm</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Cancel</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
Обратите внимание на параметры <code>TEXT(""), TEXT("")</code>. Это пустые текстовые метки, в которые должна быть передана информация о двух действиях: <code>Confirm</code> и <code>Cancel</code>.
Данные действия отвечают за <code>blueprint</code> ноды <code>Wait For Cancel Input</code> и <code>Wait For Confirm Input</code>.</p>
<p><a class="glightbox" href="../images/c5c3fb515954857e2a4a88a047e0eefc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c5c3fb515954857e2a4a88a047e0eefc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c5c3fb515954857e2a4a88a047e0eefc.png" /></a></p>
<p><a class="glightbox" href="../images/84641f000dbb06fcb36a48702ea47137.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="84641f000dbb06fcb36a48702ea47137.png" auto_="auto;" display="block;" margin:="margin:" src="../images/84641f000dbb06fcb36a48702ea47137.png" /></a></p>
<p>Если не привязать действия <code>Confirm</code> и <code>Cancel</code>, то данные ноды работать не будут.</p>
<h5 id="_16">Классический способ привязки</h5>
<p>Действия <code>Confirm</code> и <code>Cancel</code> создаются вручную через меню <code>Edit -&gt; Project Settings -&gt; Input</code>.</p>
<p><a class="glightbox" href="../images/c876833dd593b53dadbae5fef860eacf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c876833dd593b53dadbae5fef860eacf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c876833dd593b53dadbae5fef860eacf.png" /></a></p>
<p>Затем, их названия передаются в метод <code>BindAbilityActivationToInputComponent</code> следующим образом:
<div class="highlight"><pre><span></span><code><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">BindAbilityActivationToInputComponent</span><span class="p">(</span><span class="n">InputComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayAbilityInputBinds</span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ConfirmAction&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CancelAction&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">EnumAssetPath</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Confirm</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Cancel</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
Именно так это сделано в проекте <code>GAS Documentation</code>.</p>
<p><a class="glightbox" href="../images/07b46635fa8489ba224179900c1deb13.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="07b46635fa8489ba224179900c1deb13.png" auto_="auto;" display="block;" margin:="margin:" src="../images/07b46635fa8489ba224179900c1deb13.png" /></a></p>
<p>Однако, если перейти в соответствующее меню, можно увидеть, что стандартная система ввода имеет пометку - <code>Deprecated</code>.</p>
<p><a class="glightbox" href="../images/8d6bbe169dfad819e15a955a2317b41f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8d6bbe169dfad819e15a955a2317b41f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8d6bbe169dfad819e15a955a2317b41f.png" /></a></p>
<p>Создать стандартные действия ввода все еще можно и они будут работать. Но <code>Deprecated</code> статус заданных таким образом действий не внушает оптимизма.</p>
<h5 id="enhancedinput">Привязка действий с применением плагина <code>EnhancedInput</code></h5>
<p>Необходимо привязать действия <code>Confirm</code> и <code>Cancel</code> с применением плагина <code>EnhancedInput</code>.
Для выполнения данной задачи, рассмотрим реализацию метода <code>BindAbilityActivationToInputComponent</code>. В коде метода можно найти функции, отвечающие за обработку действий <code>Confirm</code> и <code>Cancel</code>.</p>
<p><a class="glightbox" href="../images/36633d98904fb791a1542030b46e79e1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="36633d98904fb791a1542030b46e79e1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/36633d98904fb791a1542030b46e79e1.png" /></a></p>
<ul>
<li>Действие <code>Confirm</code> обрабатывается методом <code>&amp;UAbilitySystemComponent::LocalInputConfirm</code>.</li>
<li>Действие <code>Cancel</code> обрабатывается методом <code>&amp;UAbilitySystemComponent::LocalInputCancel</code>
Разработчик может привязать данные методы к собственным событиям, используя <code>EnhancedInput</code> и <code>MappingContext</code>.
Добавим <code>Input Action</code>под наши действия.</li>
</ul>
<p>В <code>Content Browser</code> нажимаем на кнопку <code>Add</code>, в меню <code>Input</code> выбираем <code>Input Action</code>.</p>
<p><a class="glightbox" href="../images/4a17004af3a5cbe294c2252897f5395b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4a17004af3a5cbe294c2252897f5395b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4a17004af3a5cbe294c2252897f5395b.png" /></a></p>
<p>Добавляем таким образом два действия <code>IA_Confirm</code> и <code>IA_Cancel</code>.</p>
<p><a class="glightbox" href="../images/2450cf32aaed2f04b70aa2fade850e18.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2450cf32aaed2f04b70aa2fade850e18.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2450cf32aaed2f04b70aa2fade850e18.png" /></a></p>
<p><code>Value Type</code> в каждом действии - <code>bool</code>.</p>
<p><a class="glightbox" href="../images/86a11f61e17022a323790fd1b87f0fb7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="86a11f61e17022a323790fd1b87f0fb7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/86a11f61e17022a323790fd1b87f0fb7.png" /></a></p>
<p><a class="glightbox" href="../images/0d62ac41fc3e280bc211114399ccd887.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0d62ac41fc3e280bc211114399ccd887.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0d62ac41fc3e280bc211114399ccd887.png" /></a></p>
<p>Созданные <code>InputAction</code> необходимо добавить в <code>MappingContext</code>, в нашем случае это <code>IMC_Default</code>.</p>
<p><a class="glightbox" href="../images/b302d9e94c7314d04abe49f3702420b7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b302d9e94c7314d04abe49f3702420b7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b302d9e94c7314d04abe49f3702420b7.png" /></a></p>
<p>Добавляем привязки клавиш к обоим действиям в контексте. В моем случае, действие <code>IA_Confirm</code> будет срабатывать по нажатию левой кнопки мыши, а действие <code>IA_Cancel</code> - по нажатию правой кнопки мыши. Если левая кнопка у вас уже привязана, например, к действию <code>IA_Fire</code> - ничего страшного, код все равно будет работать корректно.</p>
<p><a class="glightbox" href="../images/21d2710521a6e6e99a437b6321221da6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="21d2710521a6e6e99a437b6321221da6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/21d2710521a6e6e99a437b6321221da6.png" /></a></p>
<p>Дополняем код метода <code>ACoreCharacter::BindContext</code> следующими строчками:
<div class="highlight"><pre><span></span><code><span class="c1">// Confirm</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Confirm&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// bind Confirm action</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Started</span><span class="p">,</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UAbilitySystemComponent</span><span class="o">::</span><span class="n">LocalInputConfirm</span><span class="p">);</span>
<span class="w">    </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GenericCancelInputID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Confirm</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Cancel</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// bind Confirm action</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Started</span><span class="p">,</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UAbilitySystemComponent</span><span class="o">::</span><span class="n">LocalInputCancel</span><span class="p">);</span>
<span class="w">    </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GenericCancelInputID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Cancel</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Общий код метода <code>ACoreCharacter::BindContext</code> выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// will bind new mapping context</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::BindContext</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">OnController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MappingContext</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// only because i don&#39;t want to crash app with check()</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetController</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">OnController</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PlayerController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get enhanced input component&#39;s subsystem</span>
<span class="w">    </span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">*</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">::</span><span class="n">GetSubsystem</span><span class="o">&lt;</span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">&gt;</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// input component</span>
<span class="w">    </span><span class="n">UEnhancedInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">EnhancedInputComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UEnhancedInputComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">InputComponent</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;ClearActionBindings(); // clear all bindings if necessary</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">ClearBindingsForObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear bindings only from this object</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// register mapping context</span>
<span class="w">        </span><span class="n">EiSubsystem</span><span class="o">-&gt;</span><span class="n">AddMappingContext</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="n">InputPriority</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// iterate over all mappings and put every unique action into the Map</span>
<span class="w">    </span><span class="c1">// since actions occur in the map multiple times, for every key binding</span>
<span class="w">    </span><span class="n">TMap</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">Actions</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FEnhancedActionKeyMapping</span><span class="w"> </span><span class="n">Mapping</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">GetMappings</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FName</span><span class="w"> </span><span class="n">ActionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Actions</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">ActionName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ActionName</span><span class="p">,</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;Action Name = %s&quot;), *Mapping.Action-&gt;GetName())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// now differentiate actions in the loop and assign them according to the names</span>
<span class="w">    </span><span class="c1">// make sure to give action names accordingly</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TPair</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">ActionInfo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Actions</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">AName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Confirm</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Confirm&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// bind Confirm action</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Started</span><span class="p">,</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UAbilitySystemComponent</span><span class="o">::</span><span class="n">LocalInputConfirm</span><span class="p">);</span>
<span class="w">            </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GenericCancelInputID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Confirm</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Cancel</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// bind Confirm action</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Started</span><span class="p">,</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UAbilitySystemComponent</span><span class="o">::</span><span class="n">LocalInputCancel</span><span class="p">);</span>
<span class="w">            </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GenericCancelInputID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Cancel</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Jumping</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// use integrated jump</span>
<span class="w">            </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Triggered, this, &amp;ACharacter::Jump);</span>
<span class="w">            </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Completed, this, &amp;ACharacter::StopJumping);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Fire</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fire&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot1</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Aim</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Aim&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot2</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot2</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Moving</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Move&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Move</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Sprinting</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Sprint&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Looking around</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Look&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Rotate</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h5 id="confirmable-fire-ability">Проверка, Confirmable <code>Fire Ability</code></h5>
<p>Для проверки кода, создадим новый <code>GameplayAction</code>. В <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; Blueprint Class</code>.
Выбираем в пункте <code>All Classes</code> подкласс <code>CoreGameplayAbility</code>.</p>
<p><a class="glightbox" href="../images/916e0fc33b16a60342ebf136593c3e85.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="916e0fc33b16a60342ebf136593c3e85.png" auto_="auto;" display="block;" margin:="margin:" src="../images/916e0fc33b16a60342ebf136593c3e85.png" /></a></p>
<p>Называем новый <code>blueprint</code> - <code>GA_Fire</code>.</p>
<p><a class="glightbox" href="../images/9513f7c22329022d1fca8214d84d3aa1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9513f7c22329022d1fca8214d84d3aa1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9513f7c22329022d1fca8214d84d3aa1.png" /></a></p>
<p>Открываем действие и устанавливаем слот - <code>Fire Slot</code>.</p>
<p><a class="glightbox" href="../images/47a8f08421033076f6c6148c3cf382d5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="47a8f08421033076f6c6148c3cf382d5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/47a8f08421033076f6c6148c3cf382d5.png" /></a></p>
<p>Добавляем в код действия <code>GA_Fire</code> следующий граф:</p>
<p><a class="glightbox" href="../images/57d8e706083558c74b7dfd7b4916e39d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="57d8e706083558c74b7dfd7b4916e39d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/57d8e706083558c74b7dfd7b4916e39d.png" /></a></p>
<p>Добавляем действие к <code>ASC</code> в методе <code>BeginPlay</code> персонажа <code>BP_CoreCharacter</code>:</p>
<p><a class="glightbox" href="../images/b02ba7f2cdd1396f92115fbc76a5e59a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b02ba7f2cdd1396f92115fbc76a5e59a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b02ba7f2cdd1396f92115fbc76a5e59a.png" /></a></p>
<p>Запускаем проект и нажимаем кнопку, к которой привязано действие <code>IA_Fire</code>. У меня это левая кнопка мыши.</p>
<p>Сначала появится сообщение <code>Ready To Fire, Ser!</code>:</p>
<p><a class="glightbox" href="../images/bb04e3bce8a161cedb7794c354c50a0e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bb04e3bce8a161cedb7794c354c50a0e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bb04e3bce8a161cedb7794c354c50a0e.png" /></a></p>
<p>Если повторно нажать левую кнопку мыши, это приведет к срабатыванию действия <code>Confirm</code>.</p>
<p><a class="glightbox" href="../images/4cd7a8a5fb07f8affbaa9aae9dc5aecc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4cd7a8a5fb07f8affbaa9aae9dc5aecc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4cd7a8a5fb07f8affbaa9aae9dc5aecc.png" /></a></p>
<p>В результате на экране, с периодом в <code>0.2</code> секунды будет печататься слово <code>PeW!</code>.</p>
<p><a class="glightbox" href="../images/114d14e9ebcccf57f340aba39681d20b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="114d14e9ebcccf57f340aba39681d20b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/114d14e9ebcccf57f340aba39681d20b.png" /></a></p>
<p><a class="glightbox" href="../images/194cfed09feee399995682f02fcc65e0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="194cfed09feee399995682f02fcc65e0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/194cfed09feee399995682f02fcc65e0.png" /></a></p>
<p>Если нажать правую кнопку мыши, произойдет срабатывание действия <code>Cancel</code> и выведется текст <code>Hold Fire!</code>.</p>
<p><a class="glightbox" href="../images/15f7897ff01a64c8fff136240ac89e41.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="15f7897ff01a64c8fff136240ac89e41.png" auto_="auto;" display="block;" margin:="margin:" src="../images/15f7897ff01a64c8fff136240ac89e41.png" /></a></p>
<p><a class="glightbox" href="../images/719dbd63ddd5869ad0f396c5012cdc61.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="719dbd63ddd5869ad0f396c5012cdc61.png" auto_="auto;" display="block;" margin:="margin:" src="../images/719dbd63ddd5869ad0f396c5012cdc61.png" /></a></p>
<h3 id="_17">Добавление способностей и эффектов "по умолчанию"</h3>
<p>Добавлять способности в <code>ASC</code> из события <code>BeginPlay</code>, как я это делал выше - крайне неудобно.</p>
<p><a class="glightbox" href="../images/6e812601a1c6032ca53838489cd783b2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6e812601a1c6032ca53838489cd783b2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6e812601a1c6032ca53838489cd783b2.png" /></a></p>
<p>В разы удобнее было бы создать массив с базовым набором автоматически загружаемых способностей.</p>
<p>Массив такого типа можно разместить прямо внутри нашего <code>Ability System Component</code>, просто переопределив его класс. Однако разработчики рекомендуют использовать в таких ситуациях <code>DataAsset</code>. Это позволит легко переключаться между наборами способностей для разного вида персонажей.</p>
<p>Помимо способностей, в <code>DataAsset</code> можно хранить настройки внешнего вида персонажей, их экипировку и любую другую информацию. Оставлю это на будущее.</p>
<h4 id="data-asset">Создаем <code>Data Asset</code> для способностей и эффектов</h4>
<p>Выполняем команду <code>Tools -&gt; New C++ Class</code>, в появившемся окне, на вкладке <code>All Classes</code> ищем базовый класс <code>PrimaryDataAsset</code>.</p>
<p><a class="glightbox" href="../images/dfff9bef0be2cba3089487d96cd3c44a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dfff9bef0be2cba3089487d96cd3c44a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dfff9bef0be2cba3089487d96cd3c44a.png" /></a></p>
<p>Называем будущий класс <code>CharacterAbilitiesData</code> и размещаем его в подпапке <code>Data</code>.</p>
<p><a class="glightbox" href="../images/ccd654b1bbfd4e391ffe02578fa69078.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ccd654b1bbfd4e391ffe02578fa69078.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ccd654b1bbfd4e391ffe02578fa69078.png" /></a></p>
<h4 id="characterabilitiesdatah">Файл <code>CharacterAbilitiesData.h</code></h4>
<p><div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/DataAsset.h&quot;</span><span class="c1"> // core</span>
<span class="c1">// GAS</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayEffect.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Abilities/GameplayAbility.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;NativeGameplayTags.h&quot;</span><span class="c1"> // gameplay tags</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputAction.h&quot;</span><span class="c1"> // enhanced input</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InputMappingContext.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CharacterAbilitiesData.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Character Initial Abilities</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">UCharacterAbilitiesData</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UPrimaryDataAsset</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor for default values</span>
<span class="w">    </span><span class="n">UCharacterAbilitiesData</span><span class="p">(){</span><span class="w"> </span><span class="cm">/* nothing here yet */</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// Default Abilities for this character</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Gameplay&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">UCoreGameplayAbility</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Abilities</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Default Effects for this character</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Gameplay&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">UGameplayEffect</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Effects</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
Внутри класса <code>UCharacterAbilitiesData</code> я сделал две переменные. Одну - для способностей, которые будут даны персонажу после инициализации, вторую - для хранения эффектов, которые тоже будут даны после инициализации.</p>
<p>Создадим новый <code>Data Asset</code> с использованием добавленного нами типа <code>CharacterAbilitiesData</code>.
Для этого в <code>Content Browser</code> нажмите кнопку <code>Add</code> и перейдите в меню <code>Miscelanneous -&gt; DataAsset</code>.</p>
<p><a class="glightbox" href="../images/bda17a032cf203de00db72458d35eddc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bda17a032cf203de00db72458d35eddc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bda17a032cf203de00db72458d35eddc.png" /></a></p>
<p>В появившемся окне ищите класс <code>CharacterAbilitiesData</code>.</p>
<p><a class="glightbox" href="../images/fcf810ff83c2e5930d57cbca81dc757e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fcf810ff83c2e5930d57cbca81dc757e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fcf810ff83c2e5930d57cbca81dc757e.png" /></a></p>
<p>Называем созданный файл - <code>DA_PlayerAbilities</code>.</p>
<p><a class="glightbox" href="../images/88a45a4e2b7142f71d845da9c6885eec.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="88a45a4e2b7142f71d845da9c6885eec.png" auto_="auto;" display="block;" margin:="margin:" src="../images/88a45a4e2b7142f71d845da9c6885eec.png" /></a></p>
<p>Открываем. Задаем созданные нами способности.</p>
<p><a class="glightbox" href="../images/947ac861567629f1148a86800c2ccd86.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="947ac861567629f1148a86800c2ccd86.png" auto_="auto;" display="block;" margin:="margin:" src="../images/947ac861567629f1148a86800c2ccd86.png" /></a></p>
<h4 id="dataasset">Применяем <code>DataAsset</code> к персонажу</h4>
<p><code>DataAsset</code> с информацией о способностям необходимо загрузить в персонажа. Напишем для этих целей дополнительный метод.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// will apply abilities and effects, that specified in Data asset</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Input&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ApplyAbilitiesData</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">UCharacterAbilitiesData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bOnlyEffects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// will apply abilities and effects, that specified in Data asset</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::ApplyAbilitiesData</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">UCharacterAbilitiesData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bOnlyEffects</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// check initialisation</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// ability grant level</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bOnlyEffects</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="p">){</span>
<span class="w">        </span><span class="cm">/**</span>
<span class="cm">         * Add Abilities</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">UCoreGameplayAbility</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">AbilityClass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Data</span><span class="o">-&gt;</span><span class="n">Abilities</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">AbilityClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// form ability info</span>
<span class="w">            </span><span class="n">FGameplayAbilitySpec</span><span class="w"> </span><span class="n">Spec</span><span class="p">{</span>
<span class="w">                </span><span class="n">AbilityClass</span>
<span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="n">Level</span><span class="w"> </span><span class="c1">// character level on that this ability will be granted</span>
<span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">AbilityClass</span><span class="o">-&gt;</span><span class="n">GetDefaultObject</span><span class="o">&lt;</span><span class="n">UCoreGameplayAbility</span><span class="o">&gt;</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">AbilitySlot</span><span class="w"> </span><span class="c1">// enum - ability slot type</span>
<span class="w">                </span><span class="p">,</span><span class="w"> </span><span class="k">this</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">            </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GiveAbility</span><span class="p">(</span><span class="n">Spec</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Add Effects</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">FGameplayEffectContextHandle</span><span class="w"> </span><span class="n">EffectContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">MakeEffectContext</span><span class="p">();</span>
<span class="w">    </span><span class="n">EffectContext</span><span class="p">.</span><span class="n">AddSourceObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// owner of effect</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">UGameplayEffect</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">EffectClass</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Data</span><span class="o">-&gt;</span><span class="n">Effects</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FGameplayEffectSpecHandle</span><span class="w"> </span><span class="n">SpecHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">MakeOutgoingSpec</span><span class="p">(</span><span class="n">EffectClass</span><span class="p">,</span><span class="w"> </span><span class="n">Level</span><span class="p">,</span><span class="w"> </span><span class="n">EffectContext</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SpecHandle</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="cm">/*FActiveGameplayEffectHandle GEHandle = */</span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">ApplyGameplayEffectSpecToSelf</span><span class="p">(</span><span class="o">*</span><span class="n">SpecHandle</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Метод <code>ApplyAbilitiesData</code> создан с модификатором <code>BlueprintCallable</code>  и потому его можно вызвать из <code>blueprint</code> кода.</p>
<p>Используя соответствующую ноду в событии <code>BeginPlay</code> персонажа, можно предоставить ему набор событий и эффектов.</p>
<p><a class="glightbox" href="../images/e38f4ceeca2450abe46e422dcca1dd08.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e38f4ceeca2450abe46e422dcca1dd08.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e38f4ceeca2450abe46e422dcca1dd08.png" /></a></p>
<p>Это, несомненно, важная возможность. Однако мне бы хотелось перименять <code>GameplayAbilities</code> к персонажу прямо из параметров класса.</p>
<p>Добавим к классу переменную:
<div class="highlight"><pre><span></span><code><span class="c1">// Character Abilities info</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span>
<span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">UCharacterAbilitiesData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DefaultAbilitiesInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</code></pre></div>
Используем данную переменную для загрузки способностей в класс. Сделать это надо в двух методах - <code>PossessedBy</code> и <code>OnRep_PlayerState</code> следующим образом:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// Character Abilities info</span>
<span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span>
<span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">UCharacterAbilitiesData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DefaultAbilitiesInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="c1">// Once character posessed</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PossessedBy</span><span class="p">(</span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">NewController</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">// PlayerState Replication Notification Callback</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnRep_PlayerState</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bDefaultAttributesApplied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// true if default attributes are applied</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// On Possessed</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::PossessedBy</span><span class="p">(</span><span class="n">AController</span><span class="o">*</span><span class="w"> </span><span class="n">NewController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PossessedBy</span><span class="p">(</span><span class="n">NewController</span><span class="p">);</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewController</span><span class="o">-&gt;</span><span class="n">IsLocalPlayerController</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Enable Camera only when character posessed by player</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsPlayer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FollowCamera</span><span class="o">-&gt;</span><span class="n">Activate</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// init GAS actor info</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="cm">/* Owner Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Avatar Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// apply default abilities and effects</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bDefaultAttributesApplied</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">DefaultAbilitiesInfo</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ApplyAbilitiesData</span><span class="p">(</span><span class="n">DefaultAbilitiesInfo</span><span class="p">);</span>
<span class="w">        </span><span class="n">bDefaultAttributesApplied</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// PlayerState Replication Notification Callback</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::OnRep_PlayerState</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">OnRep_PlayerState</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// init GAS actor info</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">InitAbilityActorInfo</span><span class="p">(</span><span class="cm">/* Owner Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Avatar Actor */</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// apply default abilities and effects</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bDefaultAttributesApplied</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">DefaultAbilitiesInfo</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ApplyAbilitiesData</span><span class="p">(</span><span class="n">DefaultAbilitiesInfo</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// on replication apply only effects</span>
<span class="w">        </span><span class="n">bDefaultAttributesApplied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">BindASCInput</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
После добавления кода и компиляции, у персонажа появится параметр <code>DefaultAbilitiesInfo</code>. В нем можно указать ассет с базовым набором способностей и эффектов персонажа. Они будут загружены автоматически.</p>
<p><a class="glightbox" href="../images/c386997b8b823c47a24274a78cdd1666.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c386997b8b823c47a24274a78cdd1666.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c386997b8b823c47a24274a78cdd1666.png" /></a></p>
<p><a class="glightbox" href="../images/09d46080f4b8e434fa0d6a7e4fa4b246.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="09d46080f4b8e434fa0d6a7e4fa4b246.png" auto_="auto;" display="block;" margin:="margin:" src="../images/09d46080f4b8e434fa0d6a7e4fa4b246.png" /></a></p>
<h3 id="_18">Фоновые способности / пассивные способности</h3>
<p>Способности такого типа автоматически запускаются, при добавлении в персонажа. Их <code>blueprint</code> логика используется для отслеживания определенных событий.</p>
<p>Например:
+ фоновая способность может накладывать на персонаж баф к здоровью, если он бежит,
+ фоновая  способность может защищать игрока ледяным щитом, с шансом в <code>25%</code>, при получении урона,
+ фоновая способность может с шансом в <code>16%</code>, при атаке наносить <code>AOE</code> урон всем окружающим противникам.</p>
<p><a class="glightbox" href="../images/b090ee403c1a408c962626e3310ef294.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b090ee403c1a408c962626e3310ef294.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b090ee403c1a408c962626e3310ef294.png" /></a></p>
<p>Это не совсем пассивные эффекты, это активные пассивные эффекты. Такие есть, например, в <code>Diablo</code>.
Как создать подобные способности?
В классе способности <code>CoreGameplayAbility</code>, который мы реализовали в главе "переопределяем <code>GameplayAbility</code>", необходимо реализовать метод <code>OnAvatarSet</code>, а так-же <code>bool</code> переменную <code>bRunOnAssign</code>.</p>
<p><a class="glightbox" href="../images/0bf9327d67af784af197d264d34983b5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0bf9327d67af784af197d264d34983b5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0bf9327d67af784af197d264d34983b5.png" /></a></p>
<p>В методе <code>OnAvatarSet</code> способность будет запускаться автоматически, если параметр <code>bRunOnAssign == true</code>.</p>
<h4 id="coregameplayabilityh"><code>CoreGameplayAbility.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Abilities/GameplayAbility.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Enums/AbilityInputEnum.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreGameplayAbility.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Base Ability class with ActionSlot support</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">UCoreGameplayAbility</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UGameplayAbility</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Ability Action</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Default&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">EAbilityInput</span><span class="w"> </span><span class="n">AbilitySlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">None</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Run Ability once it assigned to avatar</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintReadOnly</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Default&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bRunOnAssign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Called when the avatar actor is set/changes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnAvatarSet</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAbilityActorInfo</span><span class="o">*</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAbilitySpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Spec</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="coregameplayabilitycpp"><code>CoreGameplayAbility.cpp</code></h4>
<p><div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Abilities/CoreGameplayAbility.h&quot;</span>
<span class="c1">// Called when the avatar actor is set/changes</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCoreGameplayAbility::OnAvatarSet</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAbilityActorInfo</span><span class="o">*</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayAbilitySpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Spec</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">OnAvatarSet</span><span class="p">(</span><span class="n">ActorInfo</span><span class="p">,</span><span class="w"> </span><span class="n">Spec</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bRunOnAssign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// run ability automatically, once it assigned</span>
<span class="w">        </span><span class="n">ActorInfo</span><span class="o">-&gt;</span><span class="n">AbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">TryActivateAbility</span><span class="p">(</span><span class="n">Spec</span><span class="p">.</span><span class="n">Handle</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
После компиляции кода, у способностей, унаследованных от <code>UCoreGameplayAbility</code>, в секции <code>Default</code> будет доступен новый параметр - <code>RunOnAssign</code>.</p>
<p><a class="glightbox" href="../images/f8f681a420d1d8a72bdb661922d743b9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f8f681a420d1d8a72bdb661922d743b9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f8f681a420d1d8a72bdb661922d743b9.png" /></a></p>
<p>Если выставить его в <code>True</code> - такая способность активируется при присвоении.</p>
<h4 id="_19">Создаем фоновую способность</h4>
<p>Предлагаю протестировать данный функционал на примере способности, которая будет увеличивать здоровье персонажа, во время бега.</p>
<p>Для начала надо открыть способность бега - <code>GA_Sprint</code> и добавить в параметр <code>Activation Owned Tags</code>  новый тег <code>Locomotion.Sprint</code>.</p>
<p><a class="glightbox" href="../images/d2700c175492aa00f7b060a0aff26de1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d2700c175492aa00f7b060a0aff26de1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d2700c175492aa00f7b060a0aff26de1.png" /></a></p>
<p>Для добавления тега достаточно нажать на кнопку <code>Add New Gameplay Tag</code> в выпадающем меню параметра .</p>
<p><a class="glightbox" href="../images/ad9842bb62b5edaba2708879f0d58248.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ad9842bb62b5edaba2708879f0d58248.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ad9842bb62b5edaba2708879f0d58248.png" /></a></p>
<p><a class="glightbox" href="../images/e655d98e645da467bd7f14f85b75429a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e655d98e645da467bd7f14f85b75429a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e655d98e645da467bd7f14f85b75429a.png" /></a></p>
<p>Теперь необходимо создать новую способность. В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Blueprint Class</code>, в поле <code>All Classes</code> ищем <code>CoreGameplayAbility</code>, создаем ассет.</p>
<p><a class="glightbox" href="../images/2afce8d09adc8f4b4b788f712ff361ef.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2afce8d09adc8f4b4b788f712ff361ef.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2afce8d09adc8f4b4b788f712ff361ef.png" /></a></p>
<p>Называем новую способность - <code>GA_SprintHealthBoost</code>. Она будет увеличивать здоровье персонажа во время бега.</p>
<p><a class="glightbox" href="../images/8c624df9bbdc5eeaa07137d4086b4473.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8c624df9bbdc5eeaa07137d4086b4473.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8c624df9bbdc5eeaa07137d4086b4473.png" /></a></p>
<p>Так-же нам нужен <code>GameplayEffect</code>, который будет влиять на показатель здоровья.</p>
<p>В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Blueprint Class</code>, в поле <code>All Classes</code> ищем <code>GameplayEffect</code>, создаем ассет.</p>
<p><a class="glightbox" href="../images/7f0663b1cb6e6fb9d733822838ce995b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7f0663b1cb6e6fb9d733822838ce995b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7f0663b1cb6e6fb9d733822838ce995b.png" /></a></p>
<p>Называем новый эффект - <code>GE_SprintHealthBoost</code> и открываем файл эффекта.</p>
<p><a class="glightbox" href="../images/0fdd388510f17179be5cfad8bbc9ba58.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0fdd388510f17179be5cfad8bbc9ba58.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0fdd388510f17179be5cfad8bbc9ba58.png" /></a></p>
<p>В параметрах выставляем <code>Duration Policy</code> = <code>Instant</code>. Наш эффект будет мгновенным.</p>
<p><a class="glightbox" href="../images/c3242496eae432c2545de67770333890.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c3242496eae432c2545de67770333890.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c3242496eae432c2545de67770333890.png" /></a></p>
<p>Добавляем два элемента в список <code>Mofieirs</code>. Первый - увеличивает параметр <code>MaxHealth</code> на переданное значение, второй - увеличивает параметр <code>Health</code> на переданное значение.</p>
<p><a class="glightbox" href="../images/ad0101f4b214adf10c6701fd07707cec.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ad0101f4b214adf10c6701fd07707cec.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ad0101f4b214adf10c6701fd07707cec.png" /></a></p>
<p>Значение передается в эффект через <code>Set by Caller Magnitude</code> по тегу <code>Buff.Health.Increased.Value</code>. Тег можно добавить следующим образом:</p>
<p><a class="glightbox" href="../images/6fd73cbbc9b6d2cd27d1ce4dbfd3b338.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6fd73cbbc9b6d2cd27d1ce4dbfd3b338.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6fd73cbbc9b6d2cd27d1ce4dbfd3b338.png" /></a></p>
<p>Полученный эффект, при наложении на персонажа, будет увеличивать показатель здоровья на переданное через тег <code>Buff.Health.Increased.Value</code> значение.</p>
<p>Возвращаемся к способности <code>GA_SprintHealthBoost</code>. Открываем <code>blueprint</code> способности и добавляем туда следующий код:</p>
<p><a class="glightbox" href="../images/ebe59bae3f7fc7afa901ff86eff14158.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ebe59bae3f7fc7afa901ff86eff14158.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ebe59bae3f7fc7afa901ff86eff14158.png" /></a></p>
<p>Ноды <code>Wait Gameplay Tag Add</code> и <code>Wait Gameplay Tag Remove</code> активируются, когда персонаж с этой способностью получает или теряет <code>GameplayTag</code>. В нашем случае это <code>Locomotion.Sprint</code>. Данный тег накладывается на персонажа способностью <code>Sprint</code>, которую мы изменили чуть выше. Активация ожидающих нод приводит к наложению на персонажа эффекта, который увеличивает здоровье на <code>Boost Value</code> единиц.</p>
<p>Когда тег <code>Locomotion.Sprint</code> удаляется, мы так-же вычитаем значение <code>Boost Value</code> из текущего значения здоровья, используя тот-же самый эффект.</p>
<p>В моем случае <code>Boost Value</code> имеет значение в <code>10</code>, то есть здоровье будет увеличиваться на <code>10</code> единиц при беге.</p>
<p><a class="glightbox" href="../images/3e9ec4c3f771a4a7b0698889b2e6ed7f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3e9ec4c3f771a4a7b0698889b2e6ed7f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3e9ec4c3f771a4a7b0698889b2e6ed7f.png" /></a></p>
<p>Устанавливаем для способности <code>GA_SprintHealthBoost</code> параметр <code>RunOnAssign</code> в <code>true</code>.</p>
<p><a class="glightbox" href="../images/511d7b1f7dfff97827a7991ecda8b6e7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="511d7b1f7dfff97827a7991ecda8b6e7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/511d7b1f7dfff97827a7991ecda8b6e7.png" /></a></p>
<p>Теперь наша способность будет постоянно активироваться, при беге персонажа.</p>
<p>Добавляем способности <code>GA_Sprint</code> и <code>GA_SprintHealthBoost</code> в <code>DA_PlayerAbilities</code>, чтобы они загружались в класс "по умолчанию".</p>
<p><a class="glightbox" href="../images/23940fc82c902ee1306fd62287540d1b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="23940fc82c902ee1306fd62287540d1b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/23940fc82c902ee1306fd62287540d1b.png" /></a></p>
<p>Запускаем проект, вбиваем в консоль команду <code>showdebug AbilitySystem</code> и следим за изменением характеристик.</p>
<p>До бега <code>Health - 70, Max Health - 120</code>.</p>
<p><a class="glightbox" href="../images/1ee4181677622f494703200069e76d37.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1ee4181677622f494703200069e76d37.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1ee4181677622f494703200069e76d37.png" /></a></p>
<p>В беге  <code>Health - 80, Max Health - 130</code>.</p>
<p><a class="glightbox" href="../images/4d9bd307f21eaff506c65d0fff3ef752.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4d9bd307f21eaff506c65d0fff3ef752.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4d9bd307f21eaff506c65d0fff3ef752.png" /></a></p>
<h2 id="_20">Отслеживание изменений в аттрибутах</h2>
<p>Как отследить изменение уровня здоровья или выносливости из кода персонажа?
Для отслеживания аттрибутов <code>GAS</code> в <code>blueprint</code> есть два способа реализации.</p>
<h3 id="blueprintimplementableevent">Отслеживаем аттрибуты через <code>BlueprintImplementableEvent</code></h3>
<p>Это самый простой способ.</p>
<p>Добавляем два метода с модификатором <code>BlueprintImplementableEvent</code> для двух характеристик (выносливости и  здоровья) в класс персонажа <code>CoreCharacter.h</code>.
<div class="highlight"><pre><span></span><code><span class="cm">/** =======================================================</span>
<span class="cm"> * Attribute Changes</span>
<span class="cm"> */</span>
<span class="c1">// event, that will be called once HealthChanged</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintImplementableEvent</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">OnHealthChanged</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintImplementableEvent</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">OnStaminaChanged</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">NewValue</span><span class="p">);</span>
</code></pre></div>
Реализацию этим событиям писать не надо, потому что она будет сгенерирована автоматически системой <code>UHT</code>.
В методе <code>BeginPlay</code> вызываем каждую из функций внутри лямбды, связанной с изменением аттрибута:
<div class="highlight"><pre><span></span><code><span class="c1">// Called when the game starts or when spawned</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ....</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Bind Attribute Changes</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="c1">// bind health changes</span>
<span class="w">    </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GetGameplayAttributeValueChangeDelegate</span><span class="p">(</span><span class="n">AttributeSet</span><span class="o">-&gt;</span><span class="n">GetHealthAttribute</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">AddLambda</span><span class="p">([</span><span class="k">this</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">FOnAttributeChangeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">){</span>
<span class="w">        </span><span class="n">OnHealthChanged</span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">NewValue</span><span class="p">);</span><span class="w"> </span><span class="c1">// call BlueprintImplementableEvent</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// bind stamina changes</span>
<span class="w">    </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GetGameplayAttributeValueChangeDelegate</span><span class="p">(</span><span class="n">AttributeSet</span><span class="o">-&gt;</span><span class="n">GetStaminaAttribute</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">AddLambda</span><span class="p">([</span><span class="k">this</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">FOnAttributeChangeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">){</span>
<span class="w">        </span><span class="n">OnStaminaChanged</span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">OldValue</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">NewValue</span><span class="p">);</span><span class="w"> </span><span class="c1">// call BlueprintImplementableEvent</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
После компиляции кода у вас появится возможность добавить новые <code>Event'ы</code> в <code>blueprint</code> персонажа: <code>OnStaminaChanged</code> и <code>OnHealthChanged</code>. Они срабатывают, когда изменяется соответствующая характеристика.</p>
<p><a class="glightbox" href="../images/6e6e2ac3c1dbbc5d1c079e9682c8395c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6e6e2ac3c1dbbc5d1c079e9682c8395c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6e6e2ac3c1dbbc5d1c079e9682c8395c.png" /></a></p>
<p>Я написал небольшой эффект. который расходует выносливость персонажа при беге.</p>
<p><a class="glightbox" href="../images/6356d5e6c8c8ede2cf3f65c1553e0a89.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6356d5e6c8c8ede2cf3f65c1553e0a89.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6356d5e6c8c8ede2cf3f65c1553e0a89.png" /></a></p>
<p>Данный эффект вызывается из способности <code>GA_Sprint</code>, к как ее <code>cost</code>.</p>
<p><a class="glightbox" href="../images/3c65a7142460e4864d2abe386cd5cd40.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3c65a7142460e4864d2abe386cd5cd40.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3c65a7142460e4864d2abe386cd5cd40.png" /></a></p>
<p><a class="glightbox" href="../images/a61810cf30ef6378f6539bfec8e49095.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a61810cf30ef6378f6539bfec8e49095.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a61810cf30ef6378f6539bfec8e49095.png" /></a></p>
<p>Из-за изменения показателя <code>Stamina</code>, происходит вызов события <code>OnStaminaChanged</code>, что приводит к печати текста на экране.</p>
<p><a class="glightbox" href="../images/cc5cc070f7a3ba6ccba559a5ff4e2f8a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cc5cc070f7a3ba6ccba559a5ff4e2f8a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cc5cc070f7a3ba6ccba559a5ff4e2f8a.png" /></a></p>
<p><a class="glightbox" href="../images/266b108c975119d13c43af785a780ba6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="266b108c975119d13c43af785a780ba6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/266b108c975119d13c43af785a780ba6.png" /></a></p>
<h3 id="async-task">Использование <code>Async Task</code> для отслеживания аттрибутов</h3>
<p>Мы можем написать <code>Async Task</code> для отслеживания изменений в аттрибутах. (подробнее про <code>Async Task</code> можно прочитать в одной из предыдущих статей книги)</p>
<p>Автор репозитория <code>GAS Documentation</code> привел три примера <code>AsyncTask</code> - <a href="https://github.com/tranek/GASDocumentation/blob/master/Source/GASDocumentation/Public/Characters/Abilities/AsyncTaskAttributeChanged.h"><code>AsyncTaskAttributeChanged</code></a>, <a href="https://github.com/tranek/GASDocumentation/blob/master/Source/GASDocumentation/Public/Characters/Abilities/AsyncTaskCooldownChanged.h"><code>AsyncTaskCooldownChanged</code></a> и <a href="https://github.com/tranek/GASDocumentation/blob/master/Source/GASDocumentation/Public/Characters/Abilities/AsyncTaskEffectStackChanged.h"><code>AsyncTaskEffectStackChanged</code></a>.
Мы можем перенести их в свой проект без каких-либо сложностей.</p>
<p>В движке выполняем команду <code>Tools -&gt; New C++ Class</code>.
В появившемся окне переходим на вкладку <code>All Classes</code> и выбираем класс - <code>BlueprintAsyncActionBase</code>.</p>
<p><a class="glightbox" href="../images/781cace0a0e027d79f6f2ea3add3ae6f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="781cace0a0e027d79f6f2ea3add3ae6f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/781cace0a0e027d79f6f2ea3add3ae6f.png" /></a></p>
<p>Называем класс <code>AttributeChangedAsyncAction</code> и добавляем его в каталог <code>AsyncActions</code>.</p>
<p><a class="glightbox" href="../images/fa44d4a737cee673a23deb2607cc8486.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fa44d4a737cee673a23deb2607cc8486.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fa44d4a737cee673a23deb2607cc8486.png" /></a></p>
<p><a class="glightbox" href="../images/69926bef5d7c5a6d239aac13cbcf66da.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="69926bef5d7c5a6d239aac13cbcf66da.png" auto_="auto;" display="block;" margin:="margin:" src="../images/69926bef5d7c5a6d239aac13cbcf66da.png" /></a></p>
<p>Добавляем код</p>
<h4 id="attributechangedasyncactionh"><code>AttributeChangedAsyncAction.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/BlueprintAsyncActionBase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AttributeChangedAsyncAction.generated.h&quot;</span>
<span class="n">DECLARE_DYNAMIC_MULTICAST_DELEGATE_ThreeParams</span><span class="p">(</span><span class="n">FOnAttributeChangedPin</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="p">,</span><span class="w"> </span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">OldValue</span><span class="p">);</span>
<span class="cm">/**</span>
<span class="cm"> * Blueprint node to automatically register a listener for all attribute changes in an AbilitySystemComponent.</span>
<span class="cm"> * Useful to use in UI.</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ExposedAsyncProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AsyncTask</span><span class="p">))</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">UAttributeChangedAsyncAction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UBlueprintAsyncActionBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintAssignable</span><span class="p">)</span>
<span class="w">    </span><span class="n">FOnAttributeChangedPin</span><span class="w"> </span><span class="n">AttributeChanged</span><span class="p">;</span><span class="w"> </span><span class="c1">// this will create pin</span>
<span class="w">    </span><span class="c1">// Listens for an attribute changing.</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BlueprintInternalUseOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">UAttributeChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="n">ListenForAttributeChange</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="w"> </span><span class="n">Attribute</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Listens for an attribute changing.</span>
<span class="w">    </span><span class="c1">// Version that takes in an array of Attributes. Check the Attribute output for which Attribute changed.</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BlueprintInternalUseOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">UAttributeChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="n">ListenForAttributesChange</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">,</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FGameplayAttribute</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Attributes</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// You must call this function manually when you want the AsyncTask to end.</span>
<span class="w">    </span><span class="c1">// For UMG Widgets, you would call it in the Widget&#39;s Destruct event.</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">EndTask</span><span class="p">();</span>
<span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">()</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">ASC</span><span class="p">;</span>
<span class="w">    </span><span class="n">FGameplayAttribute</span><span class="w"> </span><span class="n">AttributeToListenFor</span><span class="p">;</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FGameplayAttribute</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AttributesToListenFor</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// this will be bound to GetGameplayAttributeValueChangeDelegate</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnAttributeChanged</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FOnAttributeChangeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="attributechangedasyncactioncpp"><code>AttributeChangedAsyncAction.cpp</code></h4>
<p><div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AsyncActions/AttributeChangedAsyncAction.h&quot;</span>
<span class="c1">// Listens for an attribute changing.</span>
<span class="n">UAttributeChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="nf">UAttributeChangedAsyncAction::ListenForAttributeChange</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayAttribute</span><span class="w"> </span><span class="n">Attribute</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UAttributeChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="n">WaitForAttributeChangedTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewObject</span><span class="o">&lt;</span><span class="n">UAttributeChangedAsyncAction</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">WaitForAttributeChangedTask</span><span class="o">-&gt;</span><span class="n">ASC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">;</span>
<span class="w">    </span><span class="n">WaitForAttributeChangedTask</span><span class="o">-&gt;</span><span class="n">AttributeToListenFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Attribute</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsValid</span><span class="p">(</span><span class="n">AbilitySystemComponent</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">Attribute</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">WaitForAttributeChangedTask</span><span class="o">-&gt;</span><span class="n">RemoveFromRoot</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// bind AttributeChanged</span>
<span class="w">    </span><span class="n">AbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GetGameplayAttributeValueChangeDelegate</span><span class="p">(</span><span class="n">Attribute</span><span class="p">).</span><span class="n">AddUObject</span><span class="p">(</span><span class="n">WaitForAttributeChangedTask</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UAttributeChangedAsyncAction</span><span class="o">::</span><span class="n">OnAttributeChanged</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">WaitForAttributeChangedTask</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Listens for an attribute changing.</span>
<span class="c1">// Version that takes in an array of Attributes. Check the Attribute output for which Attribute changed.</span>
<span class="n">UAttributeChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="nf">UAttributeChangedAsyncAction::ListenForAttributesChange</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">,</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FGameplayAttribute</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Attributes</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UAttributeChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="n">WaitForAttributeChangedTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewObject</span><span class="o">&lt;</span><span class="n">UAttributeChangedAsyncAction</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">WaitForAttributeChangedTask</span><span class="o">-&gt;</span><span class="n">ASC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">;</span>
<span class="w">    </span><span class="n">WaitForAttributeChangedTask</span><span class="o">-&gt;</span><span class="n">AttributesToListenFor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Attributes</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsValid</span><span class="p">(</span><span class="n">AbilitySystemComponent</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Attributes</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">WaitForAttributeChangedTask</span><span class="o">-&gt;</span><span class="n">RemoveFromRoot</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// for each attribute</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FGameplayAttribute</span><span class="w"> </span><span class="n">Attribute</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Attributes</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// bind AttributeChanged</span>
<span class="w">        </span><span class="n">AbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GetGameplayAttributeValueChangeDelegate</span><span class="p">(</span><span class="n">Attribute</span><span class="p">).</span><span class="n">AddUObject</span><span class="p">(</span><span class="n">WaitForAttributeChangedTask</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UAttributeChangedAsyncAction</span><span class="o">::</span><span class="n">OnAttributeChanged</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">WaitForAttributeChangedTask</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// You must call this function manually when you want the AsyncTask to end.</span>
<span class="c1">// For UMG Widgets, you would call it in the Widget&#39;s Destruct event.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UAttributeChangedAsyncAction::EndTask</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsValid</span><span class="p">(</span><span class="n">ASC</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">GetGameplayAttributeValueChangeDelegate</span><span class="p">(</span><span class="n">AttributeToListenFor</span><span class="p">).</span><span class="n">RemoveAll</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FGameplayAttribute</span><span class="w"> </span><span class="n">Attribute</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AttributesToListenFor</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">GetGameplayAttributeValueChangeDelegate</span><span class="p">(</span><span class="n">Attribute</span><span class="p">).</span><span class="n">RemoveAll</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">SetReadyToDestroy</span><span class="p">();</span>
<span class="w">    </span><span class="n">MarkAsGarbage</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// this will be bound to GetGameplayAttributeValueChangeDelegate</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UAttributeChangedAsyncAction::OnAttributeChanged</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FOnAttributeChangeData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AttributeChanged</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">Attribute</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">NewValue</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">OldValue</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
После компиляции данного кода, вы сможете использовать две новые <code>blueprint</code> ноды: <code>Listen for Attribute Change</code> и <code>Listen for Attributes Change</code>.</p>
<p><a class="glightbox" href="../images/6e6ecc8007a3f1f2784ded9a42a0bbf5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6e6ecc8007a3f1f2784ded9a42a0bbf5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6e6ecc8007a3f1f2784ded9a42a0bbf5.png" /></a></p>
<p>Данные ноды будут срабатывать всякий раз при изменении выбранного аттрибута или списка аттрибутов.</p>
<p>Аналогичным образом переносятся действия <code>AsyncTaskCooldownChanged</code> и <code>AsyncTaskEffectStackChanged</code>.</p>
<h4 id="cooldownchangedasyncactionh"><code>CooldownChangedAsyncAction.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Fill out your copyright notice in the Description page of Project Settings.</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/BlueprintAsyncActionBase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayTagContainer.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CooldownChangedAsyncAction.generated.h&quot;</span>
<span class="n">DECLARE_DYNAMIC_MULTICAST_DELEGATE_ThreeParams</span><span class="p">(</span><span class="n">FOnCooldownChangedPin</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="p">,</span><span class="w"> </span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">TimeRemaining</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="n">Duration</span><span class="p">);</span>
<span class="cm">/**</span>
<span class="cm"> * Blueprint node to automatically register a listener for changes (Begin and End) to an array of Cooldown tags.</span>
<span class="cm"> * Useful to use in UI.</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ExposedAsyncProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AsyncTask</span><span class="p">))</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">UCooldownChangedAsyncAction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UBlueprintAsyncActionBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintAssignable</span><span class="p">)</span>
<span class="w">    </span><span class="n">FOnCooldownChangedPin</span><span class="w"> </span><span class="n">CooldownBegin</span><span class="p">;</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintAssignable</span><span class="p">)</span>
<span class="w">    </span><span class="n">FOnCooldownChangedPin</span><span class="w"> </span><span class="n">CooldownEnd</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Listens for changes (Begin and End) to cooldown GameplayEffects based on the cooldown tag.</span>
<span class="w">    </span><span class="c1">// UseServerCooldown determines if the Sever&#39;s cooldown is returned in addition to the local predicted cooldown.</span>
<span class="w">    </span><span class="c1">// If using ServerCooldown, TimeRemaining and Duration will return -1 to signal local predicted cooldown has begun.</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BlueprintInternalUseOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">UCooldownChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="n">ListenForCooldownChange</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">InCooldownTags</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">InUseServerCooldown</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// You must call this function manually when you want the AsyncTask to end.</span>
<span class="w">    </span><span class="c1">// For UMG Widgets, you would call it in the Widget&#39;s Destruct event.</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">EndTask</span><span class="p">();</span>
<span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">()</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">ASC</span><span class="p">;</span>
<span class="w">    </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">CooldownTags</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">UseServerCooldown</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will be bound to OnActiveGameplayEffectAddedDelegateToSelf</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnActiveGameplayEffectAddedCallback</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectSpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">SpecApplied</span><span class="p">,</span><span class="w"> </span><span class="n">FActiveGameplayEffectHandle</span><span class="w"> </span><span class="n">ActiveHandle</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Callback for RegisterGameplayTagEvent Added or Removed</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">CooldownTagAddedRemoved</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewCount</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// calculates cooldown for tag</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">GetCooldownRemainingForTag</span><span class="p">(</span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">InCooldownTags</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">TimeRemaining</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CooldownDuration</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="cooldownchangedasyncactionh_1"><code>CooldownChangedAsyncAction.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Fill out your copyright notice in the Description page of Project Settings.</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AsyncActions/CooldownChangedAsyncAction.h&quot;</span>
<span class="c1">// Listens for changes (Begin and End) to cooldown GameplayEffects based on the cooldown tag.</span>
<span class="c1">// UseServerCooldown determines if the Sever&#39;s cooldown is returned in addition to the local predicted cooldown.</span>
<span class="c1">// If using ServerCooldown, TimeRemaining and Duration will return -1 to signal local predicted cooldown has begun.</span>
<span class="n">UCooldownChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="nf">UCooldownChangedAsyncAction::ListenForCooldownChange</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">InCooldownTags</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">InUseServerCooldown</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UCooldownChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="n">ListenForCooldownChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewObject</span><span class="o">&lt;</span><span class="n">UCooldownChangedAsyncAction</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">ListenForCooldownChange</span><span class="o">-&gt;</span><span class="n">ASC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">;</span>
<span class="w">    </span><span class="n">ListenForCooldownChange</span><span class="o">-&gt;</span><span class="n">CooldownTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InCooldownTags</span><span class="p">;</span>
<span class="w">    </span><span class="n">ListenForCooldownChange</span><span class="o">-&gt;</span><span class="n">UseServerCooldown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InUseServerCooldown</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsValid</span><span class="p">(</span><span class="n">AbilitySystemComponent</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">InCooldownTags</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ListenForCooldownChange</span><span class="o">-&gt;</span><span class="n">EndTask</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// bind OnActiveGameplayEffectAddedCallback</span>
<span class="w">    </span><span class="n">AbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">OnActiveGameplayEffectAddedDelegateToSelf</span><span class="p">.</span><span class="n">AddUObject</span><span class="p">(</span><span class="n">ListenForCooldownChange</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UCooldownChangedAsyncAction</span><span class="o">::</span><span class="n">OnActiveGameplayEffectAddedCallback</span><span class="p">);</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FGameplayTag</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CooldownTagArray</span><span class="p">;</span>
<span class="w">    </span><span class="n">InCooldownTags</span><span class="p">.</span><span class="n">GetGameplayTagArray</span><span class="p">(</span><span class="n">CooldownTagArray</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">CooldownTag</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">CooldownTagArray</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// bind tag Added or Removed</span>
<span class="w">        </span><span class="n">AbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">RegisterGameplayTagEvent</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="n">EGameplayTagEventType</span><span class="o">::</span><span class="n">NewOrRemoved</span><span class="p">).</span><span class="n">AddUObject</span><span class="p">(</span><span class="n">ListenForCooldownChange</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UCooldownChangedAsyncAction</span><span class="o">::</span><span class="n">CooldownTagAddedRemoved</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ListenForCooldownChange</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// You must call this function manually when you want the AsyncTask to end.</span>
<span class="c1">// For UMG Widgets, you would call it in the Widget&#39;s Destruct event.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCooldownChangedAsyncAction::EndTask</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsValid</span><span class="p">(</span><span class="n">ASC</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">OnActiveGameplayEffectAddedDelegateToSelf</span><span class="p">.</span><span class="n">RemoveAll</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FGameplayTag</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CooldownTagArray</span><span class="p">;</span>
<span class="w">        </span><span class="n">CooldownTags</span><span class="p">.</span><span class="n">GetGameplayTagArray</span><span class="p">(</span><span class="n">CooldownTagArray</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">CooldownTag</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">CooldownTagArray</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">RegisterGameplayTagEvent</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="n">EGameplayTagEventType</span><span class="o">::</span><span class="n">NewOrRemoved</span><span class="p">).</span><span class="n">RemoveAll</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">SetReadyToDestroy</span><span class="p">();</span>
<span class="w">    </span><span class="n">MarkAsGarbage</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// will be bound to OnActiveGameplayEffectAddedDelegateToSelf</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCooldownChangedAsyncAction::OnActiveGameplayEffectAddedCallback</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectSpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">SpecApplied</span><span class="p">,</span><span class="w"> </span><span class="n">FActiveGameplayEffectHandle</span><span class="w"> </span><span class="n">ActiveHandle</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">AssetTags</span><span class="p">;</span>
<span class="w">    </span><span class="n">SpecApplied</span><span class="p">.</span><span class="n">GetAllAssetTags</span><span class="p">(</span><span class="n">AssetTags</span><span class="p">);</span>
<span class="w">    </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">GrantedTags</span><span class="p">;</span>
<span class="w">    </span><span class="n">SpecApplied</span><span class="p">.</span><span class="n">GetAllGrantedTags</span><span class="p">(</span><span class="n">GrantedTags</span><span class="p">);</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FGameplayTag</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CooldownTagArray</span><span class="p">;</span>
<span class="w">    </span><span class="n">CooldownTags</span><span class="p">.</span><span class="n">GetGameplayTagArray</span><span class="p">(</span><span class="n">CooldownTagArray</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">CooldownTag</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">CooldownTagArray</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AssetTags</span><span class="p">.</span><span class="n">HasTagExact</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">GrantedTags</span><span class="p">.</span><span class="n">HasTagExact</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">TimeRemaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// Expecting cooldown tag to always be first tag</span>
<span class="w">            </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">CooldownTagContainer</span><span class="p">(</span><span class="n">GrantedTags</span><span class="p">.</span><span class="n">GetByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="w">            </span><span class="n">GetCooldownRemainingForTag</span><span class="p">(</span><span class="n">CooldownTagContainer</span><span class="p">,</span><span class="w"> </span><span class="n">TimeRemaining</span><span class="p">,</span><span class="w"> </span><span class="n">Duration</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">GetOwnerRole</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ROLE_Authority</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Player is Server</span>
<span class="w">                </span><span class="n">CooldownBegin</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="n">TimeRemaining</span><span class="p">,</span><span class="w"> </span><span class="n">Duration</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">UseServerCooldown</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">SpecApplied</span><span class="p">.</span><span class="n">GetContext</span><span class="p">().</span><span class="n">GetAbilityInstance_NotReplicated</span><span class="p">())</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Client using predicted cooldown</span>
<span class="w">                </span><span class="n">CooldownBegin</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="n">TimeRemaining</span><span class="p">,</span><span class="w"> </span><span class="n">Duration</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UseServerCooldown</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">SpecApplied</span><span class="p">.</span><span class="n">GetContext</span><span class="p">().</span><span class="n">GetAbilityInstance_NotReplicated</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Client using Server&#39;s cooldown. This is Server&#39;s corrective cooldown GE.</span>
<span class="w">                </span><span class="n">CooldownBegin</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="n">TimeRemaining</span><span class="p">,</span><span class="w"> </span><span class="n">Duration</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UseServerCooldown</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">SpecApplied</span><span class="p">.</span><span class="n">GetContext</span><span class="p">().</span><span class="n">GetAbilityInstance_NotReplicated</span><span class="p">())</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Client using Server&#39;s cooldown but this is predicted cooldown GE.</span>
<span class="w">                </span><span class="c1">// This can be useful to gray out abilities until Server&#39;s cooldown comes in.</span>
<span class="w">                </span><span class="n">CooldownBegin</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Callback for RegisterGameplayTagEvent Added or Removed</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UCooldownChangedAsyncAction::CooldownTagAddedRemoved</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewCount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CooldownEnd</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">CooldownTag</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// calculates cooldown for tag</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">UCooldownChangedAsyncAction::GetCooldownRemainingForTag</span><span class="p">(</span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">InCooldownTags</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">TimeRemaining</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CooldownDuration</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsValid</span><span class="p">(</span><span class="n">ASC</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">InCooldownTags</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">TimeRemaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">CooldownDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">        </span><span class="n">FGameplayEffectQuery</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FGameplayEffectQuery</span><span class="o">::</span><span class="n">MakeQuery_MatchAnyOwningTags</span><span class="p">(</span><span class="n">InCooldownTags</span><span class="p">);</span>
<span class="w">        </span><span class="n">TArray</span><span class="o">&lt;</span><span class="w"> </span><span class="n">TPair</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">DurationAndTimeRemaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">GetActiveEffectsTimeRemainingAndDuration</span><span class="p">(</span><span class="n">Query</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DurationAndTimeRemaining</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">int32</span><span class="w"> </span><span class="n">BestIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">LongestTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DurationAndTimeRemaining</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Key</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">int32</span><span class="w"> </span><span class="n">Idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">Idx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">DurationAndTimeRemaining</span><span class="p">.</span><span class="n">Num</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">Idx</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DurationAndTimeRemaining</span><span class="p">[</span><span class="n">Idx</span><span class="p">].</span><span class="n">Key</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">LongestTime</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">LongestTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DurationAndTimeRemaining</span><span class="p">[</span><span class="n">Idx</span><span class="p">].</span><span class="n">Key</span><span class="p">;</span>
<span class="w">                    </span><span class="n">BestIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Idx</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">TimeRemaining</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DurationAndTimeRemaining</span><span class="p">[</span><span class="n">BestIdx</span><span class="p">].</span><span class="n">Key</span><span class="p">;</span>
<span class="w">            </span><span class="n">CooldownDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DurationAndTimeRemaining</span><span class="p">[</span><span class="n">BestIdx</span><span class="p">].</span><span class="n">Value</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><a class="glightbox" href="../images/a92cb1c4d2b0f167dae7a327132ad771.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a92cb1c4d2b0f167dae7a327132ad771.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a92cb1c4d2b0f167dae7a327132ad771.png" /></a></p>
<h4 id="effectstackchangedasyncactionh"><code>EffectStackChangedAsyncAction.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/BlueprintAsyncActionBase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EffectStackChangedAsyncAction.generated.h&quot;</span>
<span class="n">DECLARE_DYNAMIC_MULTICAST_DELEGATE_FourParams</span><span class="p">(</span><span class="n">FOnGameplayEffectStackChangedPin</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="p">,</span><span class="w"> </span><span class="n">EffectGameplayTag</span><span class="p">,</span><span class="w"> </span><span class="n">FActiveGameplayEffectHandle</span><span class="p">,</span><span class="w"> </span><span class="n">Handle</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="p">,</span><span class="w"> </span><span class="n">NewStackCount</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="p">,</span><span class="w"> </span><span class="n">OldStackCount</span><span class="p">);</span>
<span class="cm">/**</span>
<span class="cm"> * Blueprint node to automatically register a listener for changes to a GameplayEffect&#39;s stack count based on an Asset or Granted tag on the Effect.</span>
<span class="cm"> * Useful to use in UI.</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ExposedAsyncProxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AsyncTask</span><span class="p">))</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GASBASE_API</span><span class="w"> </span><span class="n">UEffectStackChangedAsyncAction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UBlueprintAsyncActionBase</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintAssignable</span><span class="p">,</span><span class="w"> </span><span class="n">Meta</span><span class="o">=</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EffectStackChange&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">FOnGameplayEffectStackChangedPin</span><span class="w"> </span><span class="n">OnGameplayEffectStackChange</span><span class="p">;</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BlueprintInternalUseOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">UEffectStackChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="n">ListenForGameplayEffectStackChange</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">EffectGameplayTag</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// You must call this function manually when you want the AsyncTask to end.</span>
<span class="w">    </span><span class="c1">// For UMG Widgets, you would call it in the Widget&#39;s Destruct event.</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">EndTask</span><span class="p">();</span>
<span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">()</span>
<span class="w">    </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">ASC</span><span class="p">;</span>
<span class="w">    </span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">EffectGameplayTag</span><span class="p">;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnActiveGameplayEffectAddedCallback</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectSpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">SpecApplied</span><span class="p">,</span><span class="w"> </span><span class="n">FActiveGameplayEffectHandle</span><span class="w"> </span><span class="n">ActiveHandle</span><span class="p">);</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">OnRemoveGameplayEffectCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FActiveGameplayEffect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">EffectRemoved</span><span class="p">);</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GameplayEffectStackChanged</span><span class="p">(</span><span class="n">FActiveGameplayEffectHandle</span><span class="w"> </span><span class="n">EffectHandle</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewStackCount</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">PreviousStackCount</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="effectstackchangedasyncactioncpp"><code>EffectStackChangedAsyncAction.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AsyncActions/EffectStackChangedAsyncAction.h&quot;</span>
<span class="n">UEffectStackChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="nf">UEffectStackChangedAsyncAction::ListenForGameplayEffectStackChange</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="w"> </span><span class="n">InEffectGameplayTag</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEffectStackChangedAsyncAction</span><span class="o">*</span><span class="w"> </span><span class="n">ListenForGameplayEffectStackChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewObject</span><span class="o">&lt;</span><span class="n">UEffectStackChangedAsyncAction</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">ListenForGameplayEffectStackChange</span><span class="o">-&gt;</span><span class="n">ASC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AbilitySystemComponent</span><span class="p">;</span>
<span class="w">    </span><span class="n">ListenForGameplayEffectStackChange</span><span class="o">-&gt;</span><span class="n">EffectGameplayTag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InEffectGameplayTag</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsValid</span><span class="p">(</span><span class="n">AbilitySystemComponent</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">InEffectGameplayTag</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ListenForGameplayEffectStackChange</span><span class="o">-&gt;</span><span class="n">EndTask</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">AbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">OnActiveGameplayEffectAddedDelegateToSelf</span><span class="p">.</span><span class="n">AddUObject</span><span class="p">(</span><span class="n">ListenForGameplayEffectStackChange</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UEffectStackChangedAsyncAction</span><span class="o">::</span><span class="n">OnActiveGameplayEffectAddedCallback</span><span class="p">);</span>
<span class="w">    </span><span class="n">AbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">OnAnyGameplayEffectRemovedDelegate</span><span class="p">().</span><span class="n">AddUObject</span><span class="p">(</span><span class="n">ListenForGameplayEffectStackChange</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UEffectStackChangedAsyncAction</span><span class="o">::</span><span class="n">OnRemoveGameplayEffectCallback</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ListenForGameplayEffectStackChange</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UEffectStackChangedAsyncAction::EndTask</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsValid</span><span class="p">(</span><span class="n">ASC</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">OnActiveGameplayEffectAddedDelegateToSelf</span><span class="p">.</span><span class="n">RemoveAll</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">OnAnyGameplayEffectRemovedDelegate</span><span class="p">().</span><span class="n">RemoveAll</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">SetReadyToDestroy</span><span class="p">();</span>
<span class="w">    </span><span class="n">MarkAsGarbage</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UEffectStackChangedAsyncAction::OnActiveGameplayEffectAddedCallback</span><span class="p">(</span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectSpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">SpecApplied</span><span class="p">,</span><span class="w"> </span><span class="n">FActiveGameplayEffectHandle</span><span class="w"> </span><span class="n">ActiveHandle</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">AssetTags</span><span class="p">;</span>
<span class="w">    </span><span class="n">SpecApplied</span><span class="p">.</span><span class="n">GetAllAssetTags</span><span class="p">(</span><span class="n">AssetTags</span><span class="p">);</span>
<span class="w">    </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">GrantedTags</span><span class="p">;</span>
<span class="w">    </span><span class="n">SpecApplied</span><span class="p">.</span><span class="n">GetAllGrantedTags</span><span class="p">(</span><span class="n">GrantedTags</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AssetTags</span><span class="p">.</span><span class="n">HasTagExact</span><span class="p">(</span><span class="n">EffectGameplayTag</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">GrantedTags</span><span class="p">.</span><span class="n">HasTagExact</span><span class="p">(</span><span class="n">EffectGameplayTag</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ASC</span><span class="o">-&gt;</span><span class="n">OnGameplayEffectStackChangeDelegate</span><span class="p">(</span><span class="n">ActiveHandle</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">AddUObject</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UEffectStackChangedAsyncAction</span><span class="o">::</span><span class="n">GameplayEffectStackChanged</span><span class="p">);</span>
<span class="w">        </span><span class="n">OnGameplayEffectStackChange</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">EffectGameplayTag</span><span class="p">,</span><span class="w"> </span><span class="n">ActiveHandle</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UEffectStackChangedAsyncAction::OnRemoveGameplayEffectCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FActiveGameplayEffect</span><span class="o">&amp;</span><span class="w"> </span><span class="n">EffectRemoved</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">AssetTags</span><span class="p">;</span>
<span class="w">    </span><span class="n">EffectRemoved</span><span class="p">.</span><span class="n">Spec</span><span class="p">.</span><span class="n">GetAllAssetTags</span><span class="p">(</span><span class="n">AssetTags</span><span class="p">);</span>
<span class="w">    </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">GrantedTags</span><span class="p">;</span>
<span class="w">    </span><span class="n">EffectRemoved</span><span class="p">.</span><span class="n">Spec</span><span class="p">.</span><span class="n">GetAllGrantedTags</span><span class="p">(</span><span class="n">GrantedTags</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AssetTags</span><span class="p">.</span><span class="n">HasTagExact</span><span class="p">(</span><span class="n">EffectGameplayTag</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">GrantedTags</span><span class="p">.</span><span class="n">HasTagExact</span><span class="p">(</span><span class="n">EffectGameplayTag</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">OnGameplayEffectStackChange</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">EffectGameplayTag</span><span class="p">,</span><span class="w"> </span><span class="n">EffectRemoved</span><span class="p">.</span><span class="n">Handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UEffectStackChangedAsyncAction::GameplayEffectStackChanged</span><span class="p">(</span><span class="n">FActiveGameplayEffectHandle</span><span class="w"> </span><span class="n">EffectHandle</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewStackCount</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">PreviousStackCount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">OnGameplayEffectStackChange</span><span class="p">.</span><span class="n">Broadcast</span><span class="p">(</span><span class="n">EffectGameplayTag</span><span class="p">,</span><span class="w"> </span><span class="n">EffectHandle</span><span class="p">,</span><span class="w"> </span><span class="n">NewStackCount</span><span class="p">,</span><span class="w"> </span><span class="n">PreviousStackCount</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><a class="glightbox" href="../images/a1114b18d8f90695022fdb759231c65e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a1114b18d8f90695022fdb759231c65e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a1114b18d8f90695022fdb759231c65e.png" /></a></p>
<h2 id="gui">Добавляем <code>GUI</code></h2>
<p>Теперь, когда мы можем отслеживать изменения аттрибутов - самое время добавить интерфейс для нашего проекта.</p>
<p>В <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; User Interface -&gt; Widget Blueprint</code> чтобы создать новый виджет.</p>
<p><a class="glightbox" href="../images/70c1be32eea040c52a5c058acefbc765.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="70c1be32eea040c52a5c058acefbc765.png" auto_="auto;" display="block;" margin:="margin:" src="../images/70c1be32eea040c52a5c058acefbc765.png" /></a></p>
<p>Называем виджет - <code>WB_Hud</code>.</p>
<p><a class="glightbox" href="../images/6ec53647b9c6d504adcc64720cc1fcbf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6ec53647b9c6d504adcc64720cc1fcbf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6ec53647b9c6d504adcc64720cc1fcbf.png" /></a></p>
<p>Откройте виджет.</p>
<p>Добавляем в <code>Designer</code> виджета два прогресс бара для отображения здоровья и выносливости, а так-же текстовые метки, которые будут отображать цифровое значение этих параметров:</p>
<p><a class="glightbox" href="../images/6be26d52657e6de2516331c9db90d076.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6be26d52657e6de2516331c9db90d076.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6be26d52657e6de2516331c9db90d076.png" /></a></p>
<p>Для <code>Progress Bar</code> выставляем  параметр <code>Percent</code> в <code>1</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/e34591e455963165fb75909fbe9380b9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e34591e455963165fb75909fbe9380b9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e34591e455963165fb75909fbe9380b9.png" /></a></p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/8aeff445033b2fab7a009da589d663d2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8aeff445033b2fab7a009da589d663d2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8aeff445033b2fab7a009da589d663d2.png" /></a></p>
<p>В <code>Graph</code> виджета добавьте переменную <code>ASC</code> типа <code>AbilitySystemComponent</code>, она должна иметь параметры <code>Instance Editable</code> и <code>Expose On Spawn</code>.</p>
<p><a class="glightbox" href="../images/e4c0448bf940e492d842c8826ae115b9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e4c0448bf940e492d842c8826ae115b9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e4c0448bf940e492d842c8826ae115b9.png" /></a></p>
<p>Далее добавляем логику для обновления обоих <code>Progress</code> баров и информации о показателях здоровья.</p>
<p><a class="glightbox" href="../images/377ef4448f131615863664ef4942f372.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="377ef4448f131615863664ef4942f372.png" auto_="auto;" display="block;" margin:="margin:" src="../images/377ef4448f131615863664ef4942f372.png" /></a></p>
<p><a class="glightbox" href="../images/f4c113b32f6d3c53c05294284873f2fa.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f4c113b32f6d3c53c05294284873f2fa.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f4c113b32f6d3c53c05294284873f2fa.png" /></a></p>
<p><a class="glightbox" href="../images/1cd2a6d78f1a5149c3e7e04886c3f26a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1cd2a6d78f1a5149c3e7e04886c3f26a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1cd2a6d78f1a5149c3e7e04886c3f26a.png" /></a></p>
<p><a class="glightbox" href="../images/e58b4a5c8e38e1f0180c9c114ae4c1ec.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e58b4a5c8e38e1f0180c9c114ae4c1ec.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e58b4a5c8e38e1f0180c9c114ae4c1ec.png" /></a></p>
<p><a class="glightbox" href="../images/bc04f9d5c4cc6f5e2810814728f8e19b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bc04f9d5c4cc6f5e2810814728f8e19b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bc04f9d5c4cc6f5e2810814728f8e19b.png" /></a></p>
<p>Чтобы виджет с показателями здоровья и выносливости отображался на главном экране, откроем <code>blueprint</code> нашего персонажа - <code>BP_CoreCharacter</code>.
В событии <code>BeginPlay</code> реализуйте логику создания виджета <code>WB_Hud</code> и добавления его в <code>Viewport</code>.</p>
<p><a class="glightbox" href="../images/3f2676fa0dbff8ce982d483d0ba7888e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3f2676fa0dbff8ce982d483d0ba7888e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3f2676fa0dbff8ce982d483d0ba7888e.png" /></a></p>
<p>В запущенном проекте виджет выглядит так:</p>
<p><a class="glightbox" href="../images/399bcd05a486acfa3b27a788de220414.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="399bcd05a486acfa3b27a788de220414.png" auto_="auto;" display="block;" margin:="margin:" src="../images/399bcd05a486acfa3b27a788de220414.png" /></a></p>
<p>Теперь, когда у нас есть визуальное представление характеристик, можно переходить к изучению эффектов.</p>
<h2 id="gameplayeffects"><code>GameplayEffects</code></h2>
<p><code>GameplayEffects</code> используются чтобы манипулировать аттрибутами в <code>Ability System Component</code>. Через эффекты разработчик может накладывать бафы, дебафы, эффекты периодического урона или исцеления.</p>
<h3 id="_21">Эффект, периодически расходующий выносливость при беге</h3>
<p>Самый элементарный пример эффекта - расход выносливости при беге. Данный эффект может быть создан двумя способами - через применение <code>Effect Cost</code> и через периодический эффект. В этой главе поговорим о периодическом эффекте расхода выносливости при беге.</p>
<p>Чтобы создать эффект, в <code>Content Browser</code> нажмите на кнопку <code>Add -&gt; Blueprint Class</code>.
В появившемся окне выбора класса найдите <code>GameplayEffect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/d5fae89c5eebee5cda9c94e3cbdc76c3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d5fae89c5eebee5cda9c94e3cbdc76c3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d5fae89c5eebee5cda9c94e3cbdc76c3.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Называем эффект <code>GE_SprintDrain</code>.</p>
<p><a class="glightbox" href="../images/5ca4beb8430e3021c94f6bfbdc8975b6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5ca4beb8430e3021c94f6bfbdc8975b6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5ca4beb8430e3021c94f6bfbdc8975b6.png" /></a></p>
<p>Открываем.</p>
<p>На панеди <code>Details</code> вы можете видеть основное меню настройки эффекта. Установите в этом меню следующие параметры:</p>
<p><a class="glightbox" href="../images/24a13ae32dc8d1a8441530a3edae056e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="24a13ae32dc8d1a8441530a3edae056e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/24a13ae32dc8d1a8441530a3edae056e.png" /></a></p>
<p>Параметр <code>Duration</code> отвечает за время активности эффекта. Я выставил там значение <code>Infinite</code>, потому что эффект будет накладываться и убираться по нажатию клавиши бега.</p>
<p>Параметр <code>Modifiers</code> содержит массив модификаторов, которые будут применены к аттрибутам персонажа, при активации эффекта. В список модификаторов необходимо добавить всего один - добавляющий к аттрибуту <code>Stamina</code> значение <code>-1</code>. Это будет убавлять выносливость при наложении модификатора.</p>
<p>Параметр <code>Period</code> отвечает за периодичность наложения модификаторов. В этом параметре необходимо установить значение в <code>0.1</code> - именно с такой периодичностью параметр <code>Stamina</code> будет расходоваться во время бега.</p>
<p>Эффект готов. Теперь необходимо его наложить из <code>Gameplay Action</code>, которое отвечает за <code>Sprint</code>, у нас это <code>GA_Sprint</code>.</p>
<p><a class="glightbox" href="../images/63476e3068e4a6fe0cceba094bce1548.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="63476e3068e4a6fe0cceba094bce1548.png" auto_="auto;" display="block;" margin:="margin:" src="../images/63476e3068e4a6fe0cceba094bce1548.png" /></a></p>
<p>Открываем <code>blueprint</code> действия. Добавляем туда следующий код:</p>
<p><a class="glightbox" href="../images/4caacaaecd64cf92d13d9cde8fc0c17f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4caacaaecd64cf92d13d9cde8fc0c17f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4caacaaecd64cf92d13d9cde8fc0c17f.png" /></a></p>
<p><a class="glightbox" href="../images/0f6edcfb4bc99613ee17b9b018873054.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0f6edcfb4bc99613ee17b9b018873054.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0f6edcfb4bc99613ee17b9b018873054.png" /></a></p>
<p>Эффект применяется нодой <code>Apply Gameplay Effect To Owner</code>, убирается нодой - <code>Remove Gameplay Effect From Owner</code>.
За уровнем выносливости следит нода <code>Wait Attribute Change Treshold</code>. За состоянием нажатия клавиши следит нода <code>Wait Input Release</code>. Если выносливость кончилась или клавиша бега была отпущена - эффект расхода выносливости спадает, а скорость персонажа восстанавливает свое значение.</p>
<p>Метод работает, но у него есть один крайне серьезный минус. Чтобы понять это - достаточно подпрыгнуть во время бега. Выносливость продолжит расходоваться, даже если персонаж в воздухе.</p>
<p><a class="glightbox" href="../images/4b03a2d92aa2eb4f592e3d0669be0276.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4b03a2d92aa2eb4f592e3d0669be0276.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4b03a2d92aa2eb4f592e3d0669be0276.png" /></a></p>
<p>Очевидно, что во время прыжка выносливость расходоваться не должна.</p>
<p>Для этого можно использовать <code>Ongoing Tag Requirements -&gt; Ignore Tags</code>. Если указать тут тег <code>Locomotion.Jump</code>, то при прыжках выносливость расходоваться не будет.</p>
<p><a class="glightbox" href="../images/cf2d287e6ad91f19cfa86b54dd9e7405.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cf2d287e6ad91f19cfa86b54dd9e7405.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cf2d287e6ad91f19cfa86b54dd9e7405.png" /></a></p>
<p>Проблема наступит тогда, когда персонаж упрется в стену и не будет фактически перемещаться, что все равно будет расходовать его выносливость. И эту проблему тегами не исправить.</p>
<p><a class="glightbox" href="../images/a02c3023753e3ac5d30eacc47c4e6440.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a02c3023753e3ac5d30eacc47c4e6440.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a02c3023753e3ac5d30eacc47c4e6440.png" /></a></p>
<p>Рассмотрим альтернативный способ расхода выносливости.</p>
<h3 id="effect-cost">Расход выносливости за счет <code>Effect Cost</code></h3>
<p>У <code>GameplayAbility</code> есть параметр <code>Effect Cost</code>.</p>
<p><a class="glightbox" href="../images/07e9a5fa0e6b3859d795f9c3152abfc0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="07e9a5fa0e6b3859d795f9c3152abfc0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/07e9a5fa0e6b3859d795f9c3152abfc0.png" /></a></p>
<p>В это поле надо добавлять <code>Duration = Instant</code> эффект. Данный эффект применяется на способность всякий раз, как вызывается нода <code>Commit Ability</code>.</p>
<p><a class="glightbox" href="../images/709584b40119f8ebb5908eeeb72f760d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="709584b40119f8ebb5908eeeb72f760d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/709584b40119f8ebb5908eeeb72f760d.png" /></a></p>
<p>Создаем новый эффект для <code>Effect Cost</code>.
В <code>Content Browser</code> нажмите на кнопку <code>Add -&gt; Blueprint Class</code>.
В появившемся окне выбора класса найдите <code>GameplayEffect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/d5fae89c5eebee5cda9c94e3cbdc76c3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d5fae89c5eebee5cda9c94e3cbdc76c3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d5fae89c5eebee5cda9c94e3cbdc76c3.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Называем эффект <code>GE_SprintCost</code>.</p>
<p><a class="glightbox" href="../images/75585c5639f4cde5a3d3ba723cc00ce8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="75585c5639f4cde5a3d3ba723cc00ce8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/75585c5639f4cde5a3d3ba723cc00ce8.png" /></a></p>
<p>Открываем.</p>
<p>На панели <code>Details</code> вы можете видеть основное меню настройки эффекта. Установите в этом меню следующие параметры:</p>
<p><a class="glightbox" href="../images/068e90970a296c8d772db7296c25d0f4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="068e90970a296c8d772db7296c25d0f4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/068e90970a296c8d772db7296c25d0f4.png" /></a></p>
<p><code>Duration</code> - <code>Instant</code>, потому что все <code>Cost</code> эффекты применяются единовременно и <code>Modifier Magnitude</code> -&gt; <code>Add</code> -&gt; <code>-1</code>, именно столько выносливости будет отниматься у персонажа, при применении эффекта.</p>
<p>Теперь идем в <code>GameplayAction</code> с логикой бега - <code>GA_Sprint</code> и устанавливаем эффект в слот <code>Cost Gameplay Effect Class</code>:</p>
<p><a class="glightbox" href="../images/97518d7a7b02a5436c98f5ee7d944b6a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="97518d7a7b02a5436c98f5ee7d944b6a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/97518d7a7b02a5436c98f5ee7d944b6a.png" /></a></p>
<p>Реализуем в теле класса следующую логику:</p>
<p><a class="glightbox" href="../images/b4e9d30cb3a0608118945073886a23df.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b4e9d30cb3a0608118945073886a23df.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b4e9d30cb3a0608118945073886a23df.png" /></a></p>
<p><a class="glightbox" href="../images/f259dfa03f289e8c2e606dd5a356eb00.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f259dfa03f289e8c2e606dd5a356eb00.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f259dfa03f289e8c2e606dd5a356eb00.png" /></a></p>
<p><a class="glightbox" href="../images/9b74a93dc81388d82340887a516122d6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9b74a93dc81388d82340887a516122d6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9b74a93dc81388d82340887a516122d6.png" /></a></p>
<p><a class="glightbox" href="../images/cdedbdad3bf7e31a8589fd0777140f62.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cdedbdad3bf7e31a8589fd0777140f62.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cdedbdad3bf7e31a8589fd0777140f62.png" /></a></p>
<p><a class="glightbox" href="../images/9a7da3581065baed79042bff7e234ef7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9a7da3581065baed79042bff7e234ef7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9a7da3581065baed79042bff7e234ef7.png" /></a></p>
<p>В этом коде, раз в <code>0.1</code> секунды вызывается нода <code>Commit Ability</code>, которая применяет эффект из параметра <code>Cost</code> к персонажу до тех пор, пока не кончится выносливость.</p>
<p><a class="glightbox" href="../images/7e4e475d6b2670c600f46e5527324e1c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7e4e475d6b2670c600f46e5527324e1c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7e4e475d6b2670c600f46e5527324e1c.png" /></a></p>
<p>Благодаря сложной логике проверок - выносливость не расходуется, если игрок прыгнул или уперся в стену и не бежит, или если его скорость равна той, что была до бега.</p>
<p><a class="glightbox" href="../images/f2fa783a64af376e62ec6bfa0a27a762.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f2fa783a64af376e62ec6bfa0a27a762.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f2fa783a64af376e62ec6bfa0a27a762.png" /></a></p>
<h3 id="_22">Эффект, переопределяющий начальные значения характеристик</h3>
<p>Базовые значения характеристик, которые разработчик задал в конструкторе <code>AttributeSet</code> могут быть переопределены за счет автоматически применяемого эффекта.</p>
<p><a class="glightbox" href="../images/beb4a699b4449a9f2bacd1e252139383.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="beb4a699b4449a9f2bacd1e252139383.png" auto_="auto;" display="block;" margin:="margin:" src="../images/beb4a699b4449a9f2bacd1e252139383.png" /></a></p>
<p>В частности, нам надо переопределить такие параметры как <code>Stamina Regen Rate</code> и <code>Health Regen Rate</code>. Остальное я пока трогать не буду.</p>
<p>Добавляем новый <code>GameplayEffect</code>.
В <code>Content Browser</code> нажмите на кнопку <code>Add -&gt; Blueprint Class</code>.
В появившемся окне выбора класса найдите <code>GameplayEffect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/d5fae89c5eebee5cda9c94e3cbdc76c3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d5fae89c5eebee5cda9c94e3cbdc76c3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d5fae89c5eebee5cda9c94e3cbdc76c3.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Называем эффект <code>GE_InitialAttributes</code>.
Это должен быть <code>Intant</code> эффект.</p>
<p><a class="glightbox" href="../images/87b8aa68b5f0f649b27671faacf5d71d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="87b8aa68b5f0f649b27671faacf5d71d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/87b8aa68b5f0f649b27671faacf5d71d.png" /></a></p>
<p>Я задал начальное значение здоровья на <code>70</code>, а максимальное на <code>100</code>.</p>
<p><a class="glightbox" href="../images/b1b2a27fdae780fb6763ad8fed962b47.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b1b2a27fdae780fb6763ad8fed962b47.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b1b2a27fdae780fb6763ad8fed962b47.png" /></a></p>
<p>Скорось восстановления здоровья - <code>1</code>, максимальная выносливость - <code>200</code>.</p>
<p><a class="glightbox" href="../images/ce8de0168f18724b26f9fcad55753b6b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ce8de0168f18724b26f9fcad55753b6b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ce8de0168f18724b26f9fcad55753b6b.png" /></a></p>
<p>Выносливость - <code>200</code>, скорость восстановления выносливости - <code>1</code>.</p>
<p><a class="glightbox" href="../images/cbd48bcd9aca633045e75f00bd779f33.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cbd48bcd9aca633045e75f00bd779f33.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cbd48bcd9aca633045e75f00bd779f33.png" /></a></p>
<p>Мана - <code>300</code>, скорость восстановления маны - <code>1</code>.</p>
<p><a class="glightbox" href="../images/e5cc3a10b04455cf0cbce9b5e6f29000.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e5cc3a10b04455cf0cbce9b5e6f29000.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e5cc3a10b04455cf0cbce9b5e6f29000.png" /></a></p>
<p>Все модификаторы эффекта создаются в режиме <code>Override</code>.
Первым задается модификатор <code>Max</code> значения характеристики, а потом - значение характеристики. Порядок важен.</p>
<p>Добавляем ссылку на созданный эффект в наш <code>DataAsset</code> со стартовыми способностями - <code>DA_PlayerAbilities</code>.</p>
<p><a class="glightbox" href="../images/e604cc47369c139288b9609dcdc9da2c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e604cc47369c139288b9609dcdc9da2c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e604cc47369c139288b9609dcdc9da2c.png" /></a></p>
<p>Запускаем проект и видим, что параметры изменились.</p>
<p><a class="glightbox" href="../images/509fbafcb9e56163e0053ae2fbc35a41.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="509fbafcb9e56163e0053ae2fbc35a41.png" auto_="auto;" display="block;" margin:="margin:" src="../images/509fbafcb9e56163e0053ae2fbc35a41.png" /></a></p>
<h3 id="_23">Эффект пассивного восстановления здоровья и выносливости</h3>
<p>Давайте создадим эффект, пассивно восстанавливающий выносливость и здоровье.</p>
<p>Добавляем новый <code>GameplayEffect</code>.
В <code>Content Browser</code> нажмите на кнопку <code>Add -&gt; Blueprint Class</code>.
В появившемся окне выбора класса найдите <code>GameplayEffect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/d5fae89c5eebee5cda9c94e3cbdc76c3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d5fae89c5eebee5cda9c94e3cbdc76c3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d5fae89c5eebee5cda9c94e3cbdc76c3.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Называем эффект <code>GE_HealthStaminaRegen</code>.</p>
<p><a class="glightbox" href="../images/3594000b7fe7d022e86ef095355394e6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3594000b7fe7d022e86ef095355394e6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3594000b7fe7d022e86ef095355394e6.png" /></a></p>
<p>Открываем созданный эффект. Задаем <code>Duration Policy = Infinite</code> и добавляем два модификатора, для здоровья и для выносливости.</p>
<p><a class="glightbox" href="../images/d2c8d11f233f578fe005ac3874bf2db3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d2c8d11f233f578fe005ac3874bf2db3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d2c8d11f233f578fe005ac3874bf2db3.png" /></a></p>
<p>Выставляем <code>Modifier Magnitude</code> - <code>Attribute Based</code> и в параметре <code>Attribute To Capture</code> выбираем аттрибут - <code>Health Regen Rate</code>.</p>
<p><a class="glightbox" href="../images/21287cfbc42c7c7c82aaccb9f363f033.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="21287cfbc42c7c7c82aaccb9f363f033.png" auto_="auto;" display="block;" margin:="margin:" src="../images/21287cfbc42c7c7c82aaccb9f363f033.png" /></a></p>
<p>Точно так-же выставляем и <code>Stamina Regen Rate</code>.
Сохраняем и запускаем проект. Видим постепенное восстановление здоровья и выносливости.</p>
<p><a class="glightbox" href="../images/b2533e09fe85548b7e63919dcd51770c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b2533e09fe85548b7e63919dcd51770c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b2533e09fe85548b7e63919dcd51770c.png" /></a></p>
<p>Однако, этого не достаточно. Во время бега происходит восстановление выносливости, что сказывается на поведении прогресс бара в интерфейсе.</p>
<p>Остановим восстановление выносливости во время бега.</p>
<p>Действие <code>GA_Sprint</code> накладывает тег <code>Locomotion.Sprint</code>, зная этот факт мы можем блокировать применение способности.</p>
<p><a class="glightbox" href="../images/d44981c2bb9a7587a1ae40cfcc9d8629.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d44981c2bb9a7587a1ae40cfcc9d8629.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d44981c2bb9a7587a1ae40cfcc9d8629.png" /></a></p>
<p>Для этого, в эффекте <code>GE_HealthStaminaRegen</code> выставляем параметр <code>Ongoing Tag Requirements -&gt; Ignore Tags</code> в значение <code>Locomotion.Sprint</code>.</p>
<p><a class="glightbox" href="../images/f6f6c2a21ef68189c04933504b4a460e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f6f6c2a21ef68189c04933504b4a460e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f6f6c2a21ef68189c04933504b4a460e.png" /></a></p>
<p>В результате, во время бега выносливость восстанавливаться не будет.</p>
<p>Вынесем логику восстановления здоровья в отдельный эффект, чтобы оно не останавливалось, во время бега.</p>
<p><a class="glightbox" href="../images/9c789fd85e2f1079fd54f7785c9fe2a5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9c789fd85e2f1079fd54f7785c9fe2a5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9c789fd85e2f1079fd54f7785c9fe2a5.png" /></a></p>
<p><a class="glightbox" href="../images/e3e11b2f65584201c7f070b9f86e9587.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e3e11b2f65584201c7f070b9f86e9587.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e3e11b2f65584201c7f070b9f86e9587.png" /></a></p>
<h3 id="_24">Стаки эффектов, стаки брони</h3>
<p>Создадим эффект который будет пассивно восстанавливать до 10 стаков брони на персонаже.</p>
<h4 id="_25">Добавляем эффект стаков брони</h4>
<p>В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Blueprint Class</code>, в появившемся окне, на вкладке <code>All Classes</code> ищем <code>Gameplay Effect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/249f28bb2be5d32d277fbd0265f963fd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="249f28bb2be5d32d277fbd0265f963fd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/249f28bb2be5d32d277fbd0265f963fd.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Создаем новый <code>blueprint</code> и называем его <code>GE_ArmorStacks</code>.</p>
<p><a class="glightbox" href="../images/5be9aff9375d3a62c80d7f3c3dfe3dc5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5be9aff9375d3a62c80d7f3c3dfe3dc5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5be9aff9375d3a62c80d7f3c3dfe3dc5.png" /></a></p>
<p>В коде эффекта добавляем модификатор, который увеличивает количество параметра <code>Armor</code> на 3.</p>
<p>Так-же устанавливаем <code>Duration Policy</code> на <code>Infinite</code>.</p>
<p><a class="glightbox" href="../images/7f4c884683d5acd168466aae7c6cf35d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7f4c884683d5acd168466aae7c6cf35d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7f4c884683d5acd168466aae7c6cf35d.png" /></a></p>
<p>В параметре <code>Stack Limit Count</code> ставим <code>5</code> - максимум <code>5</code> стаков брони. Так-же устанавливаем <code>Stacking Type</code>, этот параметр отвечает за накопление стаков на цели эффекта, выбираем <code>Aggregate by Target</code>.</p>
<p><a class="glightbox" href="../images/f16d6f8e34c6f3b719d1d2707dec45c6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f16d6f8e34c6f3b719d1d2707dec45c6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f16d6f8e34c6f3b719d1d2707dec45c6.png" /></a></p>
<p>Добавляем для эффекта тег, в секции <code>Granted Tags</code>, по которому мы будем отслеживать стаки. В моем случае тег - <code>Buff.Armor</code>.</p>
<p><a class="glightbox" href="../images/fab0b8f76c3d9e5219710996f77490ea.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fab0b8f76c3d9e5219710996f77490ea.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fab0b8f76c3d9e5219710996f77490ea.png" /></a></p>
<p><a class="glightbox" href="../images/630a5e2a28145b7a3c6bd75c9d1e4cba.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="630a5e2a28145b7a3c6bd75c9d1e4cba.png" auto_="auto;" display="block;" margin:="margin:" src="../images/630a5e2a28145b7a3c6bd75c9d1e4cba.png" /></a></p>
<h4 id="_26">Пишем способность, добавляющую стаки брони</h4>
<p>Добавляем пассивную способность, которая будет восстанавливать стаки брони с течением времени.</p>
<p>Для этого в <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; Blueprint Class</code>. В появившемся окне, на вкладке <code>All Classes</code> ищем класс - <code>CoreGameplayAbility</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/e3f80d1163ab005edef045ec35b0b34a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e3f80d1163ab005edef045ec35b0b34a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e3f80d1163ab005edef045ec35b0b34a.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Создаем новый <code>blueprint</code> на его основе. Называем новый класс <code>GA_ArmorRegen</code>.</p>
<p><a class="glightbox" href="../images/3fb0b30cb7f596ab77987c8482a89410.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3fb0b30cb7f596ab77987c8482a89410.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3fb0b30cb7f596ab77987c8482a89410.png" /></a></p>
<p>В настройках эффекта устанавливаем параметр <code>Run on Assign</code> в <code>True</code>.</p>
<p><a class="glightbox" href="../images/457cacc1c3e5b08af1a47ef1c8b4c1a2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="457cacc1c3e5b08af1a47ef1c8b4c1a2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/457cacc1c3e5b08af1a47ef1c8b4c1a2.png" /></a></p>
<p>Пишем код, который будет накладывать эффекты брони с течением времени.</p>
<p><a class="glightbox" href="../images/75878a14454227e5eca10e4f8c297ba5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="75878a14454227e5eca10e4f8c297ba5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/75878a14454227e5eca10e4f8c297ba5.png" /></a></p>
<p><a class="glightbox" href="../images/9cff18ad3655d68460f5f18b41ca6f93.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9cff18ad3655d68460f5f18b41ca6f93.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9cff18ad3655d68460f5f18b41ca6f93.png" /></a></p>
<p><a class="glightbox" href="../images/13bda7695c44ee72b533d0e8a87abdf3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="13bda7695c44ee72b533d0e8a87abdf3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/13bda7695c44ee72b533d0e8a87abdf3.png" /></a></p>
<p>Добавим созданное действие в список загружаемых "по умолчанию". Для этого откройте <code>Data Asset</code> - <code>DA_PlayerAbilities</code> и добавьте способность <code>GA_ArmorRegen</code> в список.</p>
<p><a class="glightbox" href="../images/63d6fd44242a411af98a5f66ef83488b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="63d6fd44242a411af98a5f66ef83488b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/63d6fd44242a411af98a5f66ef83488b.png" /></a></p>
<h4 id="_27">Добавляем индикатор брони в интерфейс</h4>
<p>Открываем виджет интерфейса <code>WB_Hud</code>.</p>
<p><a class="glightbox" href="../images/789bce00c966ebfbe265c443f3e84157.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="789bce00c966ebfbe265c443f3e84157.png" auto_="auto;" display="block;" margin:="margin:" src="../images/789bce00c966ebfbe265c443f3e84157.png" /></a></p>
<p>Добавляем справа от полосок здоровья и выносливости дополнительную иконку брони. Я нарисовал ее за пару секунд в gimp, изображение иконки приложено к книге в папке "дополнительно".</p>
<p><a class="glightbox" href="../images/c57fd1c7cb52daf9d89136e69aba0fe1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c57fd1c7cb52daf9d89136e69aba0fe1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c57fd1c7cb52daf9d89136e69aba0fe1.png" /></a></p>
<p>Интерфейс выглядит так:</p>
<p><a class="glightbox" href="../images/5c9796f0d6639af33f17ff6dfaff3c0d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5c9796f0d6639af33f17ff6dfaff3c0d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5c9796f0d6639af33f17ff6dfaff3c0d.png" /></a></p>
<p>Добавляем логику отслеживания стаков брони в <code>Graph</code> виджета, по событию <code>Construct</code>.</p>
<p><a class="glightbox" href="../images/cd068778c20a8a8e932d2ff2156e69fa.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cd068778c20a8a8e932d2ff2156e69fa.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cd068778c20a8a8e932d2ff2156e69fa.png" /></a></p>
<p><a class="glightbox" href="../images/5dd1f3ccb9ffcd82ed5e4e57b5359b18.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5dd1f3ccb9ffcd82ed5e4e57b5359b18.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5dd1f3ccb9ffcd82ed5e4e57b5359b18.png" /></a></p>
<h4 id="_28">Проверка</h4>
<p>При запуске игры вы увидите, как над индикатором брони увеличивается число стаков.</p>
<p><a class="glightbox" href="../images/f89d50cd229560bd33ec647a67f2254f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f89d50cd229560bd33ec647a67f2254f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f89d50cd229560bd33ec647a67f2254f.png" /></a></p>
<h2 id="gameplay-effect">Передача информации в <code>Gameplay Effect</code></h2>
<p>Рассмотрим различные способы передачи информации о уроне в <code>Gameplay Effect</code>, а так-же взаимодействия эффектов со способностями.</p>
<h3 id="set-by-caller-magnitude">Зоны урона и восстановления здоровья <code>Set By Caller Magnitude</code></h3>
<p>Реализуем зону урона, в которой у персонажа будет отниматься здоровье и еще одну зону, которая будет ускорять восстановление здоровья.</p>
<p>Передача значения урона, который наносит соответствующая зона, будет реализована с применением ноды <code>Set By Called Magnitude</code>. Это самый простой способ передать динамическое значение внутрь эффекта.</p>
<p>Добавляем новый <code>blueprint</code> класс типа <code>Actor</code>, он и будет олицетворять собой зону, которая применяет на персонажа требуемый эффект.</p>
<p>В <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; Blueprint Class</code>. В появившемся окне выбираем <code>Actor</code>.</p>
<p><a class="glightbox" href="../images/40ddde2399fa125954ecdb0f8c7346ae.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="40ddde2399fa125954ecdb0f8c7346ae.png" auto_="auto;" display="block;" margin:="margin:" src="../images/40ddde2399fa125954ecdb0f8c7346ae.png" /></a></p>
<p>Называем класс <code>BP_EffectZoneActor</code>.</p>
<p><a class="glightbox" href="../images/d61954c2f56cd97907a7ad8272393ac8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d61954c2f56cd97907a7ad8272393ac8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d61954c2f56cd97907a7ad8272393ac8.png" /></a></p>
<p>Открываем. Для обработки коллизий в класс необходимо добавить компонент - <code>Box Collision</code>.
Перетаскиваем его вверх, на <code>Default Scene Root</code>, чтобы сделать основным компоенентом класса.</p>
<p><a class="glightbox" href="../images/22783de9077d45d7b71d0dfb891f734c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="22783de9077d45d7b71d0dfb891f734c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/22783de9077d45d7b71d0dfb891f734c.png" /></a></p>
<p><a class="glightbox" href="../images/9147903e64f550378a6e14bd340db812.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9147903e64f550378a6e14bd340db812.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9147903e64f550378a6e14bd340db812.png" /></a></p>
<p>Для отображения места установки зоны, добавим <code>Static Mesh Component</code> и загрузим туда предзаданный меш <code>Plane</code>.</p>
<p><a class="glightbox" href="../images/00aa54e4f4780073a0605c11158e9918.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="00aa54e4f4780073a0605c11158e9918.png" auto_="auto;" display="block;" margin:="margin:" src="../images/00aa54e4f4780073a0605c11158e9918.png" /></a></p>
<p>Настроим коллизии. В компоненте <code>Box</code>, переключаемся на вкладку <code>Collision</code>.
Устанавливаем пресет - <code>OverlapAllDynamic</code>.</p>
<p><a class="glightbox" href="../images/eb67bc17e0453bba5186f35232124007.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="eb67bc17e0453bba5186f35232124007.png" auto_="auto;" display="block;" margin:="margin:" src="../images/eb67bc17e0453bba5186f35232124007.png" /></a></p>
<p>В компоненте <code>Plane</code> отключаем все коллизии, потому что он используется только для визуализации зоны.</p>
<p><a class="glightbox" href="../images/7651e32df55d353faab67d2807829911.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7651e32df55d353faab67d2807829911.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7651e32df55d353faab67d2807829911.png" /></a></p>
<p>В код класса добавляем переменную <code>Gameplay Effect Class</code>.</p>
<p><a class="glightbox" href="../images/b86d6cd343871fdf808a12da33f2cb39.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b86d6cd343871fdf808a12da33f2cb39.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b86d6cd343871fdf808a12da33f2cb39.png" /></a></p>
<p>Делаем данную переменную <code>Expose On Spawn</code> и <code>Instance Editable</code>.</p>
<p><a class="glightbox" href="../images/5dafeee8f2158094f691f373d4a864d0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5dafeee8f2158094f691f373d4a864d0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5dafeee8f2158094f691f373d4a864d0.png" /></a></p>
<p>Добавляем ряд других переменных.</p>
<p><a class="glightbox" href="../images/de9df36215ceba194bb9936b4c0e1a13.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="de9df36215ceba194bb9936b4c0e1a13.png" auto_="auto;" display="block;" margin:="margin:" src="../images/de9df36215ceba194bb9936b4c0e1a13.png" /></a></p>
<p><code>EffectValue</code> по умолчанию имеет значение в <code>-10</code>.
<code>Period</code> по умолчанию имеет значение в <code>0.1</code>.
Пишем логику применения выбранного эффекта по событию <code>Begin Play</code>.</p>
<p><a class="glightbox" href="../images/3562c3af6790303f6b4b87a6750b6839.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3562c3af6790303f6b4b87a6750b6839.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3562c3af6790303f6b4b87a6750b6839.png" /></a></p>
<p><a class="glightbox" href="../images/c70653cb465224bbf6f8f78038af8174.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c70653cb465224bbf6f8f78038af8174.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c70653cb465224bbf6f8f78038af8174.png" /></a></p>
<p><a class="glightbox" href="../images/5569c9a1751308a83442825bb0c62e21.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5569c9a1751308a83442825bb0c62e21.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5569c9a1751308a83442825bb0c62e21.png" /></a></p>
<p>Размещаем созданный класс где-нибудь на уровне.</p>
<p><a class="glightbox" href="../images/808ce1fc8dff032b635aea17fb9811ba.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="808ce1fc8dff032b635aea17fb9811ba.png" auto_="auto;" display="block;" margin:="margin:" src="../images/808ce1fc8dff032b635aea17fb9811ba.png" /></a></p>
<h4 id="_29">Добавляем  эффект нанесения урона здоровью</h4>
<p>В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Blueprint Class</code>, в появившемся окне, на вкладке <code>All Classes</code> ищем <code>Gameplay Effect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/249f28bb2be5d32d277fbd0265f963fd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="249f28bb2be5d32d277fbd0265f963fd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/249f28bb2be5d32d277fbd0265f963fd.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Создаем новый <code>blueprint</code> и называем его <code>GE_ZoneEffect</code>.</p>
<p><a class="glightbox" href="../images/6fff4b92be49d23573b5173b87afd5e6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6fff4b92be49d23573b5173b87afd5e6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6fff4b92be49d23573b5173b87afd5e6.png" /></a></p>
<p>Значение урона, которое будет накладываться в эффектом, можно передавать через параметр <code>Caller Magnitude</code>. Вот как это делается:</p>
<p><a class="glightbox" href="../images/112c0054c4489ff7da91b940a3122353.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="112c0054c4489ff7da91b940a3122353.png" auto_="auto;" display="block;" margin:="margin:" src="../images/112c0054c4489ff7da91b940a3122353.png" /></a></p>
<p>Параметр <code>Caller Magnitude</code> создается с использованием <code>blueprint</code> ноды <code>Assign Tag Set by Caller Magnitude</code>. Для маркировки значения урона я использовал тег <code>Damage.Value</code>.
Открываем созданный нами эффект <code>GE_DamageZoneHealth</code>.
Добавляем один модификатор и устанавливаем ему параметр <code>Modifier Magnitude -&gt; Set By Caller</code>. В выпадающем списке <code>Set by Caller Magnitude</code> выбираем наш тег - <code>Damage.Value</code>.</p>
<p><a class="glightbox" href="../images/7bbc6f08e5352224acddfd6809962c57.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7bbc6f08e5352224acddfd6809962c57.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7bbc6f08e5352224acddfd6809962c57.png" /></a></p>
<p>Таким способом разработчик может передавать цифровые значения внутрь <code>Gameplay Effect</code>.
Установим выбранный эффект, в качестве параметра <code>Gameplay Effect Class</code> нашей зоны с уроном.</p>
<p><a class="glightbox" href="../images/8b5fa17b9c83eb26d95a7acc05a8cfba.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8b5fa17b9c83eb26d95a7acc05a8cfba.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8b5fa17b9c83eb26d95a7acc05a8cfba.png" /></a></p>
<p>Запустим проект и войдем в зону персонажем. Здоровье начнет убывать и остановится у нуля.</p>
<p><a class="glightbox" href="../images/18c7e262651c78f9d3f6ddc8a592e86f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="18c7e262651c78f9d3f6ddc8a592e86f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/18c7e262651c78f9d3f6ddc8a592e86f.png" /></a></p>
<p>Благодаря передаче значения прямо в эффект через <code>Caller Magnitude</code>, мы можем создать вторую зону такого-же типа, но с другим значением <code>Effect Value</code>. Для нанесения урона здоровью мы ставили значение <code>-10</code>. Если мы поставим положительное значение <code>5</code> в параметр <code>Effect Value</code>, то такая зона будет выступать как зона лечения.</p>
<p><a class="glightbox" href="../images/4f61e3e87bf1b7266714d88e5aa94042.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4f61e3e87bf1b7266714d88e5aa94042.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4f61e3e87bf1b7266714d88e5aa94042.png" /></a></p>
<p>Проверим.</p>
<p>Урон:</p>
<p><a class="glightbox" href="../images/4538cb4215963e2df1a4679e6093edb2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4538cb4215963e2df1a4679e6093edb2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4538cb4215963e2df1a4679e6093edb2.png" /></a></p>
<p>Лечение:</p>
<p><a class="glightbox" href="../images/dcfba876b76bf3fd2bdcc9b11fec7edb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dcfba876b76bf3fd2bdcc9b11fec7edb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dcfba876b76bf3fd2bdcc9b11fec7edb.png" /></a></p>
<h3 id="_30">Пишем логику смерти персонажа</h3>
<p>При падении здоровья до <code>0</code> персонаж должен прекращать всякую активность и падать в <code>ragdoll</code>.</p>
<h4 id="physics-asset">Исправляем <code>Physics Asset</code></h4>
<p>Для начала нам нужно исправить стандартный <code>Phycisc Asset</code>, чтобы <code>Ragdoll</code> в нем работал корректно.</p>
<p>В шаблоне <code>ThirdPerson</code>, который мы используем для этого проекта, есть <code>Physics Asset</code> маникена. Называется он <code>PA_Mannequin</code>.</p>
<p><a class="glightbox" href="../images/d5a9484ebe421c311cb2f3c046eb21cd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d5a9484ebe421c311cb2f3c046eb21cd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d5a9484ebe421c311cb2f3c046eb21cd.png" /></a></p>
<p><a class="glightbox" href="../images/d629885cf21fb2d79054b794f4d72bea.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d629885cf21fb2d79054b794f4d72bea.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d629885cf21fb2d79054b794f4d72bea.png" /></a></p>
<p>В этом ассете, к кости <code>root</code> необходимо добавить физическое тело с <code>Kinematic</code> режимом симуляции. Я уже писал на форуме <code>Epic Games</code> длинный пост <a href="https://forums.unrealengine.com/t/attempting-to-move-fully-simulated-skeletal-mesh-error/402585/15?u=alexanderst">как такое делается</a>. Напишу еще раз.</p>
<p>В редакторе <code>Physics Asset</code> нажимаем на неприметную кнопку с иконкой колесика, смотрите на картинку. После нажатия перед вами появится меню, в котором надо будет выбрать пункт - <code>Show All Bones</code>.</p>
<p><a class="glightbox" href="../images/09f8f98576c478094bed7feca430c136.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="09f8f98576c478094bed7feca430c136.png" auto_="auto;" display="block;" margin:="margin:" src="../images/09f8f98576c478094bed7feca430c136.png" /></a></p>
<p>Теперь выделяем кость <code>Root</code> и щелкаем по ней правой кнопкой мыши.</p>
<p><a class="glightbox" href="../images/a096036008f15e9dbfbda166ee3ef04c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a096036008f15e9dbfbda166ee3ef04c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a096036008f15e9dbfbda166ee3ef04c.png" /></a></p>
<p>В появившемся меню переходим по пунктам <code>Add Shape -&gt; Add Sphere</code>.
В результате редактор сгенерирует нам новое физическое тело у ног персонажа - сферу.</p>
<p><a class="glightbox" href="../images/3d1b12e5abf0195dee393a1f2671bb28.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3d1b12e5abf0195dee393a1f2671bb28.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3d1b12e5abf0195dee393a1f2671bb28.png" /></a></p>
<p>Щелкните по ней мышью. Поскольку я не хочу, чтобы данная сфера симулировала физику и хоть как-то влияла на <code>ragdoll</code> - необходимо установить в параметрах сферы <code>Physics Type</code> - <code>Kinematic</code>.</p>
<p><a class="glightbox" href="../images/3e3b5cbb25267ddc77f5c870a5682b27.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3e3b5cbb25267ddc77f5c870a5682b27.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3e3b5cbb25267ddc77f5c870a5682b27.png" /></a></p>
<p>Наличие этого тела  позволит сохранять трансформ персонажа при входе в рагдолл. Свяжем <code>root</code> тело с остальным физическим скелетом.</p>
<p>Для этого снизу, в редакторе, есть окно - <code>Graph</code>, а точнее <code>Joint Graph</code>. В этом графе можно отслеживать связи нашего физического тела с другими телами. Поскольку <code>root</code> тело только что создано - связей у него нет.</p>
<p><a class="glightbox" href="../images/5ecad98ef88df3fb6d19ee94b241717b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5ecad98ef88df3fb6d19ee94b241717b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5ecad98ef88df3fb6d19ee94b241717b.png" /></a></p>
<p>Щелкаем по узлу <code>Body root</code> правой кнопкой мыши и переходим в меню <code>Constraints</code>. Выберите тут кость <code>pelvis</code>.</p>
<p><a class="glightbox" href="../images/40be91881519c50ae5a2eed4bac1db60.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="40be91881519c50ae5a2eed4bac1db60.png" auto_="auto;" display="block;" margin:="margin:" src="../images/40be91881519c50ae5a2eed4bac1db60.png" /></a></p>
<p>Теперь физическое тело <code>root</code> связано с физическим телом <code>pelvis</code>.</p>
<p><a class="glightbox" href="../images/35e44059a36b27744dc54982728f0135.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="35e44059a36b27744dc54982728f0135.png" auto_="auto;" display="block;" margin:="margin:" src="../images/35e44059a36b27744dc54982728f0135.png" /></a></p>
<p>Нажмите на соединяющую оба тела прослойку - <code>Constraint pelvis:root</code>.
Тут необходимо установить допустимые лимиты отступа тел друг от друга.</p>
<p><a class="glightbox" href="../images/9ccb201358e6006a77a8a1a27fd9ab46.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9ccb201358e6006a77a8a1a27fd9ab46.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9ccb201358e6006a77a8a1a27fd9ab46.png" /></a></p>
<p>Выставляете в параметрах <code>Linear Limits</code> и  <code>Angular Limits</code> все в <code>Free</code>. Не надо экспериментировать с <code>Limited</code>, вы только сломаете <code>Ragdoll</code>. Тут обязательно должно быть <code>Free</code>.
Давайте повысим производительность нашего рига в движке. Переключите параметр отображения костей с <code>Show All Bones</code> на <code>Hide Bones</code>.</p>
<p><a class="glightbox" href="../images/7991a55e4b1d408a8b14b9a575208095.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7991a55e4b1d408a8b14b9a575208095.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7991a55e4b1d408a8b14b9a575208095.png" /></a></p>
<p>Выделите в редакторе все физические тела рига, кроме <code>hand_l, hand_r, head, foot_l, foot_r</code></p>
<p><a class="glightbox" href="../images/c75153f175881c48624c6ea6400b97fc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c75153f175881c48624c6ea6400b97fc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c75153f175881c48624c6ea6400b97fc.png" /></a></p>
<p>Снимите у выделенных тел параметр <code>Consider for Bounds</code>. Установите данным физическим телам параметр <code>Skip Scale from Animation</code>.
Это повысит производительность <code>Radoll</code>, без каких-либо видимых потерь качества.</p>
<h4 id="-ge_death">Добавляем эффект, обнуляющий статы персонажа - <code>GE_Death</code></h4>
<p>Поскольку при смерти персонажа все его характеристики должны обнуляться, включая выносливость и здоровье - создадим эффект, который все это сделает.</p>
<p>В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Blueprint Class</code>, в появившемся окне, на вкладке <code>All Classes</code> ищем <code>Gameplay Effect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/249f28bb2be5d32d277fbd0265f963fd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="249f28bb2be5d32d277fbd0265f963fd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/249f28bb2be5d32d277fbd0265f963fd.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Создаем новый <code>blueprint</code> и называем его <code>GE_Death</code>.</p>
<p><a class="glightbox" href="../images/96bff4309cf4fa7c3d924b86ac41b206.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="96bff4309cf4fa7c3d924b86ac41b206.png" auto_="auto;" display="block;" margin:="margin:" src="../images/96bff4309cf4fa7c3d924b86ac41b206.png" /></a></p>
<p>Создаем два модификатора <code>Modifier</code> для обнуления здоровья и выносливости. Значение, которое будут применять эти модификаторы должно быть основано на соответствующем аттрибуте. Выбираем параметр <code>Magnitude Calculation Type</code> - <code>Attribute Based</code>. Выставляем параметр <code>Coefficient</code> в <code>-1</code>. Таким образом значения аттрибутов здоровье и выносливость, при наложении эффекта, будут вычитаться сами из себя.</p>
<p><a class="glightbox" href="../images/36dc177d9d91a6b5de792b927ddcc2e3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="36dc177d9d91a6b5de792b927ddcc2e3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/36dc177d9d91a6b5de792b927ddcc2e3.png" /></a></p>
<h4 id="_31">Удаляем эффекты и способности при смерти персонажа</h4>
<p>Чтобы активные эффекты и способности удалялись при смерти персонажа, надо создать особый тег, я предлагаю назвать его <code>Effect.RemoveOnDeath</code>. Этот тег необходимо присвоить каждому эффекту и каждой способности, которые должны удаляться при смерти персонажа.</p>
<p>Начнем с эффекта восстановления здоровья, который мы написали ранее - <code>GE_HealthRegen</code>.</p>
<p><a class="glightbox" href="../images/36300d25aa72fb02b0dda2c8a141b912.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="36300d25aa72fb02b0dda2c8a141b912.png" auto_="auto;" display="block;" margin:="margin:" src="../images/36300d25aa72fb02b0dda2c8a141b912.png" /></a></p>
<p>Откроем ассет и добавим в список <code>GrantedTags</code> тег <code>Effect.RemoveOnDeath</code>.</p>
<p><a class="glightbox" href="../images/a9b6f4d8c3f99c8d164c27eea47b2767.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a9b6f4d8c3f99c8d164c27eea47b2767.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a9b6f4d8c3f99c8d164c27eea47b2767.png" /></a></p>
<p>Аналогичные действия надо провести с эффектом брони <code>GE_ArmorStacks</code>.</p>
<p><a class="glightbox" href="../images/8e17e6a6f1f539191775049ca6346164.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8e17e6a6f1f539191775049ca6346164.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8e17e6a6f1f539191775049ca6346164.png" /></a></p>
<p>Теперь откройте эффект смерти персонажа - <code>GE_Death</code>.</p>
<p><a class="glightbox" href="../images/a44c58c5d140d5069adfc6950e6c94ca.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a44c58c5d140d5069adfc6950e6c94ca.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a44c58c5d140d5069adfc6950e6c94ca.png" /></a></p>
<p>При наложении этого эффекта, все эффекты, помеченные тегом <code>Effect.RemoveOnDeath</code> должны удаляться. Чтобы этого добиться, переходим вниз, к параметру <code>Remove Gameplay Effects With Tags</code>, выставляем <code>Effect.RemoveOnDeath</code>. Все эффекты, с этим тегом, будут удалены при наложении <code>GE_Death</code>.
Так-же задаем <code>GrantedBlockedAbilityTags</code> и <code>GrantedTags</code> в <code>Buff.Death</code>. Это позволит блокировать работу способностей.</p>
<p><a class="glightbox" href="../images/3200428ff3e9bcd8be179abd10b31703.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3200428ff3e9bcd8be179abd10b31703.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3200428ff3e9bcd8be179abd10b31703.png" /></a></p>
<p>Поскольку эффект <code>GE_Death</code> имеет продолжительность - <code>Infinite</code> мы можем блокировать способности, используя <code>Buff.Death</code>.
Способностям, работу которых необходимо блокировать выставляем <code>Activation Blocked Tags</code> - <code>Buff.Death</code>. Например в способности <code>GA_Sprint</code> выставите следующее:</p>
<p><a class="glightbox" href="../images/a7b79aa9a9216de20898831add81802d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a7b79aa9a9216de20898831add81802d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a7b79aa9a9216de20898831add81802d.png" /></a></p>
<h4 id="ragdoll">Добавляем функционал включения / выключения <code>Ragdoll</code></h4>
<p>В класс персонажа надо добавить функцию, которая позволит включать рагдолл.</p>
<p>Окрываем <code>blueprint</code> персонажа, у нас это <code>BP_CoreCharacter</code>.</p>
<p><a class="glightbox" href="../images/e69d2b496dfdc606c4b77417658ab063.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e69d2b496dfdc606c4b77417658ab063.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e69d2b496dfdc606c4b77417658ab063.png" /></a></p>
<p>Добавляем следующий метод:</p>
<p><a class="glightbox" href="../images/524707b5fb241e2196286456233782f3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="524707b5fb241e2196286456233782f3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/524707b5fb241e2196286456233782f3.png" /></a></p>
<p>При его активации персонаж будет падать в рагдолл.</p>
<p>Протестируем.</p>
<p>Добавьте в персонажа событие нажатия клавиши <code>3</code> следующим образом:</p>
<p><a class="glightbox" href="../images/f7db64fa10c0d978f5f6e05af41a2dd4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f7db64fa10c0d978f5f6e05af41a2dd4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f7db64fa10c0d978f5f6e05af41a2dd4.png" /></a></p>
<p>Рагдолл работает:</p>
<p><a class="glightbox" href="../images/7e5a6370a86407e8697bded43e3377b4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7e5a6370a86407e8697bded43e3377b4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7e5a6370a86407e8697bded43e3377b4.png" /></a></p>
<p>Напишем функцию выхода из рагдолла.</p>
<p>Для начала, по событию <code>BeginPlay</code>, нам надо сохранять базовый трансформ меша, а так-же режим работы коллизий на меше и капсуле.</p>
<p><a class="glightbox" href="../images/21055fe07c6e3a5642fba903a5a0a007.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="21055fe07c6e3a5642fba903a5a0a007.png" auto_="auto;" display="block;" margin:="margin:" src="../images/21055fe07c6e3a5642fba903a5a0a007.png" /></a></p>
<p><a class="glightbox" href="../images/acc41ef1248e0c74460717c69c1a4b07.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="acc41ef1248e0c74460717c69c1a4b07.png" auto_="auto;" display="block;" margin:="margin:" src="../images/acc41ef1248e0c74460717c69c1a4b07.png" /></a></p>
<p>Далее пишем следующую функцию:</p>
<p><a class="glightbox" href="../images/b358d17cbaee72515520201934b3ead0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b358d17cbaee72515520201934b3ead0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b358d17cbaee72515520201934b3ead0.png" /></a></p>
<p>Переменные:</p>
<p><a class="glightbox" href="../images/1f3f53f88678bbe8a410c16dc64c0059.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1f3f53f88678bbe8a410c16dc64c0059.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1f3f53f88678bbe8a410c16dc64c0059.png" /></a></p>
<p>Для тестирования, на событие обработки клавиши <code>3</code> добавляем следующий код:</p>
<p><a class="glightbox" href="../images/a58c686176887e5c3f1ca19ae735e452.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a58c686176887e5c3f1ca19ae735e452.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a58c686176887e5c3f1ca19ae735e452.png" /></a></p>
<p>Теперь мы можем свободно выходить и входить в <code>Ragdoll</code>, по желанию.</p>
<p><a class="glightbox" href="../images/dc081ff621755e34bdf96f84b2c3928a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dc081ff621755e34bdf96f84b2c3928a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dc081ff621755e34bdf96f84b2c3928a.png" /></a></p>
<p><a class="glightbox" href="../images/aeab2e53acb43e0af1747daabe938a08.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="aeab2e53acb43e0af1747daabe938a08.png" auto_="auto;" display="block;" margin:="margin:" src="../images/aeab2e53acb43e0af1747daabe938a08.png" /></a></p>
<h4 id="ga_death">Добавляем способность <code>GA_Death</code></h4>
<p>Создаем пассивную способность для отслеживания состояния здоровья. Именно тут мы будем активировать <code>Ragdoll</code>, если здоровье равно <code>0</code>.
Для этого в <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; Blueprint Class</code>. В появившемся окне, на вкладке <code>All Classes</code> ищем класс - <code>CoreGameplayAbility</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/e3f80d1163ab005edef045ec35b0b34a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e3f80d1163ab005edef045ec35b0b34a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e3f80d1163ab005edef045ec35b0b34a.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Создаем новый <code>blueprint</code> на его основе. Называем новый класс <code>GA_Death</code>.</p>
<p><a class="glightbox" href="../images/cdbdfddf8d041863345685c2a3a1b95b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cdbdfddf8d041863345685c2a3a1b95b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cdbdfddf8d041863345685c2a3a1b95b.png" /></a></p>
<p>Устанавливаем для способности параметр <code>Run on Assign</code> в <code>True</code>.
В событии <code>Event ActivateAbility</code> добавляем ноду отслеживающую характеристику <code>Health</code> - <code>Wait for Attribute Change Treshold -&gt; Exactly Equal To -&gt; 0</code>.</p>
<p><a class="glightbox" href="../images/28e1cb5dead1a3fbbbc761b2cc3ac75d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="28e1cb5dead1a3fbbbc761b2cc3ac75d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/28e1cb5dead1a3fbbbc761b2cc3ac75d.png" /></a></p>
<p>Когда параметр <code>Health</code> достигает значения <code>0</code>, эта нода активируется и вызывается метод <code>Apply Ragdoll</code> на аватаре эффекта. Помимо рагдолла, к персонажу применяется и эффект <code>GE_Death</code>, который обнуляет ему  выносливость и здоровье уже окончательно.</p>
<p>Добавляем созданную способность в списко применяемых "по умолчанию". Для этого открываем <code>Data Asset</code> - <code>DA_PlayerAbilities</code> и добавляем способность <code>GA_Death</code> в список.</p>
<p><a class="glightbox" href="../images/cdf5a5c7fa7b94d83c42cd70acc46d8d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cdf5a5c7fa7b94d83c42cd70acc46d8d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cdf5a5c7fa7b94d83c42cd70acc46d8d.png" /></a></p>
<p>Если теперь войти персонажем в зону, наносящую урон - персонаж упадет в <code>ragdoll</code>.</p>
<p><a class="glightbox" href="../images/c7ff13c3bf22ecfb7de5f9c6d3a5de92.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c7ff13c3bf22ecfb7de5f9c6d3a5de92.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c7ff13c3bf22ecfb7de5f9c6d3a5de92.png" /></a></p>
<p>Что нам и требовалось.</p>
<p>Однако, у нашей реализации есть одна явная проблема.</p>
<h3 id="mod-magnitude-calculation">Вычисляем модификатор эффекта по собственной формуле, <code>Mod Magnitude Calculation</code></h3>
<p>Значение модификатора, накладываемого эффектом на характеристику, может быть вычислено по требуемой формуле, с использованием собственной формулы.</p>
<p>У нашего персонажа есть показатель брони, мы можем вычитать значение брони персонажа из урона, который по нему наносится.</p>
<h4 id="_32">Введение</h4>
<p>Класс вычисления значения модификатора может быть установлен через поле <code>Magnitude Calculation Type</code> - <code>Custom Calculation Class</code>.</p>
<p><a class="glightbox" href="../images/966e7b55db14d8196f126bfa42cab667.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="966e7b55db14d8196f126bfa42cab667.png" auto_="auto;" display="block;" margin:="margin:" src="../images/966e7b55db14d8196f126bfa42cab667.png" /></a></p>
<p>В появившемся списке параметров будет поле <code>Calculation Class</code>. Объект, который можно установить в это поле, должен быть унаследован от класса <code>UGameplayModMagnitudeCalculation</code>.
Как и в случае с другими классами такого типа, у него есть определенный паттерн реализации, который можно понять, если посмотреть на исходные файлы движка.</p>
<p>Сам класс <code>UGameplayModMagnitudeCalculation</code> можно найти в файле <code>\Engine\Plugins\Runtime\GameplayAbilities\Source\GameplayAbilities\Public\GameplayModMagnitudeCalculation.h</code>.</p>
<p><a class="glightbox" href="../images/e35486f1a1384b21d632593d1798f63a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e35486f1a1384b21d632593d1798f63a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e35486f1a1384b21d632593d1798f63a.png" /></a></p>
<p>Самый главный метод тут - <code>CalculateBaseMagnitude</code>. Он должен возвращать <code>float</code> значение, которое будет применено к эффекту.</p>
<p>Поскольку метод <code>CalculateBaseMagnitude</code> создан с модификатром <code>BlueprintNativeEvent</code>, чтобы его переопределить надо использовать постфикс <code>_Implementation</code>.
Класс <code>UGameplayModMagnitudeCalculation</code>  можно использовать из <code>blueprint</code>. Однако его возможности в <code>blueprint</code> сильно ограничены и ничего серьезного посчитать вы не сможете.</p>
<p><a class="glightbox" href="../images/8a95c11a32ccf57a15ee2378e173c525.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8a95c11a32ccf57a15ee2378e173c525.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8a95c11a32ccf57a15ee2378e173c525.png" /></a></p>
<p>Тем не менее, подобная возможность открывает для разработчика способ вынести часть <code>c++</code> логики в <code>blueprint</code>, для более легкого редактирования. Однако основа класса должна быть написана на <code>c++</code>.</p>
<h4 id="_33">Создаем заголовочный файл для класса</h4>
<p>Открываем расположение проекта по пути <code>Source / GASBase / Public / Attributes</code> и создаем там подпапку <code>Modifiers</code>.</p>
<p><a class="glightbox" href="../images/cd72c3eaeb6c978d00d03b2be8915396.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cd72c3eaeb6c978d00d03b2be8915396.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cd72c3eaeb6c978d00d03b2be8915396.png" /></a></p>
<p>В папку <code>Modifiers</code> добавляем пустой текстовый файл <code>DamageModMagnitudeCalculation.h</code>.</p>
<p><a class="glightbox" href="../images/d3b1dbbff6124d3bd954a0545e42792f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d3b1dbbff6124d3bd954a0545e42792f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d3b1dbbff6124d3bd954a0545e42792f.png" /></a></p>
<p>Чтобы файл отобразился в <code>Visual Studio</code> - выполните из <code>Unreal Engine</code> команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/5d61a278d3196aa5dd379c3c7b95fb25.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5d61a278d3196aa5dd379c3c7b95fb25.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5d61a278d3196aa5dd379c3c7b95fb25.png" /></a></p>
<p>Открываем файл для редактирования и пишем код.</p>
<h4 id="_34">Базовый шаблон класса</h4>
<p>Все классы, вычисляющие значение <code>Magnitude Modifier</code> должны следовать следующему паттерну:
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayModMagnitudeCalculation.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayEffectExecutionCalculation.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="c1">// project files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Attributes/CharacterAttributeSet.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DamageModMagnitudeCalculation.generated.h&quot;</span>
<span class="c1">// singleton struct to get captured fields data</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FDamageMagnitudeCapturedStatics</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">DECLARE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">Health</span><span class="p">);</span>
<span class="w">    </span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">DEFINE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// singleton</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="w"> </span><span class="n">INSTANCE</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">INSTANCE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Damage to Health Magnitude Calculation</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UDamageModMagnitudeCalculation</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UGameplayModMagnitudeCalculation</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UDamageModMagnitudeCalculation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RelevantAttributesToCapture</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">HealthDef</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// calculate magnitude here</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">CalculateBaseMagnitude_Implementation</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectSpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Spec</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div></p>
<h4 id="damagemodmagnitudecalculationh"><code>DamageModMagnitudeCalculation.h</code></h4>
<p><div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayModMagnitudeCalculation.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayEffectExecutionCalculation.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="c1">// project files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Attributes/CharacterAttributeSet.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DamageModMagnitudeCalculation.generated.h&quot;</span>
<span class="c1">// singleton struct to get captured fields data</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FDamageMagnitudeCapturedStatics</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">DECLARE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">Health</span><span class="p">);</span>
<span class="w">    </span><span class="n">DECLARE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">Armor</span><span class="p">);</span>
<span class="w">    </span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">DEFINE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">DEFINE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Armor</span><span class="p">,</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// singleton</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="w"> </span><span class="n">INSTANCE</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">INSTANCE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Damage to Health Magnitude Calculation</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UDamageModMagnitudeCalculation</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UGameplayModMagnitudeCalculation</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UDamageModMagnitudeCalculation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RelevantAttributesToCapture</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">HealthDef</span><span class="p">);</span>
<span class="w">        </span><span class="n">RelevantAttributesToCapture</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">ArmorDef</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// calculate magnitude here</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">CalculateBaseMagnitude_Implementation</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectSpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Spec</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span><span class="w"> </span><span class="c1">// result</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="o">*</span><span class="w"> </span><span class="n">SourceTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Spec</span><span class="p">.</span><span class="n">CapturedSourceTags</span><span class="p">.</span><span class="n">GetAggregatedTags</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="o">*</span><span class="w"> </span><span class="n">TargetTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Spec</span><span class="p">.</span><span class="n">CapturedTargetTags</span><span class="p">.</span><span class="n">GetAggregatedTags</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// Get DamageValue from SetByCallerMagnitude tag</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">DamageValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Spec</span><span class="p">.</span><span class="n">GetSetByCallerMagnitude</span><span class="p">(</span><span class="n">FGameplayTag</span><span class="o">::</span><span class="n">RequestGameplayTag</span><span class="p">(</span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;Damage.Value&quot;</span><span class="p">)),</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Getting Values from captured args:</span>
<span class="w">        </span><span class="c1">// set evalupation parameters</span>
<span class="w">        </span><span class="n">FAggregatorEvaluateParameters</span><span class="w"> </span><span class="n">EvaluationParameters</span><span class="p">;</span>
<span class="w">        </span><span class="n">EvaluationParameters</span><span class="p">.</span><span class="n">SourceTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceTags</span><span class="p">;</span>
<span class="w">        </span><span class="n">EvaluationParameters</span><span class="p">.</span><span class="n">TargetTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TargetTags</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Captured Armor</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">        </span><span class="n">GetCapturedAttributeMagnitude</span><span class="p">(</span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">ArmorDef</span><span class="p">,</span><span class="w"> </span><span class="n">Spec</span><span class="p">,</span><span class="w"> </span><span class="n">EvaluationParameters</span><span class="p">,</span><span class="w"> </span><span class="n">Armor</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Capured Health</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">        </span><span class="n">GetCapturedAttributeMagnitude</span><span class="p">(</span><span class="n">FDamageMagnitudeCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">HealthDef</span><span class="p">,</span><span class="w"> </span><span class="n">Spec</span><span class="p">,</span><span class="w"> </span><span class="n">EvaluationParameters</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Health</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Clamp</span><span class="p">(</span><span class="n">DamageValue</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Armor</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;float val = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Result</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
Обратите внимание, что значение урона <code>DamageValue</code> внутри эффекта получается с использованием <code>GetSetByCallerMagnitude</code>. То есть передается в эффект динамически.</p>
<h4 id="_35">Проверка</h4>
<p>Для проверки написанного нами класса используем зоны урона. Копируем эффект зоны урона - <code>GE_ZoneEffect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/b57fe24b7c2cc6494bef3b3dbbdb39e1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b57fe24b7c2cc6494bef3b3dbbdb39e1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b57fe24b7c2cc6494bef3b3dbbdb39e1.png" /></a></p>
<p>Называем копию - <code>GE_ZoneModifier</code>.</p>
<p><a class="glightbox" href="../images/b904b1315762da8ca1ee70d592d91af5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b904b1315762da8ca1ee70d592d91af5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b904b1315762da8ca1ee70d592d91af5.png" /></a></p>
<p>Открываем, устанавливаем <code>Magnitude Calculation Type</code> - <code>Custom Calculation Class</code> и <code>Calculation Class</code> - <code>DamageModMagnitudeCalculation</code>.
Поскольку предполагается, что цифра урона будет положительной - выставляем <code>Coefficient</code> в <code>-1</code>.</p>
<p><a class="glightbox" href="../images/9548b597620266194f529512c788f667.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9548b597620266194f529512c788f667.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9548b597620266194f529512c788f667.png" /></a></p>
<p>Устанавливаем наш эффект в зону для урона. Цифра урона должна быть положительной.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/91fd10ff8fecba5badd108c3aa54cf7e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="91fd10ff8fecba5badd108c3aa54cf7e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/91fd10ff8fecba5badd108c3aa54cf7e.png" /></a></p>
<p>Если войти в такую зону, урон, который она наносит, будет снижен, в зависимости от количества стаков брони персонажа.</p>
<p><a class="glightbox" href="../images/3b43b2fd84a13290d0124b6d3e5cc467.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3b43b2fd84a13290d0124b6d3e5cc467.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3b43b2fd84a13290d0124b6d3e5cc467.png" /></a></p>
<p>Однако, применение подобной логики при нанесении урона не позволяет разработчику уменьшать количество стаков брони на персонаже. А это важно для нашей работы.</p>
<h3 id="effect-execution-calculation"><code>Effect Execution Calculation</code>, обработчик эффекта</h3>
<p>После списка модификаторов, в эффекте есть параметр <code>Executions</code>. Тут можно указать собственный класс-обработчик эффекта.</p>
<p><a class="glightbox" href="../images/a38853985503a36de2e3c96760262574.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a38853985503a36de2e3c96760262574.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a38853985503a36de2e3c96760262574.png" /></a></p>
<p>Данный класс должен быть унаследован от <code>UGameplayEffectExecutionCalculation</code> и установлен в поле <code>Calculation Class</code>.
Используя обработчик, можно вызывать сложную логику, при срабатывании эффекта, можно влиять на другие эффекты или управлять тегами. Мы будем уменьшать стаки брони, используя обработчик.</p>
<h4 id="_36">Создаем заголовочный файл для класса</h4>
<p>Создадим заголовочный файл для обработчика эффекта.</p>
<p>Открываем расположение проекта по пути <code>Source / GASBase / Public / Attributes</code> и создаем там подпапку <code>Executions</code>.</p>
<p><a class="glightbox" href="../images/299b79c1b8cc20d9031bb9af5a789a7f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="299b79c1b8cc20d9031bb9af5a789a7f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/299b79c1b8cc20d9031bb9af5a789a7f.png" /></a></p>
<p>В папку <code>Executions</code> добавляем пустой текстовый файл <code>DamageExecCalculation.h</code>.</p>
<p><a class="glightbox" href="../images/97c11564378ae7a9fcedd2742b2ae502.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="97c11564378ae7a9fcedd2742b2ae502.png" auto_="auto;" display="block;" margin:="margin:" src="../images/97c11564378ae7a9fcedd2742b2ae502.png" /></a></p>
<p>Чтобы файл отобразился в <code>Visual Studio</code> - выполните из <code>Unreal Engine</code> команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/92497d43b05cf262af148f1edef66b69.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="92497d43b05cf262af148f1edef66b69.png" auto_="auto;" display="block;" margin:="margin:" src="../images/92497d43b05cf262af148f1edef66b69.png" /></a></p>
<h4 id="_37">Базовый шаблон класса</h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayModMagnitudeCalculation.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayEffectExecutionCalculation.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemBlueprintLibrary.h&quot;</span>
<span class="c1">// project files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Attributes/CharacterAttributeSet.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DamageExecCalculation.generated.h&quot;</span>
<span class="c1">// singleton struct to get captured fields data</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FDamageExecutionCapturedStatics</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">DECLARE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">Health</span><span class="p">);</span>
<span class="w">    </span><span class="n">DECLARE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">Armor</span><span class="p">);</span>
<span class="w">    </span><span class="n">FDamageExecutionCapturedStatics</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">DEFINE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// singleton</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FDamageExecutionCapturedStatics</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FDamageExecutionCapturedStatics</span><span class="w"> </span><span class="n">INSTANCE</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">INSTANCE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Damage to Health Magnitude Calculation</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UDamageExecCalculation</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UGameplayEffectExecutionCalculation</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UDamageExecCalculation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RelevantAttributesToCapture</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FDamageExecutionCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">HealthDef</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Execute_Implementation</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectCustomExecutionParameters</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ExecutionParams</span><span class="p">,</span><span class="w"> </span><span class="n">OUT</span><span class="w"> </span><span class="n">FGameplayEffectCustomExecutionOutput</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutExecutionOutput</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* your code here */</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="damagemodmagnitudecalculationh_1"><code>DamageModMagnitudeCalculation.h</code></h4>
<p><div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayModMagnitudeCalculation.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayEffectExecutionCalculation.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemComponent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilitySystemBlueprintLibrary.h&quot;</span>
<span class="c1">// project files</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Attributes/CharacterAttributeSet.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DamageExecCalculation.generated.h&quot;</span>
<span class="c1">// singleton struct to get captured fields data</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FDamageExecutionCapturedStatics</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">DECLARE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">Health</span><span class="p">);</span>
<span class="w">    </span><span class="n">DECLARE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">Armor</span><span class="p">);</span>
<span class="w">    </span><span class="n">FDamageExecutionCapturedStatics</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">DEFINE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">DEFINE_ATTRIBUTE_CAPTUREDEF</span><span class="p">(</span><span class="n">UCharacterAttributeSet</span><span class="p">,</span><span class="w"> </span><span class="n">Armor</span><span class="p">,</span><span class="w"> </span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// singleton</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FDamageExecutionCapturedStatics</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FDamageExecutionCapturedStatics</span><span class="w"> </span><span class="n">INSTANCE</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">INSTANCE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Damage to Health Magnitude Calculation</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UDamageExecCalculation</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UGameplayEffectExecutionCalculation</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UDamageExecCalculation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RelevantAttributesToCapture</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FDamageExecutionCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">HealthDef</span><span class="p">);</span>
<span class="w">        </span><span class="n">RelevantAttributesToCapture</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FDamageExecutionCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">ArmorDef</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Execute_Implementation</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectCustomExecutionParameters</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ExecutionParams</span><span class="p">,</span><span class="w"> </span><span class="n">OUT</span><span class="w"> </span><span class="n">FGameplayEffectCustomExecutionOutput</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutExecutionOutput</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">TargetAbilitySystemComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExecutionParams</span><span class="p">.</span><span class="n">GetTargetAbilitySystemComponent</span><span class="p">();</span>
<span class="w">        </span><span class="n">UAbilitySystemComponent</span><span class="o">*</span><span class="w"> </span><span class="n">SourceAbilitySystemComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExecutionParams</span><span class="p">.</span><span class="n">GetSourceAbilitySystemComponent</span><span class="p">();</span>
<span class="w">        </span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">SourceActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceAbilitySystemComponent</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">SourceAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GetAvatarActor</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">TargetActor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TargetAbilitySystemComponent</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">TargetAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GetAvatarActor</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayEffectSpec</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ExecutionParams</span><span class="p">.</span><span class="n">GetOwningSpec</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// Gather the tags from the source and target as that can affect which buffs should be used</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="o">*</span><span class="w"> </span><span class="n">SourceTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Spec</span><span class="p">.</span><span class="n">CapturedSourceTags</span><span class="p">.</span><span class="n">GetAggregatedTags</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="o">*</span><span class="w"> </span><span class="n">TargetTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Spec</span><span class="p">.</span><span class="n">CapturedTargetTags</span><span class="p">.</span><span class="n">GetAggregatedTags</span><span class="p">();</span>
<span class="w">        </span><span class="n">FAggregatorEvaluateParameters</span><span class="w"> </span><span class="n">EvaluationParameters</span><span class="p">;</span>
<span class="w">        </span><span class="n">EvaluationParameters</span><span class="p">.</span><span class="n">SourceTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceTags</span><span class="p">;</span>
<span class="w">        </span><span class="n">EvaluationParameters</span><span class="p">.</span><span class="n">TargetTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TargetTags</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Captured Armor</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">        </span><span class="n">ExecutionParams</span><span class="p">.</span><span class="n">AttemptCalculateCapturedAttributeMagnitude</span><span class="p">(</span><span class="n">FDamageExecutionCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">ArmorDef</span><span class="p">,</span><span class="w"> </span><span class="n">EvaluationParameters</span><span class="p">,</span><span class="w"> </span><span class="n">Armor</span><span class="p">);</span>
<span class="w">        </span><span class="n">Armor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Armor</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Capured Health</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">        </span><span class="n">ExecutionParams</span><span class="p">.</span><span class="n">AttemptCalculateCapturedAttributeMagnitude</span><span class="p">(</span><span class="n">FDamageExecutionCapturedStatics</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">HealthDef</span><span class="p">,</span><span class="w"> </span><span class="n">EvaluationParameters</span><span class="p">,</span><span class="w"> </span><span class="n">Health</span><span class="p">);</span>
<span class="w">        </span><span class="n">Health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Health</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Get DamageValue from SetByCallerMagnitude tag</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">DamageValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Spec</span><span class="p">.</span><span class="n">GetSetByCallerMagnitude</span><span class="p">(</span><span class="n">FGameplayTag</span><span class="o">::</span><span class="n">RequestGameplayTag</span><span class="p">(</span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;Damage.Value&quot;</span><span class="p">)),</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">);</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">BlockedDamage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.f</span><span class="p">;</span><span class="w"> </span><span class="c1">// damage blocked by armor</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DamageValue</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Armor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">DamageValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DamageValue</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Armor</span><span class="p">;</span>
<span class="w">            </span><span class="n">BlockedDamage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Armor</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">DamageValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="n">BlockedDamage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Armor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DamageValue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;DamageValue = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">DamageValue</span><span class="p">)</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;BlockedDamage = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">BlockedDamage</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TargetAbilitySystemComponent</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// iterate over all effects</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FActiveGameplayEffectsContainer</span><span class="o">::</span><span class="n">ConstIterator</span><span class="w"> </span><span class="n">ActiveEffectIt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TargetAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GetActiveGameplayEffects</span><span class="p">().</span><span class="n">CreateConstIterator</span><span class="p">();</span><span class="w"> </span><span class="n">ActiveEffectIt</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">ActiveEffectIt</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">EffectTagContainer</span><span class="p">;</span>
<span class="w">                </span><span class="n">ActiveEffectIt</span><span class="o">-&gt;</span><span class="n">Spec</span><span class="p">.</span><span class="n">GetAllGrantedTags</span><span class="p">(</span><span class="n">EffectTagContainer</span><span class="p">);</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">EffectStackCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActiveEffectIt</span><span class="o">-&gt;</span><span class="n">Spec</span><span class="p">.</span><span class="n">StackCount</span><span class="p">;</span><span class="w"> </span><span class="c1">// effect stacks</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">SingleStackMitigation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActiveEffectIt</span><span class="o">-&gt;</span><span class="n">Spec</span><span class="p">.</span><span class="n">GetModifierMagnitude</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">                </span><span class="kt">bool</span><span class="w"> </span><span class="n">bStackRemoved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// iterate thru all tags of effect</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">EffectTagIt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EffectTagContainer</span><span class="p">.</span><span class="n">CreateConstIterator</span><span class="p">();</span><span class="w"> </span><span class="n">EffectTagIt</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">EffectTagIt</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// search for effect with tag &quot;Buff.Armor&quot;</span>
<span class="w">                    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsArmorEffect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">EffectTagIt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="o">::</span><span class="n">RequestGameplayTag</span><span class="p">(</span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;Buff.Armor&quot;</span><span class="p">));</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">bIsArmorEffect</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;SingleStackMitigation = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">SingleStackMitigation</span><span class="p">)</span><span class="w"> </span><span class="c1">// just in case</span>
<span class="w">                        </span><span class="c1">// remove one stack of armor from effect</span>
<span class="w">                        </span><span class="n">TargetAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">RemoveActiveGameplayEffect</span><span class="p">((</span><span class="o">*</span><span class="n">ActiveEffectIt</span><span class="p">).</span><span class="n">Handle</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">                        </span><span class="n">bStackRemoved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// exit loop</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">bStackRemoved</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// exit loop</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// this way we can modify properties</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">DamageValue</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Apply modifier to decrease Health attribute based on amount of DamageValue</span>
<span class="w">            </span><span class="n">OutExecutionOutput</span><span class="p">.</span><span class="n">AddOutputModifier</span><span class="p">(</span>
<span class="w">                </span><span class="n">FGameplayModifierEvaluatedData</span><span class="p">(</span><span class="n">FDamageExecutionCapturedStatics</span><span class="p">().</span><span class="n">HealthProperty</span><span class="p">,</span><span class="w"> </span><span class="n">EGameplayModOp</span><span class="o">::</span><span class="n">Additive</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">DamageValue</span><span class="p">)</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
Как вы видите, из класса <code>UDamageExecCalculation</code> мы можем управлять модификаторами эффекта, через <code>OutExecutionOutput.AddOutputModifier</code>, а так-же удалять или добавлять стеки эффектов через указатель на <code>Ability System Component</code>.</p>
<h4 id="_38">Проверка</h4>
<p>Для проверки написанного нами класса используем зоны урона. Копируем эффект зоны урона - <code>GE_ZoneEffect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/b57fe24b7c2cc6494bef3b3dbbdb39e1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b57fe24b7c2cc6494bef3b3dbbdb39e1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b57fe24b7c2cc6494bef3b3dbbdb39e1.png" /></a></p>
<p>Называем копию - <code>GE_ZoneExecCalculation</code>.</p>
<p><a class="glightbox" href="../images/3467a52ed36f418062f8e77328ed2a9c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3467a52ed36f418062f8e77328ed2a9c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3467a52ed36f418062f8e77328ed2a9c.png" /></a></p>
<p>Открываем. Удаляем все модификаторы.</p>
<p>Добавляем один элемент в список <code>Executions</code>. Устанавливаем <code>Calculation Class</code> на <code>UDamageExecCalculation</code>.</p>
<p><a class="glightbox" href="../images/627d21a744a99805ceaea3580999d000.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="627d21a744a99805ceaea3580999d000.png" auto_="auto;" display="block;" margin:="margin:" src="../images/627d21a744a99805ceaea3580999d000.png" /></a></p>
<p>Устанавливаем наш эффект в зону для урона. Цифра урона должна быть положительной.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/91fd10ff8fecba5badd108c3aa54cf7e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="91fd10ff8fecba5badd108c3aa54cf7e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/91fd10ff8fecba5badd108c3aa54cf7e.png" /></a></p>
<p>Если войти в такую зону, урон, который она наносит, будет снижен, в зависимости от количества стаков брони персонажа. При нанесении урона, стаки брони персонажа будут спадать. Когда броня полностью пропадет - персонаж будет получать полный урон.</p>
<p><a class="glightbox" href="../images/16939e8afd589b8ea2ce1a311af1654e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="16939e8afd589b8ea2ce1a311af1654e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/16939e8afd589b8ea2ce1a311af1654e.png" /></a></p>
<p><a class="glightbox" href="../images/6ab742a3533fd8a2ec57b77e60d0e627.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6ab742a3533fd8a2ec57b77e60d0e627.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6ab742a3533fd8a2ec57b77e60d0e627.png" /></a></p>
<p>Напомню, что <code>1</code> стак брони блокирует <code>3</code> единицы урона.</p>
<p><a class="glightbox" href="../images/eab6f47c1d310aa9a2a278ec20128c4a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="eab6f47c1d310aa9a2a278ec20128c4a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/eab6f47c1d310aa9a2a278ec20128c4a.png" /></a></p>
<p><code>5</code> стаков блокируют <code>15</code> урона, <code>4</code> - <code>12</code>, <code>3</code> - <code>9</code>.
Зона наносит <code>10</code> единиц урона. Если значение брони выше, чем наносимый урон - то урон снижается до <code>0</code>, а стак брони - снимается.</p>
<h2 id="_39">Сложные эффекты</h2>
<p>Рассмотрим работу с <code>Gameplay Effects</code> на сложных примерах. Для начала реализуем логику стрельбы, а потом - способность метеор, с выбором зоны применения.</p>
<h3 id="_40">Примитивная логика стрельбы и нанесения урона</h3>
<p>Реализуем логику стрельбы и нанесения урона, с проигрыванием процедурного эффекта попадания.</p>
<h4 id="impact-effect">Добавляем <code>Impact Effect</code> на персонажа</h4>
<p>Чтобы персонаж, при попаданиях пуль, реалистично реагировал, мы можем использовать сесьма занятный трюк с физикой, включая ее в момент попадания, а потом постепенно уменьшая влияние физики на тело персонажа.</p>
<p>Открывает <code>blueprint</code> персонажа, в нашем случае это <code>BP_CoreCharacter</code>.</p>
<p><a class="glightbox" href="../images/73b5c0a78ff2419175479be800562c25.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="73b5c0a78ff2419175479be800562c25.png" auto_="auto;" display="block;" margin:="margin:" src="../images/73b5c0a78ff2419175479be800562c25.png" /></a></p>
<p>Добавляем новый <code>Timeline</code>.</p>
<p><a class="glightbox" href="../images/31d5b957d0a62c099e64454b713f856d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="31d5b957d0a62c099e64454b713f856d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/31d5b957d0a62c099e64454b713f856d.png" /></a></p>
<p><a class="glightbox" href="../images/208f46b980cab6c566d9decd939d0513.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="208f46b980cab6c566d9decd939d0513.png" auto_="auto;" display="block;" margin:="margin:" src="../images/208f46b980cab6c566d9decd939d0513.png" /></a></p>
<p>Двойным щелчком открываем <code>Timeline</code>.
Добавляем <code>Track</code> нажав на соответствующую кнопку.</p>
<p><a class="glightbox" href="../images/41d920e454ba5100ec1757b8b9d99ce3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="41d920e454ba5100ec1757b8b9d99ce3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/41d920e454ba5100ec1757b8b9d99ce3.png" /></a></p>
<p>Добавляем две точки на <code>Track</code>, через клик правой кнопкой мыши.</p>
<p><a class="glightbox" href="../images/05a097652b0188f37637c2ae7fe1be0f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="05a097652b0188f37637c2ae7fe1be0f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/05a097652b0188f37637c2ae7fe1be0f.png" /></a></p>
<p>Первая точка должна иметь значения <code>Time - 0.0, Value = 0.5</code>, вторая точка - значения <code>Time - 0.4, Value - 0.0</code>.</p>
<p><a class="glightbox" href="../images/d13d0328cc475d15631425fa7df14731.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d13d0328cc475d15631425fa7df14731.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d13d0328cc475d15631425fa7df14731.png" /></a></p>
<p>Таким образом мы сможем плавно переходить от значения <code>0.5</code> к <code>0.0</code> за <code>0.4</code> секунды.</p>
<p>Оборачиваем логику <code>Timeline</code> в <code>Custom Event</code> - <code>ApplyImpactWeight</code>.</p>
<p><a class="glightbox" href="../images/213f7dcab7ab74bdd01eac1441e04e63.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="213f7dcab7ab74bdd01eac1441e04e63.png" auto_="auto;" display="block;" margin:="margin:" src="../images/213f7dcab7ab74bdd01eac1441e04e63.png" /></a></p>
<p>Добавляем метод <code>Recive Impact</code> со следующей логикой:</p>
<p><a class="glightbox" href="../images/92913af0c13ae0876d1bb7a53342029c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="92913af0c13ae0876d1bb7a53342029c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/92913af0c13ae0876d1bb7a53342029c.png" /></a></p>
<p><a class="glightbox" href="../images/928c15eccb1f7c1b42ae6553ad9aa404.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="928c15eccb1f7c1b42ae6553ad9aa404.png" auto_="auto;" display="block;" margin:="margin:" src="../images/928c15eccb1f7c1b42ae6553ad9aa404.png" /></a></p>
<p><a class="glightbox" href="../images/dab3b8469e77ef318fd6b059c29e851d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dab3b8469e77ef318fd6b059c29e851d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dab3b8469e77ef318fd6b059c29e851d.png" /></a></p>
<p>Теперь мы сможем вызывать метод <code>Recive Impact</code> и видеть, как персонажи реагируют на попадания игрока.</p>
<p><a class="glightbox" href="../images/45509202ff4c551f292b00d4971ae4c7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="45509202ff4c551f292b00d4971ae4c7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/45509202ff4c551f292b00d4971ae4c7.png" /></a></p>
<p><a class="glightbox" href="../images/ae0ea79f94deb3ee6e456bbd680c909a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ae0ea79f94deb3ee6e456bbd680c909a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ae0ea79f94deb3ee6e456bbd680c909a.png" /></a></p>
<h4 id="_41">Добавляем прожектайл</h4>
<p>В <code>Content Browser</code> создаем папку <code>FireBullet</code>. Внутрь добавляем <code>blueprint</code> класс <code>Actor</code> используя <code>ContentBrowser -&gt; Add -&gt; Blueprint Clas -&gt; Actor</code>. Называем созданный класс - <code>BP_Bullet</code>.</p>
<p><a class="glightbox" href="../images/b88cc7463cbc27b0a33d29889ef8fcb5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b88cc7463cbc27b0a33d29889ef8fcb5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b88cc7463cbc27b0a33d29889ef8fcb5.png" /></a></p>
<p>Открываем созданный класс и добавляем в него следующие компоненты: <code>Projectile Movement</code>, <code>Sphere Collision</code>, и <code>Static Mesh Component</code>.
Передаскиваем компонент <code>SphereCollision</code> на <code>DefaultSceneRoot</code>.</p>
<p><a class="glightbox" href="../images/428f1746316039073133b85a2528b480.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="428f1746316039073133b85a2528b480.png" auto_="auto;" display="block;" margin:="margin:" src="../images/428f1746316039073133b85a2528b480.png" /></a></p>
<p>Чтобы было так:</p>
<p><a class="glightbox" href="../images/0448559695327fb11143a6f41f58ee7c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0448559695327fb11143a6f41f58ee7c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0448559695327fb11143a6f41f58ee7c.png" /></a></p>
<p>По желанию, можете добавить систему партиклов, которая будет проигрываться при попадании патрона по цели, в моем случае это <code>P_Explosion</code> из папки <code>Starter Content</code>.</p>
<p><a class="glightbox" href="../images/8786a52f23dd8170efc7123a22be7a98.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8786a52f23dd8170efc7123a22be7a98.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8786a52f23dd8170efc7123a22be7a98.png" /></a></p>
<p>В системе партиклов отключите автоматическую активацию.</p>
<p><a class="glightbox" href="../images/c2c823792304249290a4acb234ee20dc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c2c823792304249290a4acb234ee20dc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c2c823792304249290a4acb234ee20dc.png" /></a></p>
<p>Добавляем в <code>Static Mesh Component</code> - <code>Sphere</code> меш сферы из <code>Starter Content</code>.</p>
<p><a class="glightbox" href="../images/733acca1c0f613a445de48d6da299b5e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="733acca1c0f613a445de48d6da299b5e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/733acca1c0f613a445de48d6da299b5e.png" /></a></p>
<p>Скалируем компонент так, чтобы внешне он стал похож на пулю.</p>
<p><a class="glightbox" href="../images/bc31f6f05da577e118610e07bfda6790.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bc31f6f05da577e118610e07bfda6790.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bc31f6f05da577e118610e07bfda6790.png" /></a></p>
<p>Можете написать для пули отдельный шейдер, который будет  светиться. Для этого создайте материал, через <code>Content Browser</code> меню <code>Add -&gt; Materials -&gt; Material</code>.</p>
<p><a class="glightbox" href="../images/1331e70e5e8d7fde629bc0e8be887f05.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1331e70e5e8d7fde629bc0e8be887f05.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1331e70e5e8d7fde629bc0e8be887f05.png" /></a></p>
<p>Установите для материала <code>Sdading Mode -&gt; Unlit</code> и  добавьте в него ноду <code>Vector3</code>, для вывода цвета. Подключите ноду к параметру <code>Emissive Color</code>.</p>
<p><a class="glightbox" href="../images/4b9dfc64a1b9daa02ff8105839174758.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4b9dfc64a1b9daa02ff8105839174758.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4b9dfc64a1b9daa02ff8105839174758.png" /></a></p>
<p>Чтобы объект с материалом начал светиться, в параметре цвета измените поле <code>V</code>, например, на <code>35</code>.</p>
<p><a class="glightbox" href="../images/07fd0d96e6a833a6dec82eeb98768db6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="07fd0d96e6a833a6dec82eeb98768db6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/07fd0d96e6a833a6dec82eeb98768db6.png" /></a></p>
<p>Создайте <code>Material Instance</code> на основе нашего материала. Для этого щелкните по материалу правой кнопкой мыши -&gt; <code>Create Material Instance</code>.</p>
<p><a class="glightbox" href="../images/fe18c4185de4aa5b0aa6f4c0daa408f9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fe18c4185de4aa5b0aa6f4c0daa408f9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fe18c4185de4aa5b0aa6f4c0daa408f9.png" /></a></p>
<p>Я назвал <code>Material Instance</code> - <code>MI_Bullet</code>. Поменяйте материал у пули.</p>
<p><a class="glightbox" href="../images/f0e9d7d55b08db1f70baf9d3338a7720.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f0e9d7d55b08db1f70baf9d3338a7720.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f0e9d7d55b08db1f70baf9d3338a7720.png" /></a></p>
<p>Идем далее.</p>
<p><a class="glightbox" href="../images/c2fdcc57981cebcbb15d0b7f5a42b02f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c2fdcc57981cebcbb15d0b7f5a42b02f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c2fdcc57981cebcbb15d0b7f5a42b02f.png" /></a></p>
<p>В компоненте <code>Projectile Movement</code> выставляем параметр <code>Initial Speed</code> на <code>3000</code> и параметр <code>Projectile Gravity Scale</code> на <code>0</code>.</p>
<p><a class="glightbox" href="../images/4c8a88ad19c0470a831a277179422b74.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4c8a88ad19c0470a831a277179422b74.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4c8a88ad19c0470a831a277179422b74.png" /></a></p>
<p>Эти настройки заставят прожектайл лететь вперед, игнорируя гравитацию.</p>
<p>Установите параметр <code>Rotation Foolows Velocity</code>, чтобы вращение прожектайла соовпадало с направлением полета.</p>
<p>Выключаем все коллизии на <code>Staic Mesh Component</code> - <code>Sphere</code>.</p>
<p><a class="glightbox" href="../images/4d6648ba568be7259512def0094326fc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4d6648ba568be7259512def0094326fc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4d6648ba568be7259512def0094326fc.png" /></a></p>
<p><a class="glightbox" href="../images/979c6aecd3f8fa251281b71bb63505dc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="979c6aecd3f8fa251281b71bb63505dc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/979c6aecd3f8fa251281b71bb63505dc.png" /></a></p>
<p>На <code>Sphere Collision Component</code> ставим все коллизии в <code>Overlap</code>, кроме <code>Visibility</code> и <code>Camera</code>, а параметр <code>Collision Enabled</code> в <code>Query and Physics</code>.</p>
<p><a class="glightbox" href="../images/8d76cf2745844984d91eec1eb9412221.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8d76cf2745844984d91eec1eb9412221.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8d76cf2745844984d91eec1eb9412221.png" /></a></p>
<p><a class="glightbox" href="../images/3b839e2cf67ba97e681ea7bf06873eb5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3b839e2cf67ba97e681ea7bf06873eb5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3b839e2cf67ba97e681ea7bf06873eb5.png" /></a></p>
<p>Добавляем в прожектайл переменную <code>Max Range</code>, это максимальная дистанция, после которой прожектайл самоуничтожится. Данный параметр должен иметь два тега - <code>Instance Editable</code> и <code>Expose On Spawn</code>, значение в параметре - <code>1000</code>.</p>
<p><a class="glightbox" href="../images/352f1d553387c2d8be0b543c15b8a860.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="352f1d553387c2d8be0b543c15b8a860.png" auto_="auto;" display="block;" margin:="margin:" src="../images/352f1d553387c2d8be0b543c15b8a860.png" /></a></p>
<p>Добавляем в прожектайл переменную <code>EffectSpecHandle</code> типа <code>Gameplay Effect Spec Handle</code>. Через эту переменную мы будем передавать в пулю эффект, который она наложит на цель, при попадании. Параметры <code>Instance Editable</code> и <code>Expose On Spawn</code> - должны быть включены.</p>
<p><a class="glightbox" href="../images/9e610ec7574580415e526dd09971d3c4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9e610ec7574580415e526dd09971d3c4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9e610ec7574580415e526dd09971d3c4.png" /></a></p>
<p><a class="glightbox" href="../images/5b0d6f730193a5ac64ede3ee80944a77.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5b0d6f730193a5ac64ede3ee80944a77.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5b0d6f730193a5ac64ede3ee80944a77.png" /></a></p>
<p>Чтобы прожектайл уничтожался после прохождения этой дистанции создаем в событии <code>BeginPlay</code> вызов ноды <code>Set Life Span</code> следующим образом:</p>
<p><a class="glightbox" href="../images/6c805c9618ef4cdc04933222ce8a12f7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6c805c9618ef4cdc04933222ce8a12f7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6c805c9618ef4cdc04933222ce8a12f7.png" /></a></p>
<p>Срок существования прожектайла в секундах считается по следующей логике:
если <code>V = S / T</code> тогда <code>T = S / V</code>.
Подключаем событие <code>OnComponentBeginOverlap</code> у <code>Sphere Collision</code>. При коллизии прожектайл должен останавливаться, для этого используем метод <code>Stop Movement Immediately</code> от компонента <code>Projectile Movement</code>.</p>
<p><a class="glightbox" href="../images/30c617334c5530236982dfe8e2a2e729.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="30c617334c5530236982dfe8e2a2e729.png" auto_="auto;" display="block;" margin:="margin:" src="../images/30c617334c5530236982dfe8e2a2e729.png" /></a></p>
<p>События <code>Overlap</code> не вызываются для тех объектов на уровне, у которых отключен параметр <code>Generate Overlap Events</code>. Выделяем все меши на уровне и включаем его.</p>
<p><a class="glightbox" href="../images/c4aa8a3be064c52b1b7d7a576e7bacbb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c4aa8a3be064c52b1b7d7a576e7bacbb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c4aa8a3be064c52b1b7d7a576e7bacbb.png" /></a></p>
<p>Полный <code>blueprint</code> код метода <code>OnComponentBeginOverlap</code> достаточно длинный, я приведу его по частям.</p>
<p><a class="glightbox" href="../images/ce5b5969ced98b1291c0fc242c208674.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ce5b5969ced98b1291c0fc242c208674.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ce5b5969ced98b1291c0fc242c208674.png" /></a></p>
<p><a class="glightbox" href="../images/6175ca2e4f629da20161f53bcecc5eec.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6175ca2e4f629da20161f53bcecc5eec.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6175ca2e4f629da20161f53bcecc5eec.png" /></a></p>
<p><a class="glightbox" href="../images/54dcecf22c7090781228446b8dcd269d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="54dcecf22c7090781228446b8dcd269d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/54dcecf22c7090781228446b8dcd269d.png" /></a></p>
<p><a class="glightbox" href="../images/26f871b4661963b04261afad0ce642e5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="26f871b4661963b04261afad0ce642e5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/26f871b4661963b04261afad0ce642e5.png" /></a></p>
<h4 id="ga_firebullet">Добавляем способность <code>GA_FireBullet</code></h4>
<p>Прожектайл должен призываться из способности выстрела. Реализуем ее.</p>
<p>Для этого в <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; Blueprint Class</code>. В появившемся окне, на вкладке <code>All Classes</code> ищем класс - <code>CoreGameplayAbility</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/e3f80d1163ab005edef045ec35b0b34a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e3f80d1163ab005edef045ec35b0b34a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e3f80d1163ab005edef045ec35b0b34a.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Создаем новый <code>blueprint</code> на его основе. Называем новый класс <code>GA_FireBullet</code>.</p>
<p><a class="glightbox" href="../images/6023606f9c7c856f047561ef46071f30.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6023606f9c7c856f047561ef46071f30.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6023606f9c7c856f047561ef46071f30.png" /></a></p>
<p>Открываем файл и выставляем <code>AbilitySlot</code> на <code>FireSlot</code>, чтобы наша способность активировалась при нажатии соотествтующей клавиши.</p>
<p><a class="glightbox" href="../images/100f347d92cc655f2beb0fab06d8bd7e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="100f347d92cc655f2beb0fab06d8bd7e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/100f347d92cc655f2beb0fab06d8bd7e.png" /></a></p>
<p>Добавляем в граф способности логику призыва новых прожектайлов.</p>
<p><a class="glightbox" href="../images/076ecb1dc9509c09a4ce88328ba0a592.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="076ecb1dc9509c09a4ce88328ba0a592.png" auto_="auto;" display="block;" margin:="margin:" src="../images/076ecb1dc9509c09a4ce88328ba0a592.png" /></a></p>
<p><a class="glightbox" href="../images/79cf72c101a01f5341665cbc1a310e29.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="79cf72c101a01f5341665cbc1a310e29.png" auto_="auto;" display="block;" margin:="margin:" src="../images/79cf72c101a01f5341665cbc1a310e29.png" /></a></p>
<p><a class="glightbox" href="../images/648f8e8bece505d7098e984611c5447c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="648f8e8bece505d7098e984611c5447c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/648f8e8bece505d7098e984611c5447c.png" /></a></p>
<p><a class="glightbox" href="../images/b4ab21761078623942a5adc53378777f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b4ab21761078623942a5adc53378777f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b4ab21761078623942a5adc53378777f.png" /></a></p>
<p>Так-же, в класс способности была добавлена функция, которая высчитывает начальную позицию и вращение прожектайла в соответствии с точкой прицела - <code>GetBulletInitialTransform</code>.</p>
<p><a class="glightbox" href="../images/0c8e9531b6158c851c9fbb3728041e23.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0c8e9531b6158c851c9fbb3728041e23.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0c8e9531b6158c851c9fbb3728041e23.png" /></a></p>
<p><a class="glightbox" href="../images/a0999eb056f06c7ec2655f093481e590.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a0999eb056f06c7ec2655f093481e590.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a0999eb056f06c7ec2655f093481e590.png" /></a></p>
<p><a class="glightbox" href="../images/f12b9d84613a745b66bd713dc7cd04b0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f12b9d84613a745b66bd713dc7cd04b0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f12b9d84613a745b66bd713dc7cd04b0.png" /></a></p>
<p><a class="glightbox" href="../images/12063b755fd5e0b2255e3bd69d49aa29.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="12063b755fd5e0b2255e3bd69d49aa29.png" auto_="auto;" display="block;" margin:="margin:" src="../images/12063b755fd5e0b2255e3bd69d49aa29.png" /></a></p>
<p>Устанавливаем параметр <code>Fire Rate</code> в <code>0.3</code>.</p>
<p><a class="glightbox" href="../images/00d4c563a5f7fe11a675223f886e44e9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="00d4c563a5f7fe11a675223f886e44e9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/00d4c563a5f7fe11a675223f886e44e9.png" /></a></p>
<p><code>Bullet Damage</code> - <code>10</code>.</p>
<p><a class="glightbox" href="../images/0acacaedcb926f924856ae51eebcdab9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0acacaedcb926f924856ae51eebcdab9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0acacaedcb926f924856ae51eebcdab9.png" /></a></p>
<p><code>Bullet Max Range</code> - <code>3000</code>.</p>
<p><a class="glightbox" href="../images/6af4dcc13dd9d7704c8ab4048e0d0020.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6af4dcc13dd9d7704c8ab4048e0d0020.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6af4dcc13dd9d7704c8ab4048e0d0020.png" /></a></p>
<p>Добавляем действие <code>GA_FireBullet</code> в <code>DataAsset</code> со списком способностей персонажа - <code>DA_PlayerAbilities</code>.</p>
<p><a class="glightbox" href="../images/6e5ff33bfd677d68df3f46833ac9457f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6e5ff33bfd677d68df3f46833ac9457f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6e5ff33bfd677d68df3f46833ac9457f.png" /></a></p>
<p>Если запустить проект и нажать на левую кнопку мыши, мы увидим как раз в <code>0.3</code> секунды, в цель летят прожектайлы.</p>
<p><a class="glightbox" href="../images/50b18b8c7c3862525d5109016a974681.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="50b18b8c7c3862525d5109016a974681.png" auto_="auto;" display="block;" margin:="margin:" src="../images/50b18b8c7c3862525d5109016a974681.png" /></a></p>
<h4 id="_42">Создаем бота с примитивным ии</h4>
<p>Создадим бота с примитивным ИИ, который будет выступать в качестве цели для прожектайлов.</p>
<p>В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Blueprint Class</code>, в списке <code>All Classes</code> ищем <code>BP_CoreCharacter</code>.</p>
<p><a class="glightbox" href="../images/1b181b937cb449188a4ef876b28e3654.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1b181b937cb449188a4ef876b28e3654.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1b181b937cb449188a4ef876b28e3654.png" /></a></p>
<p>Называем новый ассет <code>BP_NPC_Character</code>.</p>
<p><a class="glightbox" href="../images/83cce0246ffdd672b882af30ecc7d5c0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="83cce0246ffdd672b882af30ecc7d5c0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/83cce0246ffdd672b882af30ecc7d5c0.png" /></a></p>
<p>Открываем. Добавляем следующую логику:</p>
<p><a class="glightbox" href="../images/ca9c5c94f5fe1721ced281a2145ac687.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ca9c5c94f5fe1721ced281a2145ac687.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ca9c5c94f5fe1721ced281a2145ac687.png" /></a></p>
<p>Добавляем на уровень <code>Nav Mesh Bounds Volume</code>.</p>
<p><a class="glightbox" href="../images/a609b586b91a5332987f018ab58e4997.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a609b586b91a5332987f018ab58e4997.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a609b586b91a5332987f018ab58e4997.png" /></a></p>
<p>Скалируем <code>Nav Mesh Bounds Volume</code> по осям <code>X</code> и <code>Y</code> так чтобы он покрывал всю карту.</p>
<p><a class="glightbox" href="../images/80c49ff59882916f522f7361ee70b0c3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="80c49ff59882916f522f7361ee70b0c3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/80c49ff59882916f522f7361ee70b0c3.png" /></a></p>
<p>Добавляем <code>BP_NPC_Character</code> на уровень.</p>
<p><a class="glightbox" href="../images/8e1e3330a276d4cfb6a56c8af92fb3cb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8e1e3330a276d4cfb6a56c8af92fb3cb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8e1e3330a276d4cfb6a56c8af92fb3cb.png" /></a></p>
<p>При запуске проекта, написанный нами <code>NPC</code> будет двигаться в случайную точку уровня.</p>
<p><a class="glightbox" href="../images/e8d732f0cbe79514b305edc6907d14a1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e8d732f0cbe79514b305edc6907d14a1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e8d732f0cbe79514b305edc6907d14a1.png" /></a></p>
<p>Передайте боту те-же самые способности, которые есть у персонажа. Для этого установите в параметр <code>Default Abilities Info</code> файл <code>DA_PlayerAbilities</code>.</p>
<p><a class="glightbox" href="../images/59c9926f5cae2f0b589e7c75eb4d3722.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="59c9926f5cae2f0b589e7c75eb4d3722.png" auto_="auto;" display="block;" margin:="margin:" src="../images/59c9926f5cae2f0b589e7c75eb4d3722.png" /></a></p>
<p>Давайте заставим бота бегать по уровню. Cпособность <code>Sprint</code> можно активировать следующим образом:</p>
<p><a class="glightbox" href="../images/634811c46b665297796cc9faee8429ee.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="634811c46b665297796cc9faee8429ee.png" auto_="auto;" display="block;" margin:="margin:" src="../images/634811c46b665297796cc9faee8429ee.png" /></a></p>
<p>Тогда функция <code>Random Point Movement</code> будет выглядеть так:</p>
<p><a class="glightbox" href="../images/fbb10127907818a273b237ecef876af8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fbb10127907818a273b237ecef876af8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fbb10127907818a273b237ecef876af8.png" /></a></p>
<p><a class="glightbox" href="../images/5d96b7811fb6b4f9b8910b685045159c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5d96b7811fb6b4f9b8910b685045159c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5d96b7811fb6b4f9b8910b685045159c.png" /></a></p>
<p><a class="glightbox" href="../images/c060eecad3c0953bfeaa9d3e7ce35394.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c060eecad3c0953bfeaa9d3e7ce35394.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c060eecad3c0953bfeaa9d3e7ce35394.png" /></a></p>
<p>Запускаем проект и смотрим как бот бегает, расходуя выносливость. Правда этого еще не видно, потому что мы не реализовали виджет с соответствующей информацией.</p>
<p><a class="glightbox" href="../images/e4247653f88ad6d76432221934629169.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e4247653f88ad6d76432221934629169.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e4247653f88ad6d76432221934629169.png" /></a></p>
<h4 id="npc">Создаем виджет полоски здоровья для <code>NPC</code></h4>
<p>Хотя полоски здоровья лучше всего выводить через класс <code>HUD</code>, как я делал это в соответствующей статье, тут, в этой статье, мы выведем полоску здоровья через обычный <code>Widget Blueprint</code>. Это очень плохо для производительности, но очень хороше для прототипирования.</p>
<p>В <code>Content Browser</code> выполняем команду <code>Add -&gt; User Interface -&gt; Widget Blueprint</code>.</p>
<p><a class="glightbox" href="../images/8e7218bd1e836f9fd773b33ba5d29df5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8e7218bd1e836f9fd773b33ba5d29df5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8e7218bd1e836f9fd773b33ba5d29df5.png" /></a></p>
<p>Называем новый ассет <code>WB_FloatingStats</code>.</p>
<p><a class="glightbox" href="../images/fa64abe58fe1de60fcf9277cb613ff20.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fa64abe58fe1de60fcf9277cb613ff20.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fa64abe58fe1de60fcf9277cb613ff20.png" /></a></p>
<p>Внутрь виджета добавляем <code>SizeBox</code>, рамзера <code>300</code> на <code>70</code> и выставляем размерность на <code>Desired</code>.</p>
<p><a class="glightbox" href="../images/7870fa53faca4dbb81ae8a318d874a7e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7870fa53faca4dbb81ae8a318d874a7e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7870fa53faca4dbb81ae8a318d874a7e.png" /></a></p>
<p>Добавляем <code>Vertical Box</code> и два <code>Progerss Bar'а</code>, а так-же иконку брони.</p>
<p><a class="glightbox" href="../images/e8be30cba1a9aac4c1d43e137a069c0a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e8be30cba1a9aac4c1d43e137a069c0a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e8be30cba1a9aac4c1d43e137a069c0a.png" /></a></p>
<p>Для <code>Progress Bar</code> выставляем  параметр <code>Percent</code> в <code>1</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/e34591e455963165fb75909fbe9380b9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e34591e455963165fb75909fbe9380b9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e34591e455963165fb75909fbe9380b9.png" /></a></p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/8aeff445033b2fab7a009da589d663d2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8aeff445033b2fab7a009da589d663d2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8aeff445033b2fab7a009da589d663d2.png" /></a></p>
<p>Переключаемся в <code>Graph</code>.</p>
<p><a class="glightbox" href="../images/8dbe862a22c47f066176ca910042335a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8dbe862a22c47f066176ca910042335a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8dbe862a22c47f066176ca910042335a.png" /></a></p>
<p>Создаем или копируем переменную <code>ASC</code> из виджета <code>HUD</code>. Тип переменной - <code>Ability System Component</code>.</p>
<p><a class="glightbox" href="../images/e905e6a637187b5f4de21cf2244620f3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e905e6a637187b5f4de21cf2244620f3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e905e6a637187b5f4de21cf2244620f3.png" /></a></p>
<p>Переносим остальную логику из виджета <code>WB_HUD</code> с небольшими правками.</p>
<p><a class="glightbox" href="../images/9b2eb9dafc7e51a37be647175d2ac150.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9b2eb9dafc7e51a37be647175d2ac150.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9b2eb9dafc7e51a37be647175d2ac150.png" /></a></p>
<p><a class="glightbox" href="../images/bc2b34017aed2e72bf0bf5817e9cdd9b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bc2b34017aed2e72bf0bf5817e9cdd9b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bc2b34017aed2e72bf0bf5817e9cdd9b.png" /></a></p>
<p><a class="glightbox" href="../images/3e5e8a49382d82e2d8fd01d9da351b59.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3e5e8a49382d82e2d8fd01d9da351b59.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3e5e8a49382d82e2d8fd01d9da351b59.png" /></a></p>
<p><a class="glightbox" href="../images/e6bc83534656418b4cbfb98f04060384.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e6bc83534656418b4cbfb98f04060384.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e6bc83534656418b4cbfb98f04060384.png" /></a></p>
<p>Возвращаемся к классу нашего <code>NPC</code> - <code>BP_NPC_Character</code>.
Добавляем в него компонент <code>Widget</code>, устанавливаем параметр <code>Widget Class</code> в <code>WB_FloatingStats</code>.</p>
<p><a class="glightbox" href="../images/d255451d6b7fea912c47867dad15f750.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d255451d6b7fea912c47867dad15f750.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d255451d6b7fea912c47867dad15f750.png" /></a></p>
<p>Выставляем рендеринг в <code>Screen Space</code> и размер <code>150</code> на <code>30</code>.</p>
<p><a class="glightbox" href="../images/175f778709c44093729a32abdce3ba86.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="175f778709c44093729a32abdce3ba86.png" auto_="auto;" display="block;" margin:="margin:" src="../images/175f778709c44093729a32abdce3ba86.png" /></a></p>
<p>Виджеты, которые рендерятся в <code>Screen Space</code> всегда будут повернуты по направлению к камере игрока.</p>
<p>Чтобы характеристики загружались в виджет - его надо инициализировать через переменную <code>ASC</code>.
Добавляем следующий код инициализации виджета в методе <code>Begin Play</code> класса <code>BP_NPC_Character</code>.</p>
<p><a class="glightbox" href="../images/09c6d05ab4ffb016fb990e696deef075.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="09c6d05ab4ffb016fb990e696deef075.png" auto_="auto;" display="block;" margin:="margin:" src="../images/09c6d05ab4ffb016fb990e696deef075.png" /></a></p>
<p>Запускаем проект и видим бегающего бота, у которого расходуется выносливость и накапливается броня.</p>
<p><a class="glightbox" href="../images/800cc44e2a45494d85dedaae5fe0e00b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="800cc44e2a45494d85dedaae5fe0e00b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/800cc44e2a45494d85dedaae5fe0e00b.png" /></a></p>
<h4 id="_43">Применение урона</h4>
<p>Просчет урона в нашем проекте осуществляется за счет <code>Execution Calculation Modifier</code>. Мы применяли этот модификатор на зоны для урона, но ничто не  мешает нам накладывать данный эффект на цели, в которые попадают пули. К тому-же сам класс рассчета урона настроен на динамическое считывание значений через <code>Set by Caller Magnitude</code>.
В <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; Blueprint Class</code>, в пункте <code>All Classes</code> ищем <code>Gameplay Effect</code>.</p>
<p><a class="glightbox" href="../images/cbbf1c21097587ae4e7556ebd29e59e2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cbbf1c21097587ae4e7556ebd29e59e2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cbbf1c21097587ae4e7556ebd29e59e2.png" /></a></p>
<p>Называем эффект <code>GE_BulletHealthModifierDamage</code>.</p>
<p><a class="glightbox" href="../images/af86371cb4c7f60e8b191f31bad5489b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="af86371cb4c7f60e8b191f31bad5489b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/af86371cb4c7f60e8b191f31bad5489b.png" /></a></p>
<p>Устанавливаем <code>Duration Policy</code> - <code>Instant</code> и <code>Executions -&gt; Calculation Class</code> - <code>DamageExecCalculation</code>.</p>
<p><a class="glightbox" href="../images/3dda76db92529b0fdccf9b121ca64ffa.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3dda76db92529b0fdccf9b121ca64ffa.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3dda76db92529b0fdccf9b121ca64ffa.png" /></a></p>
<p>Созданный эффект надо применять к цели, при попадании прожектайла.</p>
<p>Открываем <code>blueprint</code> нашего прожектайла - <code>BP_Bullet</code>. Добавляем туда переменную <code>EffectSpecHandle</code> с типом <code>GameplayEffectSpecHandle</code>. Переменная должна иметь параметры <code>Instance Editable</code> и <code>Expose on Spawn</code>.</p>
<p><a class="glightbox" href="../images/0b918f998ff95f0e0ab84ad542d531a7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0b918f998ff95f0e0ab84ad542d531a7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0b918f998ff95f0e0ab84ad542d531a7.png" /></a></p>
<p>Теперь идем в <code>blueprint</code>, призывающий прожектайл - <code>GA_FireBullet</code>. Отсюда надо передать <code>EffectSpecHandle</code> с установленным значением урона в тег <code>Damage.Value</code>.</p>
<p><a class="glightbox" href="../images/5540045cd6f88368f1df530ed17f5d56.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5540045cd6f88368f1df530ed17f5d56.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5540045cd6f88368f1df530ed17f5d56.png" /></a></p>
<p>Обратите внимание на ноду<code>MakeOutgoingGameplayEffectSpec</code>, параметр <code>Gameplay Effect Class</code> в ней имеет значение <code>GE_BulletApplied</code>. Именно этот эффект мы будем применять на цель, в которую попадет прожектайл.</p>
<p>Возвращаемся в класс прожектайла - <code>BP_Bullet</code>.
Тут необходимо написать логику применения переданного эффекта.</p>
<p><a class="glightbox" href="../images/157e8189b009048fd79647420e23a82f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="157e8189b009048fd79647420e23a82f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/157e8189b009048fd79647420e23a82f.png" /></a></p>
<p><a class="glightbox" href="../images/194d88911828028a8de07391bb2fbb21.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="194d88911828028a8de07391bb2fbb21.png" auto_="auto;" display="block;" margin:="margin:" src="../images/194d88911828028a8de07391bb2fbb21.png" /></a></p>
<p>Запускаем проект, нажимаем левую кнопку мыши и видим, что урон наносится, стаки брони - снимаются, <code>NPC</code> падают в <code>Ragdoll</code>.</p>
<p><a class="glightbox" href="../images/f112a0f370290b5c68bbd7019665ce86.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f112a0f370290b5c68bbd7019665ce86.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f112a0f370290b5c68bbd7019665ce86.png" /></a></p>
<p>Если вы хотите, чтобы "мертвые" <code>NPC</code> пропадали с уровня, можете добавить следующий код в класс <code>BP_NPC_Character</code>:</p>
<p><a class="glightbox" href="../images/7d1f89672591350e9cd552e455fa8f25.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7d1f89672591350e9cd552e455fa8f25.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7d1f89672591350e9cd552e455fa8f25.png" /></a></p>
<h3 id="meteor">Способность <code>Meteor</code></h3>
<p>Реализуем способность с выбором области действия. Такие способности, например, есть в <code>World Of Warcraft</code>, в частности пресловутый <code>Rain of Fire</code> чернокнижника.</p>
<p><a class="glightbox" href="../images/81d66be93d97bb8530cbedb932dfc781.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="81d66be93d97bb8530cbedb932dfc781.png" auto_="auto;" display="block;" margin:="margin:" src="../images/81d66be93d97bb8530cbedb932dfc781.png" /></a></p>
<p>Такие способности можно создавать и в <code>Unreal Engine</code>, при помощи системы <code>GAS</code>. Чем мы и займемся в этой главе.</p>
<h4 id="_44">Добавляем слот под нашу способность</h4>
<p>Дополняем список слотов, указанный в <code>EAbilityInput</code> новым слотом, под способность.
<code>AbilityInputEnum.h</code>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// somehow my VS dosen&#39;t detect .generated.h for nested files so i have to inclde this manyally to get rid of red errors</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span>
<span class="c1">// UHT</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AbilityInputEnum.generated.h&quot;</span>
<span class="c1">// Ability Action</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EAbilityInput</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">None</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Confirm</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Cancel</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot1</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Fire Slot&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot2</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Aim Slot&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot3</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Sprint Slot&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot4</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Jump Slot&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">Slot5</span><span class="w"> </span><span class="n">UMETA</span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Meteor Slot&quot;</span><span class="p">)</span>
<span class="p">};</span>
</code></pre></div>
Добавляем <code>InputAction</code> для использования способности <code>Meteor</code>.
В <code>Content Browser</code> нажимаем <code>Add -&gt; Input -&gt; Input Action</code>.</p>
<p><a class="glightbox" href="../images/791a8b42a133d820b9ae6b2db7d85404.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="791a8b42a133d820b9ae6b2db7d85404.png" auto_="auto;" display="block;" margin:="margin:" src="../images/791a8b42a133d820b9ae6b2db7d85404.png" /></a></p>
<p>Называем новое действие - <code>IA_Meteor</code>.
Тип действия оставляем стандартным - <code>bool</code>.</p>
<p><a class="glightbox" href="../images/f24ebca979c691347cbc0fc67aacdb89.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f24ebca979c691347cbc0fc67aacdb89.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f24ebca979c691347cbc0fc67aacdb89.png" /></a></p>
<p>Добавляем созданное действие в глобальный <code>Input Mapping Context</code>, в нашем проекте это <code>IMC_Default</code>.</p>
<p><a class="glightbox" href="../images/85f5f47f9feffd2e8ddadfec5dca847c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="85f5f47f9feffd2e8ddadfec5dca847c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/85f5f47f9feffd2e8ddadfec5dca847c.png" /></a></p>
<p>Назначаем клавишу <code>F</code> для применения способности.</p>
<p>Теперь идем в <code>Visual Studio</code> и дополняем метод <code>BindContext</code> в классе <code>ACoreCharacter</code> новым обработчиком.
<div class="highlight"><pre><span></span><code><span class="c1">// Meteor</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Meteor&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot5</span><span class="p">);</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot5</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
На всякий случай привожу полный код метода <code>BindContext</code> в данный момент.
<code>CoreCharacter.cpp</code>
<div class="highlight"><pre><span></span><code><span class="cm">/**===============================================</span>
<span class="cm"> * Input</span>
<span class="cm"> */</span>
<span class="c1">// will bind new mapping context</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">ACoreCharacter::BindContext</span><span class="p">(</span><span class="n">TSoftObjectPtr</span><span class="o">&lt;</span><span class="n">UInputMappingContext</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">OnController</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MappingContext</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// only because i don&#39;t want to crash app with check()</span>
<span class="w">    </span><span class="n">APlayerController</span><span class="o">*</span><span class="w"> </span><span class="n">PlayerController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">APlayerController</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetController</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">OnController</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PlayerController</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">GetLocalPlayer</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get enhanced input component&#39;s subsystem</span>
<span class="w">    </span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">*</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ULocalPlayer</span><span class="o">::</span><span class="n">GetSubsystem</span><span class="o">&lt;</span><span class="n">UEnhancedInputLocalPlayerSubsystem</span><span class="o">&gt;</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">LocalPlayer</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EiSubsystem</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// input component</span>
<span class="w">    </span><span class="n">UEnhancedInputComponent</span><span class="o">*</span><span class="w"> </span><span class="n">EnhancedInputComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UEnhancedInputComponent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PlayerController</span><span class="o">-&gt;</span><span class="n">InputComponent</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//EnhancedInputComponent-&gt;ClearActionBindings(); // clear all bindings if necessary</span>
<span class="w">    </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">ClearBindingsForObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear bindings only from this object</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EiSubsystem</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// register mapping context</span>
<span class="w">        </span><span class="n">EiSubsystem</span><span class="o">-&gt;</span><span class="n">AddMappingContext</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="n">InputPriority</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// iterate over all mappings and put every unique action into the Map</span>
<span class="w">    </span><span class="c1">// since actions occur in the map multiple times, for every key binding</span>
<span class="w">    </span><span class="n">TMap</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">Actions</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FEnhancedActionKeyMapping</span><span class="w"> </span><span class="n">Mapping</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">GetMappings</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FName</span><span class="w"> </span><span class="n">ActionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Actions</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">ActionName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Actions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ActionName</span><span class="p">,</span><span class="w"> </span><span class="n">Mapping</span><span class="p">.</span><span class="n">Action</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;Action Name = %s&quot;), *Mapping.Action-&gt;GetName())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// now differentiate actions in the loop and assign them according to the names</span>
<span class="w">    </span><span class="c1">// make sure to give action names accordingly</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TPair</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">ActionInfo</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Actions</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">AName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">UInputAction</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActionInfo</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// Confirm</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Confirm&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// bind Confirm action</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Started</span><span class="p">,</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UAbilitySystemComponent</span><span class="o">::</span><span class="n">LocalInputConfirm</span><span class="p">);</span>
<span class="w">            </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GenericCancelInputID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Confirm</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Cancel</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// bind Confirm action</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Started</span><span class="p">,</span><span class="w"> </span><span class="n">GameAbilitySystemComponent</span><span class="p">.</span><span class="n">Get</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">UAbilitySystemComponent</span><span class="o">::</span><span class="n">LocalInputCancel</span><span class="p">);</span>
<span class="w">            </span><span class="n">GameAbilitySystemComponent</span><span class="o">-&gt;</span><span class="n">GenericCancelInputID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Cancel</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Jumping</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot4</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// use integrated jump</span>
<span class="w">            </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Triggered, this, &amp;ACharacter::Jump);</span>
<span class="w">            </span><span class="c1">//EnhancedInputComponent-&gt;BindAction(Action, ETriggerEvent::Completed, this, &amp;ACharacter::StopJumping);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Fire</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Fire&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot1</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Meteor</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Meteor&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot5</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot5</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Aim</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Aim&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot2</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot2</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Moving</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Move&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Move</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Sprinting</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Sprint&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Completed</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">SendAbilityLocalInput</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">EAbilityInput</span><span class="o">::</span><span class="n">Slot3</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Looking around</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AName</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Look&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">EnhancedInputComponent</span><span class="o">-&gt;</span><span class="n">BindAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">ETriggerEvent</span><span class="o">::</span><span class="n">Triggered</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ACoreCharacter</span><span class="o">::</span><span class="n">Rotate</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="gameplay-ability-target-actor">Добавляем <code>Gameplay Ability Target Actor</code></h4>
<p>Система <code>GAS</code> предоставляет ряд классов, которые могут быть использованы для указания области или цели, в которой будет применена способность.</p>
<p>Увидеть доступные <code>Target Actor</code> классы можно из меню добавления нового <code>blueprint</code>.</p>
<p><a class="glightbox" href="../images/5f84fc4c26a2faae27bde5662f2a9192.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5f84fc4c26a2faae27bde5662f2a9192.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5f84fc4c26a2faae27bde5662f2a9192.png" /></a></p>
<p>Для способности метеор необходимо использовать класс <code>GameplayAbilityTargetActor_GroundTrace</code>. При призыве, экземпляр этого класса будет следовать за поверхностью террейна, позволяя выбрать область на ней.</p>
<p>За призыв классов <code>Target Actor</code> отвечает нода <code>Wait Target Data</code>. Она создает <code>Target Actor</code> и переключает на него контроллер персонажа. Когда система получае событие <code>Cancel</code> или <code>Commit</code> - <code>Target Actor</code> автоматически уничтожается, а управление возвращается к персонажу.</p>
<p><a class="glightbox" href="../images/d25afa11955875d87d68a877ff54f982.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d25afa11955875d87d68a877ff54f982.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d25afa11955875d87d68a877ff54f982.png" /></a></p>
<p>Создаем <code>Target Actor</code> от класса <code>GameplayAbilityTargetActor_GroundTrace</code>. Называем его <code>BP_MeteorTargetGroundTrace</code>.</p>
<p><a class="glightbox" href="../images/3240c8c391f945a9954c0e079a622b05.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3240c8c391f945a9954c0e079a622b05.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3240c8c391f945a9954c0e079a622b05.png" /></a></p>
<p>Добавляем компонент декали.</p>
<p><a class="glightbox" href="../images/95cb9a96458e67776f215bcc7dc76381.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="95cb9a96458e67776f215bcc7dc76381.png" auto_="auto;" display="block;" margin:="margin:" src="../images/95cb9a96458e67776f215bcc7dc76381.png" /></a></p>
<p>Эта декаль будет проецироваться на поверхность, по которой двигается <code>Target Actor</code>.
Создадим материал для декали.</p>
<p>В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Materials -&gt; Material</code>.</p>
<p><a class="glightbox" href="../images/dc8560e80bb09752b9259598d941dedd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dc8560e80bb09752b9259598d941dedd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dc8560e80bb09752b9259598d941dedd.png" /></a></p>
<p>Называем материал <code>M_GroundCircularDecal</code>.</p>
<p><a class="glightbox" href="../images/dae4dd4fd80f6f4bdc099bf65ce635fe.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dae4dd4fd80f6f4bdc099bf65ce635fe.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dae4dd4fd80f6f4bdc099bf65ce635fe.png" /></a></p>
<p>Я сделал простой круг для декали. Его исходник приложен к книге, в папке "Дополнительно".</p>
<p><a class="glightbox" href="../images/8a482965315dfa4d06f6e67e0832cb52.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8a482965315dfa4d06f6e67e0832cb52.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8a482965315dfa4d06f6e67e0832cb52.png" /></a></p>
<p>Добавляем текстуру круга в материал.</p>
<p><a class="glightbox" href="../images/937e99e9bd2c53a4e06552af9d7e3ccc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="937e99e9bd2c53a4e06552af9d7e3ccc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/937e99e9bd2c53a4e06552af9d7e3ccc.png" /></a></p>
<p>В параметрах материала выбираем <code>Material Domain</code> - <code>Deferred Decal</code> и <code>Blend Mode</code> - <code>Translucent</code>.</p>
<p><a class="glightbox" href="../images/559e98f95e4217033d07f2bade179ea6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="559e98f95e4217033d07f2bade179ea6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/559e98f95e4217033d07f2bade179ea6.png" /></a></p>
<p>Щелкаем по материалу правой кнопкой мыши и создаем <code>Material Instance</code>.</p>
<p><a class="glightbox" href="../images/e2542fc618753810dec8b20faac13e3e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e2542fc618753810dec8b20faac13e3e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e2542fc618753810dec8b20faac13e3e.png" /></a></p>
<p><a class="glightbox" href="../images/85fd45db306742f6ab7a36360bf4f0f3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="85fd45db306742f6ab7a36360bf4f0f3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/85fd45db306742f6ab7a36360bf4f0f3.png" /></a></p>
<p>Выбирае мозданный материал в компоненте декали.</p>
<p><a class="glightbox" href="../images/4df2f849351b0bd84ebda1f6918521a5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4df2f849351b0bd84ebda1f6918521a5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4df2f849351b0bd84ebda1f6918521a5.png" /></a></p>
<p>Устанавливаем трансформы компонента декали следующим образом:</p>
<p><a class="glightbox" href="../images/e7355dc5838d7f8044ffc62e1f7830b8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e7355dc5838d7f8044ffc62e1f7830b8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e7355dc5838d7f8044ffc62e1f7830b8.png" /></a></p>
<p>Больше в классе <code>Ability Target</code> добавлять ничего не надо.</p>
<h4 id="_45">Добавляем эффект, наносящий урон целям</h4>
<p>За урон, который будет наноситься целям метеора, должен отвечать отдельный <code>Gameplay Effect</code>. Создадим его.</p>
<p>В <code>Content Browser</code> нажимаем кнопку <code>Add -&gt; Blueprint Class</code>, в появившемся окне, на вкладке <code>All Classes</code> ищем <code>Gameplay Effect</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/249f28bb2be5d32d277fbd0265f963fd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="249f28bb2be5d32d277fbd0265f963fd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/249f28bb2be5d32d277fbd0265f963fd.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Создаем новый <code>blueprint</code> и называем его <code>GE_MeteorDamage</code>.</p>
<p><a class="glightbox" href="../images/696f6e8498a7aabbe11afbe4a7f03e40.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="696f6e8498a7aabbe11afbe4a7f03e40.png" auto_="auto;" display="block;" margin:="margin:" src="../images/696f6e8498a7aabbe11afbe4a7f03e40.png" /></a></p>
<p>В этот эффект надо добавить всего одну вещ - <code>Execution</code> класс <code>DamageExecCalculation</code>, который мы используем для всех эффектов, наносящих урон.</p>
<p><a class="glightbox" href="../images/8c0a49bbeb4db7f3cc75cc2ed48384b0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8c0a49bbeb4db7f3cc75cc2ed48384b0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8c0a49bbeb4db7f3cc75cc2ed48384b0.png" /></a></p>
<h4 id="_46">Создаем метеор</h4>
<p>В качестве метеора будет выступать обычный <code>Actor</code> со сферой внутри.</p>
<p>Создаем его через <code>Content Browser -&gt; Add -&gt; Blueprint Class -&gt; Actor</code>.</p>
<p><a class="glightbox" href="../images/a7e620c319a1c574919933f85b430f4f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a7e620c319a1c574919933f85b430f4f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a7e620c319a1c574919933f85b430f4f.png" /></a></p>
<p>Называем <code>BP_MeteorActor</code>.</p>
<p><a class="glightbox" href="../images/31d85fa52f38cab439c022f75d3c3425.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="31d85fa52f38cab439c022f75d3c3425.png" auto_="auto;" display="block;" margin:="margin:" src="../images/31d85fa52f38cab439c022f75d3c3425.png" /></a></p>
<p>Падение метеора будет работать за счет компонента <code>Projectile Movement</code>. Логика метеора сходна с логикой пули, которую мы уже реализовывали до этого.</p>
<p>Добавляем в класс компоненты <code>Static Mesh</code>, <code>Sphere Collision</code> и <code>Projectile Movement</code>, опционально можно добавить в класс визуальный эффект <code>P_Explosion</code>.</p>
<p><a class="glightbox" href="../images/79c7fadb9be8684f0bde8df7d01317d3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="79c7fadb9be8684f0bde8df7d01317d3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/79c7fadb9be8684f0bde8df7d01317d3.png" /></a></p>
<p>Найти эффект можно в папке <code>Starter Content</code>.</p>
<p><a class="glightbox" href="../images/ac67ec8299f711a5666dcdf2421aa43a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ac67ec8299f711a5666dcdf2421aa43a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ac67ec8299f711a5666dcdf2421aa43a.png" /></a></p>
<p>Компонент, отвечающий за эффект, должен иметь параметр <code>Auto Activate</code> = <code>False</code>.</p>
<p><a class="glightbox" href="../images/bf718cbff7700ee57aadd5e09084b259.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bf718cbff7700ee57aadd5e09084b259.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bf718cbff7700ee57aadd5e09084b259.png" /></a></p>
<p>Мы будем активировать этот компонент из кода.</p>
<p>В компоненте <code>Sphere Collision</code> установите следующие параметры коллизии:</p>
<p><a class="glightbox" href="../images/33965ba4eca73544bdc1cea845d14908.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="33965ba4eca73544bdc1cea845d14908.png" auto_="auto;" display="block;" margin:="margin:" src="../images/33965ba4eca73544bdc1cea845d14908.png" /></a></p>
<p>В компоненте <code>Static Mesh</code> отключаем все коллизии.</p>
<p><a class="glightbox" href="../images/e65cb9687a20a1a3734566624e2069f5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e65cb9687a20a1a3734566624e2069f5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e65cb9687a20a1a3734566624e2069f5.png" /></a></p>
<p>Загружаем в компонент простую сферу из <code>Starter Content</code>.</p>
<p><a class="glightbox" href="../images/3807087423dd5b8610eace237619ab47.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3807087423dd5b8610eace237619ab47.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3807087423dd5b8610eace237619ab47.png" /></a></p>
<p>Настроим компонент <code>Projectile Movement</code>. Нам надо, чтобы метеор падал вниз. Ищем праметр <code>Vecolity</code>, он отвечает за вектор скоростей по осям.</p>
<p><a class="glightbox" href="../images/2a9426750f485fb2a3acfaae0c801b90.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2a9426750f485fb2a3acfaae0c801b90.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2a9426750f485fb2a3acfaae0c801b90.png" /></a></p>
<p>Устанавливаем ось <code>Z</code> на <code>-1</code>, чтобы прожектайл двигался вниз.</p>
<p>Начальная скорость метеора задается в параметре <code>Initial Speed</code>. Тут установлено значение в <code>500</code>, потому что я не хочу, чтобы метеор падал слишком быстро.</p>
<p><a class="glightbox" href="../images/9b5c061b36f84cc16bb0058e56f4431f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9b5c061b36f84cc16bb0058e56f4431f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9b5c061b36f84cc16bb0058e56f4431f.png" /></a></p>
<p>Параметр <code>Gravity Scale</code> оставляете стандартным.</p>
<p>Пишем логику работы класса.</p>
<p>Добавляем переменную <code>EffectSpecHandle</code>, которая будет получать  информацию об накладываемом эффекте и его уроне.</p>
<p><a class="glightbox" href="../images/c6ccf6e819c7ffa82ff22b08d1b9ca32.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c6ccf6e819c7ffa82ff22b08d1b9ca32.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c6ccf6e819c7ffa82ff22b08d1b9ca32.png" /></a></p>
<p>Данная переменная должна иметь флаги <code>Expose On Spawn</code> и <code>Instance Editable</code>.</p>
<p><a class="glightbox" href="../images/734bdd107bf9ee980e01a59060239237.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="734bdd107bf9ee980e01a59060239237.png" auto_="auto;" display="block;" margin:="margin:" src="../images/734bdd107bf9ee980e01a59060239237.png" /></a></p>
<p>Добавляем переменную <code>Damage Radius</code>, которая будет отвечать за радиус, в котором персонажи, окружающие метеор, получат урон.</p>
<p><a class="glightbox" href="../images/14d0c994ab7700a0b42684346f15ba62.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="14d0c994ab7700a0b42684346f15ba62.png" auto_="auto;" display="block;" margin:="margin:" src="../images/14d0c994ab7700a0b42684346f15ba62.png" /></a></p>
<p>Данная переменная должна иметь флаги <code>Expose On Spawn</code> и <code>Instance Editable</code>.
Добавляем остальные переменные.</p>
<p><a class="glightbox" href="../images/47f2778a1c661d00b06174910305d612.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="47f2778a1c661d00b06174910305d612.png" auto_="auto;" display="block;" margin:="margin:" src="../images/47f2778a1c661d00b06174910305d612.png" /></a></p>
<p>Реализуем метод <code>OnComponentBeginOverlap</code> у компонента <code>SphereCollision</code>.</p>
<p><a class="glightbox" href="../images/a47632800593f28a4d592b8b5d9d0a5c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a47632800593f28a4d592b8b5d9d0a5c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a47632800593f28a4d592b8b5d9d0a5c.png" /></a></p>
<p><a class="glightbox" href="../images/3915b4094e7b09d6ba000361fdcdfb34.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3915b4094e7b09d6ba000361fdcdfb34.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3915b4094e7b09d6ba000361fdcdfb34.png" /></a></p>
<p>Добавляем сюда логику метеора.</p>
<p><a class="glightbox" href="../images/c8094a9ecb4cc865f4375191003c34ed.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c8094a9ecb4cc865f4375191003c34ed.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c8094a9ecb4cc865f4375191003c34ed.png" /></a></p>
<p><a class="glightbox" href="../images/0f8fc7a03af5c5b4159d4c1421ce1f4b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0f8fc7a03af5c5b4159d4c1421ce1f4b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0f8fc7a03af5c5b4159d4c1421ce1f4b.png" /></a></p>
<p><a class="glightbox" href="../images/9252a0f449c26f378e36fcf89d847e78.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9252a0f449c26f378e36fcf89d847e78.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9252a0f449c26f378e36fcf89d847e78.png" /></a></p>
<p><a class="glightbox" href="../images/9a7d9aa67851352f7d8b86e6f82442d9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9a7d9aa67851352f7d8b86e6f82442d9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9a7d9aa67851352f7d8b86e6f82442d9.png" /></a></p>
<p>Логика работает следующим образом: метеор, при коллизии о статик меш или землю прекращает движение, проигрывается визуальный эффект взрыва, сфера метеора - скрывается, происходит <code>Sphere Trace</code> в заданном радиусе на окружающих метеор персонажей, каждый персонаж, попавший в радиус, получает на себя эффект урона.</p>
<h4 id="_47">Добавляем способность, применяющую метеор</h4>
<p>Для этого в <code>Content Browser</code> нажимаем на кнопку <code>Add -&gt; Blueprint Class</code>. В появившемся окне, на вкладке <code>All Classes</code> ищем класс - <code>CoreGameplayAbility</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/e3f80d1163ab005edef045ec35b0b34a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e3f80d1163ab005edef045ec35b0b34a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e3f80d1163ab005edef045ec35b0b34a.png" /></a>
{align=center; display=block; margin: 0 auto;}
{align=center; display=block; margin: 0 auto;}</p>
<p>Создаем новый <code>blueprint</code> на его основе. Называем новый класс <code>GA_CastMeteor</code>.</p>
<p><a class="glightbox" href="../images/e820f7ec4a643a6667f676c0370fd042.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e820f7ec4a643a6667f676c0370fd042.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e820f7ec4a643a6667f676c0370fd042.png" /></a></p>
<p>Открываем <code>blueprint</code>. Устанавливаем слот, из которого способность будет запускаться, на <code>Meteor Slot</code>.</p>
<p><a class="glightbox" href="../images/220b97f17e3eb78b08efaccc4e3b114a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="220b97f17e3eb78b08efaccc4e3b114a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/220b97f17e3eb78b08efaccc4e3b114a.png" /></a></p>
<p>Добавляем код.</p>
<p><a class="glightbox" href="../images/fff431cf59bc85f0b0df9e0347b34814.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fff431cf59bc85f0b0df9e0347b34814.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fff431cf59bc85f0b0df9e0347b34814.png" /></a></p>
<p><a class="glightbox" href="../images/e22f45e6dba9dfbc1a5e6928bc256924.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e22f45e6dba9dfbc1a5e6928bc256924.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e22f45e6dba9dfbc1a5e6928bc256924.png" /></a></p>
<p><a class="glightbox" href="../images/8eacb735a631388c7ff2936fdc6edf2f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8eacb735a631388c7ff2936fdc6edf2f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8eacb735a631388c7ff2936fdc6edf2f.png" /></a></p>
<p><a class="glightbox" href="../images/13bdba1829218caec2263d79cee0e726.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="13bdba1829218caec2263d79cee0e726.png" auto_="auto;" display="block;" margin:="margin:" src="../images/13bdba1829218caec2263d79cee0e726.png" /></a></p>
<p><a class="glightbox" href="../images/5caf8db6047ae734dea92847d698288a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5caf8db6047ae734dea92847d698288a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5caf8db6047ae734dea92847d698288a.png" /></a></p>
<p><a class="glightbox" href="../images/624cbf760646620294c0cee556cae66f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="624cbf760646620294c0cee556cae66f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/624cbf760646620294c0cee556cae66f.png" /></a></p>
<p><a class="glightbox" href="../images/e9d81c541e69006b012381c42a3b30af.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e9d81c541e69006b012381c42a3b30af.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e9d81c541e69006b012381c42a3b30af.png" /></a></p>
<p>Добавляем способность в список предоставляемых "по умолчанию", через <code>DataAsset</code> - <code>DA_PlayerAbilities</code>.</p>
<p><a class="glightbox" href="../images/d5ff03643f498e3ac49479a3c30b952e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d5ff03643f498e3ac49479a3c30b952e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d5ff03643f498e3ac49479a3c30b952e.png" /></a></p>
<p>Способность уже можно применять.</p>
<p><a class="glightbox" href="../images/e05e067ddcbd08c47557af370df2b21f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e05e067ddcbd08c47557af370df2b21f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e05e067ddcbd08c47557af370df2b21f.png" /></a></p>
<p><a class="glightbox" href="../images/7bf36df5b0c0f6ce70a243c46811b472.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7bf36df5b0c0f6ce70a243c46811b472.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7bf36df5b0c0f6ce70a243c46811b472.png" /></a></p>
<p>Урон наносится, импакт проигрывается исправно, однако, этой способности не хватает эффекта кулдауна и расхода маны.</p>
<h4 id="_48">Исправляем интерфейс</h4>
<p>Я, изначально, не планировал добавлять эту способность, поэтому не вывел ману, в качестве характеристики в интерфейс. Давайте исправим этот недочет, это достаточно просто и быстро сделать.</p>
<p>Открываем виджет интерфейса, <code>WB_Hud</code> и добавляем в него индикатор маны.</p>
<p><a class="glightbox" href="../images/08c637bc169aac704a1463ca78749911.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="08c637bc169aac704a1463ca78749911.png" auto_="auto;" display="block;" margin:="margin:" src="../images/08c637bc169aac704a1463ca78749911.png" /></a></p>
<p>Копируем логику работы аттрибута <code>Health</code> и  перенастраиваем его под ману.</p>
<p><a class="glightbox" href="../images/3f236b32c41b8132cc98ea4655eb561e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3f236b32c41b8132cc98ea4655eb561e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3f236b32c41b8132cc98ea4655eb561e.png" /></a></p>
<p><a class="glightbox" href="../images/73664c8d71317f746b630466d92182c9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="73664c8d71317f746b630466d92182c9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/73664c8d71317f746b630466d92182c9.png" /></a></p>
<h4 id="ge_meteorcost">Добавляем эффект <code>GE_MeteorCost</code></h4>
<p>Эффекты <code>Cost</code> задаются в поле <code>Cost Gameplay Effect Class</code>.</p>
<p><a class="glightbox" href="../images/8314f2993ab5014f1697f3254d76bd4e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8314f2993ab5014f1697f3254d76bd4e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8314f2993ab5014f1697f3254d76bd4e.png" /></a></p>
<p>Достаточно ли ресурсов для применения способности или нет, можно проверить нодой <code>CheckAbilityCost</code>.</p>
<p><a class="glightbox" href="../images/3596b97700ba53987fb57363d2b1dc12.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3596b97700ba53987fb57363d2b1dc12.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3596b97700ba53987fb57363d2b1dc12.png" /></a></p>
<p>Эффект <code>cost</code> применяется и ресурсы отнимаются, при вызове ноды <code>CommitAbility</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/0f5aaf8618f3c437ff6fa3557a9ccf7a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0f5aaf8618f3c437ff6fa3557a9ccf7a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0f5aaf8618f3c437ff6fa3557a9ccf7a.png" /></a></p>
<p>Все эффекты <code>cost</code> имеют <code>Duration Policy</code> - <code>Instant</code>.</p>
<p><a class="glightbox" href="../images/70dffac8bfdeba1d25a35569aea80ee3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="70dffac8bfdeba1d25a35569aea80ee3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/70dffac8bfdeba1d25a35569aea80ee3.png" /></a></p>
<p>При этом такие эффекты имеют модификаторы, необходимые для изменения зависимых характеристик. Например в эффекте <code>GE_MeteorCost</code> я отнимаю <code>30</code> единиц маны.</p>
<h4 id="ge_meteorcooldown">Добавляем <code>GE_MeteorCooldown</code></h4>
<p>Кулдаун способности можно задать в параметре <code>Cooldown Gameplay Effect Class</code>.</p>
<p><a class="glightbox" href="../images/6106ab849300f4e9e142dee805a015e1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6106ab849300f4e9e142dee805a015e1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6106ab849300f4e9e142dee805a015e1.png" /></a></p>
<p>Эффект, работающий как кулдаун, не имеет модификаторов. Все что в нем есть - <code>Duration Policy</code> = <code>Has Duration</code>. Значение кулдауна задается как продолжительность эффекта, в поле <code>Duration Magnitude</code>.</p>
<p><a class="glightbox" href="../images/edd74159823dc8465585bbe4a9e78222.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="edd74159823dc8465585bbe4a9e78222.png" auto_="auto;" display="block;" margin:="margin:" src="../images/edd74159823dc8465585bbe4a9e78222.png" /></a></p>
<p>Активен кулдаун или нет, можно проверит нодой <code>CheckAbilityCooldown</code>.</p>
<p><a class="glightbox" href="../images/44abeefad0742227072f166e32421a2d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="44abeefad0742227072f166e32421a2d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/44abeefad0742227072f166e32421a2d.png" /></a></p>
<p>Кулдауны активируются, при применении ноды <code>CommitAbility</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/0f5aaf8618f3c437ff6fa3557a9ccf7a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0f5aaf8618f3c437ff6fa3557a9ccf7a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0f5aaf8618f3c437ff6fa3557a9ccf7a.png" /></a></p>
<p>Логика способности работает так: сначала мы проверяем, находится наша способность на кулдауне или нет. Если она не находится на кулдауне - вызываем таргетинг, если таргетинг успешен - отправляем способность на кулдаун и вызываем метеор по цели.</p>
<p><a class="glightbox" href="../images/16d4b3955b3e6c32bacbc1d049d8c651.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="16d4b3955b3e6c32bacbc1d049d8c651.png" auto_="auto;" display="block;" margin:="margin:" src="../images/16d4b3955b3e6c32bacbc1d049d8c651.png" /></a></p>
<p>Выведем иконку кулдауна в интерфейс.</p>
<p>Я нарисовал следующую иконку в <code>Gimp</code>, найти ее можно в папке "Дополнительно" книги.</p>
<p><a class="glightbox" href="../images/d7cf8ca43cf40a42ef303d44583642e7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d7cf8ca43cf40a42ef303d44583642e7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d7cf8ca43cf40a42ef303d44583642e7.png" /></a></p>
<p>Добавляем новую иконку в интерфейс.</p>
<p><a class="glightbox" href="../images/4039b68a70f9e263f8588ac09674ee50.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4039b68a70f9e263f8588ac09674ee50.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4039b68a70f9e263f8588ac09674ee50.png" /></a></p>
<p>Прописываем для нее логику.</p>
<p><a class="glightbox" href="../images/afe91f8383c4c96003f5d0ccec95ef4b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="afe91f8383c4c96003f5d0ccec95ef4b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/afe91f8383c4c96003f5d0ccec95ef4b.png" /></a></p>
<p>Теперь, при запуске метеорита, вы будете видеть его кулдаун.</p>
<p><a class="glightbox" href="../images/e851cb2d87f7a168e9c23930f7bfb90a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e851cb2d87f7a168e9c23930f7bfb90a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e851cb2d87f7a168e9c23930f7bfb90a.png" /></a></p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            К началу
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      aftamat4ik
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "toc.follow"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>