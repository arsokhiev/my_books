
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Справочник Unreal Engine">
      
      
        <meta name="author" content="aftamat4ik">
      
      
      
        <link rel="prev" href="../2_Core/12.%20UObject%20Interface.html">
      
      
        <link rel="next" href="2_UFUNCTION_Wildcard.html">
      
      
      <link rel="icon" href="../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.3.2">
    
    
      
        <title>HUD или Heads-up Display - Справочник Unreal Engine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.30068a00.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hud-heads-up-display" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-header__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Справочник Unreal Engine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              HUD или Heads-up Display
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Главная

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1_Basics/1_First_Project.html" class="md-tabs__link">
          
  
  Основы

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../2_Core/1_Delegates.html" class="md-tabs__link">
          
  
  Ключевые системы

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="1_HUD.html" class="md-tabs__link">
          
  
  Продвинутая разработка

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-tabs__link">
          
  
  Решение проблем

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../5_Tips/Change_Asset_Icons.html" class="md-tabs__link">
          
  
  Советы

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-nav__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    Справочник Unreal Engine
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Главная
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Основы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Основы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/1_First_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создаем первый проект в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/2_Engine_Introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Знакомство с движком
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/3_CPP_Recommendations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Рекомендации по написанию кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/4_SimplePlugin.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создание простейшего плагина для Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/5_Macroses_Reflection_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Макросы Reflection System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/6_Logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Печать информации в лог
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/7_Pointers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Указатели
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/8_ModernCpp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возможности современного c++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/9_Working_With_Strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа со строками
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/10_Timers_In_%D0%A1%2B%2B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Таймеры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/11_Instances_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Доступ к различным сущностям
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Debug
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            Debug
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Asserts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Asserts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Console Commands
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ключевые системы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Ключевые системы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/1_Delegates.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События и Делегаты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/2_Components.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Компоненты в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/3_SubObjects.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Суб Объекты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/4_Multithreading.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Многопоточность
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/5_Function_Libraries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Библиотеки Функций для Blueprint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/6_Latent_And_Async_Actions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Latent и Async Action
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/7_Gameplay_Tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/8_DataAssets_AssetManager.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с ассетами и данными
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/9_FileSystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с файловой системой
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/10_Anim_Instance.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anim Instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/11_SubSystems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Подсистемы
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/12.%20UObject%20Interface.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Interface или UInterface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Продвинутая разработка
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Продвинутая разработка
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    HUD или Heads-up Display
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="1_HUD.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    HUD или Heads-up Display
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Подготовка к работе
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ahud" class="md-nav__link">
    Обзор возможностей класса AHUD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Расширение класса полезными функциями
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#showdebuginfo" class="md-nav__link">
    Отображение информации в ShowDebugInfo
  </a>
  
    <nav class="md-nav" aria-label="Отображение информации в ShowDebugInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Рисование геометрических примитивов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#draw3dline" class="md-nav__link">
    Draw3DLine
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hud" class="md-nav__link">
    Взаимодействие с элементами HUD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Показ цифр урона
  </a>
  
    <nav class="md-nav" aria-label="Показ цифр урона">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uinterface" class="md-nav__link">
    Добавляем UInterface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Добавляем отрисовку
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Код
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Отрисовка полосок здоровья
  </a>
  
    <nav class="md-nav" aria-label="Отрисовка полосок здоровья">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uinterface_1" class="md-nav__link">
    Добавляем UInterface для персонажа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Добавляем отрисовку
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Механика скрытия и показа индикаторов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Код
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Выделение персонажей в стиле РТС
  </a>
  
    <nav class="md-nav" aria-label="Выделение персонажей в стиле РТС">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Отрисовка выделения
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Добавление логики выделения персонажей
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Расширяем логику выделения
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    Код
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    Links
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="2_UFUNCTION_Wildcard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UFUNCTION Wildcard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="3_Slate%20Runtime.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slate Runtimе, введение в Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="4_UMG.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UMG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="5_K2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="6_Registe_New_Asset_Type.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Регистрируем новый тип ассета
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="7_ACharacter_And_Enhanced%20Input.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ACharacter и Enhanced Input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="8_Gameplay_Ability_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Ability System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="9_Global_Data_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальнный доступ к данным
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="10_Global_Event_Bus.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальная шина событий
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Решение проблем
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Решение проблем
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с кодировкой в LiveCoding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/Reset_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Сброс (Reset) проекта
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/generatedh_Problems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с файлом .generated.h
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Советы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Советы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Change_Asset_Icons.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Asset Icons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Character_And_EnhancedInput.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Character Boilerplate with Enhanced Input Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/DefaultToSelf_WorldContext.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DefaultToSelf WorldContext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Different_UPROPERTY.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Переменные разных типов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/GameInputMode.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Изменение GameInputMode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Get_UScriptStruct_FromStruct.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ::UScriptStruct из встроенной структуры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Input_Binding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События ввода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Iterate_TMap.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iterate TMap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Read_Blueprint_Properties.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Чтение параметров Blueprint класса
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Return_UObject.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возвращение UObject по ссылке из функции
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Run_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Запуск консольных команд
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Screen_Size.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Размер экрана
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Slate_Snippets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Полезные сниппеты Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Spawn_Actors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spawn, призыв объектов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Time_Measuring.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Замер времени исполнения кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Trace.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UEnum_To_String.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UEnum to FString
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UObject_Base_Class.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Base Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Variable_Type_Print_Template.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Шаблон для печати типа переменной
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/struct_operator%3D%3D.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    struct и оператор ==
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Подготовка к работе
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ahud" class="md-nav__link">
    Обзор возможностей класса AHUD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Расширение класса полезными функциями
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#showdebuginfo" class="md-nav__link">
    Отображение информации в ShowDebugInfo
  </a>
  
    <nav class="md-nav" aria-label="Отображение информации в ShowDebugInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Рисование геометрических примитивов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#draw3dline" class="md-nav__link">
    Draw3DLine
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hud" class="md-nav__link">
    Взаимодействие с элементами HUD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Показ цифр урона
  </a>
  
    <nav class="md-nav" aria-label="Показ цифр урона">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uinterface" class="md-nav__link">
    Добавляем UInterface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Добавляем отрисовку
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Код
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Отрисовка полосок здоровья
  </a>
  
    <nav class="md-nav" aria-label="Отрисовка полосок здоровья">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uinterface_1" class="md-nav__link">
    Добавляем UInterface для персонажа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Добавляем отрисовку
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Механика скрытия и показа индикаторов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Код
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Выделение персонажей в стиле РТС
  </a>
  
    <nav class="md-nav" aria-label="Выделение персонажей в стиле РТС">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Отрисовка выделения
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Добавление логики выделения персонажей
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Расширяем логику выделения
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    Код
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    Links
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="hud-heads-up-display">HUD или Heads-up Display</h1>
<p><code>HUD</code> — это базовый объект, используемый, для низкоуровневой отрисовки геометрии на экране пользователя.</p>
<p>Раньше, до появления системы <code>Slate</code> именно <code>HUD</code> служил для отрисовки элементов игрового интерфейса. В современной разработке данный объект используют для вывода отладочной информации, а так-же для вспомогательных функций в некоторых играх, особенно в РТС(стратегиях).
Чаще всего <code>HUD</code> используется в РТС для:
 * выделения персонажей на экране
 * высокопроизводительного отображения полосок здоровья на группах персонажей без применения виджетов
 * отображения цифр урона над персонажами
Эти особенности класса мы и рассмотрим.</p>
<h2 id="_1">Подготовка к работе</h2>
<p>Добавляем новый модуль <code>HudInfoModule</code>.</p>
<p><a class="glightbox" href="../images/1c8f406988e42d047746949cef4adb02.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1c8f406988e42d047746949cef4adb02.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1c8f406988e42d047746949cef4adb02.png" /></a></p>
<p>Теперь нужен, собственно, класс <code>Hud'a</code>. По своей сущности <code>Hud</code> это <code>Actor</code>, то есть <code>AHud</code> будет родительским классом.</p>
<p>Идем <code>Tools-&gt; New c++ Class -&gt; AllClasses</code> ищем в списке <code>AHud</code>.</p>
<p><a class="glightbox" href="../images/3e8c5daa1b9f786bb50c4e7cd38c1431.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3e8c5daa1b9f786bb50c4e7cd38c1431.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3e8c5daa1b9f786bb50c4e7cd38c1431.png" /></a></p>
<p>Называем класс <code>InfoHUD</code>.</p>
<p><a class="glightbox" href="../images/619d91dfb344a208e49260f45f1f62cb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="619d91dfb344a208e49260f45f1f62cb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/619d91dfb344a208e49260f45f1f62cb.png" /></a></p>
<p>После добавления файла не забудьте выполнить команду <code>Tools-&gt; Refresh Visual Studio 2022 Project</code>, чтобы изменения проекта появились в <code>Solution Explorer</code>.</p>
<p><a class="glightbox" href="../images/00b4f9a481c6527a07fa29a7f4c9f0fd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="00b4f9a481c6527a07fa29a7f4c9f0fd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/00b4f9a481c6527a07fa29a7f4c9f0fd.png" /></a></p>
<p>Теперь мы можем установить класс нашего <code>Hud'а</code> в <code>Game Mode</code> проекта.</p>
<p>Для шаблона <code>Third Person</code> найти <code>Game Mode</code> можно по пути <code>/ThirdPerson/Blueprints/BP_ThirdPersonGameMode</code>.</p>
<p><a class="glightbox" href="../images/3fcde74c0d12df96df8b7fe88b8f8680.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3fcde74c0d12df96df8b7fe88b8f8680.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3fcde74c0d12df96df8b7fe88b8f8680.png" /></a></p>
<p>Открываем, ищем строчку <code>HUD</code>, меняем на <code>InfoHUD</code>.</p>
<p><a class="glightbox" href="../images/687d7200667ffe82c9035bc423ba020f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="687d7200667ffe82c9035bc423ba020f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/687d7200667ffe82c9035bc423ba020f.png" /></a></p>
<p>Теперь созданный нами <code>Hud</code> будет загружаться, при запуске проекта.</p>
<h2 id="ahud">Обзор возможностей класса <code>AHUD</code></h2>
<p>Исходники класса <code>AHUD</code> можно найти по адресу <code>C:\GameEngine\UE_5.1\Engine\Source\Runtime\Engine\Classes\GameFramework\HUD.h</code>.</p>
<p><a class="glightbox" href="../images/398e2fdea35e39b786f55bb57bb5caa5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="398e2fdea35e39b786f55bb57bb5caa5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/398e2fdea35e39b786f55bb57bb5caa5.png" /></a></p>
<p>Код класса крайне хороше документирован, поэтому рекомендую ознакомиться.</p>
<p>В заголовке написано, что класс <code>AHUD</code> содержит два холста. Один для отрисовки элементов в реальном времени, второй - для отрисовки элементов во время отладки. Так-же в классе присутствует функционал по обработке пользовательских кликов. Помимо этого <code>HUD</code> умеет рендерить текст, текстуры, материалы и графические примитивы.</p>
<p>Это низкоуровневый интерфейс, он не предоставляет виджетов.</p>
<p>Основные методы для отрисовки это:
<code>DrawHUD()</code> - основной метод отрисовки. Этот метод переопределяется в унаследованных от <code>AHUD</code> классах. Он срабатывает каждое обновление экрана.
<code>ShowDebugInfo()</code> - метод отрисовки, используемый для показа отладочной информации. Этот метод переопределяется в унаследованных от <code>AHUD</code> классах. Отладочная информация в <code>HUD</code> может быть выведена консольной командой <code>showdebug</code> или через вызов метода <code>ShowDebug()</code>.
Основные вспомогательные методы это:
<code>ShowHUD()</code> - показывает или скрывает <code>HUD</code>.
<code>ShowDebug(FName DebugType)</code> - показывает выбранную категорию отладки. По умолчанию категории отладки такие:
<div class="highlight"><pre><span></span><code><span class="k">namespace</span><span class="w"> </span><span class="nn">ShowDebugNames</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">Reset</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Reset&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">HitBox</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;HitBox&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">Animation</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Animation&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">Physics</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Physics&quot;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/c7b775ac08befced49b7648ca6bb8b54.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c7b775ac08befced49b7648ca6bb8b54.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c7b775ac08befced49b7648ca6bb8b54.png" /></a></p>
<p>Объект <code>AHUD</code> является суб объектом для класса <code>APlayerController</code>.</p>
<p><a class="glightbox" href="../images/e473e5cfc38160483fe1d1203ff952f8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e473e5cfc38160483fe1d1203ff952f8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e473e5cfc38160483fe1d1203ff952f8.png" /></a></p>
<p><a class="glightbox" href="../images/9b0f0a21079490577a231641f2808034.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9b0f0a21079490577a231641f2808034.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9b0f0a21079490577a231641f2808034.png" /></a></p>
<p>Поэтому, для получения ссылки на текущий <code>HUD</code> можно использовать следующий код:
<div class="highlight"><pre><span></span><code><span class="n">AInfoHUD</span><span class="o">*</span><span class="w"> </span><span class="n">HUD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UGameplayStatics</span><span class="o">::</span><span class="n">GetPlayerController</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetHUD</span><span class="o">&lt;</span><span class="n">AInfoHUD</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
В <code>blueprint</code> коде все тоже сводится к нодам <code>GetPlayerController</code> и <code>GetHUD</code>.</p>
<p><a class="glightbox" href="../images/fe11f2bf64c446609409d46e5f3baf4b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fe11f2bf64c446609409d46e5f3baf4b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fe11f2bf64c446609409d46e5f3baf4b.png" /></a></p>
<h2 id="_2">Расширение класса полезными функциями</h2>
<p>Для начала нужен безопасный доступ указателю <code>ULocalPlayer*</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// Local Player Ref</span>
<span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="nf">AInfoHUD::GetLocalPlayer</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GetOwningPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">ULocalPlayer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetOwningPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Player</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Теперь реализуем доступ к размеру экрана, потому что стандартный метод <code>GetViewportSize</code> работает со ссылками и не очень удобен.
<div class="highlight"><pre><span></span><code><span class="c1">// Viewport Size</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="nf">AInfoHUD::GetViewportSize</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XVSize</span><span class="p">,</span><span class="w"> </span><span class="n">YVSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// viewport size</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">){</span>
<span class="w">        </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">GetViewportSize</span><span class="p">(</span><span class="n">XVSize</span><span class="p">,</span><span class="w"> </span><span class="n">YVSize</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="p">{};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">XVSize</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">YVSize</span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="showdebuginfo">Отображение информации в <code>ShowDebugInfo</code></h2>
<p>Метод <code>ShowDebugInfo</code> позволяет каждый цикл обновления экрана рисовать на этом экране ту или иную информацию.</p>
<p>Реализация метода выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// Render Debug info</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span>
<span class="p">{}</span>
</code></pre></div>
Для начала, предлагаю написать код, который будет выводить в правом верхнем углу экрана текущее разрешение этого самого экрана.
<div class="highlight"><pre><span></span><code><span class="c1">// Render Debug info</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ShowDebugInfo</span><span class="p">(</span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="n">YPos</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XSize</span><span class="p">,</span><span class="w"> </span><span class="n">YSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XSize</span><span class="p">,</span><span class="w"> </span><span class="n">YSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Log</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Drawing string in right upper corner with offset of 50 from right and 1 letter(YSize) from top</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">Log</span><span class="p">,</span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="o">-</span><span class="w"> </span><span class="n">XSize</span><span class="mi">-50</span><span class="p">,</span><span class="w"> </span><span class="n">YSize</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="c1">//GEngine-&gt;AddOnScreenDebugMessage(-1, 0.f, FColor::Red, FString::Printf(TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y));</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y)</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/a10f3f3135b4da3cbcf7cec393183a9d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a10f3f3135b4da3cbcf7cec393183a9d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a10f3f3135b4da3cbcf7cec393183a9d.png" /></a></p>
<p>В приведенном выше коде я использовал метод <code>DrawText</code> для отрисовки текста одним из системных шрифтов. Я использовал встроенный метод <code>StringSize</code> для получения размера строки, чтобы отрисовать с корректным отступами.</p>
<p>Сами отступы строятся по следующей логике:
Отступ по оси X:
<div class="highlight"><pre><span></span><code><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XSize</span><span class="mi">-50</span>
</code></pre></div>
Тут берется размер экрана по горизонтали в пикселях <code>VS.X</code> из него вычетается размер строки <code>XSize</code>. Это позволяет получить позицию для отрисовки строки в правом углу экрана.</p>
<p><a class="glightbox" href="../images/c8b9a9db5321817dcaec0d9091bb6d94.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c8b9a9db5321817dcaec0d9091bb6d94.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c8b9a9db5321817dcaec0d9091bb6d94.png" /></a></p>
<p>Цифра 50 это отступ от правого угла экрана в 50 пикселей.</p>
<p>Отступ по оси Y:
<div class="highlight"><pre><span></span><code><span class="n">YSize</span>
</code></pre></div>
Это просто размер строки по оси Y. Мы делаем отступ в 1 строку сверху экрана.</p>
<p>Давайте протестируем.</p>
<p>Поскольку мы отрисовываем информацию в отладочном слое, для ее вывода напишите в консоли <code>~</code> команду <code>showdebug</code>. Это приведет к появлению отладочной информации.</p>
<p><a class="glightbox" href="../images/68e5220d99402dcfa2067b6ef4bff7b4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="68e5220d99402dcfa2067b6ef4bff7b4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/68e5220d99402dcfa2067b6ef4bff7b4.png" /></a></p>
<p><a class="glightbox" href="../images/51d68627b526f72eec5a9fa504f1b88f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="51d68627b526f72eec5a9fa504f1b88f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/51d68627b526f72eec5a9fa504f1b88f.png" /></a></p>
<p>Изменение размера экрана - меняет значения в логе.</p>
<p><a class="glightbox" href="../images/f83b66b58dfbd18e72a39178e14f4131.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f83b66b58dfbd18e72a39178e14f4131.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f83b66b58dfbd18e72a39178e14f4131.png" /></a></p>
<p>Чтобы лог пропал снова - отправьте <code>showdebug</code> в консоль.</p>
<h3 id="_3">Рисование геометрических примитивов</h3>
<p>Теперь давайте рассмотрим рисование примитивной геометрии. Для начала можно обвести наше сообщение из лога квадратной рамкой.</p>
<p>Для этого можно использовать следующий код:
<div class="highlight"><pre><span></span><code><span class="c1">// Make Rectangle around text</span>
<span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0f</span><span class="p">;</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// upper point</span>
<span class="w">    </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">    </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="p">};</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// lower point</span>
<span class="w">    </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">    </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="p">};</span>
<span class="n">DrawDebugCanvas2DBox</span><span class="p">(</span><span class="n">DebugCanvas</span><span class="p">,</span><span class="w"> </span><span class="n">FBox2D</span><span class="p">{</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">,</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
</code></pre></div>
Этот код отрисует прямоугольник между двумя точками - верхней и нижней.</p>
<p><a class="glightbox" href="../images/191cd3f6ef7b793fd3b9773338986401.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="191cd3f6ef7b793fd3b9773338986401.png" auto_="auto;" display="block;" margin:="margin:" src="../images/191cd3f6ef7b793fd3b9773338986401.png" /></a></p>
<p>Помимо рисования прямоугольников, можно рисовать и другие примитивы, но их вы сумеете рассмотреть самостоятельно. Я же покажу только линию. Умение рисовать линии одно из ключевых, потому что и прямоугольники и любые другие фигуры, но что самое главное - графики(если вдруг соберетесь их рисовать) строятся из линий.</p>
<p>Добавим под наш прямоугольник линию подчеркивания, используя метод <code>Draw2DLine</code>.
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">LineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">;</span>
<span class="n">Draw2DLine</span><span class="p">(</span>
<span class="w">    </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">    </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">    </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">    </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">    </span><span class="n">FColor</span><span class="o">::</span><span class="n">Magenta</span>
<span class="p">);</span>
</code></pre></div>
Итоговый код функции будет таким:
<div class="highlight"><pre><span></span><code><span class="c1">// Render Debug info</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ShowDebugInfo</span><span class="p">(</span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="n">YPos</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Log Text</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Log</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Drawing string in right upper corner with offset of 50 from right and 1 letter(YSize) from top</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">50.0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">Log</span><span class="p">,</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// Make Rectangle around text</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// upper point</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// lower point</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawDebugCanvas2DBox</span><span class="p">(</span><span class="n">DebugCanvas</span><span class="p">,</span><span class="w"> </span><span class="n">FBox2D</span><span class="p">{</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">,</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">LineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">Draw2DLine</span><span class="p">(</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">FColor</span><span class="o">::</span><span class="n">Magenta</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">//GEngine-&gt;AddOnScreenDebugMessage(-1, 0.f, FColor::Red, FString::Printf(TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y));</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y)</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/0cd64202ee6e134bfa327a2bcafe5b2e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0cd64202ee6e134bfa327a2bcafe5b2e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0cd64202ee6e134bfa327a2bcafe5b2e.png" /></a></p>
<h3 id="draw3dline"><code>Draw3DLine</code></h3>
<p>Метод <code>Draw3DLine</code> позволяет нарисовать линию в 3D пространстве аналогичную той, которая нарисовалась бы при <code>Line Trace</code>.
<div class="highlight"><pre><span></span><code><span class="n">Draw3DLine</span><span class="p">(</span><span class="n">FVector</span><span class="p">{</span><span class="mf">1150.f</span><span class="p">,</span><span class="w"> </span><span class="mf">1350.f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="p">},</span><span class="w"> </span><span class="n">FVector</span><span class="p">{</span><span class="w"> </span><span class="mf">1150.f</span><span class="p">,</span><span class="w"> </span><span class="mf">950.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">50.f</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">);</span>
</code></pre></div>
Данный код проведет линию от одной точки до другой в 3D пространстве.</p>
<p><a class="glightbox" href="../images/41cbafbec4dd8772575c0edb747099f2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="41cbafbec4dd8772575c0edb747099f2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/41cbafbec4dd8772575c0edb747099f2.png" /></a></p>
<p>Координаты, которые я использовал для отрисовки линии, взяты напрямую от двух синих кубиков на сцене. Линия проводится между ними и отображается в 3D пространстве, отвязанном от <code>HUD</code>.</p>
<h2 id="hud">Взаимодействие с элементами <code>HUD</code></h2>
<p>Поскольку каждый раз вбивать в консоль команду <code>showdebug</code> - весьма утомительно, а система <code>HUD</code> позволяет создание интерактивной геометрии, предлагаю сделать кнопку, по нажатию которой показывалась бы отладочная информация.</p>
<p>Кнопку эту мы будем показывать  как в основном холсте отрисовки, то есть в методе <code>DrawHUD</code>, так и в холсте отладки. Поэтому нам понадобится отдельный метод, в котором будет осуществлятсья отрисовка кнопки.</p>
<p>Добавляем методы.
<div class="highlight"><pre><span></span><code><span class="c1">// will draw clickable button that execute console command &quot;showdebug&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">DrawShowDebugButton</span><span class="p">();</span>
<span class="c1">// begin play</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">// triggered once hitbox click</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">NotifyHitBoxClick</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">BoxName</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">// main hud update loop</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawHUD</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
</code></pre></div>
Помимо отрисовки, нужно осуществить привязку <code>HitBox</code> к кнопке, это делается через текстовые метки типа <code>FName</code>.
Задаем соответствующую константу. Лучше бы сделать ее <code>static</code>, но это немного запутает код из-за особенностей инициализации <code>static const</code> переменных.
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ShowDebug&quot;</span><span class="p">);</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/106e6f19dd5bbcf3b55ef02290e6720f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="106e6f19dd5bbcf3b55ef02290e6720f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/106e6f19dd5bbcf3b55ef02290e6720f.png" /></a></p>
<p>Система <code>HitBox</code> не работает сама по себе. Для начала надо. чтобы класс <code>HUD</code> начал получать пользовательский ввод. Далее необходимо, чтобы у пользовательского ввода был включен парметр захвата событий клика.</p>
<p>Используем событие <code>BeginPlay</code> для выполнения операций, включающих обработку кликов мыши.
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Enable input for the HUD actor. Otherwise Hit Boxes will not work.</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">EnableInput</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="p">);</span>
<span class="w">    </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">bEnableClickEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// this necessary!</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
</code></pre></div>
Код отрисовки кнопки выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// will draw clickable button that execute console command &quot;showdebug&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::DrawShowDebugButton</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Draw rectangle for our button</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">RectSize</span><span class="p">{</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">{</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">FHUDHitBox</span><span class="w"> </span><span class="o">*</span><span class="n">HitBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">FHUDHitBox</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">GetHitBoxWithName</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">));</span><span class="w"> </span><span class="c1">// *note  we don&#39;t need const here</span>
<span class="w">    </span><span class="c1">// Add Collision HitBox</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">HitBox</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">){</span>
<span class="w">        </span><span class="n">AddHitBox</span><span class="p">(</span><span class="n">RectPosition</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">,</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Change button color based on state</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Change Rect Color on mouse Hover from blue to gray, and clear hit state</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HitBoxesOver</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Gray</span><span class="p">;</span>
<span class="w">        </span><span class="n">HitBoxesOver</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span>
<span class="w">    </span><span class="c1">// Change Rect Color on Click to red, and clear hit state</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HitBoxHits</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">HitBox</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">;</span>
<span class="w">        </span><span class="n">HitBoxHits</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">HitBox</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">ButtonColor</span><span class="p">,</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">ButtonText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Show Debug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ButtonText</span><span class="p">);</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">{</span>
<span class="w">        </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">RectPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="c1">// draw text in center</span>
<span class="w">        </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">RectPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">ButtonText</span><span class="p">,</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
Его надо вызвать как в методе <code>DrawHUD</code>, так и в методе <code>ShowDebugInfo</code>.</p>
<p><a class="glightbox" href="../images/f59e887848ba34e39c3c02289123293d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f59e887848ba34e39c3c02289123293d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f59e887848ba34e39c3c02289123293d.png" /></a></p>
<p>Данный код нарисует синюю кнопку.</p>
<p><a class="glightbox" href="../images/30267673dc78346a8151e6058dd77392.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="30267673dc78346a8151e6058dd77392.png" auto_="auto;" display="block;" margin:="margin:" src="../images/30267673dc78346a8151e6058dd77392.png" /></a></p>
<p>При наведении мыши на эту кнопку она будет становиться серой.</p>
<p><a class="glightbox" href="../images/1375a6f7c85c435d1f2fc7e299ca536c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1375a6f7c85c435d1f2fc7e299ca536c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1375a6f7c85c435d1f2fc7e299ca536c.png" /></a></p>
<p>При клике она будет красной.</p>
<p><a class="glightbox" href="../images/24d810185eb4f92d9f416554f5ec26b8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="24d810185eb4f92d9f416554f5ec26b8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/24d810185eb4f92d9f416554f5ec26b8.png" /></a></p>
<p>Теперь нужен обработчик <code>HitBox'а</code>. В качестве обработчика выступает метод <code>NotifyHitBoxClick</code>, в котором я запускаю консольную команду <code>showdebug</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// triggered once hitbox click</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::NotifyHitBoxClick</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">BoxName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Process HitBoxes</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BoxName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] ShowDebug HitBox Clicked&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="c1">// run console command on owner</span>
<span class="w">        </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">ConsoleCommand</span><span class="p">(</span><span class="s">&quot;showdebug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">NotifyHitBoxClick</span><span class="p">(</span><span class="n">BoxName</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
</code></pre></div>
Этот код при нажатии сгенерирует текст в консоль и переключит режим <code>HUD</code>.</p>
<p><a class="glightbox" href="../images/3cb838ff3bb7db0c0979dd6fc4b4c531.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3cb838ff3bb7db0c0979dd6fc4b4c531.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3cb838ff3bb7db0c0979dd6fc4b4c531.png" /></a></p>
<h2 id="_4">Показ цифр урона</h2>
<p><code>HUD</code> можно использовать, чтобы показывать цифры урона, нанесенные игровому персонажу.</p>
<p>Делается это элементарно. Предлагаю усложнить и выводить урон не над одним персонажем, а над несколькими.</p>
<p>Для начала нам нужен список персонажей или акторов, над которыми мы будем выводить цифры урона.Так-же нужен способ добавлять персонажей в этот список.</p>
<h3 id="uinterface">Добавляем <code>UInterface</code></h3>
<p>Решить эти проблемы поможет интерфейс, он позволит обмениваться данными с классом <code>HUD'а</code> без приведения типа.</p>
<p>Идем в <code>Tools-&gt;New C++ Class -&gt; Unreal Interface</code>.</p>
<p><a class="glightbox" href="../images/3bd43b6b2477c519d3bb1cceeca5e0c3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3bd43b6b2477c519d3bb1cceeca5e0c3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3bd43b6b2477c519d3bb1cceeca5e0c3.png" /></a></p>
<p>Назовем интерфейс <code>HudDamageInterface</code>.</p>
<p><a class="glightbox" href="../images/d892f13d67b8fc3b2f3792da1f5b4fe8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d892f13d67b8fc3b2f3792da1f5b4fe8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d892f13d67b8fc3b2f3792da1f5b4fe8.png" /></a></p>
<p>В код интерфейса добавляем всего один метод, без реализации, это <code>iShowHUDDamage</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// This class does not need to be modified.</span>
<span class="n">UINTERFACE</span><span class="p">(</span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UHudDamageInterface</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Interface for AInfoHUD class to render damage numbers</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">IHudDamageInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Add interface functions to this class. This is the class that will be inherited to implement this interface.</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Will render damage number on hud</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HudDamageInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iShowHUDDamage</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// bluepritable interfaces don&#39;t need body or realisation</span>
<span class="p">};</span>
</code></pre></div>
Метод <code>iShowHUDDamage</code> будет отправлять в <code>HUD</code> указатель на <code>AActor</code>, а так-же количество урона и отступ в пикселях, используемый для отрисовки цифр.</p>
<p>Интерфейс, через множественное наследование, надо добавить к нашему классу <code>AInfoHUD</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HudDamageInterface.h&quot;</span><span class="c1"> // Damage Interface</span>
<span class="c1">//...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">AHUD</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IHudDamageInterface</span>
<span class="p">{}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/e9e0e8fdc62a8ada6bd5dec055cbdf24.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e9e0e8fdc62a8ada6bd5dec055cbdf24.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e9e0e8fdc62a8ada6bd5dec055cbdf24.png" /></a></p>
<p>Теперь надо реализовать метод <code>iShowHUDDamage</code> в классе <code>HUD</code>.
Поскольку это метод интерфейса, его реализация включает разделение на описание и реализацию. Метод описания это просто <code>iShowHUDDamage</code>, реализации у этого метода быть не должно. Так-же данный метод должен быть <code>UFUNCTION</code>.
Метод реализации имеет дополнение <code>_Implementation</code>, в нашем случае это <code>iShowHUDDamage_Implementation</code>. В методе реализации должен идти код, вызываемый интерфейсом.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// This struct will hold actor and it&#39;s damage</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FActorDamageInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">AActor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// offset of damage number from actor&#39;s middle</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FActorDamageInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of the actors taht will be used to render damage numbers</span>
<span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HudDamageInterface&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">iShowHUDDamage</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">iShowHUDDamage_Implementation</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::iShowHUDDamage_Implementation</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD]&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// add actor to list</span>
<span class="w">    </span><span class="n">ActorsToShowDamage</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="p">{</span>
<span class="w">        </span><span class="n">ForActor</span><span class="p">,</span>
<span class="w">        </span><span class="n">DamageAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">Offset</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/0a0afc406078f92d3016400999d83f8f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0a0afc406078f92d3016400999d83f8f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0a0afc406078f92d3016400999d83f8f.png" /></a></p>
<p>Для сохранения информации о <code>Actor'е</code>, для которого надо отрисовать цифры урона, была создана структура  <code>FActorDamageInfo</code>. Данная структура содержит указатель на <code>Actor</code> и информацию о цифрах, которые на нем необходимо отрисовать, а так-же кое какие дополнительные поля, например поле отступа.</p>
<p>В класс <code>AInfoHUD</code> был добавлен массив <code>TArray&lt;FActorDamageInfo&gt;</code>, позволяющий хранить экземпляры структуры <code>FActorDamageInfo</code>, поскольку информацию про урон планируется показывать не на одном <code>Actor'е</code>, а на нескольких.</p>
<p>Реализация интерфейса <code>iShowHUDDamage_Implementation</code> позволяет помещать информацию об отображаемом на персонаже, в массив.</p>
<h3 id="_5">Добавляем отрисовку</h3>
<p>Теперь можно переходить к отрисовке.</p>
<p>Поскольку цифры урона планируется отображать на персонажах в 3D пространстве, придется проецировать это самое 3D пространство на пространство <code>HUD</code>. Для проецирования координат в классе <code>AHUD</code> есть методы:
<div class="highlight"><pre><span></span><code><span class="cm">/** Transforms a 3D world-space vector into 2D screen coordinates</span>
<span class="cm"> * @param Location          The world-space position to transform</span>
<span class="cm"> * @param bClampToZeroPlane If true, 2D screen coordinates behind the viewing plane (-Z) will have Z set to 0 (leaving X and Y alone)</span>
<span class="cm"> * @return The transformed vector</span>
<span class="cm"> */</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HUD</span><span class="p">)</span>
<span class="n">FVector</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">FVector</span><span class="w"> </span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bClampToZeroPlane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="cm">/** Transforms a 2D screen location into a 3D location and direction */</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HUD</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">Deproject</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">ScreenX</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">ScreenY</span><span class="p">,</span><span class="w"> </span><span class="n">FVector</span><span class="o">&amp;</span><span class="w"> </span><span class="n">WorldPosition</span><span class="p">,</span><span class="w"> </span><span class="n">FVector</span><span class="o">&amp;</span><span class="w"> </span><span class="n">WorldDirection</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</code></pre></div>
Метод <code>Project</code> проецирует координату в 3D пространстве в пространство <code>HUD'а</code>. Его я и использую.</p>
<p>Для проверки я написал такой код:
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip empty</span>
<span class="w">    </span><span class="c1">// project actor location to HUD</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">HudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Drawing string on desired actor</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;DAMAGE&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">HudPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">HudPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
Он будет отрисовывать слово <code>DAMAGE</code> на каждом <code>Actor'е</code> из списка <code>ActorsToShowDamage</code>.
Чтобы добавить <code>Actor</code> в этот список используем метод интерфейса <code>iShowHUDDamage</code> в <code>blueprint</code> коде нашего <code>BP_ThirdPersonCharacter</code>, по событию <code>BeginPlay</code>.</p>
<p><a class="glightbox" href="../images/6200b5d8cacff4c221172efe078377dc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6200b5d8cacff4c221172efe078377dc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6200b5d8cacff4c221172efe078377dc.png" /></a></p>
<p>Если скомпилировать и запустить код, то мы увидим, как текст <code>DAMAGE</code> отрисовывается по центру игрового персонажа.</p>
<p><a class="glightbox" href="../images/3a98545544dc42e5db27ab01da201546.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3a98545544dc42e5db27ab01da201546.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3a98545544dc42e5db27ab01da201546.png" /></a></p>
<p>Разумеется, такое расположение текста нас не устраивает. Используем <code>Offset</code> для более тонкой настройки позиции.
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip empty</span>
<span class="w">    </span><span class="c1">// project actor location to HUD</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// add damage signs &quot;+&quot; and &quot;-&quot; depending on damage value</span>
<span class="w">    </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">DamageText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">        </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot; + %d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">))</span>
<span class="w">        </span><span class="o">:</span>
<span class="w">        </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot; - %d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// show positive damage with green color, negative damage with red color</span>
<span class="w">    </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">    </span><span class="n">FColor</span><span class="w"> </span><span class="n">DamageColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">        </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#00ff00ff&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Green RGBA for positive damage</span>
<span class="w">        </span><span class="o">:</span>
<span class="w">        </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#ff0000ff&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Red RGBA</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">{</span>
<span class="w">        </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
<span class="w">        </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="c1">// invert Y to move text Upper, not Lower</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// Drawing string on desired actor</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="o">*</span><span class="n">DamageText</span><span class="p">,</span><span class="w"> </span><span class="n">DamageColor</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
Я решил добавить еще и изменение цвета урона, в зависимости от того, больше нуля он или меньше нуля.</p>
<p><a class="glightbox" href="../images/0155e3c22b4e6544cd0b06dd50baddd4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0155e3c22b4e6544cd0b06dd50baddd4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0155e3c22b4e6544cd0b06dd50baddd4.png" /></a></p>
<p><a class="glightbox" href="../images/4c404e5d4f843a0f2b79a90664acef6a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4c404e5d4f843a0f2b79a90664acef6a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4c404e5d4f843a0f2b79a90664acef6a.png" /></a></p>
<p><a class="glightbox" href="../images/0d50e07c454e3e9e8d2e030468d399ca.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0d50e07c454e3e9e8d2e030468d399ca.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0d50e07c454e3e9e8d2e030468d399ca.png" /></a></p>
<p><a class="glightbox" href="../images/9d5b851dfeea7df190a1810dc77a5146.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9d5b851dfeea7df190a1810dc77a5146.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9d5b851dfeea7df190a1810dc77a5146.png" /></a></p>
<p>Теперь надо заставить цифры урона подниматься наверх и, как-бы "расстворяться".</p>
<p>Для этого я заранее задумал два параметра в структуре <code>FActorDamageInfo</code>. Это <code>Height</code> и <code>Opacity</code>.</p>
<p><a class="glightbox" href="../images/0c665b5c27ccefddbee5c80e04f786ae.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0c665b5c27ccefddbee5c80e04f786ae.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0c665b5c27ccefddbee5c80e04f786ae.png" /></a></p>
<p>Каждый цикл отрисовки будем прибавлять к значению <code>Height</code> по 1 пикселю. Так-же будем менять прозрачность. После того, как прозрачность достигнет максимума в <code>255</code> мы удалим элемент массива.</p>
<p>Поскольку массивы <code>TArray</code> не умеют просто так удалять элементы структур, в структуру <code>FActorDamageInfo</code> надо добавить перегрузку оператора <code>==</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// This struct will hold actor and it&#39;s damage</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FActorDamageInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">AActor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// offset of damage number from actor&#39;s middle</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// oveload operator == because without it functions like TArray::IndexOfByKey will not work</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FActorDamageInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Actor</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Offset</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Opacity</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
Далее реализуем механику обновления.
<div class="highlight"><pre><span></span><code><span class="c1">// main hud update loop</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::DrawHUD</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">DrawHUD</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">DrawShowDebugButton</span><span class="p">();</span><span class="w"> </span><span class="c1">// show debug button</span>
<span class="w">    </span><span class="c1">//Draw3DLine(FVector{ 1150.f, 1350.f, 50.f }, FVector{ 1150.f, 950.0f, 50.f }, FColor::Red);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip empty</span>
<span class="w">        </span><span class="c1">// project actor location to HUD</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// add damage signs &quot;+&quot; and &quot;-&quot; depending on damage value</span>
<span class="w">        </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">DamageText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;+%d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">))</span>
<span class="w">            </span><span class="o">:</span>
<span class="w">            </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;-%d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// show positive damage with green color, negative damage with red color</span>
<span class="w">        </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">        </span><span class="n">FColor</span><span class="w"> </span><span class="n">DamageColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#00ff00ff&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Green RGBA for positive damage</span>
<span class="w">            </span><span class="o">:</span>
<span class="w">            </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#ff0000ff&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Red RGBA</span>
<span class="w">        </span><span class="n">DamageColor</span><span class="p">.</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="o">&lt;</span><span class="n">uint8</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="p">);</span>
<span class="w">        </span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">//change text opacity each screen update</span>
<span class="w">        </span><span class="c1">// fully transparent items should be removed from array</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] removing item&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="n">ActorsToShowDamage</span><span class="p">.</span><span class="n">RemoveSingle</span><span class="p">(</span><span class="n">Info</span><span class="p">);</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">{</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span><span class="w"> </span><span class="c1">// invert Y to move text Upper, not Lower</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">Info</span><span class="p">.</span><span class="n">Height</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// move text by 5 pixels each screen update</span>
<span class="w">        </span><span class="c1">// Drawing string on desired actor</span>
<span class="w">        </span><span class="n">DrawText</span><span class="p">(</span><span class="o">*</span><span class="n">DamageText</span><span class="p">,</span><span class="w"> </span><span class="n">DamageColor</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Чтобы изменять информацию элементов массива прямо в цикле я использовал инициализацию по ссылке  <code>FActorDamageInfo&amp; Info</code>. Это позволяет делать, например, так: <code>Info.Height += 3;</code>. Удаление элементво массива осуществляется методом <code>ActorsToShowDamage.RemoveSingle(Info);</code>.
Как это работает? Появляющиеся над персонажем цифры идут вверх и исчезают. Мы можем показать не одну цифру, а несколько ибо функционал позволяет добавлять одного и того-же <code>Actor'а</code> в массив.</p>
<p><a class="glightbox" href="../images/15fac54577fb8a57f652cb44fd7afb2b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="15fac54577fb8a57f652cb44fd7afb2b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/15fac54577fb8a57f652cb44fd7afb2b.png" /></a></p>
<p><a class="glightbox" href="../images/ebcfa5080e6c59bb436f7f75ee290b12.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ebcfa5080e6c59bb436f7f75ee290b12.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ebcfa5080e6c59bb436f7f75ee290b12.png" /></a></p>
<p>Таким образом мы реализовали "классическое" отображение цифор урона над персонажем.</p>
<h3 id="_6">Код</h3>
<p>Приведу полный код классов на данном этапе.</p>
<p><a class="glightbox" href="../images/7fd7c395b378f9133889880fb43cbd29.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7fd7c395b378f9133889880fb43cbd29.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7fd7c395b378f9133889880fb43cbd29.png" /></a></p>
<p>Файл <code>HudDamageInterface.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/Interface.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HudDamageInterface.generated.h&quot;</span>
<span class="c1">// This class does not need to be modified.</span>
<span class="n">UINTERFACE</span><span class="p">(</span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UHudDamageInterface</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Interface for AInfoHUD class to render damage numbers</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">IHudDamageInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Add interface functions to this class. This is the class that will be inherited to implement this interface.</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Will render damage number on hud</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HudDamageInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iShowHUDDamage</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// bluepritable interfaces don&#39;t need body or realisation</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>InfoHUD.h</code>:
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/HUD.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HudDamageInterface.h&quot;</span><span class="c1"> // Damage Interface</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/GameplayStatics.h&quot;</span><span class="c1"> // GetPlayerController</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InfoHUD.generated.h&quot;</span>
<span class="c1">// This struct will hold actor and it&#39;s damage</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FActorDamageInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">AActor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// offset of damage number from actor&#39;s middle</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// oveload operator == because without it functions like TArray::IndexOfByKey will not work</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FActorDamageInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Actor</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Offset</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Opacity</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Hud class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">AHUD</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IHudDamageInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ShowDebug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FActorDamageInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of the actors taht will be used to render damage numbers</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">AInfoHUD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HudDamageInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iShowHUDDamage</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">iShowHUDDamage_Implementation</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will draw clickable button that execute console command &quot;showdebug&quot;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawShowDebugButton</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// begin play</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// triggered once hitbox click</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">NotifyHitBoxClick</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">BoxName</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// main hud update loop</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawHUD</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to control debug info</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShowDebug</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">DebugType</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// debug hud update loop</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"> </span><span class="c1">// will render debug info</span>
<span class="w">    </span><span class="c1">// Will return Viewport Size</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="nf">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Local Player Ref</span>
<span class="w">    </span><span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="nf">GetLocalPlayer</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>InfoHUD.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InfoHUD.h&quot;</span>
<span class="c1">// Constructor</span>
<span class="n">AInfoHUD</span><span class="o">::</span><span class="n">AInfoHUD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Enable input for the HUD actor. Otherwise Hit Boxes will not work.</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">EnableInput</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="p">);</span>
<span class="w">    </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">bEnableClickEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// this necessary!</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">iShowHUDDamage_Implementation</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD]&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// add actor to list</span>
<span class="w">    </span><span class="n">ActorsToShowDamage</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="p">{</span>
<span class="w">        </span><span class="n">ForActor</span><span class="p">,</span>
<span class="w">        </span><span class="n">DamageAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">Offset</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
<span class="c1">// will draw clickable button that execute console command &quot;showdebug&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawShowDebugButton</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Draw rectangle for our button</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">RectSize</span><span class="p">{</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">{</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">FHUDHitBox</span><span class="w"> </span><span class="o">*</span><span class="n">HitBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">FHUDHitBox</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">GetHitBoxWithName</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">));</span><span class="w"> </span><span class="c1">// *note  we don&#39;t need const here</span>
<span class="w">    </span><span class="c1">// Add Collision HitBox</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">HitBox</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">){</span>
<span class="w">        </span><span class="n">AddHitBox</span><span class="p">(</span><span class="n">RectPosition</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">,</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Change button color based on state</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Change Rect Color on mouse Hover from blue to gray, and clear hit state</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HitBoxesOver</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Gray</span><span class="p">;</span>
<span class="w">        </span><span class="n">HitBoxesOver</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span>
<span class="w">    </span><span class="c1">// Change Rect Color on Click to red, and clear hit state</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HitBoxHits</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">HitBox</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">;</span>
<span class="w">        </span><span class="n">HitBoxHits</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">HitBox</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">ButtonColor</span><span class="p">,</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">ButtonText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Show Debug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ButtonText</span><span class="p">);</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">{</span>
<span class="w">        </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">RectPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="c1">// draw text in center</span>
<span class="w">        </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">RectPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">ButtonText</span><span class="p">,</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="p">}</span>
<span class="c1">// triggered once hitbox click</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">NotifyHitBoxClick</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">BoxName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Process HitBoxes</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BoxName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] ShowDebug HitBox Clicked&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="c1">// run console command on owner</span>
<span class="w">        </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">ConsoleCommand</span><span class="p">(</span><span class="s">&quot;showdebug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">NotifyHitBoxClick</span><span class="p">(</span><span class="n">BoxName</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// main hud update loop</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawHUD</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">DrawHUD</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">DrawShowDebugButton</span><span class="p">();</span><span class="w"> </span><span class="c1">// show debug button</span>
<span class="w">    </span><span class="c1">//Draw3DLine(FVector{ 1150.f, 1350.f, 50.f }, FVector{ 1150.f, 950.0f, 50.f }, FColor::Red);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip empty</span>
<span class="w">        </span><span class="c1">// project actor location to HUD</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// add damage signs &quot;+&quot; and &quot;-&quot; depending on damage value</span>
<span class="w">        </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">DamageText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;+%d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">))</span>
<span class="w">            </span><span class="o">:</span>
<span class="w">            </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;-%d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// show positive damage with green color, negative damage with red color</span>
<span class="w">        </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">        </span><span class="n">FColor</span><span class="w"> </span><span class="n">DamageColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#00ff00ff&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Green RGBA for positive damage</span>
<span class="w">            </span><span class="o">:</span>
<span class="w">            </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#ff0000ff&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Red RGBA</span>
<span class="w">        </span><span class="n">DamageColor</span><span class="p">.</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="o">&lt;</span><span class="n">uint8</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="p">);</span>
<span class="w">        </span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">//change text opacity each screen update</span>
<span class="w">        </span><span class="c1">// fully transparent items should be removed from array</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] removing item&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="n">ActorsToShowDamage</span><span class="p">.</span><span class="n">RemoveSingle</span><span class="p">(</span><span class="n">Info</span><span class="p">);</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">{</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span><span class="w"> </span><span class="c1">// invert Y to move text Upper, not Lower</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">Info</span><span class="p">.</span><span class="n">Height</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// move text by 5 pixels each screen update</span>
<span class="w">        </span><span class="c1">// Drawing string on desired actor</span>
<span class="w">        </span><span class="n">DrawText</span><span class="p">(</span><span class="o">*</span><span class="n">DamageText</span><span class="p">,</span><span class="w"> </span><span class="n">DamageColor</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// For Console parameters</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ShowDebug</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">DebugType</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ShowDebug</span><span class="p">(</span><span class="n">DebugType</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// Render Debug info</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ShowDebugInfo</span><span class="p">(</span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="n">YPos</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">DrawShowDebugButton</span><span class="p">();</span><span class="w"> </span><span class="c1">// show debug button</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Log Text</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] Viewport: Width = %f, Height = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Log</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Drawing string in right upper corner with offset of 50 from right and 1 letter(YSize) from top</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">50.0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">Log</span><span class="p">,</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// Make Rectangle around text</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// upper point</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// lower point</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawDebugCanvas2DBox</span><span class="p">(</span><span class="n">DebugCanvas</span><span class="p">,</span><span class="w"> </span><span class="n">FBox2D</span><span class="p">{</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">,</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">LineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">Draw2DLine</span><span class="p">(</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">FColor</span><span class="o">::</span><span class="n">Magenta</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">//GEngine-&gt;AddOnScreenDebugMessage(-1, 0.f, FColor::Red, FString::Printf(TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y));</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y)</span>
<span class="p">}</span>
<span class="c1">// Viewport Size</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">GetViewportSize</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XVSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">YVSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// viewport size</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">){</span>
<span class="w">        </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">GetViewportSize</span><span class="p">(</span><span class="n">XVSize</span><span class="p">,</span><span class="w"> </span><span class="n">YVSize</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="p">{};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">XVSize</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">YVSize</span><span class="p">};</span>
<span class="p">}</span>
<span class="c1">// Local Player Ref</span>
<span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">GetLocalPlayer</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GetOwningPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">ULocalPlayer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetOwningPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Player</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/9f77885513fc89a300f97e5ea78de279.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9f77885513fc89a300f97e5ea78de279.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9f77885513fc89a300f97e5ea78de279.png" /></a></p>
<h2 id="_7">Отрисовка полосок здоровья</h2>
<p>В РТС играх у игрока есть возможность показать или скрыть полоски здоровья над нпс. В <code>Warcraft 3</code> это делается клавишей <code>Alt</code>.</p>
<p><a class="glightbox" href="../images/5b4060663b048fcdce37fddeb32e0b03.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5b4060663b048fcdce37fddeb32e0b03.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5b4060663b048fcdce37fddeb32e0b03.png" /></a></p>
<p>Предлагаю реализовать схожую механику.</p>
<h3 id="uinterface_1">Добавляем <code>UInterface</code> для персонажа</h3>
<p><code>HUD</code> должен откуда-то знать, сколько у того или иного персонажа здоровья в данный момент. Предлагаю для этих целей использовать интерфейс, потому что он позволяет работать с любыми классами <code>Actor'ов</code>, а не только с <code>ACharacter</code>. Вдруг мы захотим полоски здоровья показать на зданиях, например.</p>
<p>Идем <code>Tools -&gt; New C++ Class -&gt; Unreal Interface</code>.</p>
<p><a class="glightbox" href="../images/bb818d082e592d279ce85db7255dffd6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bb818d082e592d279ce85db7255dffd6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bb818d082e592d279ce85db7255dffd6.png" /></a></p>
<p>Называем <code>ActorHUDInterface</code>.</p>
<p><a class="glightbox" href="../images/61ec9e2fbe88ea1ab7c3916c029a564d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="61ec9e2fbe88ea1ab7c3916c029a564d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/61ec9e2fbe88ea1ab7c3916c029a564d.png" /></a></p>
<p>После каждого добавления файла делаем <code>Tools-&gt;Refresh Visual Studio 2022 Project</code>, чтобы добавленные файлы отобразились в <code>Solution Explorer</code>.</p>
<p><a class="glightbox" href="../images/6e2e623aad93cca1ec03076b55667790.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6e2e623aad93cca1ec03076b55667790.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6e2e623aad93cca1ec03076b55667790.png" /></a></p>
<p>В интерфейсе нам нужен метод для получения уровня здоровья персонажа, позиции полоски и состояния видимости / невидимости полоски.</p>
<p>Поскольку параметров, которые могут понадобиться системе <code>HUD</code> в будущем может быть крайне много - предлагаю создать отдельную структуру, которую затем запрашивать у класса персонажа через интерфейс.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/Interface.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ActorHUDInterface.generated.h&quot;</span>
<span class="c1">// This class does not need to be modified.</span>
<span class="n">UINTERFACE</span><span class="p">(</span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UActorHUDInterface</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="p">};</span>
<span class="c1">// Struct that contains Hud related character info</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ActorHudInterface&quot;</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FHudActorInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentHealthAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// HP Bar Position</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthBarPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// HP Bar Size</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthBarSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">100.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">25.0f</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// oveload operator == because without it functions like TArray::IndexOfByKey will not work</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FHudActorInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">CurrentHealthAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">CurrentHealthAmount</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">HealthBarPosition</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Hud Interface to inteeract with the character</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">IActorHUDInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Add interface functions to this class. This is the class that will be inherited to implement this interface.</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// This interface function allow</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintImplementableEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ActorHudInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iGetHudActorInfo</span><span class="p">(</span><span class="n">FHudActorInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
Я добавил структуру <code>FHudActorInfo</code>, которая хранит всю информацию <code>Actor'а</code>. При желании ее легко можно будет расширить. Метод <code>iGetHudActorInfo</code> предполагается переопределить внутри класса персонажа.</p>
<p>После компиляции мы сможем добавить этот интерфейс к классу нашего персонажа <code>BP_ThirdPersonCharacter</code>.</p>
<p><a class="glightbox" href="../images/bf0525d58e1d39489d156460a8d6085c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bf0525d58e1d39489d156460a8d6085c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bf0525d58e1d39489d156460a8d6085c.png" /></a></p>
<p><a class="glightbox" href="../images/85efa57627948cf302138efe481f7616.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="85efa57627948cf302138efe481f7616.png" auto_="auto;" display="block;" margin:="margin:" src="../images/85efa57627948cf302138efe481f7616.png" /></a></p>
<p>После добавления интерфейса необходимо переопределить функцию <code>iGetHudActorInfo</code>. Идем в список функций и ищем ее там.</p>
<p><a class="glightbox" href="../images/427e56675499b27aa43c7e5fc4d849f7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="427e56675499b27aa43c7e5fc4d849f7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/427e56675499b27aa43c7e5fc4d849f7.png" /></a></p>
<p>Добавляем.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/1f404e249024e9b6d2dadf0b72f03f99.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1f404e249024e9b6d2dadf0b72f03f99.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1f404e249024e9b6d2dadf0b72f03f99.png" /></a></p>
<p>В этой функции мы должны вернуть значение здоровья персонажа, а так-же позицию бара здоровья и его размер.</p>
<h3 id="_8">Добавляем отрисовку</h3>
<p>Для начала добавим отрисовку просто двух полосок. Красная для здоровья и черная обводка для нее. В качестве элементов отрисовки можно использовать <code>DrawRect</code>, но на <code>Rect</code> не получится отобразить текстуру. А для полосок здоровья было бы желательно иметь возможность применения текстуры, на будущее. Поэтому используем <code>FCanvasTileItem</code>.
Код отрисовки полосок получился таким:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ActorHUDInterface.h&quot;</span><span class="c1"> // Actor HUD Interface</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/Canvas.h&quot;</span><span class="c1"> // canvas</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CanvasItem.h&quot;</span><span class="c1"> // FCanvasTileItem</span>
<span class="c1">//...</span>
<span class="c1">// iterate thru all actors that implement UActorHUDInterface</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">FoundActors</span><span class="p">;</span>
<span class="n">UGameplayStatics</span><span class="o">::</span><span class="n">GetAllActorsWithInterface</span><span class="p">(</span><span class="n">GetWorld</span><span class="p">(),</span><span class="w"> </span><span class="n">UActorHUDInterface</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">FoundActors</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">FoundActors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get ActorInfo from interface</span>
<span class="w">    </span><span class="n">FHudActorInfo</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">;</span>
<span class="w">    </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iGetHudActorInfo</span><span class="p">(</span><span class="n">Actor</span><span class="p">,</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[HUD] fval =  %f&quot;), ActorInfo.HealthBarSize.X);</span>
<span class="w">    </span><span class="c1">// project actor location to HUD</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorWorldLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">ActorWorldLocation</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Make Background</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BGLocation</span><span class="p">{</span>
<span class="w">        </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="c1">// put bar in the middle</span>
<span class="w">        </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">BGColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">FromSRGBColor</span><span class="p">(</span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#22222299&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// semi-transparent dark color</span>
<span class="w">    </span><span class="c1">// for bg element we will use CanvasTile, because it supports textures.</span>
<span class="w">    </span><span class="c1">// in case if in future we want to use this with texture.</span>
<span class="w">    </span><span class="n">FCanvasTileItem</span><span class="w"> </span><span class="nf">BGTile</span><span class="p">(</span><span class="n">BGLocation</span><span class="p">,</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">,</span><span class="w"> </span><span class="n">BGColor</span><span class="p">);</span>
<span class="w">    </span><span class="n">BGTile</span><span class="p">.</span><span class="n">BlendMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE_BLEND_Translucent</span><span class="p">;</span><span class="w"> </span><span class="c1">// this will enable transparency</span>
<span class="w">    </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">BGTile</span><span class="p">);</span><span class="w"> </span><span class="c1">// draw BG</span>
<span class="w">    </span><span class="c1">// Make Background</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthLineSize</span><span class="p">{</span>
<span class="w">            </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="p">,</span>
<span class="w">            </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealhtLineLocation</span><span class="p">{</span>
<span class="w">        </span><span class="n">BGLocation</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="n">BGLocation</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="c1">// - because we want to move health bar upper</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">HealhtLineColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">FromSRGBColor</span><span class="p">(</span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#FF0000FF&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// non-transparent red</span>
<span class="w">    </span><span class="c1">// for bg element we will use CanvasTile, because it supports textures.</span>
<span class="w">    </span><span class="c1">// in case if in future we want to use this with texture.</span>
<span class="w">    </span><span class="n">FCanvasTileItem</span><span class="w"> </span><span class="nf">HealthLineTile</span><span class="p">(</span><span class="n">HealhtLineLocation</span><span class="p">,</span><span class="w"> </span><span class="n">HealthLineSize</span><span class="p">,</span><span class="w"> </span><span class="n">HealhtLineColor</span><span class="p">);</span>
<span class="w">    </span><span class="n">HealthLineTile</span><span class="p">.</span><span class="n">BlendMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE_BLEND_Masked</span><span class="p">;</span><span class="w"> </span><span class="c1">// non transparent</span>
<span class="w">    </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">HealthLineTile</span><span class="p">);</span><span class="w"> </span><span class="c1">// draw</span>
<span class="p">}</span>
</code></pre></div></p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/1f404e249024e9b6d2dadf0b72f03f99.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1f404e249024e9b6d2dadf0b72f03f99.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1f404e249024e9b6d2dadf0b72f03f99.png" /></a></p>
<p><a class="glightbox" href="../images/d7efbad92f7a08fbd3690e2d05a5d1b3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d7efbad92f7a08fbd3690e2d05a5d1b3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d7efbad92f7a08fbd3690e2d05a5d1b3.png" /></a></p>
<p>В моем коде нет оптимизации, метод <code>GetAllActorsWithInterface</code> очень не оптимален и вызывать его каждый фрейм обновления экрана не стоит даже в с++ коде.</p>
<p>Так-же я не реализовал зависимость полоски от % оставшегося здоровья.</p>
<p>Для оптимизации я предлагаю вынести функционал сканирования персонажей в отдельную функцию. А список персонажей поместить в массив.
<div class="highlight"><pre><span></span><code><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of actors that implement ActorHUDInterface</span>
<span class="c1">//...</span>
<span class="c1">// will scan for actors with that implement ActorHUDInterface</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ScanActorsWithHUDInterface</span><span class="p">();</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// will scan for actors with that implement ActorHUDInterface</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ScanActorsWithHUDInterface</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UGameplayStatics</span><span class="o">::</span><span class="n">GetAllActorsWithInterface</span><span class="p">(</span><span class="n">GetWorld</span><span class="p">(),</span><span class="w"> </span><span class="n">UActorHUDInterface</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/58b634f906eb4c2bfaca109aa3a11a98.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="58b634f906eb4c2bfaca109aa3a11a98.png" auto_="auto;" display="block;" margin:="margin:" src="../images/58b634f906eb4c2bfaca109aa3a11a98.png" /></a></p>
<p>Теперь из <code>blueprint</code> кода можно будет вызвать функцию <code>ScanActorsWithHUDInterface</code>, чтобы просканировать сцену на персонажей с интерфейсом <code>ActorHUDInterface</code>.</p>
<p><a class="glightbox" href="../images/ccede117d4425d29a716d12b1845e4e5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ccede117d4425d29a716d12b1845e4e5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ccede117d4425d29a716d12b1845e4e5.png" /></a></p>
<p>Подправим код с учетом оптимизации, а так-же добавим изменение здоровья в %.
<div class="highlight"><pre><span></span><code><span class="c1">// iterate thru all actors that implement UActorHUDInterface</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get ActorInfo from interface</span>
<span class="w">    </span><span class="n">FHudActorInfo</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">;</span>
<span class="w">    </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iGetHudActorInfo</span><span class="p">(</span><span class="n">Actor</span><span class="p">,</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// project actor location to HUD</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorWorldLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">ActorWorldLocation</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Make Background</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BGLocation</span><span class="p">{</span>
<span class="w">        </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="c1">// put bar in the middle</span>
<span class="w">        </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">BGColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">FromSRGBColor</span><span class="p">(</span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#22222299&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// semi-transparent dark color</span>
<span class="w">    </span><span class="c1">// for bg element we will use CanvasTile, because it supports textures.</span>
<span class="w">    </span><span class="c1">// in case if in future we want to use this with texture.</span>
<span class="w">    </span><span class="n">FCanvasTileItem</span><span class="w"> </span><span class="nf">BGTile</span><span class="p">(</span><span class="n">BGLocation</span><span class="p">,</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">,</span><span class="w"> </span><span class="n">BGColor</span><span class="p">);</span>
<span class="w">    </span><span class="n">BGTile</span><span class="p">.</span><span class="n">BlendMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE_BLEND_Translucent</span><span class="p">;</span><span class="w"> </span><span class="c1">// this will enable transparency</span>
<span class="w">    </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">BGTile</span><span class="p">);</span><span class="w"> </span><span class="c1">// draw BG</span>
<span class="w">    </span><span class="c1">// Make Background</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// 1% of health line</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">HealtLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthLineSize</span><span class="p">{</span>
<span class="w">            </span><span class="n">HealtLine1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">FMath::Min</span><span class="p">(</span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">CurrentHealthAmount</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">            </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealhtLineLocation</span><span class="p">{</span>
<span class="w">        </span><span class="n">BGLocation</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="n">BGLocation</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">// - because we want to move health bar upper</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">HealhtLineColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">FromSRGBColor</span><span class="p">(</span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#FF0000FF&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// non-transparent red</span>
<span class="w">    </span><span class="c1">// for bg element we will use CanvasTile, because it supports textures.</span>
<span class="w">    </span><span class="c1">// in case if in future we want to use this with texture.</span>
<span class="w">    </span><span class="n">FCanvasTileItem</span><span class="w"> </span><span class="nf">HealthLineTile</span><span class="p">(</span><span class="n">HealhtLineLocation</span><span class="p">,</span><span class="w"> </span><span class="n">HealthLineSize</span><span class="p">,</span><span class="w"> </span><span class="n">HealhtLineColor</span><span class="p">);</span>
<span class="w">    </span><span class="n">HealthLineTile</span><span class="p">.</span><span class="n">BlendMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE_BLEND_Masked</span><span class="p">;</span><span class="w"> </span><span class="c1">// non transparent</span>
<span class="w">    </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">HealthLineTile</span><span class="p">);</span><span class="w"> </span><span class="c1">// draw</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/3ac831448f05698ac43c86acbc03e705.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3ac831448f05698ac43c86acbc03e705.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3ac831448f05698ac43c86acbc03e705.png" /></a></p>
<p><a class="glightbox" href="../images/9a299fe922132870d8844f227c25dd33.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9a299fe922132870d8844f227c25dd33.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9a299fe922132870d8844f227c25dd33.png" /></a></p>
<p>Для теста давайте добавим бар со здоровьем не только к нашему персонажу, но еще и к кубику в игровом мире.</p>
<p>Щелкаем на кубик в игровом мире, потом на кнопку <code>Add</code> в панели <code>Details</code>.</p>
<p><a class="glightbox" href="../images/51e2e1aa5f70928697a2e7db28dc1a97.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="51e2e1aa5f70928697a2e7db28dc1a97.png" auto_="auto;" display="block;" margin:="margin:" src="../images/51e2e1aa5f70928697a2e7db28dc1a97.png" /></a></p>
<p>Далее добавляем к кубику интерфейс.</p>
<p><a class="glightbox" href="../images/b555716763c82a59d94cb915641d32f2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b555716763c82a59d94cb915641d32f2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b555716763c82a59d94cb915641d32f2.png" /></a></p>
<p><a class="glightbox" href="../images/ef1a06a16b3bffc766602be0aa983230.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ef1a06a16b3bffc766602be0aa983230.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ef1a06a16b3bffc766602be0aa983230.png" /></a></p>
<p>Переопределяем функцию интерфейса.</p>
<p><a class="glightbox" href="../images/af07bbf314e14489ac657ef338f5fa39.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="af07bbf314e14489ac657ef338f5fa39.png" auto_="auto;" display="block;" margin:="margin:" src="../images/af07bbf314e14489ac657ef338f5fa39.png" /></a></p>
<p>После компиляции мы можем наблюдать как над кубиком появился бар со здоровьем.</p>
<p><a class="glightbox" href="../images/1879e44c55288bdb8bb53db60e363e1f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1879e44c55288bdb8bb53db60e363e1f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1879e44c55288bdb8bb53db60e363e1f.png" /></a></p>
<h3 id="_9">Механика скрытия и показа индикаторов</h3>
<p>Хм… Я забыл про механику скрытия и показа индикаторов здоровья.</p>
<p>Добавяем в класс <code>AInfoHUD</code> метод <code>ToggleHealthBars</code> и переменную <code>bHealthBarsVisible</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">bHealthBarsVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// allow show/hide health bars</span>
<span class="c1">// will show / hide health bars</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ToggleHealthBars</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">Show</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">){</span><span class="w"> </span><span class="n">bHealthBarsVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Show</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="c1">//.cpp</span>
<span class="c1">// don&#39;t render health bars if bHealthBarsVisible is false</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">bHealthBarsVisible</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/4e2947c6413003438982f179fbe1a1d6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4e2947c6413003438982f179fbe1a1d6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4e2947c6413003438982f179fbe1a1d6.png" /></a></p>
<p><a class="glightbox" href="../images/0509f0dc7abb64ed0c32048189a22096.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0509f0dc7abb64ed0c32048189a22096.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0509f0dc7abb64ed0c32048189a22096.png" /></a></p>
<p>Компилируем и в <code>blueprint</code> код добавляем вызов метода <code>ToggleHealthBars</code> по нажатию клавиши <code>Alt</code>.</p>
<p><a class="glightbox" href="../images/f7c89d2a6d93212e52cf3da4bc3c7b53.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f7c89d2a6d93212e52cf3da4bc3c7b53.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f7c89d2a6d93212e52cf3da4bc3c7b53.png" /></a></p>
<p><a class="glightbox" href="../images/35b6dd0d00cf22a08e5b4213297d5444.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="35b6dd0d00cf22a08e5b4213297d5444.png" auto_="auto;" display="block;" margin:="margin:" src="../images/35b6dd0d00cf22a08e5b4213297d5444.png" /></a></p>
<p><a class="glightbox" href="../images/d0c9b869864493e76fc5527ab06ff025.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d0c9b869864493e76fc5527ab06ff025.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d0c9b869864493e76fc5527ab06ff025.png" /></a></p>
<h3 id="_10">Код</h3>
<p>Приведу полный код классов на данном этапе.</p>
<p><a class="glightbox" href="../images/4e5f59f9f74a0992fbbc7f7472d279d3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4e5f59f9f74a0992fbbc7f7472d279d3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4e5f59f9f74a0992fbbc7f7472d279d3.png" /></a></p>
<p>Файл <code>ActorHUDInterface.h</code>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/Interface.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ActorHUDInterface.generated.h&quot;</span>
<span class="c1">// This class does not need to be modified.</span>
<span class="n">UINTERFACE</span><span class="p">(</span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UActorHUDInterface</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="p">};</span>
<span class="c1">// Struct that contains Hud related character info</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ActorHudInterface&quot;</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FHudActorInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentHealthAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// HP Bar Position</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthBarPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// HP Bar Size</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthBarSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">100.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">25.0f</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// oveload operator == because without it functions like TArray::IndexOfByKey will not work</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FHudActorInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">CurrentHealthAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">CurrentHealthAmount</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">HealthBarPosition</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Hud Interface to inteeract with the character</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">IActorHUDInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Add interface functions to this class. This is the class that will be inherited to implement this interface.</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// This interface function allow</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintImplementableEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ActorHudInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iGetHudActorInfo</span><span class="p">(</span><span class="n">FHudActorInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>HudDamageInterface.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/Interface.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HudDamageInterface.generated.h&quot;</span>
<span class="c1">// This class does not need to be modified.</span>
<span class="n">UINTERFACE</span><span class="p">(</span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UHudDamageInterface</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Interface for AInfoHUD class to render damage numbers</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">IHudDamageInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Add interface functions to this class. This is the class that will be inherited to implement this interface.</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Will render damage number on hud</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HudDamageInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iShowHUDDamage</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// bluepritable interfaces don&#39;t need body or realisation</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>InfoHUD.h</code>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/HUD.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HudDamageInterface.h&quot;</span><span class="c1"> // Damage Interface</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ActorHUDInterface.h&quot;</span><span class="c1"> // Actor HUD Interface</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/GameplayStatics.h&quot;</span><span class="c1"> // GetPlayerController</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/Canvas.h&quot;</span><span class="c1"> // canvas</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CanvasItem.h&quot;</span><span class="c1"> // FCanvasTileItem</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InfoHUD.generated.h&quot;</span>
<span class="c1">// This struct will hold actor and it&#39;s damage</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FActorDamageInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">AActor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// offset of damage number from actor&#39;s middle</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// oveload operator == because without it functions like TArray::IndexOfByKey will not work</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FActorDamageInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Actor</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Offset</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Opacity</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Hud class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">AHUD</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IHudDamageInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ShowDebug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bHealthBarsVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// allow show/hide health bars</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FActorDamageInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of the actors taht will be used to render damage numbers</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of actors that implement ActorHUDInterface</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">AInfoHUD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HudDamageInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iShowHUDDamage</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">iShowHUDDamage_Implementation</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will scan for actors with that implement ActorHUDInterface</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">ScanActorsWithHUDInterface</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will show / hide health bars</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ToggleHealthBars</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">Show</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">){</span><span class="w"> </span><span class="n">bHealthBarsVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Show</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// will draw health bars</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawHealthBars</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will draw clickable button that execute console command &quot;showdebug&quot;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawShowDebugButton</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will draw damage numbers</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawShowDamageNumbers</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// begin play</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// triggered once hitbox click</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">NotifyHitBoxClick</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">BoxName</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// main hud update loop</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawHUD</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to control debug info</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShowDebug</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">DebugType</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// debug hud update loop</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"> </span><span class="c1">// will render debug info</span>
<span class="w">    </span><span class="c1">// Will return Viewport Size</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="nf">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Local Player Ref</span>
<span class="w">    </span><span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="nf">GetLocalPlayer</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>InfoHUD.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InfoHUD.h&quot;</span>
<span class="c1">// Constructor</span>
<span class="n">AInfoHUD</span><span class="o">::</span><span class="n">AInfoHUD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Enable input for the HUD actor. Otherwise Hit Boxes will not work.</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">EnableInput</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="p">);</span>
<span class="w">    </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">bEnableClickEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// this necessary!</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">iShowHUDDamage_Implementation</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// add actor to list</span>
<span class="w">    </span><span class="n">ActorsToShowDamage</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="p">{</span>
<span class="w">        </span><span class="n">ForActor</span><span class="p">,</span>
<span class="w">        </span><span class="n">DamageAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">Offset</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
<span class="c1">// will draw clickable button that execute console command &quot;showdebug&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawShowDebugButton</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Draw rectangle for our button</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">RectSize</span><span class="p">{</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">{</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">FHUDHitBox</span><span class="w"> </span><span class="o">*</span><span class="n">HitBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">FHUDHitBox</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">GetHitBoxWithName</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">));</span><span class="w"> </span><span class="c1">// *note  we don&#39;t need const here</span>
<span class="w">    </span><span class="c1">// Add Collision HitBox</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">HitBox</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">){</span>
<span class="w">        </span><span class="n">AddHitBox</span><span class="p">(</span><span class="n">RectPosition</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">,</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Change button color based on state</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Change Rect Color on mouse Hover from blue to gray, and clear hit state</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HitBoxesOver</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Gray</span><span class="p">;</span>
<span class="w">        </span><span class="n">HitBoxesOver</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span>
<span class="w">    </span><span class="c1">// Change Rect Color on Click to red, and clear hit state</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HitBoxHits</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">HitBox</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">;</span>
<span class="w">        </span><span class="n">HitBoxHits</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">HitBox</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">ButtonColor</span><span class="p">,</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">ButtonText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Show Debug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ButtonText</span><span class="p">);</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">{</span>
<span class="w">        </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">RectPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="c1">// draw text in center</span>
<span class="w">        </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">RectPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">ButtonText</span><span class="p">,</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="p">}</span>
<span class="c1">// triggered once hitbox click</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">NotifyHitBoxClick</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">BoxName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Process HitBoxes</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BoxName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] ShowDebug HitBox Clicked&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="c1">// run console command on owner</span>
<span class="w">        </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">ConsoleCommand</span><span class="p">(</span><span class="s">&quot;showdebug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">NotifyHitBoxClick</span><span class="p">(</span><span class="n">BoxName</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// main hud update loop</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawHUD</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">DrawHUD</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">DrawShowDebugButton</span><span class="p">();</span><span class="w"> </span><span class="c1">// show debug button</span>
<span class="w">    </span><span class="c1">//Draw3DLine(FVector{ 1150.f, 1350.f, 50.f }, FVector{ 1150.f, 950.0f, 50.f }, FColor::Red);</span>
<span class="w">    </span><span class="n">DrawShowDamageNumbers</span><span class="p">();</span>
<span class="w">    </span><span class="n">DrawHealthBars</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// will scan for actors with that implement ActorHUDInterface</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ScanActorsWithHUDInterface</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UGameplayStatics</span><span class="o">::</span><span class="n">GetAllActorsWithInterface</span><span class="p">(</span><span class="n">GetWorld</span><span class="p">(),</span><span class="w"> </span><span class="n">UActorHUDInterface</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will draw health bars</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawHealthBars</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// don&#39;t render health bars if bHealthBarsVisible is false</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">bHealthBarsVisible</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// iterate thru all actors that implement UActorHUDInterface</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// get ActorInfo from interface</span>
<span class="w">        </span><span class="n">FHudActorInfo</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">;</span>
<span class="w">        </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iGetHudActorInfo</span><span class="p">(</span><span class="n">Actor</span><span class="p">,</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// project actor location to HUD</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorWorldLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">ActorWorldLocation</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Make Background</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BGLocation</span><span class="p">{</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="c1">// put bar in the middle</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">BGColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">FromSRGBColor</span><span class="p">(</span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#22222299&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// semi-transparent dark color</span>
<span class="w">        </span><span class="c1">// for bg element we will use CanvasTile, because it supports textures.</span>
<span class="w">        </span><span class="c1">// in case if in future we want to use this with texture.</span>
<span class="w">        </span><span class="n">FCanvasTileItem</span><span class="w"> </span><span class="nf">BGTile</span><span class="p">(</span><span class="n">BGLocation</span><span class="p">,</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">,</span><span class="w"> </span><span class="n">BGColor</span><span class="p">);</span>
<span class="w">        </span><span class="n">BGTile</span><span class="p">.</span><span class="n">BlendMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE_BLEND_Translucent</span><span class="p">;</span><span class="w"> </span><span class="c1">// this will enable transparency</span>
<span class="w">        </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">BGTile</span><span class="p">);</span><span class="w"> </span><span class="c1">// draw BG</span>
<span class="w">        </span><span class="c1">// Make Background</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// 1% of health line</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">HealtLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthLineSize</span><span class="p">{</span>
<span class="w">                </span><span class="n">HealtLine1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">FMath::Min</span><span class="p">(</span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">CurrentHealthAmount</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">                </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealhtLineLocation</span><span class="p">{</span>
<span class="w">            </span><span class="n">BGLocation</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">            </span><span class="n">BGLocation</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">// - because we want to move health bar upper</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">HealhtLineColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">FromSRGBColor</span><span class="p">(</span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#FF0000FF&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// non-transparent red</span>
<span class="w">        </span><span class="c1">// for bg element we will use CanvasTile, because it supports textures.</span>
<span class="w">        </span><span class="c1">// in case if in future we want to use this with texture.</span>
<span class="w">        </span><span class="n">FCanvasTileItem</span><span class="w"> </span><span class="nf">HealthLineTile</span><span class="p">(</span><span class="n">HealhtLineLocation</span><span class="p">,</span><span class="w"> </span><span class="n">HealthLineSize</span><span class="p">,</span><span class="w"> </span><span class="n">HealhtLineColor</span><span class="p">);</span>
<span class="w">        </span><span class="n">HealthLineTile</span><span class="p">.</span><span class="n">BlendMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE_BLEND_Masked</span><span class="p">;</span><span class="w"> </span><span class="c1">// non transparent</span>
<span class="w">        </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">HealthLineTile</span><span class="p">);</span><span class="w"> </span><span class="c1">// draw</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will draw damage numbers</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawShowDamageNumbers</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip empty</span>
<span class="w">        </span><span class="c1">// project actor location to HUD</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// add damage signs &quot;+&quot; and &quot;-&quot; depending on damage value</span>
<span class="w">        </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">DamageText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;+%d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">))</span>
<span class="w">            </span><span class="o">:</span>
<span class="w">            </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;-%d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// show positive damage with green color, negative damage with red color</span>
<span class="w">        </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">        </span><span class="n">FColor</span><span class="w"> </span><span class="n">DamageColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#00ff00ff&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Green RGBA for positive damage</span>
<span class="w">            </span><span class="o">:</span>
<span class="w">            </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#ff0000ff&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Red RGBA</span>
<span class="w">        </span><span class="n">DamageColor</span><span class="p">.</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="o">&lt;</span><span class="n">uint8</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="p">);</span>
<span class="w">        </span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">//change text opacity each screen update</span>
<span class="w">        </span><span class="c1">// fully transparent items should be removed from array</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[HUD] removing item&quot;))</span>
<span class="w">            </span><span class="n">ActorsToShowDamage</span><span class="p">.</span><span class="n">RemoveSingle</span><span class="p">(</span><span class="n">Info</span><span class="p">);</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">{</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span><span class="w"> </span><span class="c1">// invert Y to move text Upper, not Lower</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">Info</span><span class="p">.</span><span class="n">Height</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// move text by 5 pixels each screen update</span>
<span class="w">        </span><span class="c1">// Drawing string on desired actor</span>
<span class="w">        </span><span class="n">DrawText</span><span class="p">(</span><span class="o">*</span><span class="n">DamageText</span><span class="p">,</span><span class="w"> </span><span class="n">DamageColor</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// For Console parameters</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ShowDebug</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">DebugType</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ShowDebug</span><span class="p">(</span><span class="n">DebugType</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// Render Debug info</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ShowDebugInfo</span><span class="p">(</span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="n">YPos</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">DrawShowDebugButton</span><span class="p">();</span><span class="w"> </span><span class="c1">// show debug button</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Log Text</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] Viewport: Width = %f, Height = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Log</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Drawing string in right upper corner with offset of 50 from right and 1 letter(YSize) from top</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">50.0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">Log</span><span class="p">,</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// Make Rectangle around text</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// upper point</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// lower point</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawDebugCanvas2DBox</span><span class="p">(</span><span class="n">DebugCanvas</span><span class="p">,</span><span class="w"> </span><span class="n">FBox2D</span><span class="p">{</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">,</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">LineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">Draw2DLine</span><span class="p">(</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">FColor</span><span class="o">::</span><span class="n">Magenta</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">//GEngine-&gt;AddOnScreenDebugMessage(-1, 0.f, FColor::Red, FString::Printf(TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y));</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y)</span>
<span class="p">}</span>
<span class="c1">// Viewport Size</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">GetViewportSize</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XVSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">YVSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// viewport size</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">){</span>
<span class="w">        </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">GetViewportSize</span><span class="p">(</span><span class="n">XVSize</span><span class="p">,</span><span class="w"> </span><span class="n">YVSize</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="p">{};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">XVSize</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">YVSize</span><span class="p">};</span>
<span class="p">}</span>
<span class="c1">// Local Player Ref</span>
<span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">GetLocalPlayer</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GetOwningPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">ULocalPlayer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetOwningPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Player</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="_11">Выделение персонажей в стиле РТС</h2>
<p>Самый частый способ применения класса <code>AHUD</code> заключается в реализации выделения персонажей на экране, как это делается в ртс, например <code>Warcraft 3</code>.</p>
<p><a class="glightbox" href="../images/e83dd3f4e1f4e2c712a2f08119ff3e0b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e83dd3f4e1f4e2c712a2f08119ff3e0b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e83dd3f4e1f4e2c712a2f08119ff3e0b.png" /></a></p>
<p>Для этого в классе <code>AHUD</code> есть даже класс <code>GetActorsInSelectionRectangle</code>.</p>
<p><a class="glightbox" href="../images/120bb243998621863a3c6eb6c16cd433.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="120bb243998621863a3c6eb6c16cd433.png" auto_="auto;" display="block;" margin:="margin:" src="../images/120bb243998621863a3c6eb6c16cd433.png" /></a></p>
<p>Этот метод возвращает персонажей в выделенном секторе. Поскольку он уже написан "за нас", реализация этой механики сильно упрощается.</p>
<p>Замечу, что в <code>blueprint</code> коде одного из моих прошлых проектов я уже делал схожую логику.</p>
<p><a class="glightbox" href="../images/47a9a285bffae57101493b4574753488.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="47a9a285bffae57101493b4574753488.png" auto_="auto;" display="block;" margin:="margin:" src="../images/47a9a285bffae57101493b4574753488.png" /></a></p>
<p>Поэтому я просто перенесу свою старую логику в <code>с++</code> код.</p>
<blockquote>
<p>(дописал, когда закончил статью) Стоит заметить, что делать выделение персонажей через с++ куда проще, чем через <code>blueprint</code>, к тому-же сам процесс выделения работает быстрее.</p>
</blockquote>
<h3 id="_12">Отрисовка выделения</h3>
<p>Первое что нам надо - начать выделение по нажатию левой клавиши мыши и закончить, когда мышь отпущена. Соответственно, мы будем по нажатию мышки брать координату на экране и чертить по ней прямоугольник.</p>
<p>Для начала нужны две переменные для, одна - для  координаты начала выделения и одна для отслеживания режима выделения.
<div class="highlight"><pre><span></span><code><span class="c1">// Selection Coordinates</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">{};</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">bInSelection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// true if selection is active</span>
</code></pre></div>
Создаем три функции: для начала выделения, окончания его окончания  и получения координат курсора мыши в пространстве экрана.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// will start selection</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud|Selection&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SelectionStart</span><span class="p">();</span>
<span class="c1">// will stop selection</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud|Selection&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SelectionStop</span><span class="p">();</span>
<span class="c1">// will get cursor position</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="nf">GetCursorPostion</span><span class="p">();</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// will get cursor position</span>
<span class="c1">// will get cursor position</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="nf">AInfoHUD::GetCursorPostion</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// in case if hud not initialized yet</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Location</span><span class="p">{};</span>
<span class="w">    </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">GetMousePosition</span><span class="p">(</span><span class="n">Location</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Location</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Location</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will start selection</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::SelectionStart</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// in case if hud not initialized yet</span>
<span class="w">    </span><span class="n">SelectionStartLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCursorPostion</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SelectionStartLocation</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bInSelection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will stop selection</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::SelectionStop</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">bInSelection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Теперь в методе <code>DrawHUD</code> делаем отрисовку прямоугольника.</p>
<p>Для начала логика будет такой.
<div class="highlight"><pre><span></span><code><span class="c1">// RTS Selection</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bInSelection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCursorPostion</span><span class="p">();</span>
<span class="w">    </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span>
<span class="w">        </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// from start location</span>
<span class="w">        </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
<span class="w">        </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// to current location</span>
<span class="w">        </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Скомпилируем.</p>
<p>Теперь необходимо добавить в <code>blueprint</code> код вызовы методов <code>SelectionStart</code> и <code>SelectionStop</code>, а так-же переключение режимов ввода.</p>
<p>Помимо этого надо чтобы камера не шаталась вслед за курсором, когда мы выделяем область на экране.</p>
<p><a class="glightbox" href="../images/831c57cff72506141c71fcc1cec92b32.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="831c57cff72506141c71fcc1cec92b32.png" auto_="auto;" display="block;" margin:="margin:" src="../images/831c57cff72506141c71fcc1cec92b32.png" /></a></p>
<p><a class="glightbox" href="../images/c350eaa08606f740e011af6e75576a45.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c350eaa08606f740e011af6e75576a45.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c350eaa08606f740e011af6e75576a45.png" /></a></p>
<p>Чтобы во время выделения курсор случной не вышел за рамки игрового экрана, я блокирую подобное поведение используя параметр <code>Mouse Lock Mode</code> у узла <code>Set Input Mode Game And UI</code>.</p>
<p><a class="glightbox" href="../images/a816831e9798e73dddead84fce479367.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a816831e9798e73dddead84fce479367.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a816831e9798e73dddead84fce479367.png" /></a></p>
<p><a class="glightbox" href="../images/930d58cd04ec8d068018b01ce8076ff2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="930d58cd04ec8d068018b01ce8076ff2.png" auto_="auto;" display="block;" margin:="margin:" src="../images/930d58cd04ec8d068018b01ce8076ff2.png" /></a></p>
<p>В данный момент мы рисуем непрозрачный красный квадрат. Это легко исправить, потому что функция <code>DrawRect</code> принимает <code>RGBA</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// RTS Selection</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bInSelection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCursorPostion</span><span class="p">();</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">RectColor</span><span class="p">{</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">RectColor</span><span class="p">,</span>
<span class="w">        </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// from start location</span>
<span class="w">        </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
<span class="w">        </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// to current location</span>
<span class="w">        </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/1a6f97c049ba2f9fbd9e979a329ece43.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1a6f97c049ba2f9fbd9e979a329ece43.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1a6f97c049ba2f9fbd9e979a329ece43.png" /></a></p>
<p>Теперь, когда выделение готово, надо организовать определение персонажей в выделенном прямоугольнике, а так-же отправу этим персонажам событий.</p>
<h3 id="_13">Добавление логики выделения персонажей</h3>
<p>У нас уже есть интерфейс <code>IActorHUDInterface</code>, который мы использовали для показа полосок здоровья. Используем его для отправки событий выделенным персонажам.</p>
<p>Добавляем в интерфейс <code>IActorHUDInterface</code> метод <code>iSelectActor</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// This interface function triggered by hud to select actor</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintImplementableEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ActorHudInterface&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">iSelectActor</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">bSelect</span><span class="p">);</span>
</code></pre></div>
Данный метод будет вызываться из <code>HUD</code> в каждом пероснаже, вписанном в прямоугольник выделения.</p>
<p><a class="glightbox" href="../images/76390089efcd24daae249996a22ef79e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="76390089efcd24daae249996a22ef79e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/76390089efcd24daae249996a22ef79e.png" /></a></p>
<p>Компилируем.</p>
<p>В <code>BP_ThirdPersonCharacter</code> идем на панель <code>Class Settings</code> и  в секции <code>Interfaces</code> добавляем <code>ActorHUDInterface</code>. Я это уже сделал в главе про полоски здоровья.</p>
<p><a class="glightbox" href="../images/7b56724a32530930e432d8925b044a9f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7b56724a32530930e432d8925b044a9f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7b56724a32530930e432d8925b044a9f.png" /></a></p>
<p>Реализуем метод интерфейса - <code>iSelectActor</code>.</p>
<p><a class="glightbox" href="../images/3fb9289858469911f66325c4d4eb3d31.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3fb9289858469911f66325c4d4eb3d31.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3fb9289858469911f66325c4d4eb3d31.png" /></a></p>
<p><a class="glightbox" href="../images/975f5182629e49f51fdb896ff79489f3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="975f5182629e49f51fdb896ff79489f3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/975f5182629e49f51fdb896ff79489f3.png" /></a></p>
<p>Этот метод используется для запуска логик выделения персонажа. Точнее будет использоваться.</p>
<p>В РТС играх под выделенными персонажами показывается зеленый круг. У меня нет никакого круга, но я его могу сделать из цилиндра. Меш цилиндра встроен в базовые ассеты движка Unreal Engine.
Добавляем цилиндр и скалируем до состояния плоского блина, отключаем физику с коллизиями.</p>
<p><a class="glightbox" href="../images/12484477e2338b29416676257db1cb9e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="12484477e2338b29416676257db1cb9e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/12484477e2338b29416676257db1cb9e.png" /></a></p>
<p>Цилиндр должен быть скрыт, показывать его мы будем при срабатывании события <code>iSelectActor</code>. Поэтому выставляем параметр <code>Hidden in Game</code> в <code>true</code>.</p>
<p><a class="glightbox" href="../images/34dd2b244a1c352ad51f6719fd982397.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="34dd2b244a1c352ad51f6719fd982397.png" auto_="auto;" display="block;" margin:="margin:" src="../images/34dd2b244a1c352ad51f6719fd982397.png" /></a></p>
<p>По срабатыванию события интерфейса <code>iSelectActor</code> мы будем показывать цилиндр или скрывать его, в зависимости от переданного значения.</p>
<p><a class="glightbox" href="../images/4e0810f9e1dc08101229900bdcdc4c9a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4e0810f9e1dc08101229900bdcdc4c9a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4e0810f9e1dc08101229900bdcdc4c9a.png" /></a></p>
<p>Теперь сделаем логику вызова интерфейса.</p>
<p>Вводим переменную <code>SelectedActors</code>, которая будет хранить список персонажей, выделенных в данный момент.
<div class="highlight"><pre><span></span><code><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">SelectedActors</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of currently selcted actors</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/3979fd14a2cd532b94c3aa0029de8d6a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3979fd14a2cd532b94c3aa0029de8d6a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3979fd14a2cd532b94c3aa0029de8d6a.png" /></a></p>
<p>Логика выделения персонажей основывается на проекции координат выделенного на экране прямоугольника в игровой мир. К счастью, самостоятельно писать подобную логику не нужно, потому что в классе <code>AHUD</code> уже есть метод <code>GetActorsInSelectionRectangle</code>. Полученный из этого метода список <code>Actor'ов</code> помещается в массив <code>SelectedActors</code>.
Алгоритм выделения таков:
 * Получаем список персонажей в выделеном прямоугольнике.
 * Проверяем какие из персонажей реализуют интерфейс <code>UActorHUDInterface</code>.
 * Отправляем этим персонажам событие интерфейса <code>iSelectActor</code> с параметром <code>true</code>.
 * Добавляем персонажей в массив <code>SelectedActors</code>.
Это позволит просто выделять. Если же нам надо всякий раз выделять новых персонажей, а со старых выделение снимать (именно так выделение работает в, например, <code>Warcrat 3</code>), то перед выделением нам надо:
 * Пройтись по списку уже выделенных персоажей в массиве <code>SelectedActors</code>
 * Отправить им событие интерфейса <code>iSelectActor</code> с параметром <code>false</code>, что снимет с них выделение
 * Очистить массив <code>SelectedActors</code>
Теперь, при каждом новом выделении - со всех старых выделенных персонажей - выделение снимается и устанавливается на новых.
<div class="highlight"><pre><span></span><code><span class="c1">// RTS Selection</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bInSelection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCursorPostion</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">ScreenSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">RectColor</span><span class="p">{</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">};</span><span class="w"> </span><span class="c1">// semi-transparent blue</span>
<span class="w">    </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">RectColor</span><span class="p">,</span>
<span class="w">        </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// from start location</span>
<span class="w">        </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
<span class="w">        </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// to current location</span>
<span class="w">        </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">// deselect old actors</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Previous</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Previous</span><span class="o">-&gt;</span><span class="n">Implements</span><span class="o">&lt;</span><span class="n">UActorHUDInterface</span><span class="o">&gt;</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip actors without interface</span>
<span class="w">        </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iSelectActor</span><span class="p">(</span><span class="n">Previous</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear array</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// select new actors</span>
<span class="w">    </span><span class="n">GetActorsInSelectionRectangle</span><span class="p">(</span><span class="n">SelectionStartLocation</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="p">,</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Current</span><span class="o">-&gt;</span><span class="n">Implements</span><span class="o">&lt;</span><span class="n">UActorHUDInterface</span><span class="o">&gt;</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip actors without interface</span>
<span class="w">        </span><span class="n">FHudActorInfo</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">;</span>
<span class="w">        </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iSelectActor</span><span class="p">(</span><span class="n">Current</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Current</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
После компиляции кода мы сможем выделять нашего игрового персонажа.</p>
<p><a class="glightbox" href="../images/e422ce54c161e53e2f05f90fdec299ed.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e422ce54c161e53e2f05f90fdec299ed.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e422ce54c161e53e2f05f90fdec299ed.png" /></a></p>
<p>Давайте добавим интерфейс выделения еще и к какому-нибудь объекту в игровом мире. Например к пресловутому кубику.</p>
<p>Добавляете к кубику, в игровом мире. <code>blueprint</code> нажав на кнопку <code>Add</code> в панели <code>Details</code>.</p>
<p><a class="glightbox" href="../images/4d3e50741a9fcba8305d57b0950f6636.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4d3e50741a9fcba8305d57b0950f6636.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4d3e50741a9fcba8305d57b0950f6636.png" /></a></p>
<p>Открыаете этот <code>blueprint</code> на редактирование.</p>
<p><a class="glightbox" href="../images/776756ffe56351eb4fb1d8ccc89f0487.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="776756ffe56351eb4fb1d8ccc89f0487.png" auto_="auto;" display="block;" margin:="margin:" src="../images/776756ffe56351eb4fb1d8ccc89f0487.png" /></a></p>
<p>Добавляете <code>ActorHudInterface</code> на панели <code>Class Settings</code>.</p>
<p><a class="glightbox" href="../images/389dd9a2d32b48d073b69557f655433d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="389dd9a2d32b48d073b69557f655433d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/389dd9a2d32b48d073b69557f655433d.png" /></a></p>
<p>Добавляете цилиндр в качестве выделяющей метки, скалируете его до состояния круга, скрываете в игровом мире выставляя  параметр <code>Hidden in Game</code> в <code>true</code>.</p>
<p><a class="glightbox" href="../images/49921f4f90165ae704ca25714091884e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="49921f4f90165ae704ca25714091884e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/49921f4f90165ae704ca25714091884e.png" /></a></p>
<p>Реализуете метод интерфейса <code>iSelectActor</code>, чтобы он скрывал и показывал выделяющую метку, в роли которой выступает наш цилиндр.</p>
<p><a class="glightbox" href="../images/fb3260925842653a8d7e36a1af8e7345.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fb3260925842653a8d7e36a1af8e7345.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fb3260925842653a8d7e36a1af8e7345.png" /></a></p>
<p>Теперь на сцене у нас два выделяемых персонажа. Игровой персонаж <code>BP_ThirdPersonCharacter</code> и кубик, в моем случае его класс это <code>BP_TestRefrenceActor</code>.</p>
<p><a class="glightbox" href="../images/802a568617dc8465fb068329b718810f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="802a568617dc8465fb068329b718810f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/802a568617dc8465fb068329b718810f.png" /></a></p>
<p><a class="glightbox" href="../images/4194024f0a3fa2e86c15cf8f9f6559f5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4194024f0a3fa2e86c15cf8f9f6559f5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4194024f0a3fa2e86c15cf8f9f6559f5.png" /></a></p>
<h3 id="_14">Расширяем логику выделения</h3>
<p>В РТС играх, при зажатии клавиши <code>Shift</code> можно расширить область выделения, а при зажатии клавиши <code>Control</code> - уменьшить область выделения.</p>
<p>Давайте реализуем похожую логику.</p>
<p>Добавим перечисление <code>EHUD_RTS_SelectionMode</code> с тремя полями: <code>Default</code>, <code>Extend</code>, <code>Reduce</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// Selection Mode Enum</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EHUD_RTS_SelectionMode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Default</span><span class="p">,</span>
<span class="w">    </span><span class="n">Extend</span><span class="p">,</span>
<span class="w">    </span><span class="n">Reduce</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>
Добавляем переменную типа <code>EHUD_RTS_SelectionMode</code> в глобальную область класса. Тут будет храниться текущий режим выделения.
<div class="highlight"><pre><span></span><code><span class="n">EHUD_RTS_SelectionMode</span><span class="w"> </span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Default</span><span class="p">;</span>
</code></pre></div>
Добавляем к функции <code>SelectionStart</code> параметр типа <code>EHUD_RTS_SelectionMode</code>, который будет сохранять режим выделения.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// will start selection</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud|Selection&quot;</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="n">SelectionStart</span><span class="p">(</span><span class="n">EHUD_RTS_SelectionMode</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// will start selection</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">AInfoHUD::SelectionStart</span><span class="p">(</span><span class="n">EHUD_RTS_SelectionMode</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// in case if hud not initialized yet</span>
<span class="w">    </span><span class="n">SelectionStartLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCursorPostion</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SelectionStartLocation</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bInSelection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">;</span><span class="w"> </span><span class="c1">// set selection mode</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/3bcdca19160daec29d7aa2c2ae6239f8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3bcdca19160daec29d7aa2c2ae6239f8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3bcdca19160daec29d7aa2c2ae6239f8.png" /></a></p>
<p>Перепишем логику выделения с учетом новых изменений.
<div class="highlight"><pre><span></span><code><span class="c1">// RTS Selection</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bInSelection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCursorPostion</span><span class="p">();</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">ScreenSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">RectColor</span><span class="p">{</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">};</span><span class="w"> </span><span class="c1">// semi-transparent blue</span>
<span class="w">    </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">RectColor</span><span class="p">,</span>
<span class="w">        </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// from start location</span>
<span class="w">        </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
<span class="w">        </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// to current location</span>
<span class="w">        </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">// by Default we deselect old actors and select new actors</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Default</span><span class="p">){</span>
<span class="w">        </span><span class="c1">// deselect old actors</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Previous</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Previous</span><span class="o">-&gt;</span><span class="n">Implements</span><span class="o">&lt;</span><span class="n">UActorHUDInterface</span><span class="o">&gt;</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip actors without interface</span>
<span class="w">            </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iSelectActor</span><span class="p">(</span><span class="n">Previous</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear array</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// select new actors</span>
<span class="w">    </span><span class="n">GetActorsInSelectionRectangle</span><span class="p">(</span><span class="n">SelectionStartLocation</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="p">,</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Current</span><span class="o">-&gt;</span><span class="n">Implements</span><span class="o">&lt;</span><span class="n">UActorHUDInterface</span><span class="o">&gt;</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip actors without interface</span>
<span class="w">        </span><span class="n">FHudActorInfo</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Default</span><span class="w"> </span><span class="o">||</span>
<span class="w">            </span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Extend</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// select</span>
<span class="w">            </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iSelectActor</span><span class="p">(</span><span class="n">Current</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Current</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Reduce</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// deselect</span>
<span class="w">            </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iSelectActor</span><span class="p">(</span><span class="n">Current</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">.</span><span class="n">RemoveSingle</span><span class="p">(</span><span class="n">Current</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Теперь если <code>CurrentSelectionMode == Reduce</code>, то вместо выделения персонажей, прямоугольник будет его снимать.</p>
<p>Если <code>CurrentSelectionMode == Extend</code>, то с уже выделенных персонажей не будет сниматься выделение.</p>
<p>По умолчанию же алгоритм работы сохраняется - с предыдущих персонажей снимается выделение и добавляется на новых.</p>
<p>В <code>blueprint</code> коде тоже потребуются изменения.</p>
<p>Для начала, надо добавить логику отслеживания нажатий <code>Shift</code> и <code>Control</code>.</p>
<p><a class="glightbox" href="../images/a006279687f39e63912ae32d1fbcd5e6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a006279687f39e63912ae32d1fbcd5e6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a006279687f39e63912ae32d1fbcd5e6.png" /></a></p>
<p>При нажатом <code>Shift</code> режим выделения будет <code>Exdtend</code>. При нажатом <code>Ctrl</code> режим выделения будет <code>Reduce</code>.</p>
<p><a class="glightbox" href="../images/8ae84dea14aed3a08ebd7981aeaaa3b0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8ae84dea14aed3a08ebd7981aeaaa3b0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8ae84dea14aed3a08ebd7981aeaaa3b0.png" /></a></p>
<p>Так-же приведу скриншеты остального <code>blueprint</code> кода, относящегося к логике выделения.</p>
<p><a class="glightbox" href="../images/edda4073f3c5664a079fbed03444beef.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="edda4073f3c5664a079fbed03444beef.png" auto_="auto;" display="block;" margin:="margin:" src="../images/edda4073f3c5664a079fbed03444beef.png" /></a></p>
<p><a class="glightbox" href="../images/8e3d7ca4649e5c0b560b25fea394d19e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8e3d7ca4649e5c0b560b25fea394d19e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8e3d7ca4649e5c0b560b25fea394d19e.png" /></a></p>
<p>В игре это выглядит так.</p>
<p>Я добавил на сцену несколько кубиков.</p>
<p><a class="glightbox" href="../images/473be5145093fab3e3ebc9dd3344bcd3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="473be5145093fab3e3ebc9dd3344bcd3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/473be5145093fab3e3ebc9dd3344bcd3.png" /></a></p>
<p>По умолчанию я могу выделять их свободно.</p>
<p><a class="glightbox" href="../images/14203460f05946b1cff65532ab38bfdd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="14203460f05946b1cff65532ab38bfdd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/14203460f05946b1cff65532ab38bfdd.png" /></a></p>
<p>Если зажать <code>Ctrl</code> то можно убрать выделение с некоторых кубиков.</p>
<p><a class="glightbox" href="../images/394edba5f4f95393d6804b6e795a977f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="394edba5f4f95393d6804b6e795a977f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/394edba5f4f95393d6804b6e795a977f.png" /></a></p>
<p>Если зажать клавишу <code>Shift</code> - можно выделить новые кубики, сохранив предыдущее выделение.</p>
<p><a class="glightbox" href="../images/822f64e112d09d6b389658fbff25d6ab.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="822f64e112d09d6b389658fbff25d6ab.png" auto_="auto;" display="block;" margin:="margin:" src="../images/822f64e112d09d6b389658fbff25d6ab.png" /></a></p>
<h3 id="_15">Код</h3>
<p>Приведу полный код всех классов модуля.</p>
<p><a class="glightbox" href="../images/0276f076293a577fd577f8f1a5c18eea.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0276f076293a577fd577f8f1a5c18eea.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0276f076293a577fd577f8f1a5c18eea.png" /></a></p>
<p>Файл <code>HudInfoModule.build.cs</code>.
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="n">UnrealBuildTool</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">HudInfoModule</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ModuleRules</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">HudInfoModule</span><span class="p">(</span><span class="n">ReadOnlyTargetRules</span><span class="w"> </span><span class="n">Target</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">base</span><span class="p">(</span><span class="n">Target</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">PCHUsage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PCHUsageMode</span><span class="p">.</span><span class="n">UseExplicitOrSharedPCHs</span><span class="p">;</span>
<span class="w">        </span><span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Core&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CoreUObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Engine&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">PublicIncludePaths</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;HudInfoModule/Public&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">PrivateIncludePaths</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;HudInfoModule/Private&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Файл <code>ActorHUDInterface.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/Interface.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ActorHUDInterface.generated.h&quot;</span>
<span class="c1">// This class does not need to be modified.</span>
<span class="n">UINTERFACE</span><span class="p">(</span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UActorHUDInterface</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="p">};</span>
<span class="c1">// Struct that contains Hud related character info</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ActorHudInterface&quot;</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FHudActorInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">CurrentHealthAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// HP Bar Position</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthBarPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// HP Bar Size</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Info&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthBarSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">100.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">25.0f</span><span class="p">};</span>
<span class="w">    </span><span class="c1">// oveload operator == because without it functions like TArray::IndexOfByKey will not work</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FHudActorInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">CurrentHealthAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">CurrentHealthAmount</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">HealthBarPosition</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Hud Interface to inteeract with the character</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">IActorHUDInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Add interface functions to this class. This is the class that will be inherited to implement this interface.</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// This interface function allows to get Actor Info for the Hud Class</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintImplementableEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ActorHudInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iGetHudActorInfo</span><span class="p">(</span><span class="n">FHudActorInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// This interface function triggered by hud to select actor</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintImplementableEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ActorHudInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iSelectActor</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">bSelect</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>HudDamageInterface.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/Interface.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HudDamageInterface.generated.h&quot;</span>
<span class="c1">// This class does not need to be modified.</span>
<span class="n">UINTERFACE</span><span class="p">(</span><span class="n">MinimalAPI</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UHudDamageInterface</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Interface for AInfoHUD class to render damage numbers</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">IHudDamageInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Add interface functions to this class. This is the class that will be inherited to implement this interface.</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// Will render damage number on hud</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HudDamageInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iShowHUDDamage</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// bluepritable interfaces don&#39;t need body or realisation</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>InfoHUD.h</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/HUD.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;HudDamageInterface.h&quot;</span><span class="c1"> // Damage Interface</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ActorHUDInterface.h&quot;</span><span class="c1"> // Actor HUD Interface</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/GameplayStatics.h&quot;</span><span class="c1"> // GetPlayerController</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Engine/Canvas.h&quot;</span><span class="c1"> // canvas</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CanvasItem.h&quot;</span><span class="c1"> // FCanvasTileItem</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InfoHUD.generated.h&quot;</span>
<span class="c1">// This struct will hold actor and it&#39;s damage</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FActorDamageInfo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">AActor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// offset of damage number from actor&#39;s middle</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// oveload operator == because without it functions like TArray::IndexOfByKey will not work</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FActorDamageInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Actor</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Offset</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Opacity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Opacity</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="c1">// Selection Mode Enum</span>
<span class="n">UENUM</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">EHUD_RTS_SelectionMode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uint8</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Default</span><span class="p">,</span>
<span class="w">    </span><span class="n">Extend</span><span class="p">,</span>
<span class="w">    </span><span class="n">Reduce</span><span class="p">,</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * Hud class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HUDINFOMODULE_API</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">AHUD</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IHudDamageInterface</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Hit Box</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ShowDebug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bHealthBarsVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// allow show/hide health bars</span>
<span class="w">    </span><span class="c1">// Selection</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">{};</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bInSelection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// true if selection is active</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">SelectedActors</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of currently selcted actors</span>
<span class="w">    </span><span class="n">EHUD_RTS_SelectionMode</span><span class="w"> </span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Default</span><span class="p">;</span><span class="w"> </span><span class="c1">// rts selection mode</span>
<span class="w">    </span><span class="c1">// Damage Display</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FActorDamageInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of the actors taht will be used to render damage numbers</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">{};</span><span class="w"> </span><span class="c1">// list of actors that implement ActorHUDInterface</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">AInfoHUD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will start selection</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud|Selection&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SelectionStart</span><span class="p">(</span><span class="n">EHUD_RTS_SelectionMode</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will stop selection</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud|Selection&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SelectionStop</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HudDamageInterface&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">iShowHUDDamage</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">iShowHUDDamage_Implementation</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will scan for actors with that implement ActorHUDInterface</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">ScanActorsWithHUDInterface</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will show / hide health bars</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hud&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ToggleHealthBars</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">Show</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">){</span><span class="w"> </span><span class="n">bHealthBarsVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Show</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// will draw health bars</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawHealthBars</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will get cursor position</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="nf">GetCursorPostion</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will draw clickable button that execute console command &quot;showdebug&quot;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawShowDebugButton</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will draw damage numbers</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawShowDamageNumbers</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// begin play</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// triggered once hitbox click</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">NotifyHitBoxClick</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">BoxName</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// main hud update loop</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">DrawHUD</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to control debug info</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShowDebug</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">DebugType</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// debug hud update loop</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"> </span><span class="c1">// will render debug info</span>
<span class="w">    </span><span class="c1">// Will return Viewport Size</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="nf">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Local Player Ref</span>
<span class="w">    </span><span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="nf">GetLocalPlayer</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div>
Файл <code>InfoHUD.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;InfoHUD.h&quot;</span>
<span class="c1">// Constructor</span>
<span class="n">AInfoHUD</span><span class="o">::</span><span class="n">AInfoHUD</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Enable input for the HUD actor. Otherwise Hit Boxes will not work.</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">EnableInput</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="p">);</span>
<span class="w">    </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">bEnableClickEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// this necessary!</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">BeginPlay</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// Part of the IHudDamageInterface, will render damage number on top of the character</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">iShowHUDDamage_Implementation</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">ForActor</span><span class="p">,</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DamageAmount</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// add actor to list</span>
<span class="w">    </span><span class="n">ActorsToShowDamage</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="p">{</span>
<span class="w">        </span><span class="n">ForActor</span><span class="p">,</span>
<span class="w">        </span><span class="n">DamageAmount</span><span class="p">,</span>
<span class="w">        </span><span class="n">Offset</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
<span class="c1">// will draw clickable button that execute console command &quot;showdebug&quot;</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawShowDebugButton</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Draw rectangle for our button</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">RectSize</span><span class="p">{</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">{</span><span class="w"> </span><span class="n">Offset</span><span class="p">,</span><span class="w"> </span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Offset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">FHUDHitBox</span><span class="w"> </span><span class="o">*</span><span class="n">HitBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">FHUDHitBox</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">GetHitBoxWithName</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">));</span><span class="w"> </span><span class="c1">// *note  we don&#39;t need const here</span>
<span class="w">    </span><span class="c1">// Add Collision HitBox</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">HitBox</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">){</span>
<span class="w">        </span><span class="n">AddHitBox</span><span class="p">(</span><span class="n">RectPosition</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">,</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Change button color based on state</span>
<span class="w">    </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Change Rect Color on mouse Hover from blue to gray, and clear hit state</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HitBoxesOver</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Gray</span><span class="p">;</span>
<span class="w">        </span><span class="n">HitBoxesOver</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">HitBox_ShowDebug</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span>
<span class="w">    </span><span class="c1">// Change Rect Color on Click to red, and clear hit state</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">HitBoxHits</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">HitBox</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ButtonColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Red</span><span class="p">;</span>
<span class="w">        </span><span class="n">HitBoxHits</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">HitBox</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">ButtonColor</span><span class="p">,</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RectPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">ButtonText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Show Debug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ButtonText</span><span class="p">);</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">{</span>
<span class="w">        </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">RectPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="c1">// draw text in center</span>
<span class="w">        </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">RectPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">ButtonText</span><span class="p">,</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="p">}</span>
<span class="c1">// triggered once hitbox click</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">NotifyHitBoxClick</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">BoxName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Process HitBoxes</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">BoxName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">HitBox_ShowDebug</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] ShowDebug HitBox Clicked&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="c1">// run console command on owner</span>
<span class="w">        </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">ConsoleCommand</span><span class="p">(</span><span class="s">&quot;showdebug&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">NotifyHitBoxClick</span><span class="p">(</span><span class="n">BoxName</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// main hud update loop</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawHUD</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">DrawHUD</span><span class="p">();</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">DrawShowDebugButton</span><span class="p">();</span><span class="w"> </span><span class="c1">// show debug button</span>
<span class="w">    </span><span class="c1">//Draw3DLine(FVector{ 1150.f, 1350.f, 50.f }, FVector{ 1150.f, 950.0f, 50.f }, FColor::Red);</span>
<span class="w">    </span><span class="n">DrawShowDamageNumbers</span><span class="p">();</span>
<span class="w">    </span><span class="n">DrawHealthBars</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// RTS Selection</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bInSelection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCursorPostion</span><span class="p">();</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">ScreenSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">RectColor</span><span class="p">{</span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">};</span><span class="w"> </span><span class="c1">// semi-transparent blue</span>
<span class="w">        </span><span class="n">DrawRect</span><span class="p">(</span><span class="n">RectColor</span><span class="p">,</span>
<span class="w">            </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// from start location</span>
<span class="w">            </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
<span class="w">            </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1">// to current location</span>
<span class="w">            </span><span class="n">CurrentMousePos</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SelectionStartLocation</span><span class="p">.</span><span class="n">Y</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// by Default we deselect old actors and select new actors</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Default</span><span class="p">){</span>
<span class="w">            </span><span class="c1">// deselect old actors</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Previous</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Previous</span><span class="o">-&gt;</span><span class="n">Implements</span><span class="o">&lt;</span><span class="n">UActorHUDInterface</span><span class="o">&gt;</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip actors without interface</span>
<span class="w">                </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iSelectActor</span><span class="p">(</span><span class="n">Previous</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear array</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// select new actors</span>
<span class="w">        </span><span class="n">GetActorsInSelectionRectangle</span><span class="p">(</span><span class="n">SelectionStartLocation</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentMousePos</span><span class="p">,</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">RectangleActors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Current</span><span class="o">-&gt;</span><span class="n">Implements</span><span class="o">&lt;</span><span class="n">UActorHUDInterface</span><span class="o">&gt;</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip actors without interface</span>
<span class="w">            </span><span class="n">FHudActorInfo</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="w">                </span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Default</span><span class="w"> </span><span class="o">||</span>
<span class="w">                </span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Extend</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// select</span>
<span class="w">                </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iSelectActor</span><span class="p">(</span><span class="n">Current</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">                </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Current</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EHUD_RTS_SelectionMode</span><span class="o">::</span><span class="n">Reduce</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// deselect</span>
<span class="w">                </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iSelectActor</span><span class="p">(</span><span class="n">Current</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">                </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SelectedActors</span><span class="p">.</span><span class="n">RemoveSingle</span><span class="p">(</span><span class="n">Current</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will start selection</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">SelectionStart</span><span class="p">(</span><span class="n">EHUD_RTS_SelectionMode</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// in case if hud not initialized yet</span>
<span class="w">    </span><span class="n">SelectionStartLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCursorPostion</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SelectionStartLocation</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">bInSelection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">CurrentSelectionMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SelectionMode</span><span class="p">;</span><span class="w"> </span><span class="c1">// set selection mode</span>
<span class="p">}</span>
<span class="c1">// will stop selection</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">SelectionStop</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">bInSelection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will scan for actors with that implement ActorHUDInterface</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ScanActorsWithHUDInterface</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UGameplayStatics</span><span class="o">::</span><span class="n">GetAllActorsWithInterface</span><span class="p">(</span><span class="n">GetWorld</span><span class="p">(),</span><span class="w"> </span><span class="n">UActorHUDInterface</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will draw health bars</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawHealthBars</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// don&#39;t render health bars if bHealthBarsVisible is false</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">bHealthBarsVisible</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// iterate thru all actors that implement UActorHUDInterface</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsWithInterface</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// get ActorInfo from interface</span>
<span class="w">        </span><span class="n">FHudActorInfo</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">;</span>
<span class="w">        </span><span class="n">IActorHUDInterface</span><span class="o">::</span><span class="n">Execute_iGetHudActorInfo</span><span class="p">(</span><span class="n">Actor</span><span class="p">,</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// project actor location to HUD</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorWorldLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">ActorWorldLocation</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Make Background</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BGLocation</span><span class="p">{</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="c1">// put bar in the middle</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">BGColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">FromSRGBColor</span><span class="p">(</span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#22222299&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// semi-transparent dark color</span>
<span class="w">        </span><span class="c1">// for bg element we will use CanvasTile, because it supports textures.</span>
<span class="w">        </span><span class="c1">// in case if in future we want to use this with texture.</span>
<span class="w">        </span><span class="n">FCanvasTileItem</span><span class="w"> </span><span class="nf">BGTile</span><span class="p">(</span><span class="n">BGLocation</span><span class="p">,</span><span class="w"> </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">,</span><span class="w"> </span><span class="n">BGColor</span><span class="p">);</span>
<span class="w">        </span><span class="n">BGTile</span><span class="p">.</span><span class="n">BlendMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE_BLEND_Translucent</span><span class="p">;</span><span class="w"> </span><span class="c1">// this will enable transparency</span>
<span class="w">        </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">BGTile</span><span class="p">);</span><span class="w"> </span><span class="c1">// draw BG</span>
<span class="w">        </span><span class="c1">// Make Background</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// 1% of health line</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">HealtLine1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealthLineSize</span><span class="p">{</span>
<span class="w">                </span><span class="n">HealtLine1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">FMath::Min</span><span class="p">(</span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">CurrentHealthAmount</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<span class="w">                </span><span class="n">ActorInfo</span><span class="p">.</span><span class="n">HealthBarSize</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">HealhtLineLocation</span><span class="p">{</span>
<span class="w">            </span><span class="n">BGLocation</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">            </span><span class="n">BGLocation</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HealhtLineOffset</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">// - because we want to move health bar upper</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">FLinearColor</span><span class="w"> </span><span class="n">HealhtLineColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">FromSRGBColor</span><span class="p">(</span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#FF0000FF&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// non-transparent red</span>
<span class="w">        </span><span class="c1">// for bg element we will use CanvasTile, because it supports textures.</span>
<span class="w">        </span><span class="c1">// in case if in future we want to use this with texture.</span>
<span class="w">        </span><span class="n">FCanvasTileItem</span><span class="w"> </span><span class="nf">HealthLineTile</span><span class="p">(</span><span class="n">HealhtLineLocation</span><span class="p">,</span><span class="w"> </span><span class="n">HealthLineSize</span><span class="p">,</span><span class="w"> </span><span class="n">HealhtLineColor</span><span class="p">);</span>
<span class="w">        </span><span class="n">HealthLineTile</span><span class="p">.</span><span class="n">BlendMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SE_BLEND_Masked</span><span class="p">;</span><span class="w"> </span><span class="c1">// non transparent</span>
<span class="w">        </span><span class="n">Canvas</span><span class="o">-&gt;</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">HealthLineTile</span><span class="p">);</span><span class="w"> </span><span class="c1">// draw</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will draw damage numbers</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">DrawShowDamageNumbers</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FActorDamageInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ActorsToShowDamage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip empty</span>
<span class="w">        </span><span class="c1">// project actor location to HUD</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">FVector</span><span class="w"> </span><span class="n">ActorHudPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="n">Location</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// add damage signs &quot;+&quot; and &quot;-&quot; depending on damage value</span>
<span class="w">        </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">DamageText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;+%d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">))</span>
<span class="w">            </span><span class="o">:</span>
<span class="w">            </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;-%d&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Abs</span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// show positive damage with green color, negative damage with red color</span>
<span class="w">        </span><span class="c1">// this is shortened if syntax, just split into lines</span>
<span class="w">        </span><span class="n">FColor</span><span class="w"> </span><span class="n">DamageColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">DamageAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span>
<span class="w">            </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#00ff00ff&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Green RGBA for positive damage</span>
<span class="w">            </span><span class="o">:</span>
<span class="w">            </span><span class="n">FColor</span><span class="o">::</span><span class="n">FromHex</span><span class="p">(</span><span class="s">&quot;#ff0000ff&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Red RGBA</span>
<span class="w">        </span><span class="n">DamageColor</span><span class="p">.</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FMath</span><span class="o">::</span><span class="n">Max</span><span class="o">&lt;</span><span class="n">uint8</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="p">);</span>
<span class="w">        </span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">//change text opacity each screen update</span>
<span class="w">        </span><span class="c1">// fully transparent items should be removed from array</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Info</span><span class="p">.</span><span class="n">Opacity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[HUD] removing item&quot;))</span>
<span class="w">            </span><span class="n">ActorsToShowDamage</span><span class="p">.</span><span class="n">RemoveSingle</span><span class="p">(</span><span class="n">Info</span><span class="p">);</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">{</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
<span class="w">            </span><span class="n">ActorHudPosition</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Offset</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Info</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span><span class="w"> </span><span class="c1">// invert Y to move text Upper, not Lower</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">Info</span><span class="p">.</span><span class="n">Height</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// move text by 5 pixels each screen update</span>
<span class="w">        </span><span class="c1">// Drawing string on desired actor</span>
<span class="w">        </span><span class="n">DrawText</span><span class="p">(</span><span class="o">*</span><span class="n">DamageText</span><span class="p">,</span><span class="w"> </span><span class="n">DamageColor</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextPosition</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// For Console parameters</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ShowDebug</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">DebugType</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ShowDebug</span><span class="p">(</span><span class="n">DebugType</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="p">}</span>
<span class="c1">// Render Debug info</span>
<span class="kt">void</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">ShowDebugInfo</span><span class="p">(</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">YPos</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ShowDebugInfo</span><span class="p">(</span><span class="n">YL</span><span class="p">,</span><span class="w"> </span><span class="n">YPos</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">DrawShowDebugButton</span><span class="p">();</span><span class="w"> </span><span class="c1">// show debug button</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetViewportSize</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Log Text</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;[HUD] Viewport: Width = %f, Height = %f&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">VS</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Getting String size in pixels</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">StringSize</span><span class="p">(</span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">(),</span><span class="w"> </span><span class="n">XTSize</span><span class="p">,</span><span class="w"> </span><span class="n">YTSize</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">Log</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Drawing string in right upper corner with offset of 50 from right and 1 letter(YSize) from top</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">VS</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">50.0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawText</span><span class="p">(</span><span class="n">Log</span><span class="p">,</span><span class="w"> </span><span class="n">FColor</span><span class="o">::</span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">GEngine</span><span class="o">-&gt;</span><span class="n">GetMediumFont</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// Make Rectangle around text</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// upper point</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="p">{</span><span class="w"> </span><span class="c1">// lower point</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">DrawDebugCanvas2DBox</span><span class="p">(</span><span class="n">DebugCanvas</span><span class="p">,</span><span class="w"> </span><span class="n">FBox2D</span><span class="p">{</span><span class="w"> </span><span class="n">BoxStartPoint</span><span class="p">,</span><span class="w"> </span><span class="n">BoxEndPoint</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">,</span><span class="w"> </span><span class="mf">1.f</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">LineOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">;</span>
<span class="w">    </span><span class="n">Draw2DLine</span><span class="p">(</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextCoordinates</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">YTSize</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">RectOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">LineOffset</span><span class="p">,</span>
<span class="w">        </span><span class="n">FColor</span><span class="o">::</span><span class="n">Magenta</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">//GEngine-&gt;AddOnScreenDebugMessage(-1, 0.f, FColor::Red, FString::Printf(TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y));</span>
<span class="w">    </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;[HUD] Viewpoert: Width = %f, Height = %f&quot;), (float)VS.X, (float)VS.Y)</span>
<span class="p">}</span>
<span class="c1">// Viewport Size</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">GetViewportSize</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">XVSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">YVSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// viewport size</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">){</span>
<span class="w">        </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">GetViewportSize</span><span class="p">(</span><span class="n">XVSize</span><span class="p">,</span><span class="w"> </span><span class="n">YVSize</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">VS</span><span class="p">{};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">XVSize</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">YVSize</span><span class="p">};</span>
<span class="p">}</span>
<span class="c1">// will get cursor position</span>
<span class="n">FVector2D</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">GetCursorPostion</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PlayerOwner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// in case if hud not initialized yet</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">Location</span><span class="p">{};</span>
<span class="w">    </span><span class="n">PlayerOwner</span><span class="o">-&gt;</span><span class="n">GetMousePosition</span><span class="p">(</span><span class="n">Location</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Location</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Location</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Local Player Ref</span>
<span class="n">ULocalPlayer</span><span class="o">*</span><span class="w"> </span><span class="n">AInfoHUD</span><span class="o">::</span><span class="n">GetLocalPlayer</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">GetOwningPlayerController</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">ULocalPlayer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetOwningPlayerController</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Player</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="links">Links</h2>
<p>https://docs.unrealengine.com/4.27/en-US/API/Runtime/Engine/GameFramework/AHUD/</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            К началу
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      aftamat4ik
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "toc.follow"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>