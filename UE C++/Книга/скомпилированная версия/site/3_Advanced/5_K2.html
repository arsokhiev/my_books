
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Справочник Unreal Engine">
      
      
        <meta name="author" content="aftamat4ik">
      
      
      
        <link rel="prev" href="4_UMG.html">
      
      
        <link rel="next" href="6_Registe_New_Asset_Type.html">
      
      
      <link rel="icon" href="../assets/icon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.3.2">
    
    
      
        <title>K2 - Справочник Unreal Engine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.30068a00.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#k2" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Верхний колонтитул">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-header__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Справочник Unreal Engine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              K2
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Поиск">
        
        <button type="reset" class="md-search__icon md-icon" title="Очистить" aria-label="Очистить" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Инициализация поиска
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Вкладки" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Главная

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1_Basics/1_First_Project.html" class="md-tabs__link">
          
  
  Основы

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../2_Core/1_Delegates.html" class="md-tabs__link">
          
  
  Ключевые системы

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="1_HUD.html" class="md-tabs__link">
          
  
  Продвинутая разработка

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-tabs__link">
          
  
  Решение проблем

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../5_Tips/Change_Asset_Icons.html" class="md-tabs__link">
          
  
  Советы

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Навигация" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Справочник Unreal Engine" class="md-nav__button md-logo" aria-label="Справочник Unreal Engine" data-md-component="logo">
      
  <img src="../assets/icon.png" alt="logo">

    </a>
    Справочник Unreal Engine
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Главная
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Основы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Основы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/1_First_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создаем первый проект в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/2_Engine_Introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Знакомство с движком
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/3_CPP_Recommendations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Рекомендации по написанию кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/4_SimplePlugin.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Создание простейшего плагина для Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/5_Macroses_Reflection_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Макросы Reflection System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/6_Logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Печать информации в лог
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/7_Pointers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Указатели
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/8_ModernCpp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возможности современного c++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/9_Working_With_Strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа со строками
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/10_Timers_In_%D0%A1%2B%2B.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Таймеры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/11_Instances_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Доступ к различным сущностям
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Debug
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            Debug
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Asserts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Asserts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_Basics/Debug/Debug_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug Console Commands
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ключевые системы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Ключевые системы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/1_Delegates.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События и Делегаты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/2_Components.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Компоненты в Unreal Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/3_SubObjects.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Суб Объекты
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/4_Multithreading.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Многопоточность
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/5_Function_Libraries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Библиотеки Функций для Blueprint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/6_Latent_And_Async_Actions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Latent и Async Action
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/7_Gameplay_Tags.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/8_DataAssets_AssetManager.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с ассетами и данными
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/9_FileSystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Работа с файловой системой
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/10_Anim_Instance.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anim Instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/11_SubSystems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Подсистемы
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_Core/12.%20UObject%20Interface.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Interface или UInterface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Продвинутая разработка
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Продвинутая разработка
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="1_HUD.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HUD или Heads-up Display
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="2_UFUNCTION_Wildcard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UFUNCTION Wildcard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="3_Slate%20Runtime.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slate Runtimе, введение в Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="4_UMG.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UMG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    K2
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="5_K2.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    K2
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    О системе
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Подготовка к работе
  </a>
  
    <nav class="md-nav" aria-label="Подготовка к работе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#editor" class="md-nav__link">
    Создаем Editor модуль
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime" class="md-nav__link">
    Создаем Runtime модуль
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Добавляем библиотеку функций
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Добавляем зависимости
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k2_1" class="md-nav__link">
    Простейшая K2 нода
  </a>
  
    <nav class="md-nav" aria-label="Простейшая K2 нода">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_testh" class="md-nav__link">
    Файл K2Node_Test.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_testcpp" class="md-nav__link">
    Файл K2Node_Test.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Изучаем результат
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2_2" class="md-nav__link">
    Проблемы с добавлением K2 узлов
  </a>
  
    <nav class="md-nav" aria-label="Проблемы с добавлением K2 узлов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2_3" class="md-nav__link">
    Что делать если написанная вами K2 нода не появляется в редакторе?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2-nodes-should-only-be-defined-in-a-developer-or-uncookedonly-module" class="md-nav__link">
    K2 Nodes should only be defined in a Developer or UncookedOnly module.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Изучаем пины
  </a>
  
    <nav class="md-nav" aria-label="Изучаем пины">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#allocatedefaultpins" class="md-nav__link">
    AllocateDefaultPins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#createpin" class="md-nav__link">
    CreatePin
  </a>
  
    <nav class="md-nav" aria-label="CreatePin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eedgraphpindirection-direction" class="md-nav__link">
    Параметр EEdGraphPinDirection Direction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#const-fname-pincategory" class="md-nav__link">
    Параметр const FName PinCategory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pinname" class="md-nav__link">
    Параметр PinName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pinparams" class="md-nav__link">
    Параметр PinParams
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Значение "по умолчанию" для пина
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reallocatepinsduringreconstruction" class="md-nav__link">
    Обновление пинов в ноде, ReallocatePinsDuringReconstruction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pindefaultvaluechanged" class="md-nav__link">
    Отслеживание изменений пина PinDefaultValueChanged
  </a>
  
    <nav class="md-nav" aria-label="Отслеживание изменений пина PinDefaultValueChanged">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Удаление добавленных пинов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removepin" class="md-nav__link">
    Метод RemovePin и его проблемы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2_4" class="md-nav__link">
    Пересборка K2 ноды с сохранением имеющихся соединений
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint" class="md-nav__link">
    Получение списка пинов у Blueprint объекта
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Контекстное меню, добавление и удаление пинов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wildcard" class="md-nav__link">
    Wildcard пины и изменение типа пинов "на лету"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pin-boilerplates" class="md-nav__link">
    Шаблоны пинов, Pin Boilerplates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Полный код класса
  </a>
  
    <nav class="md-nav" aria-label="Полный код класса">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_testh_1" class="md-nav__link">
    Файл K2Node_Test.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_testcpp_1" class="md-nav__link">
    Файл K2Node_Test.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k2-node-boilerplate-k2" class="md-nav__link">
    K2 Node Boilerplate, шаблон K2 ноды
  </a>
  
    <nav class="md-nav" aria-label="K2 Node Boilerplate, шаблон K2 ноды">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_boilerplateh" class="md-nav__link">
    Файл K2Node_Boilerplate.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_boilerplatecpp" class="md-nav__link">
    Файл K2Node_Boilerplate.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k2-expandnode" class="md-nav__link">
    Развертка K2 ноды, ExpandNode
  </a>
  
    <nav class="md-nav" aria-label="Развертка K2 ноды, ExpandNode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spawnintermediatenode" class="md-nav__link">
    Метод SpawnIntermediateNode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movepinlinkstointermediate" class="md-nav__link">
    Метод MovePinLinksToIntermediate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trycreateconnection" class="md-nav__link">
    Метод TryCreateConnection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Развертка простой функции
  </a>
  
    <nav class="md-nav" aria-label="Развертка простой функции">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_expandbasicfunctionh" class="md-nav__link">
    Файл K2Node_ExpandBasicFunction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_expandbasicfunctioncpp" class="md-nav__link">
    Файл K2Node_ExpandBasicFunction.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Разбор кода
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intermediate" class="md-nav__link">
    Как получить список пинов у Intermediate ноды?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latent-action-delay" class="md-nav__link">
    Развертка Latent Action Delay и создание временных переменных
  </a>
  
    <nav class="md-nav" aria-label="Развертка Latent Action Delay и создание временных переменных">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_delayedincrementh" class="md-nav__link">
    Файл K2Node_DelayedIncrement.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_delayedincrementcpp" class="md-nav__link">
    Файл K2Node_DelayedIncrement.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Результат
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exec" class="md-nav__link">
    Развертка события в Exec пин
  </a>
  
    <nav class="md-nav" aria-label="Развертка события в Exec пин">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_threadeddelayh" class="md-nav__link">
    Файл K2Node_ThreadedDelay.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_threadeddelaycpp" class="md-nav__link">
    Файл K2Node_ThreadedDelay.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Результат
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    Запрет на добавление ноды в определенные графы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ifthenelse-promotableoperator" class="md-nav__link">
    Развертка условия IfThenElse, а так-же PromotableOperator
  </a>
  
    <nav class="md-nav" aria-label="Развертка условия IfThenElse, а так-же PromotableOperator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_branchtesth" class="md-nav__link">
    Файл K2Node_BranchTest.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_branchtestcpp" class="md-nav__link">
    Файл K2Node_BranchTest.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    Результат
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exec_1" class="md-nav__link">
    Развертка делегатов в Exec пины
  </a>
  
    <nav class="md-nav" aria-label="Развертка делегатов в Exec пины">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_constructibleobjecth" class="md-nav__link">
    Файл K2Node_ConstructibleObject.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_constructibleobjectcpp" class="md-nav__link">
    Файл K2Node_ConstructibleObject.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    Разбор кода
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    Links
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="6_Registe_New_Asset_Type.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Регистрируем новый тип ассета
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="7_ACharacter_And_Enhanced%20Input.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ACharacter и Enhanced Input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="8_Gameplay_Ability_System.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay Ability System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="9_Global_Data_Access.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальнный доступ к данным
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="10_Global_Event_Bus.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Глобальная шина событий
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Решение проблем
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Решение проблем
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/LiveCoding_Encoding_Issues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с кодировкой в LiveCoding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/Reset_Project.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Сброс (Reset) проекта
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_Resolving%20Issues/generatedh_Problems.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Проблемы с файлом .generated.h
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Советы
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Советы
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Change_Asset_Icons.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Asset Icons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Character_And_EnhancedInput.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Character Boilerplate with Enhanced Input Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/DefaultToSelf_WorldContext.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DefaultToSelf WorldContext
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Different_UPROPERTY.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Переменные разных типов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/GameInputMode.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Изменение GameInputMode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Get_UScriptStruct_FromStruct.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ::UScriptStruct из встроенной структуры
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Input_Binding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    События ввода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Iterate_TMap.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iterate TMap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Read_Blueprint_Properties.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Чтение параметров Blueprint класса
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Return_UObject.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Возвращение UObject по ссылке из функции
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Run_Console_Commands.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Запуск консольных команд
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Screen_Size.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Размер экрана
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Slate_Snippets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Полезные сниппеты Slate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Spawn_Actors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spawn, призыв объектов
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Time_Measuring.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Замер времени исполнения кода
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Trace.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UEnum_To_String.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UEnum to FString
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/UObject_Base_Class.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UObject Base Class
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/Variable_Type_Print_Template.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Шаблон для печати типа переменной
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_Tips/struct_operator%3D%3D.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    struct и оператор ==
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    О системе
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Подготовка к работе
  </a>
  
    <nav class="md-nav" aria-label="Подготовка к работе">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#editor" class="md-nav__link">
    Создаем Editor модуль
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime" class="md-nav__link">
    Создаем Runtime модуль
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Добавляем библиотеку функций
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Добавляем зависимости
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k2_1" class="md-nav__link">
    Простейшая K2 нода
  </a>
  
    <nav class="md-nav" aria-label="Простейшая K2 нода">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_testh" class="md-nav__link">
    Файл K2Node_Test.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_testcpp" class="md-nav__link">
    Файл K2Node_Test.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Изучаем результат
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2_2" class="md-nav__link">
    Проблемы с добавлением K2 узлов
  </a>
  
    <nav class="md-nav" aria-label="Проблемы с добавлением K2 узлов">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2_3" class="md-nav__link">
    Что делать если написанная вами K2 нода не появляется в редакторе?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2-nodes-should-only-be-defined-in-a-developer-or-uncookedonly-module" class="md-nav__link">
    K2 Nodes should only be defined in a Developer or UncookedOnly module.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Изучаем пины
  </a>
  
    <nav class="md-nav" aria-label="Изучаем пины">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#allocatedefaultpins" class="md-nav__link">
    AllocateDefaultPins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#createpin" class="md-nav__link">
    CreatePin
  </a>
  
    <nav class="md-nav" aria-label="CreatePin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eedgraphpindirection-direction" class="md-nav__link">
    Параметр EEdGraphPinDirection Direction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#const-fname-pincategory" class="md-nav__link">
    Параметр const FName PinCategory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pinname" class="md-nav__link">
    Параметр PinName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pinparams" class="md-nav__link">
    Параметр PinParams
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Значение "по умолчанию" для пина
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reallocatepinsduringreconstruction" class="md-nav__link">
    Обновление пинов в ноде, ReallocatePinsDuringReconstruction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pindefaultvaluechanged" class="md-nav__link">
    Отслеживание изменений пина PinDefaultValueChanged
  </a>
  
    <nav class="md-nav" aria-label="Отслеживание изменений пина PinDefaultValueChanged">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Удаление добавленных пинов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removepin" class="md-nav__link">
    Метод RemovePin и его проблемы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2_4" class="md-nav__link">
    Пересборка K2 ноды с сохранением имеющихся соединений
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blueprint" class="md-nav__link">
    Получение списка пинов у Blueprint объекта
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Контекстное меню, добавление и удаление пинов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wildcard" class="md-nav__link">
    Wildcard пины и изменение типа пинов "на лету"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pin-boilerplates" class="md-nav__link">
    Шаблоны пинов, Pin Boilerplates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Полный код класса
  </a>
  
    <nav class="md-nav" aria-label="Полный код класса">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_testh_1" class="md-nav__link">
    Файл K2Node_Test.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_testcpp_1" class="md-nav__link">
    Файл K2Node_Test.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k2-node-boilerplate-k2" class="md-nav__link">
    K2 Node Boilerplate, шаблон K2 ноды
  </a>
  
    <nav class="md-nav" aria-label="K2 Node Boilerplate, шаблон K2 ноды">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_boilerplateh" class="md-nav__link">
    Файл K2Node_Boilerplate.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_boilerplatecpp" class="md-nav__link">
    Файл K2Node_Boilerplate.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#k2-expandnode" class="md-nav__link">
    Развертка K2 ноды, ExpandNode
  </a>
  
    <nav class="md-nav" aria-label="Развертка K2 ноды, ExpandNode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spawnintermediatenode" class="md-nav__link">
    Метод SpawnIntermediateNode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movepinlinkstointermediate" class="md-nav__link">
    Метод MovePinLinksToIntermediate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trycreateconnection" class="md-nav__link">
    Метод TryCreateConnection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Развертка простой функции
  </a>
  
    <nav class="md-nav" aria-label="Развертка простой функции">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_expandbasicfunctionh" class="md-nav__link">
    Файл K2Node_ExpandBasicFunction.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_expandbasicfunctioncpp" class="md-nav__link">
    Файл K2Node_ExpandBasicFunction.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Разбор кода
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intermediate" class="md-nav__link">
    Как получить список пинов у Intermediate ноды?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latent-action-delay" class="md-nav__link">
    Развертка Latent Action Delay и создание временных переменных
  </a>
  
    <nav class="md-nav" aria-label="Развертка Latent Action Delay и создание временных переменных">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_delayedincrementh" class="md-nav__link">
    Файл K2Node_DelayedIncrement.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_delayedincrementcpp" class="md-nav__link">
    Файл K2Node_DelayedIncrement.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Результат
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exec" class="md-nav__link">
    Развертка события в Exec пин
  </a>
  
    <nav class="md-nav" aria-label="Развертка события в Exec пин">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_threadeddelayh" class="md-nav__link">
    Файл K2Node_ThreadedDelay.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_threadeddelaycpp" class="md-nav__link">
    Файл K2Node_ThreadedDelay.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Результат
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    Запрет на добавление ноды в определенные графы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ifthenelse-promotableoperator" class="md-nav__link">
    Развертка условия IfThenElse, а так-же PromotableOperator
  </a>
  
    <nav class="md-nav" aria-label="Развертка условия IfThenElse, а так-же PromotableOperator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_branchtesth" class="md-nav__link">
    Файл K2Node_BranchTest.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_branchtestcpp" class="md-nav__link">
    Файл K2Node_BranchTest.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    Результат
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exec_1" class="md-nav__link">
    Развертка делегатов в Exec пины
  </a>
  
    <nav class="md-nav" aria-label="Развертка делегатов в Exec пины">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k2node_constructibleobjecth" class="md-nav__link">
    Файл K2Node_ConstructibleObject.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k2node_constructibleobjectcpp" class="md-nav__link">
    Файл K2Node_ConstructibleObject.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    Разбор кода
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    Links
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="k2"><code>K2</code></h1>
<p><code>K2</code> - или <code>Kismet2</code> это система, использующаяся для создания сложных <code>blueprint</code> узлов, в тех случаях, когда функционала <code>latent action</code> и <code>async action</code> не достаточно.
<code>K2</code> предоставляет разработчику низкоуровневый доступ к созданию практически любых <code>blueprint</code> узлов. При этом данная система - самая сложная для освоения в Unreal Engine.
Абсолютно вся базовая <code>blueprint</code> логика  движка сделана через систему <code>K2</code>. Включая узлы событий, вызовов функций и переменных.</p>
<h2 id="_1">О системе</h2>
<p><code>K2</code> является частью модуля <code>BlueprintGraph</code>. Это <code>Engine</code> модуль, который можно найти по пути <code>\Engine\Source\Editor\BlueprintGraph\</code>.
За непосредственно систему <code>K2</code> отвечает глобальный класс <code>UK2Node</code>, который находится в файле <code>\Engine\Source\Editor\BlueprintGraph\Classes\K2Node.h</code>.</p>
<p><a class="glightbox" href="../images/e0e7a39cc7fb65668a30efa44eec9c36.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e0e7a39cc7fb65668a30efa44eec9c36.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e0e7a39cc7fb65668a30efa44eec9c36.png" /></a></p>
<p><a class="glightbox" href="../images/4e820604f00317bc409658cef256acdd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4e820604f00317bc409658cef256acdd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4e820604f00317bc409658cef256acdd.png" /></a></p>
<p>Класс <code>UK2Node</code> унаследован от другого не менее важного класса <code>UEdGraphNode</code>. Он отвечает за генерацию пинов и внешнее оформление ноды.</p>
<p>Найти его можно в файле <code>\Engine\Source\Runtime\Engine\Classes\EdGraph\EdGraphNode.h</code>.</p>
<p><a class="glightbox" href="../images/1a2e0ed12cc05ae1f39484fcd3ca3acc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1a2e0ed12cc05ae1f39484fcd3ca3acc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1a2e0ed12cc05ae1f39484fcd3ca3acc.png" /></a></p>
<p><a class="glightbox" href="../images/df622cfbbd4dfd5d02bfd6c578172529.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="df622cfbbd4dfd5d02bfd6c578172529.png" auto_="auto;" display="block;" margin:="margin:" src="../images/df622cfbbd4dfd5d02bfd6c578172529.png" /></a></p>
<p><a class="glightbox" href="../images/eb1ee51e1b40ae51c4db29b5af63b84a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="eb1ee51e1b40ae51c4db29b5af63b84a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/eb1ee51e1b40ae51c4db29b5af63b84a.png" /></a></p>
<p>Рекомендую открыть эти два класса в <code>Visual Studio</code>, потому что они содержат методы  и логику, которой мы будем пользоваться по ходу работы.</p>
<p>Методы, отвечающие за компиляцию <code>blueprint</code> ноды, а так-же за регистрацию этой ноды в редакторе относятся непосредственно к самому классу <code>UK2Node</code>.</p>
<p><a class="glightbox" href="../images/4dffc7adc2668e8b1cf54a84bd51fbd9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4dffc7adc2668e8b1cf54a84bd51fbd9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4dffc7adc2668e8b1cf54a84bd51fbd9.png" /></a></p>
<p>В папке <code>\Engine\Source\Editor\BlueprintGraph\Classes\</code> можно найти примеры реализации большинства <code>blueprint</code> узлов доступных в редакторе "из коробки".</p>
<p><a class="glightbox" href="../images/b8043ec7519d6ec6735bf91bbbaf8082.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b8043ec7519d6ec6735bf91bbbaf8082.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b8043ec7519d6ec6735bf91bbbaf8082.png" /></a></p>
<p>Эти примеры реализации будут послужат для нас отличным пособием при разработке собственных классов.</p>
<h2 id="_2">Подготовка к работе</h2>
<p>Для работы с системой <code>K2</code> нам понадобится целых два модуля: один для расширения редактора <code>Editor</code>, второй для <code>Runtime</code> библиотеки функций.</p>
<h3 id="editor">Создаем <code>Editor</code> модуль</h3>
<p>Создаем модуль <code>Editor</code> с названием <code>K2CustomEditor</code>. Тут будут размещаться <code>K2</code> ноды.</p>
<p><a class="glightbox" href="../images/0ac558d3e11c0228c964bec2b50af89d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0ac558d3e11c0228c964bec2b50af89d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0ac558d3e11c0228c964bec2b50af89d.png" /></a></p>
<p>После того как модуль сгенерируется, необходимо установить порядок его загрузки. Открываем в текстовом редакторе файл <code>.uproject</code>.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/f2ce31f5f3a4557c8aa6de52fdd32850.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f2ce31f5f3a4557c8aa6de52fdd32850.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f2ce31f5f3a4557c8aa6de52fdd32850.png" /></a>
{align=center; display=block; margin: 0 auto;}</p>
<p>Найдите в этом файле параметры модуля <code>K2CustomEditor</code> и измените их следующим образом:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;Name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;K2CustomEditor&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;UncookedOnly&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;LoadingPhase&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;PreDefault&quot;</span>
<span class="p">},</span>
</code></pre></div></p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/a9dce8d43e8aa5b5bf13b3eba19341f8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a9dce8d43e8aa5b5bf13b3eba19341f8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a9dce8d43e8aa5b5bf13b3eba19341f8.png" /></a>
{align=center; display=block; margin: 0 auto;}</p>
<p>Сохраните файл <code>.uproject</code> и перезапустите <code>Unreal Engine</code> с компиляцией проекта.</p>
<h3 id="runtime">Создаем <code>Runtime</code> модуль</h3>
<p>Теперь нам нужен <code>Runtime</code> модуль с названием <code>K2Custom</code>. Тут будет библиотека функций.</p>
<p><a class="glightbox" href="../images/5c55fc11fdf06e810837d6359caa58f1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5c55fc11fdf06e810837d6359caa58f1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5c55fc11fdf06e810837d6359caa58f1.png" /></a></p>
<p>Закрываем движок и пересобираем проект.</p>
<h3 id="_3">Добавляем библиотеку функций</h3>
<p>Поскольку <code>K2</code> ноды существуют только внутри редактора, их надо заменять аналогичной по функционалу <code>runtime</code> логикой.</p>
<p>Эту логику надо где-то размещать. Например - в библиотеке функций. Создадим ее.</p>
<p>Идем <code>Tools -&gt; New C++ Class -&gt; Blueprint Function Library</code>.</p>
<p><a class="glightbox" href="../images/c4eaf80de681d920b1901071806e8aea.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c4eaf80de681d920b1901071806e8aea.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c4eaf80de681d920b1901071806e8aea.png" /></a></p>
<p>Я назвал библиотеку функций <code>K2RuntimeFunctionsLibrary</code>.</p>
<p><a class="glightbox" href="../images/3487b21c474c8047a46331c6aa1e7033.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3487b21c474c8047a46331c6aa1e7033.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3487b21c474c8047a46331c6aa1e7033.png" /></a></p>
<p>На данном этапе проект выглядит так:</p>
<p><a class="glightbox" href="../images/9bc0ffc0d9e33a018f5ea1d9c7c0ce38.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9bc0ffc0d9e33a018f5ea1d9c7c0ce38.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9bc0ffc0d9e33a018f5ea1d9c7c0ce38.png" /></a></p>
<p><a class="glightbox" href="../images/3a8605ab9a5fe0333c0daebb9bf8d364.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3a8605ab9a5fe0333c0daebb9bf8d364.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3a8605ab9a5fe0333c0daebb9bf8d364.png" /></a></p>
<h3 id="_4">Добавляем зависимости</h3>
<p>Теперь необходимо рассмотреть зависимости.</p>
<p>Открываем файл <code>.build.cs</code> у модуля <code>K2CustomEditor</code>.</p>
<p><a class="glightbox" href="../images/cda76621b1a93d7e10208df392ea9a83.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cda76621b1a93d7e10208df392ea9a83.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cda76621b1a93d7e10208df392ea9a83.png" /></a></p>
<p>Добавляем зависимости из списка, приведенного ниже:
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="n">UnrealBuildTool</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">K2CustomEditor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ModuleRules</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">K2CustomEditor</span><span class="p">(</span><span class="n">ReadOnlyTargetRules</span><span class="w"> </span><span class="n">Target</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">base</span><span class="p">(</span><span class="n">Target</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">PCHUsage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PCHUsageMode</span><span class="p">.</span><span class="n">UseExplicitOrSharedPCHs</span><span class="p">;</span>
<span class="w">        </span><span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Core&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CoreUObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Engine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UnrealEd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GameplayTags&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="n">PrivateDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;Slate&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;SlateCore&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;BlueprintGraph&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;Kismet&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;KismetCompiler&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;ToolMenus&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;K2Custom&quot;</span><span class="w"> </span><span class="c1">// Runtime Module</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="n">PublicIncludePaths</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;K2CustomEditor/Public&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">PrivateIncludePaths</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;K2CustomEditor/Private&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="k2_1">Простейшая <code>K2</code> нода</h2>
<p>Первые классы для системы <code>K2</code> я буду создавать вручную. Чуть ниже я создам т.н. основной шаблон или <code>boilerplate</code>, который упростит вам создание новых <code>K2</code> нод. Но пока, давайте создадим и рассмотрим простейший <code>K2</code> класс в действии.</p>
<p>Переходим в папку модуля <code>K2CustomEditor</code> и добавляем в <code>/Public</code> и <code>/Private</code> директории файлы, соответственно, <code>K2Node_Test.h</code> и <code>K2Node_Test.cpp</code>.</p>
<p><a class="glightbox" href="../images/41f26967925ba5ed644545fad5de667b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="41f26967925ba5ed644545fad5de667b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/41f26967925ba5ed644545fad5de667b.png" /></a></p>
<p><a class="glightbox" href="../images/5943bfbb1215000c5bf540b0eb42fc1b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5943bfbb1215000c5bf540b0eb42fc1b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5943bfbb1215000c5bf540b0eb42fc1b.png" /></a></p>
<p>Теперь необходимо выполните команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>, чтобы добавленные файлы отобразились в проекте.</p>
<p><a class="glightbox" href="../images/8bfc1f8eca175ea291d96e39bfb13b13.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8bfc1f8eca175ea291d96e39bfb13b13.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8bfc1f8eca175ea291d96e39bfb13b13.png" /></a></p>
<p>В данный момент файлы пусты.</p>
<p><a class="glightbox" href="../images/ab7b748d2eb0968ce0e4e6601dc32d89.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ab7b748d2eb0968ce0e4e6601dc32d89.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ab7b748d2eb0968ce0e4e6601dc32d89.png" /></a></p>
<p>Предлагаю реализовать ноду, которая будет просто печатать переданное число в лог. Такая нода может быть описана следующим простым графом:</p>
<p><a class="glightbox" href="../images/32b3e8cb5115c3e7ea0520c027f5b90f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="32b3e8cb5115c3e7ea0520c027f5b90f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/32b3e8cb5115c3e7ea0520c027f5b90f.png" /></a></p>
<p><a class="glightbox" href="../images/92b33432ed999bd5e4a7fa799d659e28.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="92b33432ed999bd5e4a7fa799d659e28.png" auto_="auto;" display="block;" margin:="margin:" src="../images/92b33432ed999bd5e4a7fa799d659e28.png" /></a></p>
<p>Для печати числа используем макрос <code>UE_LOG</code>. Его надо обернуть внутрь функции, для дальнейшего обращения.
<div class="highlight"><pre><span></span><code><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BlueprintInternalUseOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">))</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">LogNumber</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Log Number = %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Number</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
Сама функция должна быть добавлена в созданную ранее <code>Runtime</code> библиотеку функций <code>K2RuntimeFunctionsLibrary</code>.</p>
<p><a class="glightbox" href="../images/2b1e8c2ea9c2bb72c4cba932c6f8c114.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2b1e8c2ea9c2bb72c4cba932c6f8c114.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2b1e8c2ea9c2bb72c4cba932c6f8c114.png" /></a></p>
<p>Переходим непосредственно к коду будущей ноды.</p>
<h3 id="k2node_testh">Файл <code>K2Node_Test.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// Main File</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_EaseFunction.h&quot;</span>
<span class="c1">// EdGraph is part of K2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNode.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNodeUtils.h&quot;</span>
<span class="c1">// Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;KismetCompiler.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/CompilerResultsLog.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/BlueprintEditorUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabaseRegistrar.h&quot;</span>
<span class="c1">//#include &quot;GameFramework/PlayerController.h&quot;</span>
<span class="c1">// UObject related includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span><span class="c1"> // this will hide warnings from intellisense</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UObjectGlobals.h&quot;</span>
<span class="c1">// Editor Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintNodeSpawner.h&quot;</span>
<span class="c1">// K2 Nodes that we refer to</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CallFunction.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="c1">// runtime function library</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2RuntimeFunctionsLibrary.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Test.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * K2 Node Test class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOMEDITOR_API</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UK2Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// variables</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="o">=</span><span class="s">&quot;Data&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UK2NodeTest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//~ Begin UK2Node Interface.</span>
<span class="w">    </span><span class="c1">// will be called during compilation. Allows to perform validation of internal values</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ValidateNodeDuringCompilation</span><span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">FCompilerResultsLog</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MessageLog</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// core method, during compilation will generate resulting data</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to place this node into add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will set node category in add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// node corner icon</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// return true if we want do show node properties in Details panel</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ShouldShowNodeProperties</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// should return unique node signature</span>
<span class="w">    </span><span class="c1">// if we generate multiple nodes depending on different data, use this to differentiate them by signature</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FBlueprintNodeSignature</span><span class="w"> </span><span class="nf">GetSignature</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">FBlueprintNodeSignature</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//~ End UK2Node Interface</span>
<span class="w">    </span><span class="c1">//~ Begin UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// used to add pins for node</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AllocateDefaultPins</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to add node title color</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FLinearColor</span><span class="w"> </span><span class="nf">GetNodeTitleColor</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to generate node title</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// for tooltip</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetTooltipText</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// for icon and tint</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="w"> </span><span class="nf">GetIconAndTint</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutColor</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// true if compatible with selected blueprint editor graph</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsCompatibleWithGraph</span><span class="p">(</span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UEdGraphNode Interface.</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="k2node_testcpp">Файл <code>K2Node_Test.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Test.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;K2Node_TestText&quot;</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;IntInputParam&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">UK2NodeTest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// int data pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IntPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">IntPin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Int Test Input Pin&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">IntPin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">    </span><span class="n">IntPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">FromInt</span><span class="p">(</span><span class="n">NodeNumber</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// core method, during compilation will generate resulting data</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// access to the blueprint where this node has been called</span>
<span class="w">    </span><span class="cm">/*UBlueprint* BP = FBlueprintEditorUtils::FindBlueprintForGraph(SourceGraph);</span>
<span class="cm">    ensure(BP);</span>
<span class="cm">    if (BP != nullptr)</span>
<span class="cm">    {</span>
<span class="cm">        // do some logics here</span>
<span class="cm">    }*/</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IntPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">IntPinName</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IntPin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;K2 Int Pin Value is %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">IntPin</span><span class="o">-&gt;</span><span class="n">GetDefaultAsString</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">CallFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">LogNumber</span><span class="p">),</span><span class="w"> </span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">());</span>
<span class="w">    </span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// connect IntPin of editor k2 node (this) to runtime function node&#39;s Number pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">TargetIntPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Number&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">CopyPinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">IntPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">TargetIntPin</span><span class="p">);</span><span class="w"> </span><span class="c1">// copy data from editor pin</span>
<span class="w">    </span><span class="c1">// move Exec and Then pin addreses from editor node to runtime function node</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// since all connections from this node are forwarded to CallFunction</span>
<span class="w">    </span><span class="c1">// we should disconnect the rest, if any</span>
<span class="w">    </span><span class="c1">// why? because this node will not exist in runtime build</span>
<span class="w">    </span><span class="c1">// in runtime only CallFunction node will exist</span>
<span class="w">    </span><span class="c1">// this is how K2 works, it just replaces one node with another or group of another nodes with some logic</span>
<span class="w">    </span><span class="c1">// since this script is short, here we do only very basic logic of forwarding data, it can be much more complex</span>
<span class="w">    </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// will be called during compilation. Allows to perform validation of internal values</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ValidateNodeDuringCompilation</span><span class="p">(</span><span class="n">FCompilerResultsLog</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MessageLog</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ValidateNodeDuringCompilation</span><span class="p">(</span><span class="n">MessageLog</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    // simple, classic way of working</span>
<span class="cm">    UClass* Action = GetClass();</span>
<span class="cm">    if (ActionRegistrar.IsOpenForRegistration(Action))</span>
<span class="cm">    {</span>
<span class="cm">        UBlueprintNodeSpawner* Spawner = UBlueprintNodeSpawner::Create(GetClass());</span>
<span class="cm">        check(Spawner != nullptr);</span>
<span class="cm">        ActionRegistrar.AddBlueprintAction(Action, Spawner);</span>
<span class="cm">    }*/</span>
<span class="w">    </span><span class="c1">// this lambda used to sync settings between spawned K2 nodes of this type</span>
<span class="w">    </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">UEdGraphNode</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SetupNodeData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">UEdGraphNode</span><span class="o">*</span><span class="w"> </span><span class="n">NewNode</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsTemplateNode</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">MenuNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastChecked</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">&gt;</span><span class="p">(</span><span class="n">NewNode</span><span class="p">);</span>
<span class="w">        </span><span class="n">MenuNode</span><span class="o">-&gt;</span><span class="n">NodeNumber</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">;</span><span class="w"> </span><span class="c1">// set new node&#39;s internal value</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">NodeClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">NodeClass</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// as example - register 3 nodes of UK2NodeTest type</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">            </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">NodeSpawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">NodeClass</span><span class="p">);</span>
<span class="w">            </span><span class="n">check</span><span class="p">(</span><span class="n">NodeSpawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">            </span><span class="n">NodeSpawner</span><span class="o">-&gt;</span><span class="n">CustomizeNodeDelegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">FCustomizeNodeDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">SetupNodeData</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">NodeClass</span><span class="p">,</span><span class="w"> </span><span class="n">NodeSpawner</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node|1&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node|2&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node|3&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// default</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// node corner icon</span>
<span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//return TEXT(&quot;Graph.Latent.LatentIcon&quot;);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FontEditor.UpdateAll&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to add node title color</span>
<span class="n">FLinearColor</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetNodeTitleColor</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// used to generate node title</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">Format</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestNode {0}&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// for tooltip</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetTooltipText</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">Format</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;This is test K2 Node Tooltip. NodeNumber is = {0}.&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// for icon and tint</span>
<span class="n">FSlateIcon</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetIconAndTint</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutColor</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="w"> </span><span class="n">Icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="p">(</span><span class="n">FAppStyle</span><span class="o">::</span><span class="n">GetAppStyleSetName</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;GraphEditor.K2Node_CallFunction&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Icon</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// true if compatible with selected blueprint editor graph</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IsCompatibleWithGraph</span><span class="p">(</span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">EGraphType</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">GraphType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Graph</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetGraphType</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GraphType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGraphType</span><span class="o">::</span><span class="n">GT_Ubergraph</span><span class="p">);</span><span class="w"> </span><span class="c1">// this is default graph for actor editor</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsCompatible</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">        </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Graph</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// prevent placement of this node in Construction Script</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">IsConstructionScript</span><span class="p">(</span><span class="n">Graph</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//return bIsCompatible;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h3 id="_5">Изучаем результат</h3>
<p>После компиляции кода, в меню создания <code>blueprint</code> узлов появилась категория <code>Test K2Node</code> и три подкатегории.</p>
<p><a class="glightbox" href="../images/b50d3f052c25993ea2b311379162aec3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b50d3f052c25993ea2b311379162aec3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b50d3f052c25993ea2b311379162aec3.png" /></a></p>
<p>Если выбрать один из пунктов в этих категориях - в выбранном графе появится созданная нами <code>K2</code> нода. Она крайне проста и имеет всего одно входное значение, а так-же два <code>Exec</code> пина: входящий и выходящий.</p>
<p><a class="glightbox" href="../images/6b0b2c9730ac7dce2ab2c57485e1b769.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6b0b2c9730ac7dce2ab2c57485e1b769.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6b0b2c9730ac7dce2ab2c57485e1b769.png" /></a></p>
<p>Что соответствует паттерну, который я ранее вам продемонстрировал.</p>
<p><a class="glightbox" href="../images/c126dcbec2fb80f02e47292d309a0064.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c126dcbec2fb80f02e47292d309a0064.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c126dcbec2fb80f02e47292d309a0064.png" /></a></p>
<p>При каждой компиляции <code>blueprint</code> кода - в лог печатается результат выполнения метода <code>ExpandNode</code>:</p>
<p><a class="glightbox" href="../images/f4bb269ee7dd53053ad152743e20fc8c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f4bb269ee7dd53053ad152743e20fc8c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f4bb269ee7dd53053ad152743e20fc8c.png" /></a></p>
<p><a class="glightbox" href="../images/e9cf5da418353ba3ee8407a5c79b7a3f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e9cf5da418353ba3ee8407a5c79b7a3f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e9cf5da418353ba3ee8407a5c79b7a3f.png" /></a></p>
<p>Я привязал вызов созданной <code>K2</code> ноды к событию нажатия кнопки <code>1</code>.</p>
<p><a class="glightbox" href="../images/3585aa7aba0338e368541e496ecef0a6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3585aa7aba0338e368541e496ecef0a6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3585aa7aba0338e368541e496ecef0a6.png" /></a></p>
<p>При запуске проекта и нажатии на эту кнопку значения вызова узла корректно печатаются в лог. Нода корректно работает.</p>
<p><a class="glightbox" href="../images/dfcee2af70938cefc098fd2b566456ad.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dfcee2af70938cefc098fd2b566456ad.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dfcee2af70938cefc098fd2b566456ad.png" /></a></p>
<h3 id="k2_2">Проблемы с добавлением <code>K2</code> узлов</h3>
<p>В процессе реализации данной примитивной ноды я столкнулся с массой технических проблем. Два дня у меня ушло на то, чтобы со всем разобраться. Надеюсь мои заметки вам помогут.</p>
<h4 id="k2_3">Что делать если написанная вами <code>K2</code> нода не появляется в редакторе?</h4>
<p>Иногда класс <code>K2</code> ноды, добавленный в проект, упорно не желает регистрироваться в системе, что бы вы не делали. Как быть?
Для начала обратите внимание на файл модуля <code>_editor.build.cs</code>, убедитесь, что там прописаны следующие зависимости:
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="n">UnrealBuildTool</span><span class="p">;</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">K2CustomEditor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ModuleRules</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">K2CustomEditor</span><span class="p">(</span><span class="n">ReadOnlyTargetRules</span><span class="w"> </span><span class="n">Target</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">base</span><span class="p">(</span><span class="n">Target</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">PCHUsage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PCHUsageMode</span><span class="p">.</span><span class="n">UseExplicitOrSharedPCHs</span><span class="p">;</span>
<span class="w">        </span><span class="n">PublicDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Core&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CoreUObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Engine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UnrealEd&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">PrivateDependencyModuleNames</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;Slate&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;SlateCore&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;BlueprintGraph&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;Kismet&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;KismetCompiler&quot;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="n">PublicIncludePaths</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;K2CustomEditor/Public&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="n">PrivateIncludePaths</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;K2CustomEditor/Private&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/f10b937bcbb44292c60002c0ffa64441.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f10b937bcbb44292c60002c0ffa64441.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f10b937bcbb44292c60002c0ffa64441.png" /></a></p>
<p>Далее откройте файл проекта <code>.uproject</code> в текстором редакторе.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/f2ce31f5f3a4557c8aa6de52fdd32850.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f2ce31f5f3a4557c8aa6de52fdd32850.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f2ce31f5f3a4557c8aa6de52fdd32850.png" /></a>
{align=center; display=block; margin: 0 auto;}</p>
<p>Убедитесь, что ваш модуль загружается правильным образом:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;Name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;K2CustomEditor&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;UncookedOnly&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;LoadingPhase&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;PreDefault&quot;</span>
<span class="p">},</span>
</code></pre></div></p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/a9dce8d43e8aa5b5bf13b3eba19341f8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a9dce8d43e8aa5b5bf13b3eba19341f8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a9dce8d43e8aa5b5bf13b3eba19341f8.png" /></a>
{align=center; display=block; margin: 0 auto;}</p>
<p>Если это не помогло - обратите внимание на класс, в котором вы реализовали <code>K2</code> ноду. Уберите все аргументы у макроса <code>UCLASS</code>, если они там есть. Особенно это относится к аргументу <code>abstract</code>.</p>
<p><a class="glightbox" href="../images/19f9081c32c0dfcbc20abc93588bc935.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="19f9081c32c0dfcbc20abc93588bc935.png" auto_="auto;" display="block;" margin:="margin:" src="../images/19f9081c32c0dfcbc20abc93588bc935.png" /></a></p>
<p>Если даже это не помогло - идите в вашу <code>K2</code> ноду и закомментируйте в ней методы, влияющие на видимость:
<div class="highlight"><pre><span></span><code><span class="c1">// node corner icon</span>
<span class="c1">//virtual FName GetCornerIcon() const override;</span>
<span class="c1">//virtual FSlateIcon GetIconAndTint(FLinearColor&amp; OutColor) const override;</span>
<span class="c1">// true if compatible with selected blueprint editor graph</span>
<span class="c1">//virtual bool IsCompatibleWithGraph(UEdGraph const* Graph) const override;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/f73c49a79c11ffafffb14429913ddc42.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f73c49a79c11ffafffb14429913ddc42.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f73c49a79c11ffafffb14429913ddc42.png" /></a></p>
<p>Измените методы <code>GetMenuCategory</code> и <code>GetMenuActions</code> так, чтобы они реализовывали примитивную логику, вместо сложной.
<div class="highlight"><pre><span></span><code><span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="nf">UK2NodeTest::GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// default</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">Action</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">Spawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span>
<span class="w">        </span><span class="n">check</span><span class="p">(</span><span class="n">Spawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">Spawner</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Так-же переделайте метод <code>ExpandNode</code> на что-нибудь крайне примитивное:
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
После всех изменений обязательно перезапустите <code>Unreal Engine</code>, удалите папки <code>Intermediate</code> и <code>Binaries</code>, после чего запустите движок с пересборкой всех файлов.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/66af015cf26bfde2b569ac95c9050d75.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="66af015cf26bfde2b569ac95c9050d75.png" auto_="auto;" display="block;" margin:="margin:" src="../images/66af015cf26bfde2b569ac95c9050d75.png" /></a></p>
<p>Запустив движок не забудьте выполнить команду <code>Tools -&gt; Refresh Visual Studio 2022 Project</code>.
Надеюсь эти советы вам помогут.</p>
<p><a class="glightbox" href="../images/a9152f941c18d23eeadf2f7d9373a3d9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a9152f941c18d23eeadf2f7d9373a3d9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a9152f941c18d23eeadf2f7d9373a3d9.png" /></a></p>
<h4 id="k2-nodes-should-only-be-defined-in-a-developer-or-uncookedonly-module"><code>K2 Nodes should only be defined in a Developer or UncookedOnly module.</code></h4>
<p>Если при компиляции вылезает ошибка:</p>
<blockquote>
<p><code>K2 Nodes should only be defined in a Developer or UncookedOnly module.</code>
Для начала открываем в текстовом редакторе файл <code>.uproject</code>.</p>
</blockquote>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/f2ce31f5f3a4557c8aa6de52fdd32850.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f2ce31f5f3a4557c8aa6de52fdd32850.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f2ce31f5f3a4557c8aa6de52fdd32850.png" /></a>
{align=center; display=block; margin: 0 auto;}</p>
<p>Убедитесь, что ваш модуль загружается правильным образом:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;Name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;K2CustomEditor&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;UncookedOnly&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;LoadingPhase&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;PreDefault&quot;</span>
<span class="p">},</span>
</code></pre></div></p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/a9dce8d43e8aa5b5bf13b3eba19341f8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a9dce8d43e8aa5b5bf13b3eba19341f8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a9dce8d43e8aa5b5bf13b3eba19341f8.png" /></a>
{align=center; display=block; margin: 0 auto;}</p>
<p>Сохраните файл и закройте <code>Visual Studio</code> и <code>Unreal Engine</code>.
Несмотря на то, что мы изменили порядок загрузки модуля - этого не достаточно, чтобы изменения провились в движке. Следующий шаг крайне <strong>важен, чтобы все заработало</strong>.</p>
<p>Удалите папки <code>Intermediate</code> и <code>Binaries</code>, после чего запустите движок с пересборкой всех файлов.</p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/66af015cf26bfde2b569ac95c9050d75.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="66af015cf26bfde2b569ac95c9050d75.png" auto_="auto;" display="block;" margin:="margin:" src="../images/66af015cf26bfde2b569ac95c9050d75.png" /></a></p>
<p>Запустив движок не забудьте выполнить команду <code>Tools-&gt;Refresh Visual Studio 2022 Project</code>.</p>
<p><a class="glightbox" href="../images/f927f99bfa18a10a5fd31873916ba3bc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f927f99bfa18a10a5fd31873916ba3bc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f927f99bfa18a10a5fd31873916ba3bc.png" /></a></p>
<h2 id="_6">Изучаем пины</h2>
<p>Пин является базовым элементом любой <code>K2</code> ноды. Именно через пины выстраивается <code>blueprint</code> логика проекта.</p>
<p><a class="glightbox" href="../images/c195909ae1bbd3185fede4d1ffcec16c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c195909ae1bbd3185fede4d1ffcec16c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c195909ae1bbd3185fede4d1ffcec16c.png" /></a></p>
<p>Умение добавлять, удалять и обновлять список пинов - одно из ключевых при работе с системой <code>K2</code>. Рассмотрим возможности пинов в этой системе на примере ноды <code>UK2NodeTest</code>, которую я написал в предыдущей главе.</p>
<p>Предлагаю улучшить эту ноду, дополнив ее функционалом отображения и скрытия пинов.</p>
<p><a class="glightbox" href="../images/7b1803133ad63dd7d99106030f0c9426.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7b1803133ad63dd7d99106030f0c9426.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7b1803133ad63dd7d99106030f0c9426.png" /></a></p>
<p><a class="glightbox" href="../images/95dd15b1bfe5c4eda9e534ca708f46d8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="95dd15b1bfe5c4eda9e534ca708f46d8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/95dd15b1bfe5c4eda9e534ca708f46d8.png" /></a></p>
<p>Давайте начнем с основного набора пинов и их генерации.</p>
<h3 id="allocatedefaultpins"><code>AllocateDefaultPins</code></h3>
<p>Основные пины ноды добавляются в методе <code>AllocateDefaultPins</code>.
Данный метод отвечает за пины, которые будут доступны в ноде сразу после ее добавления в граф и которые не будут изменяться с течением времени.</p>
<p>Именно в этом методе стоит добавлять <code>Execute</code> и <code>Then</code> пины. Они отвечают за вход и  выход из ноды.</p>
<p><a class="glightbox" href="../images/ac31ab5c5a0f057ec80f1bf0ace11342.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ac31ab5c5a0f057ec80f1bf0ace11342.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ac31ab5c5a0f057ec80f1bf0ace11342.png" /></a></p>
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// if this pin is True, then all rest pins will be visible</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ShowExtraPinsPinName</span><span class="p">;</span>
<span class="c1">//.cpp</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ShowHidden&quot;</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Show Extra Node Pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ShowExtraPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">ShowExtraPin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will show extra pins if checked&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ShowExtraPin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><a class="glightbox" href="../images/4a137194c890340ebf6e682f06186b7f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4a137194c890340ebf6e682f06186b7f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4a137194c890340ebf6e682f06186b7f.png" /></a></p>
<p>Новые пины могут быть добавлены в ноду и после ее сборки, но за первоначальный набор нод отвечает именно <code>AllocateDefaultPins</code>.</p>
<h3 id="createpin"><code>CreatePin</code></h3>
<p>Метод <code>CreatePin</code> используется для регистрации новых пинов у <code>K2</code> ноды.</p>
<p>В приведенном выше примере создаются два пина для ноды - входной и выходной, соответственно.</p>
<p>Аргументы этого метода выглядят так:
<div class="highlight"><pre><span></span><code><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span>
<span class="w">    </span><span class="n">EEdGraphPinDirection</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="c1">// bin node direction: input | output</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">PinCategory</span><span class="p">,</span><span class="w"> </span><span class="c1">// pin type</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">,</span><span class="w"> </span><span class="c1">// pin text name</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FCreatePinParams</span><span class="o">&amp;</span><span class="w"> </span><span class="n">PinParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FCreatePinParams</span><span class="p">())</span><span class="w"> </span><span class="c1">// used to set pin params, such as: `bIsConst`, `bIsReference`, `Index`</span>
<span class="p">{</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></p>
<h4 id="eedgraphpindirection-direction">Параметр <code>EEdGraphPinDirection Direction</code></h4>
<p>Данный параметр отвечает за расположение пина внутри <code>K2</code> ноды.</p>
<p>Он принимает следующие значения:
<code>EGPD_Input</code> - пин будет добавлен в начало ноды</p>
<p><a class="glightbox" href="../images/5ff0b23d6f40c13fb8a2cfd1b003ef79.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5ff0b23d6f40c13fb8a2cfd1b003ef79.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5ff0b23d6f40c13fb8a2cfd1b003ef79.png" /></a></p>
<p><code>EGPD_Output</code> - пин будет добавлен в конец ноды</p>
<p><a class="glightbox" href="../images/c96341235ddb1605ed9f97f64f4dccce.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c96341235ddb1605ed9f97f64f4dccce.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c96341235ddb1605ed9f97f64f4dccce.png" /></a></p>
<h4 id="const-fname-pincategory">Параметр <code>const FName PinCategory</code></h4>
<p>Отвечает за тип данных, который относится к пину.</p>
<p>Данный параметр берется из перечилсения <code>UEdGraphSchema_K2</code>.
Типов у перечисления крайне много, полный их список можно найти в файле <code>\Engine\Source\Editor\BlueprintGraph\Classes\EdGraphSchema_K2.h</code>.</p>
<p><a class="glightbox" href="../images/954edac976ad51936cdc6db12095a51d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="954edac976ad51936cdc6db12095a51d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/954edac976ad51936cdc6db12095a51d.png" /></a></p>
<p><code>int</code> пин задается так:
<div class="highlight"><pre><span></span><code><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IntPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">);</span>
</code></pre></div>
<code>Exec</code> пин задается так:
<div class="highlight"><pre><span></span><code><span class="c1">// second output exec pin</span>
<span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Out Exec&quot;</span><span class="p">));</span>
</code></pre></div></p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/51e0a00c996b9ed247f1f70d96fbb378.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="51e0a00c996b9ed247f1f70d96fbb378.png" auto_="auto;" display="block;" margin:="margin:" src="../images/51e0a00c996b9ed247f1f70d96fbb378.png" /></a></p>
<p>Пину можно добавить подсказку <code>tooltip</code> следующим образом:
<div class="highlight"><pre><span></span><code><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="c1">// second output exec pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OutExecPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Out Exec&quot;</span><span class="p">));</span>
<span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">OutExecPin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Out Exec Pin Tooltip&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">OutExecPin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/10f68a29b6b05b4825235d91e4859283.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="10f68a29b6b05b4825235d91e4859283.png" auto_="auto;" display="block;" margin:="margin:" src="../images/10f68a29b6b05b4825235d91e4859283.png" /></a></p>
<h4 id="pinname">Параметр <code>PinName</code></h4>
<p>Данный параметр позволяет задать пину текстовую метку. По этой метке можно будет найти пин в будущем.</p>
<p>В системе есть ряд готовых текстовых меток, их можно найти в перечислении <code>UEdGraphSchema_K2</code>.</p>
<p><a class="glightbox" href="../images/c05ecd7f1664b2a7f48a9f27c55e2e96.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c05ecd7f1664b2a7f48a9f27c55e2e96.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c05ecd7f1664b2a7f48a9f27c55e2e96.png" /></a></p>
<p>В частности, метки <code>execute</code> и <code>then</code> соответствуют входному и выходному пину.
<div class="highlight"><pre><span></span><code><span class="c1">// Add execution pins</span>
<span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
</code></pre></div>
Крайне рекомендуется создавать под названия пинов отдельные <code>static const</code> переменные внутри класса.</p>
<p>Например, для входящего цифрового параметра ноды <code>IntInputParam</code> в классе была создана соответствующая <code>static const</code> переменная.</p>
<p><a class="glightbox" href="../images/2e61d556a32a58a60702eebb3a7550fc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2e61d556a32a58a60702eebb3a7550fc.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2e61d556a32a58a60702eebb3a7550fc.png" /></a></p>
<p><div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;IntInputParam&quot;</span><span class="p">);</span>
</code></pre></div>
Эти переменные пригодятся нам не только для создания пинов, но так-же и для их поиска с помощью <code>FindPin</code>.</p>
<h4 id="pinparams">Параметр <code>PinParams</code></h4>
<p>Позволяет изменить параметры для конкретного пина. Например пин можно превратить в массив или передавать его значение по ссылке.</p>
<p>Пин, передающий значение по ссылке, делается так:
<div class="highlight"><pre><span></span><code><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">PinParams</span><span class="p">;</span>
<span class="n">PinParams</span><span class="p">.</span><span class="n">bIsReference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// this pin will be refrence</span>
<span class="c1">// int data pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IntPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">,</span><span class="w"> </span><span class="n">PinParams</span><span class="p">);</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/631cfac3105c5d774326770ddf901c07.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="631cfac3105c5d774326770ddf901c07.png" auto_="auto;" display="block;" margin:="margin:" src="../images/631cfac3105c5d774326770ddf901c07.png" /></a></p>
<p>Пин целочисленного массива делается так:
<div class="highlight"><pre><span></span><code><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">PinParams</span><span class="p">;</span>
<span class="n">PinParams</span><span class="p">.</span><span class="n">ContainerType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPinContainerType</span><span class="o">::</span><span class="n">Array</span><span class="p">;</span>
<span class="c1">// int data pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IntPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">,</span><span class="w"> </span><span class="n">PinParams</span><span class="p">);</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/292f1806a1f3e947cc6b00c7211f85ac.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="292f1806a1f3e947cc6b00c7211f85ac.png" auto_="auto;" display="block;" margin:="margin:" src="../images/292f1806a1f3e947cc6b00c7211f85ac.png" /></a></p>
<h4 id="_7">Значение "по умолчанию" для пина</h4>
<p>Некоторым типам пинов можно задать значение "по умолчанию".</p>
<p>Для этого есть два параметра <code>UEdGraphPin::AutogeneratedDefaultValue</code> и <code>UEdGraphPin::DefaultValue</code>.
Параметр <code>UEdGraphPin::AutogeneratedDefaultValue</code> автоматически генерируемое значение пина при его создании.</p>
<p>Параметр <code>UEdGraphPin::DefaultValue</code> задает значение пина "по умолчанию" для пинов, к которым ничего не подведено.</p>
<p>На практике надо использовать оба параметра.
<code>int</code> пин с числом <code>3</code>:
<div class="highlight"><pre><span></span><code><span class="c1">// int data pin</span>
<span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">PinParams</span><span class="p">;</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IntPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">,</span><span class="w"> </span><span class="n">PinParams</span><span class="p">);</span>
<span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">IntPinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">FromInt</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">IntPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IntPinValue</span><span class="p">;</span>
<span class="n">IntPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IntPinValue</span><span class="p">;</span>
</code></pre></div>
<code>bool</code> пин со значением <code>true</code>:
<div class="highlight"><pre><span></span><code><span class="c1">// boolean data  pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">BoolPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">BoolPinName</span><span class="p">);</span>
<span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">);</span>
<span class="n">BoolPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="p">;</span>
<span class="n">BoolPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="p">;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/bb384d27ae7d01a16ed1d4dd71a10e77.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bb384d27ae7d01a16ed1d4dd71a10e77.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bb384d27ae7d01a16ed1d4dd71a10e77.png" /></a></p>
<p><code>FString</code> пин с текстовым значением:
<div class="highlight"><pre><span></span><code><span class="c1">// string data  pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">StringPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_String</span><span class="p">,</span><span class="w"> </span><span class="n">StringPinName</span><span class="p">);</span>
<span class="n">StringPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Test String Value&quot;</span><span class="p">);</span>
<span class="n">StringPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Test String Value&quot;</span><span class="p">);</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/4b8a032398e42d5d3c3a760ae19cc6f0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4b8a032398e42d5d3c3a760ae19cc6f0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4b8a032398e42d5d3c3a760ae19cc6f0.png" /></a></p>
<p>Пин класса, с присвоенным значением "по умолчанию":
<div class="highlight"><pre><span></span><code><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Class</span><span class="p">,</span><span class="w"> </span><span class="n">AActor</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">ClassPinName</span><span class="p">);</span>
<span class="n">FString</span><span class="w"> </span><span class="n">StringClassPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Blueprint&#39;/Game/Characters/BP_ACharacterTestChild.BP_ACharacterTestChild&#39;&quot;</span><span class="p">);</span>
<span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringClassPath</span><span class="p">;</span>
<span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringClassPath</span><span class="p">;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/2d144a2dfe054a6edba8fb2ca782bb16.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2d144a2dfe054a6edba8fb2ca782bb16.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2d144a2dfe054a6edba8fb2ca782bb16.png" /></a></p>
<p>Объект на который я ссылаюсь выглядит так:</p>
<p><a class="glightbox" href="../images/a2e952af0749f7d0085c8a9c3530bc1e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a2e952af0749f7d0085c8a9c3530bc1e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a2e952af0749f7d0085c8a9c3530bc1e.png" /></a></p>
<p>Ссылка получена через пункт меню <code>Copy Refrence</code>.</p>
<p><a class="glightbox" href="../images/ab218a0059349072136b19a7716fe826.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ab218a0059349072136b19a7716fe826.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ab218a0059349072136b19a7716fe826.png" /></a></p>
<p>Пин <code>self</code> создается так:
<div class="highlight"><pre><span></span><code><span class="c1">// self pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">SelfPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PSC_Self</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Self</span><span class="p">);</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/2e7e447eda9ad9e0dd80e50518e2bb60.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2e7e447eda9ad9e0dd80e50518e2bb60.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2e7e447eda9ad9e0dd80e50518e2bb60.png" /></a></p>
<p>Пин делегата:
<div class="highlight"><pre><span></span><code><span class="c1">// Test Delegate Pin</span>
<span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Delegate</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InDelegate&quot;</span><span class="p">));</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/64033c60ca4ba190d7e9e8e4da6e86a9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="64033c60ca4ba190d7e9e8e4da6e86a9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/64033c60ca4ba190d7e9e8e4da6e86a9.png" /></a></p>
<p>Пин <code>Exec</code> задается так:
<div class="highlight"><pre><span></span><code><span class="c1">// second output exec pin</span>
<span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Out Exec&quot;</span><span class="p">));</span>
</code></pre></div></p>
<p 0="0" align="center;" auto_="auto;" display="block;" margin:="margin:"><a class="glightbox" href="../images/51e0a00c996b9ed247f1f70d96fbb378.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="51e0a00c996b9ed247f1f70d96fbb378.png" auto_="auto;" display="block;" margin:="margin:" src="../images/51e0a00c996b9ed247f1f70d96fbb378.png" /></a></p>
<h3 id="reallocatepinsduringreconstruction">Обновление пинов в ноде, <code>ReallocatePinsDuringReconstruction</code></h3>
<p>Метод <code>ReallocatePinsDuringReconstruction</code> удаляет все имеющиеся в ноде пины и позволяет сгенерировать новые. Он срабатывает, когда разработчик вызывает операцию <code>Refresh Nodes</code> из контекстного меню ноды.</p>
<p><a class="glightbox" href="../images/5fe28e6924433de6d7ce1b921900720f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="5fe28e6924433de6d7ce1b921900720f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/5fe28e6924433de6d7ce1b921900720f.png" /></a></p>
<p>Формат метода:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// used to change pins in runtime</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// used to change pins in runtime</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AllocateDefaultPins</span><span class="p">();</span><span class="w"> </span><span class="c1">// this will load default exec pins</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Reconstruction&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// main function code</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetShowExtraPinValue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GenerateExtraPins</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// restore pins that was split</span>
<span class="w">    </span><span class="n">RestoreSplitPins</span><span class="p">(</span><span class="n">OldPins</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Для тестирования нам понадобится переменная:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// if this pin is True, then all rest pins will be visible</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ShowExtraPinsPinName</span><span class="p">;</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/ba3dcabb3e489e59f2ccc59e7ecb4866.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ba3dcabb3e489e59f2ccc59e7ecb4866.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ba3dcabb3e489e59f2ccc59e7ecb4866.png" /></a></p>
<p>Задумка такова: если переменная <code>bExpandNode</code> выставлена в <code>True</code>, то в ноде, после обновления, должны будут появиться дополнительные пины. За генерацию дополнительных пинов отвечает метод <code>GenerateExtraPins</code>.
В данный момент он выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// will generate extra pins</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">GenerateExtraPins</span><span class="p">();</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// will generate extra pins</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::GenerateExtraPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// another output exec pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">OutExecPinName</span><span class="p">);</span>
<span class="w">        </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Out Exec Pin Tooltip&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// generate class pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Class</span><span class="p">,</span><span class="w"> </span><span class="n">AActor</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">);</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Blueprint&#39;/Game/Characters/BP_ACharacterTestChild.BP_ACharacterTestChild&#39;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// generate ACharacter object pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">,</span><span class="w"> </span><span class="n">ACharacter</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ObjectPinName</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// there is no default value, it&#39;s object pin</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// generate DataAsset pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">,</span><span class="w"> </span><span class="n">UDataAsset</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">DataPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/DataAccess.CharacterData&#39;/Game/Characters/Data/DA_Character.DA_Character&#39;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//UDataAsset* Asset = LoadObject&lt;UDataAsset&gt;(NULL, *PinValue);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UKismetSystemLibrary</span><span class="o">::</span><span class="n">MakeSoftObjectPath</span><span class="p">(</span><span class="n">PinValue</span><span class="p">).</span><span class="n">ResolveObject</span><span class="p">();</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// generate int pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">PinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//PinParams.ContainerType = EPinContainerType::Array;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span><span class="p">,</span><span class="w"> </span><span class="n">PinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">//FString::FromInt(3);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Struct pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.ContainerType = EPinContainerType::Set;</span>
<span class="w">        </span><span class="c1">//InPinParams.ValueTerminalType = FEdGraphTerminalType::bTerminalIsUObjectWrapper;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TestStructPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="c1">// *note: we can&#39;t directly set default struct values</span>
<span class="w">        </span><span class="c1">// instead we should export struct as i did it below</span>
<span class="w">        </span><span class="n">FTestPinData</span><span class="w"> </span><span class="n">Data</span><span class="p">;</span><span class="w"> </span><span class="c1">// we gonna export this struct variable</span>
<span class="w">        </span><span class="n">Data</span><span class="p">.</span><span class="n">Number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">        </span><span class="n">Data</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Data</span><span class="p">.</span><span class="n">InlineRotator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotator</span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="n">Data</span><span class="p">.</span><span class="n">InlineVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">Struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">();</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">StrStructValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">//string struct value</span>
<span class="w">        </span><span class="c1">// this method will serialize struct fields to string StrStructValue, fields taked from variable Data</span>
<span class="w">        </span><span class="n">Struct</span><span class="o">-&gt;</span><span class="n">ExportText</span><span class="p">(</span><span class="n">StrStructValue</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PPF_ExportsNotFullyQualified</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_Copy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_Delimited</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_IncludeTransient</span><span class="p">),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// pin will automatically deserialize DefaultValue on the node itself</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StrStructValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StrStructValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// string data pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_String</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">StringPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Test String Value&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// boolean data pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">BoolPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// GameplayTag pin</span>
<span class="w">    </span><span class="c1">//*note: Add &quot;GameplayTags&quot; as Module Dependancy or this won&#39;t work!</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TAG_FROZEN</span><span class="p">.</span><span class="n">GetTag</span><span class="p">().</span><span class="n">ToString</span><span class="p">();</span><span class="w"> </span><span class="c1">//TEXT(&quot;State.Frozen&quot;);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// GameplayTagContainer pin</span>
<span class="w">    </span><span class="c1">//*note: Add &quot;GameplayTags&quot; as Module Dependancy or this won&#39;t work!</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagContainerPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// build container</span>
<span class="w">        </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">Container</span><span class="p">;</span>
<span class="w">        </span><span class="n">Container</span><span class="p">.</span><span class="n">AddTag</span><span class="p">(</span><span class="n">TAG_FROZEN</span><span class="p">);</span>
<span class="w">        </span><span class="n">Container</span><span class="p">.</span><span class="n">AddTag</span><span class="p">(</span><span class="n">TAG_STUN</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// set default value</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Container</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Vector pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">        </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">VectorStruct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TBaseStructure</span><span class="o">&lt;</span><span class="n">FVector</span><span class="o">&gt;::</span><span class="n">Get</span><span class="p">();</span><span class="w"> </span><span class="c1">// well... i&#39;d never expected THIS</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">VectorStruct</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">VectorPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1.4, 0.3, 0.0&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Rotator pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">        </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">RotatorStruct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TBaseStructure</span><span class="o">&lt;</span><span class="n">FRotator</span><span class="o">&gt;::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">RotatorStruct</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">RotatorPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1.4, 0.3, 0.0&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Test Delegate Pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Delegate</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InDelegate&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Принцип работы логики таков: в методе <code>AllocateDefaultPins</code> есть пин, отвечающий за показ других пинов и "разворачивание" ноды, он называется <code>ShowExtraPin</code>.</p>
<p><a class="glightbox" href="../images/944631c9876be52e1afdeb4e156e3809.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="944631c9876be52e1afdeb4e156e3809.png" auto_="auto;" display="block;" margin:="margin:" src="../images/944631c9876be52e1afdeb4e156e3809.png" /></a></p>
<p>В методе <code>ReallocatePinsDuringReconstruction</code> выполняется проверка значения данного пина.
<div class="highlight"><pre><span></span><code><span class="c1">// used to change pins in runtime</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AllocateDefaultPins</span><span class="p">();</span><span class="w"> </span><span class="c1">// this will load default exec pins</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Reconstruction&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// main function code</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetShowExtraPinValue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GenerateExtraPins</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// restore pins that was split</span>
<span class="w">    </span><span class="n">RestoreSplitPins</span><span class="p">(</span><span class="n">OldPins</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Если при обновлении узла пин <code>ShowExtra</code> выставлен в <code>true</code> - срабатывает метод <code>GenerateExtraPins</code>, который отображает новые пины.</p>
<p><a class="glightbox" href="../images/b4093fbec9f2e126d799ce88751a327a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b4093fbec9f2e126d799ce88751a327a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b4093fbec9f2e126d799ce88751a327a.png" /></a></p>
<p>Проверка состояния пина <code>ShowExtra</code> выполняется в методе <code>GetShowExtraPinValue</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// pin value getter for bExpandNode</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">GetShowExtraPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// pin value getter for ShowExtraPinsPinName</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">UK2NodeTest::GetShowExtraPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">PinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pins</span><span class="p">;</span><span class="w"> </span><span class="c1">// *note: &quot;Pins&quot; is all K2 Node current pins list</span>
<span class="w">    </span><span class="c1">// in given pins list search for desired pin, in our case  is&#39;t ShowExtraPinsPinName</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">TestPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">PinsToSearch</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TestPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">TestPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="p">)</span><span class="w"> </span><span class="c1">// if this pin is ExpandNotePin</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestPin</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// exit of loop</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// just extra check in case if previous loop dosen&#39;t found anything</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// no such pin</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// connections, linked to pin, can be accessed thru array: Pin-&gt;LinkedTo</span>
<span class="w">    </span><span class="c1">// first connection is Pin-&gt;LinkedTo[0]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// if pin dosen&#39;t linked to anything - just get it&#39;s Default Value</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="p">.</span><span class="n">ToBool</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="c1">// if pin is linked to some logic</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// pin can be linked to variable or function</span>
<span class="w">        </span><span class="c1">// i want to read linked variable or function pin&#39;s default value, and return it as result</span>
<span class="w">        </span><span class="c1">// get first pin that we are linked to</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">PinSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PinSource</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// no connected nodes</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// debug</span>
<span class="w">        </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;Source Pin Name = %s&quot;), *PinSource-&gt;PinName.ToString())</span>
<span class="w">        </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;Blueprint Node Name = %s&quot;), *PinSource-&gt;GetOwningNode()-&gt;GetName())</span>
<span class="w">        </span><span class="c1">// search blueprint, that has current K2 node</span>
<span class="w">        </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">PinSource</span><span class="o">-&gt;</span><span class="n">GetOwningNode</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetGraph</span><span class="p">());</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Blueprint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// it&#39;s impossible to trigger, but let it be</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// &quot;blueprint variable&quot; is &quot;blueprint property&quot;</span>
<span class="w">        </span><span class="c1">// we can read any of the variables inside given blueprint</span>
<span class="w">        </span><span class="c1">// we need so, because user can link to our ShowExtraPin any variable, and i want to read linked variable default value</span>
<span class="w">        </span><span class="n">FProperty</span><span class="o">*</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindFProperty</span><span class="o">&lt;</span><span class="n">FProperty</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Blueprint</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span><span class="p">,</span><span class="w"> </span><span class="n">PinSource</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// we dealing with linked boolean property</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Property</span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">IsA</span><span class="p">(</span><span class="n">FBoolProperty</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">FString</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// parse variable property and get it&#39;s DefaultValue</span>
<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsVariableLinked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintCompilationManager</span><span class="o">::</span><span class="n">GetDefaultValue</span><span class="p">(</span><span class="n">Blueprint</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsVariableLinked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// UE_LOG(LogTemp, Warning, TEXT(&quot;Linked Variable Default Value = %s&quot;), *DefaultValueAsString)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">.</span><span class="n">ToBool</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// we dealing with function property</span>
<span class="w">            </span><span class="c1">// since all code below dosen&#39;t make sense, just return pin default value</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="p">.</span><span class="n">ToBool</span><span class="p">();</span>
<span class="w">            </span><span class="c1">// even if this dosen&#39;t make sence, it&#39;s still usefull information to read</span>
<span class="w">            </span><span class="c1">// It&#39;s impossible to directly access DefaultValue from blueprint pin</span>
<span class="w">            </span><span class="c1">// we can get node, that connected to our node, in our case it&#39;s function node, but we can&#39;t get pin&#39;s default value</span>
<span class="w">            </span><span class="c1">// *note1: this code dosen&#39;t work with booleans! why so? well, it&#39;s because old bug in the engine</span>
<span class="w">            </span><span class="c1">// *note2: actually, we can evaluate blueprint functions by their names, why not do so?</span>
<span class="w">            </span><span class="c1">// well, because we don&#39;t know exact signature of function, that has currently linked pin</span>
<span class="w">            </span><span class="c1">// which pin is it. is it return pin or any else? what args function has?</span>
<span class="w">            </span><span class="cm">/*UEdGraphNode* Node = PinSource-&gt;GetOwningNode();</span>
<span class="cm">            UK2Node_CallFunction *FunctionCall = Cast&lt;UK2Node_CallFunction&gt;(PinSource-&gt;GetOwningNode());</span>
<span class="cm">            if (FunctionCall != nullptr) {</span>
<span class="cm">                UE_LOG(LogTemp, Warning, TEXT(&quot;This is Function Node&quot;))</span>
<span class="cm">                /*</span>
<span class="cm">                // we can try to get connected function return value by executing it</span>
<span class="cm">                // this won&#39;t work, because bp functions are runtime functions</span>
<span class="cm">                // in Editor space, where  K2 nodes are work in, no WorldObject</span>
<span class="cm">                // so this will just return true no matter what you do</span>
<span class="cm">                UFunction* BoundFunc = FunctionCall-&gt;GetTargetFunction();</span>
<span class="cm">                struct FBoolRetvalArgs</span>
<span class="cm">                {</span>
<span class="cm">                    bool Value;</span>
<span class="cm">                };</span>
<span class="cm">                FBoolRetvalArgs Arguments;</span>
<span class="cm">                Blueprint-&gt;ProcessEvent(BoundFunc, &amp;Arguments);</span>
<span class="cm">                return Arguments.Value;*\/</span>
<span class="cm">                /////////</span>
<span class="cm">                // this is alternative approach where i try to read function node pin itself, as i did with the variables</span>
<span class="cm">                // with no luck, it will anyway return false</span>
<span class="cm">                FProperty* FuncProperty = FunctionCall-&gt;GetTargetFunction()-&gt;GetReturnProperty();</span>
<span class="cm">                if (FuncProperty != nullptr &amp;&amp; FuncProperty-&gt;IsA(FBoolProperty::StaticClass())) {</span>
<span class="cm">                    FString DefaultValueAsString;</span>
<span class="cm">                    bool IsVariableLinked = FBlueprintCompilationManager::GetDefaultValue(Blueprint-&gt;GeneratedClass, FuncProperty, DefaultValueAsString);</span>
<span class="cm">                    if (IsVariableLinked) {</span>
<span class="cm">                        UE_LOG(LogTemp, Warning, TEXT(&quot;Function Return Default Value = %s&quot;), *DefaultValueAsString)</span>
<span class="cm">                        return DefaultValueAsString.ToBool();</span>
<span class="cm">                    }</span>
<span class="cm">                }</span>
<span class="cm">            }*/</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Сложность реализации метода <code>GetShowExtraPinValue</code> связана с простым, но не всегда очевидным фактом: получить значение пинов в <code>blueprint</code> ноде напрямую нельзя. Потому что к пинам могут быть подключены другие пины, создавая сложные цепочки.</p>
<p><a class="glightbox" href="../images/903fb570e748fc14d39656fadd89b700.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="903fb570e748fc14d39656fadd89b700.png" auto_="auto;" display="block;" margin:="margin:" src="../images/903fb570e748fc14d39656fadd89b700.png" /></a></p>
<p>Вычислить базовое значение, которое будет в пине при выполнении длинной цепочки из <code>blueprint</code> нод - нельзя. Получение значения подведенной к пину переменной - это все, чего мне удалось добиться.</p>
<p><a class="glightbox" href="../images/b323b0710c239607b2681b999c63de82.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b323b0710c239607b2681b999c63de82.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b323b0710c239607b2681b999c63de82.png" /></a></p>
<p>Свои исследования из кода я удалять не стал, вместо этого, закомментировав его и оставив для изучения.</p>
<p><a class="glightbox" href="../images/a4e7af5354ebf88f999e147331bdb91e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a4e7af5354ebf88f999e147331bdb91e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a4e7af5354ebf88f999e147331bdb91e.png" /></a></p>
<p>Важное замечание. Метод <code>ReallocatePinsDuringReconstruction</code> срабатывает только если вручную вызвать команду <code>Refresh Nodes</code> на выбранной <code>K2</code> ноде.</p>
<p><a class="glightbox" href="../images/c7e8dc47916c98fc6619858364fca1ce.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c7e8dc47916c98fc6619858364fca1ce.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c7e8dc47916c98fc6619858364fca1ce.png" /></a></p>
<p><a class="glightbox" href="../images/fd4ec0110a3f390e87562b4f30048abf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="fd4ec0110a3f390e87562b4f30048abf.png" auto_="auto;" display="block;" margin:="margin:" src="../images/fd4ec0110a3f390e87562b4f30048abf.png" /></a></p>
<p>Чтобы нода обновлялась автоматически, при изменении соединения или значения пина - надо реализовать соответствующую логику отслеживания.</p>
<h3 id="pindefaultvaluechanged">Отслеживание изменений пина <code>PinDefaultValueChanged</code></h3>
<p>Метод <code>PinDefaultValueChanged</code> позволяет отследить момент изменения пина, чтобы обновить ноду или провести какие-то внутренние оперции в ней.</p>
<p>В наивной реализации этого метода мы можем просто вызывать <code>ReconstructNode</code>, чтобы пересобирать ноду всякий раз, как значение пинов меняется:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// used to determine pin changes</span>
<span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="c1">// toggle reconstruction</span>
<span class="w">        </span><span class="n">ReconstructNode</span><span class="p">();</span>

<span class="w">        </span><span class="n">RestoreSplitPins</span><span class="p">(</span><span class="n">Pins</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Refresh the UI for the graph so the pin changes show up</span>
<span class="w">        </span><span class="n">GetGraph</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NotifyGraphChanged</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// Mark dirty</span>
<span class="w">        </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">MarkBlueprintAsModified</span><span class="p">(</span><span class="n">GetBlueprint</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Однако, в движке возникнет сбой, если попытаться вызвать для любого из пинов такой ноды опцию, из выпадающего по пкм, меню под названием <code>Promote To Variable</code>.</p>
<p><a class="glightbox" href="../images/8c10a40d3a3a2875433a12714c078ed7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8c10a40d3a3a2875433a12714c078ed7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8c10a40d3a3a2875433a12714c078ed7.png" /></a></p>
<p><a class="glightbox" href="../images/97a2f4a622e46b071afbcda852ae8e9c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="97a2f4a622e46b071afbcda852ae8e9c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/97a2f4a622e46b071afbcda852ae8e9c.png" /></a></p>
<p>Причина сбоя крайне проста - при вызове метода <code>ReconstructNode</code> сбрасываются все пины и соединения ноды.</p>
<p>В том числе сбрасывается тот пин, для которого мы пытаемся создать переменную через операцию <code>Promote To Variable</code>.
Чтобы обойти эту проблему, придется вручную удалять старые пины и добавлять новые.</p>
<h4 id="_8">Удаление добавленных пинов</h4>
<p>Чтобы удалять сгенерированные пины, нам нужен массив который будет хранить в себе ссылки на эти пины.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">//...</span>
<span class="k">private</span><span class="o">:</span>
<span class="c1">// cache for visible pins, that are revealed by checking ShowExtraPins</span>
<span class="c1">// used to remove pins, when ShowExtraPins is Unchecked</span>
<span class="n">UPROPERTY</span><span class="p">()</span><span class="w"> </span><span class="c1">// to allow copying and serialisation of this param we should make it UPROPERTY</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExtraPinsCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/3ee607492deb27377d428b115010bf16.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3ee607492deb27377d428b115010bf16.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3ee607492deb27377d428b115010bf16.png" /></a></p>
<p>Поскольку <code>K2</code> ноды предполагается копировать или дублировать, параметры, которые надо копировать и дублировать вместе с нодой, должны быть <code>UPROPERTY</code>. В том числе и наш массив <code>ExtraPinsCache</code> тоже должен быть <code>UPROPERTY</code>. Это обязательно.</p>
<p>Почему я храню в массиве не прямую ссылку на ноду, а ее имя <code>FName</code>?
Потому что ноду предполагается копировать или дублировать.</p>
<p>Если хранить прямой указатель на пин в массиве, например в таком <code>TArray&lt;UEdGraphPin*&gt;</code>, то такой массив не получится сделать <code>UPROPERTY</code>, потому что тип <code>UEdGraphPin</code> не <code>BlueprintType</code>. Более того, даже если это получится сделать, у нас будут большие проблемы с копированием ноды. Значения указателей в скопированной ноде, все еще будут указывать на адреса памяти оригинальной ноды, что приведет к опасному и непредсказуемому поведению. Именно поэтому список пинов, размещенных в ноде, я решил хранить внутри массива типа <code>FName</code>.
Более того, такой подход, при удалении пинов, позволяет нам так-же удалять и суб пины.</p>
<p>Например, если выполнить операцию <code>Split Struct Pin</code> на пине нашей структуры,  можно увидеть, что каждый из созданных суб пинов имеет то-же имя + суффикс. Я воспользуюсь этой замечательной особенностью системы.</p>
<p><a class="glightbox" href="../images/d2de3dc21266e3418dee6c67ce812b3d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d2de3dc21266e3418dee6c67ce812b3d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d2de3dc21266e3418dee6c67ce812b3d.png" /></a></p>
<p><a class="glightbox" href="../images/463a68dbe061df75dfb7b89b7d05d7af.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="463a68dbe061df75dfb7b89b7d05d7af.png" auto_="auto;" display="block;" margin:="margin:" src="../images/463a68dbe061df75dfb7b89b7d05d7af.png" /></a></p>
<p>При каждом создании пина внутри метода <code>GenerateExtraPins</code>, необходимо добавлять имя этого пина в массив <code>ExtraPinsCache</code>.
<div class="highlight"><pre><span></span><code><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
</code></pre></div>
В данный момент это выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// another output exec pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">OutExecPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Out Exec Pin Tooltip&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">    </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="p">}</span>
<span class="c1">// ...</span>
<span class="c1">// other pins</span>
</code></pre></div>
Теперь, используя массив <code>ExtraPinsCache</code>, мы можем удалить все пины, которые генерируются в методе <code>GenerateExtraPins</code>. Для этих целей я написал метод <code>RemovePinByName</code>, который удаляет пин по его имени .
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">UK2NodeTest::RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// code below will remove elements from array of Pins</span>
<span class="w">    </span><span class="c1">// array itself shrinks towards the beginning when elements are removed</span>
<span class="w">    </span><span class="c1">// and if we do loop from index - to Pins.Num() we will have problems with &quot;out of bounds&quot; error</span>
<span class="w">    </span><span class="c1">// so it&#39;s important to do reversed foor loop</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CurrentPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<span class="w">        </span><span class="c1">// if names are same or same+suffix (for expanden pins such as structs)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">BreakAllPinLinks</span><span class="p">();</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">MarkAsGarbage</span><span class="p">();</span>
<span class="w">            </span><span class="n">Pins</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">MarkBlueprintAsModified</span><span class="p">(</span><span class="n">GetBlueprint</span><span class="p">());</span>
<span class="w">    </span><span class="n">GetGraph</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NotifyGraphChanged</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Далее я добавил метод <code>RemoveMultiplePinsByNames</code>, в который можно отправить массив типа <code>TArray&lt;FName&gt;</code>:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// will remove pins from provided name array</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">NameList</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// will remove pins from provided name array</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::RemoveMultiplePinsByNames</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">NameList</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NameList</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">NameList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemovePinByName</span><span class="p">(</span><span class="n">Name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">NameList</span><span class="o">-&gt;</span><span class="n">Empty</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
Поскольку у нас уже есть массив с коллекцией названий, для удаляемых пинов, все что остается - использовать его.</p>
<p>В самом начале метода <code>GenerateExtraPins</code> я добавил следующий код:
<div class="highlight"><pre><span></span><code><span class="c1">// if previously generated pins still exist</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ExtraPinsCache</span><span class="p">);</span><span class="w"> </span><span class="c1">// remove previous pins</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/125b125147209a3c5d383af375d36244.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="125b125147209a3c5d383af375d36244.png" auto_="auto;" display="block;" margin:="margin:" src="../images/125b125147209a3c5d383af375d36244.png" /></a></p>
<p>Таким образом, если в кеше <code>ExtraPinsCache</code> есть элементы, перед добавлением новых элементов - происходит автоматическое удаление старых.</p>
<p>Чтобы добиться показывания и скрытия пинов, надо в методе <code>PinDefaultValueChanged</code> отследить состояние пина <code>ShowExtraPins</code>. Если он имеет значение <code>true</code> то пины генерируются, если <code>false</code> то удаляются.
<div class="highlight"><pre><span></span><code><span class="c1">// used to determine pin changes</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PinDefaultValueChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// skip null</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin default value changed&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// show extra pins</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetShowExtraPinValue</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if ShowExtraPins checked - show extra pins and class pins as well</span>
<span class="w">            </span><span class="c1">// re-generate hidden pins</span>
<span class="w">            </span><span class="n">GenerateExtraPins</span><span class="p">();</span>
<span class="w">            </span><span class="n">RestoreSplitPins</span><span class="p">(</span><span class="n">Pins</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if ShowExtraPins unchecked - hide everything by clearing both pin groups</span>
<span class="w">            </span><span class="c1">// clear pins</span>
<span class="w">            </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ExtraPinsCache</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Refresh the UI for the graph so the pin changes show up</span>
<span class="w">    </span><span class="n">GetGraph</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NotifyGraphChanged</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Mark dirty</span>
<span class="w">    </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">MarkBlueprintAsModified</span><span class="p">(</span><span class="n">GetBlueprint</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/efbbfd18b5f853939df1bcc166fded36.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="efbbfd18b5f853939df1bcc166fded36.png" auto_="auto;" display="block;" margin:="margin:" src="../images/efbbfd18b5f853939df1bcc166fded36.png" /></a></p>
<p><a class="glightbox" href="../images/0000709727bd144b83e32a96ce66212d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0000709727bd144b83e32a96ce66212d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0000709727bd144b83e32a96ce66212d.png" /></a></p>
<h4 id="removepin">Метод <code>RemovePin</code> и его проблемы</h4>
<p>Разработчику доступен метод <code>UEdGraphNode::RemovePin</code>, почему я не использую его?  Напомню, что в моей реализации, пины удаляются через метод <code>Pins.RemoveAt(index)</code>.</p>
<p><a class="glightbox" href="../images/0b60ecbcbd281e5eb15f0ac83df4cb35.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0b60ecbcbd281e5eb15f0ac83df4cb35.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0b60ecbcbd281e5eb15f0ac83df4cb35.png" /></a></p>
<p><a class="glightbox" href="../images/77b1c0911695fb1baabbbbbe343c71a5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="77b1c0911695fb1baabbbbbe343c71a5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/77b1c0911695fb1baabbbbbe343c71a5.png" /></a></p>
<p>Вот как выглядит метод <code>RemovePinByName</code> с применением <code>RemovePin</code>:
<div class="highlight"><pre><span></span><code><span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">UK2NodeTest::RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// code below will remove elements from array of Pins</span>
<span class="w">    </span><span class="c1">// array itself shrinks towards the beginning when elements are removed</span>
<span class="w">    </span><span class="c1">// and if we do loop from index - to Pins.Num() we will have problems with &quot;out of bounds&quot; error</span>
<span class="w">    </span><span class="c1">// so it&#39;s important to do reversed foor loop</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CurrentPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<span class="w">        </span><span class="c1">// if names are same or same+suffix (for expanden pins such as structs)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">BreakAllPinLinks</span><span class="p">();</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">MarkAsGarbage</span><span class="p">();</span>
<span class="w">            </span><span class="n">RemovePin</span><span class="p">(</span><span class="n">CurrentPin</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//Pins.RemoveAt(index);</span>
<span class="w">            </span><span class="n">OnPinRemoved</span><span class="p">(</span><span class="n">CurrentPin</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">MarkBlueprintAsModified</span><span class="p">(</span><span class="n">GetBlueprint</span><span class="p">());</span>
<span class="w">    </span><span class="n">GetGraph</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NotifyGraphChanged</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/22bb4df32f245f73243b345e403fc687.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="22bb4df32f245f73243b345e403fc687.png" auto_="auto;" display="block;" margin:="margin:" src="../images/22bb4df32f245f73243b345e403fc687.png" /></a></p>
<p>К сожалению, вызов метода <code>RemovePin</code> приводит к сбою движка. Причем вам даже не напишет от чего возникла ошибка и где она появляется.</p>
<p><a class="glightbox" href="../images/16009bed8d9baf4ddb7d79cd6fc38b2b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="16009bed8d9baf4ddb7d79cd6fc38b2b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/16009bed8d9baf4ddb7d79cd6fc38b2b.png" /></a></p>
<p>Это достаточно старый баг, судя по коду, который мне довелось изучить. Другие разработчики стараются избегать прямого использования <code>RemovePin</code>.
Вы можете попробовать использовать данный метод самостоятельно, особенно если программируете не в <code>Unreal Engine 5.1</code>, а в какой-то последующей версии. Возможно в будущем баг исправят.</p>
<h3 id="k2_4">Пересборка <code>K2</code> ноды с сохранением имеющихся соединений</h3>
<p>Пины, которые уже имеют соединения, при их удалении и восстановлении - не обновляются. Вот как это выглядит:</p>
<p><a class="glightbox" href="../images/7abb99026713df4f6566d64988031c68.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7abb99026713df4f6566d64988031c68.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7abb99026713df4f6566d64988031c68.png" /></a></p>
<p><a class="glightbox" href="../images/2d5499bfcca089bb4d87d2619eff1276.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2d5499bfcca089bb4d87d2619eff1276.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2d5499bfcca089bb4d87d2619eff1276.png" /></a></p>
<p>К счастью эта проблема решаема.</p>
<p>Метод <code>DoPinsMatchForReconstruction</code> позволяет восстанавливать соединения для тех пинов, которые восстанавливаются или заменяются новыми. Делается это так:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// used to reconnect deprecated pin connections</span>
<span class="k">virtual</span><span class="w"> </span><span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="nf">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// used to reconnect deprecated pin connections</span>
<span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="nf">UK2NodeTest::DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// reconnect given pin types:</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ERedirectType_Name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ERedirectType_Name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Теперь, при вызове <code>ReallocatePinsDuringReconstruction</code> соединения между пересоздаваемыми пинами <code>ClassPinName</code> и <code>IntPinName</code> восстанавливаются корректно.</p>
<p><a class="glightbox" href="../images/cecbe2cf693bb4e2e3166d922f2c2591.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cecbe2cf693bb4e2e3166d922f2c2591.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cecbe2cf693bb4e2e3166d922f2c2591.png" /></a></p>
<p><a class="glightbox" href="../images/3fd233c1a01d18109aaac5f870d52573.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3fd233c1a01d18109aaac5f870d52573.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3fd233c1a01d18109aaac5f870d52573.png" /></a></p>
<h3 id="blueprint">Получение списка пинов у <code>Blueprint</code> объекта</h3>
<p>В <code>K2</code> доступна возможность получить доступ к <code>blueprint</code> объекту, в котором размещена текущая нода.</p>
<p>Делается это так:
<div class="highlight"><pre><span></span><code><span class="c1">// search blueprint, that has current K2 node</span>
<span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">PinSource</span><span class="o">-&gt;</span><span class="n">GetOwningNode</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetGraph</span><span class="p">());</span>
</code></pre></div>
Получив ссылку на <code>blueprint</code>, мы можем использовать его параметр <code>PropertyLink</code>.
Данный односвязный список <code>linked list</code> хранит в себе набор параметров, относящихся к текущему <code>UObject</code>.</p>
<p><a class="glightbox" href="../images/dfbdb16a7bd043e5768bca2a668a367d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="dfbdb16a7bd043e5768bca2a668a367d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/dfbdb16a7bd043e5768bca2a668a367d.png" /></a></p>
<p>Для разворачивания списка параметров объекта есть отдельный интерфейс - <code>TFieldIterator</code>.</p>
<p><a class="glightbox" href="../images/533c03d52a8fef3f3c36244a31045202.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="533c03d52a8fef3f3c36244a31045202.png" auto_="auto;" display="block;" margin:="margin:" src="../images/533c03d52a8fef3f3c36244a31045202.png" /></a></p>
<p>Именно через этот итератор разработчики <code>Unreal Engine</code> выводят список пинов отмеченных как <code>ExposeOnSpawn</code> в ноде <code>K2Node_ConstructObjectFromClass</code>.</p>
<p><a class="glightbox" href="../images/d0ac60847e0a848f5788b09e3d2eaeb0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d0ac60847e0a848f5788b09e3d2eaeb0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d0ac60847e0a848f5788b09e3d2eaeb0.png" /></a></p>
<p>Ознакомиться с кодом реализации такого подхода можно в файле <code>\Engine\Source\Editor\BlueprintGraph\Private\K2Node_ConstructObjectFromClass.cpp</code>.</p>
<p><a class="glightbox" href="../images/7e76a1e4a0251fe95f419397d92cf131.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7e76a1e4a0251fe95f419397d92cf131.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7e76a1e4a0251fe95f419397d92cf131.png" /></a></p>
<p>Используем аналогичный подход.
<div class="highlight"><pre><span></span><code><span class="c1">// search blueprint, that has current K2 node</span>
<span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetGraph</span><span class="p">();</span>
<span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Blueprint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// it&#39;s impossible to trigger, but let it be</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">InClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Blueprint</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span><span class="p">;</span><span class="w"> </span><span class="c1">// get current blueprint&#39;s class</span>
<span class="k">const</span><span class="w"> </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ClassDefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InClass</span><span class="o">-&gt;</span><span class="n">GetDefaultObject</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if this object exists in game memory</span>
<span class="c1">// iterate over current blueprint&#39;s fields</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TFieldIterator</span><span class="o">&lt;</span><span class="n">FProperty</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">(</span><span class="n">InClass</span><span class="p">,</span><span class="w"> </span><span class="n">EFieldIteratorFlags</span><span class="o">::</span><span class="n">IncludeSuper</span><span class="p">);</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">PropertyIt</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">FProperty</span><span class="o">*</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">PropertyIt</span><span class="p">;</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">PropertyClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastChecked</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetOwner</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="p">());</span><span class="w"> </span><span class="c1">// make sure we are on UObject</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsDelegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">IsA</span><span class="p">(</span><span class="n">FMulticastDelegateProperty</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">());</span><span class="w"> </span><span class="c1">// check if is Delegate</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsExposedToSpawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">IsPropertyExposedOnSpawn</span><span class="p">(</span><span class="n">Property</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property marked as Expose to Spawn</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsSettableExternally</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_DisableEditOnInstance</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property can be set externally</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">bIsExposedToSpawn</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_Parm</span><span class="p">)</span><span class="w"> </span><span class="c1">// make sure it&#39;s param</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bIsSettableExternally</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAllPropertyFlags</span><span class="p">(</span><span class="n">CPF_BlueprintVisible</span><span class="p">)</span><span class="w"> </span><span class="c1">// is visible to bp&#39;s</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">bIsDelegate</span><span class="w"> </span><span class="c1">// do not add delegates as pins</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">FindPin</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// make sure this pin dosen&#39;t exist</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">PropertyStillExists</span><span class="p">(</span><span class="n">Property</span><span class="p">))</span><span class="w"> </span><span class="c1">// make sure it&#39;s not pending delete with GC</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// create new pin with property name on it</span>
<span class="w">        </span><span class="c1">// *note: make Output pin</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">NAME_None</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">());</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// initialise created pin with property data</span>
<span class="w">            </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConvertPropertyToPinType</span><span class="p">(</span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="cm">/*out*/</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// copy param default value to pin if object is not initialised</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassDefaultObject</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">PinDefaultValueIsEditable</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">FString</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// read property value</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bDefaultValueSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">PropertyValueToString</span><span class="p">(</span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">uint8</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">ClassDefaultObject</span><span class="p">),</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">                </span><span class="n">check</span><span class="p">(</span><span class="n">bDefaultValueSet</span><span class="p">);</span><span class="w"> </span><span class="c1">// assert</span>
<span class="w">                </span><span class="c1">// set default value</span>
<span class="w">                </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">SetPinAutogeneratedDefaultValue</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Property Name is %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFullName</span><span class="p">())</span>
<span class="w">            </span><span class="c1">// Copy tooltip from the property.</span>
<span class="w">            </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetToolTipText</span><span class="p">(),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Данный код добавлен в метод <code>ReallocatePinsDuringReconstruction</code>.</p>
<p><a class="glightbox" href="../images/93e8635d920e90db8a637613dafdbe52.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="93e8635d920e90db8a637613dafdbe52.png" auto_="auto;" display="block;" margin:="margin:" src="../images/93e8635d920e90db8a637613dafdbe52.png" /></a></p>
<p>Чтобы увидеть работу кода, надо добавить в вызывающий ноду <code>blueprint</code> несколько <code>Expose on Spawn</code> параметров.</p>
<p><a class="glightbox" href="../images/31a1e27cb201c6e0ac2c3133e7e97861.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="31a1e27cb201c6e0ac2c3133e7e97861.png" auto_="auto;" display="block;" margin:="margin:" src="../images/31a1e27cb201c6e0ac2c3133e7e97861.png" /></a></p>
<p>После чего просто щелкнуть по ноде правой кнопкой мыши и выбрать пункт <code>Refresh Nodes</code>.</p>
<p><a class="glightbox" href="../images/60422c746fe0e75495756746c82000d5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="60422c746fe0e75495756746c82000d5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/60422c746fe0e75495756746c82000d5.png" /></a></p>
<p>В результате на ноде появятся соответствующие пины.</p>
<p><a class="glightbox" href="../images/eb8b460be32515d2a7dcce09e687dfb3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="eb8b460be32515d2a7dcce09e687dfb3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/eb8b460be32515d2a7dcce09e687dfb3.png" /></a></p>
<p>Этот трюк можно использовать не только с <code>blueprint</code> файлом, который вызывает ноду, но и с файлом, который передается в ноду через параметр типа <code>Class</code>. У нас как раз есть такой параметр - <code>Class Input Param</code>, давайте переделаем код под использование этого параметра.</p>
<p>Для начала нам нужен метод получения значений этого пина. Я сделал свой на основе того-же самого класса <code>\Engine\Source\Editor\BlueprintGraph\Private\K2Node_ConstructObjectFromClass.cpp</code>.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// pin value gettr for ClassPin</span>
<span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="nf">GetClassPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// pin value gettr for ClassPin</span>
<span class="c1">// *note this method build based on \Engine\Source\Editor\BlueprintGraph\Private\K2Node_ConstructObjectFromClass.cpp</span>
<span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="nf">UK2NodeTest::GetClassPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// result</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">PinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pins</span><span class="p">;</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// search for class pin</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">TestPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">PinsToSearch</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TestPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">TestPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestPin</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassPin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// pin is found</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// pin not linked, so get default value</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">            </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassSource</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ClassSource</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="p">.</span><span class="n">Get</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// pin linked so get pub category object value</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ClassResult</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Этот метод нам нужен обязательно, потому что пины мы ищем в <code>ReallocatePinsDuringReconstruction</code>, где есть доступ к переменной <code>OldPins</code>. В <code>OldPins</code> хранятся значения, присвоенные пинам в предыдущем состоянии ноды.</p>
<p><a class="glightbox" href="../images/6b7b59bac755abbfb3b2c3d095652402.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6b7b59bac755abbfb3b2c3d095652402.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6b7b59bac755abbfb3b2c3d095652402.png" /></a></p>
<p>Теперь добавляем метод генерации пинов для выбранного класса:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// will generate extra pins for given class</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">GeneratePinsForClass</span><span class="p">(</span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Class</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// will generate extra pins for given class</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::GeneratePinsForClass</span><span class="p">(</span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">InClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if nothing is passed</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// search blueprint, that has current K2 node</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetGraph</span><span class="p">();</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Blueprint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// it&#39;s impossible to trigger, but let it be</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ClassDefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InClass</span><span class="o">-&gt;</span><span class="n">GetDefaultObject</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if this object exists in game memory</span>
<span class="w">    </span><span class="c1">// iterate over current blueprint&#39;s fields</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TFieldIterator</span><span class="o">&lt;</span><span class="n">FProperty</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">(</span><span class="n">InClass</span><span class="p">,</span><span class="w"> </span><span class="n">EFieldIteratorFlags</span><span class="o">::</span><span class="n">IncludeSuper</span><span class="p">);</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">PropertyIt</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FProperty</span><span class="o">*</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">PropertyIt</span><span class="p">;</span>
<span class="w">        </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">PropertyClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastChecked</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetOwner</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="p">());</span><span class="w"> </span><span class="c1">// make sure we are on UObject</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsDelegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">IsA</span><span class="p">(</span><span class="n">FMulticastDelegateProperty</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">());</span><span class="w"> </span><span class="c1">// check if is Delegate</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsExposedToSpawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">IsPropertyExposedOnSpawn</span><span class="p">(</span><span class="n">Property</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property marked as Expose to Spawn</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsSettableExternally</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_DisableEditOnInstance</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property can be set externally</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsExposedToSpawn</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_Parm</span><span class="p">)</span><span class="w"> </span><span class="c1">// make sure it&#39;s param</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bIsSettableExternally</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAllPropertyFlags</span><span class="p">(</span><span class="n">CPF_BlueprintVisible</span><span class="p">)</span><span class="w"> </span><span class="c1">// is visible to bp&#39;s</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">bIsDelegate</span><span class="w"> </span><span class="c1">// do not add delegates as pins</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">FindPin</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// make sure this pin dosen&#39;t exist</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">PropertyStillExists</span><span class="p">(</span><span class="n">Property</span><span class="p">))</span><span class="w"> </span><span class="c1">// make sure it&#39;s not pending delete with GC</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// create new pin with property name on it</span>
<span class="w">            </span><span class="c1">// *note: make Output pin</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">NAME_None</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">());</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// initialise created pin with property data</span>
<span class="w">                </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConvertPropertyToPinType</span><span class="p">(</span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// copy param default value to pin if object is not initialised</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassDefaultObject</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">PinDefaultValueIsEditable</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">))</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">FString</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">;</span>
<span class="w">                    </span><span class="c1">// read property value</span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bDefaultValueSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">PropertyValueToString</span><span class="p">(</span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">uint8</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">ClassDefaultObject</span><span class="p">),</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">                    </span><span class="n">check</span><span class="p">(</span><span class="n">bDefaultValueSet</span><span class="p">);</span><span class="w"> </span><span class="c1">// assert</span>
<span class="w">                    </span><span class="c1">// set default value</span>
<span class="w">                    </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">SetPinAutogeneratedDefaultValue</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Property Name is %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFullName</span><span class="p">())</span>
<span class="w">                    </span><span class="c1">// Copy tooltip from the property.</span>
<span class="w">                    </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetToolTipText</span><span class="p">(),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Через метод <code>GeneratePinsForClass</code> в ноду будут добавляться <code>Output</code> пины на основе выбранного класса.</p>
<p>Метод <code>ReallocatePinsDuringReconstruction</code> меняется так:
<div class="highlight"><pre><span></span><code><span class="c1">// used to change pins in runtime</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AllocateDefaultPins</span><span class="p">();</span><span class="w"> </span><span class="c1">// this will load default exec pins</span>
<span class="w">    </span><span class="c1">// main function code</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetExpandNodePinValue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GenerateExtraPins</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// Generate pins for specified class</span>
<span class="w">        </span><span class="c1">//UClass* Source = Blueprint-&gt;GeneratedClass; // get current blueprint&#39;s class</span>
<span class="w">        </span><span class="c1">// we can read class data from specific pin</span>
<span class="w">        </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClassPinValue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">GeneratePinsForClass</span><span class="p">(</span><span class="n">Source</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// restore pins that was split</span>
<span class="w">    </span><span class="n">RestoreSplitPins</span><span class="p">(</span><span class="n">OldPins</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Добавляем к любому <code>blueprint</code> классу типа <code>Actor</code> пару <code>ExposeOnSpawn</code> параметров.</p>
<p><a class="glightbox" href="../images/9acb5ec203b62e6ebfe80de861e38fdd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9acb5ec203b62e6ebfe80de861e38fdd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9acb5ec203b62e6ebfe80de861e38fdd.png" /></a></p>
<p>После чего обновляем ноду и видим, как эти параметры появляются в ней.</p>
<p><a class="glightbox" href="../images/bdcd063cfde05eb7858ff92059469bbe.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bdcd063cfde05eb7858ff92059469bbe.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bdcd063cfde05eb7858ff92059469bbe.png" /></a></p>
<h3 id="_9">Контекстное меню, добавление и удаление пинов</h3>
<p>За показ контекстного меню отвечает метод <code>GetNodeContextMenuActions</code>. Причем контекстное меню может быть как у самой ноды, так и у отдельных пинов.</p>
<p>Используем это меню, для добавления дополнительных <code>Exec</code> пинов.</p>
<p>Для начала нам нужен массив, в котором будут храниться <code>Exec</code> пины.
<div class="highlight"><pre><span></span><code><span class="c1">// exec pins generated using context menu</span>
<span class="n">UPROPERTY</span><span class="p">()</span>
<span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExecPinsCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
</code></pre></div>
Далее нам нужен метод генерации пинов по этому массиву.
<div class="highlight"><pre><span></span><code><span class="c1">// will generate exec pins by list</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::GenerateExecPins</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear old pins</span>
<span class="w">    </span><span class="c1">//RemoveMultiplePinsByNames(&amp;ExecPinsCache);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// generate new pins</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="o">:</span><span class="w"> </span><span class="n">ExecPinsCache</span><span class="p">){</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">PinName</span><span class="p">);</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Out Exec Pin&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Теперь, самое время реализовать логику добавления и удаления элементов из <code>ExecPinsCache</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// used to show and process context menu on node or node pins</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::GetNodeContextMenuActions</span><span class="p">(</span><span class="n">UToolMenu</span><span class="o">*</span><span class="w"> </span><span class="n">Menu</span><span class="p">,</span><span class="w"> </span><span class="n">UGraphNodeContextMenuContext</span><span class="o">*</span><span class="w"> </span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetNodeContextMenuActions</span><span class="p">(</span><span class="n">Menu</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent wih current context</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// we are in Node context</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// lambda to reset exec pins list</span>
<span class="w">        </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ClearExecPins</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">[</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// remove const modifiers</span>
<span class="w">            </span><span class="c1">// &quot;this&quot; lambda modifier is const so get rid of constness as well</span>
<span class="w">            </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">OwningNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// validation</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">OwningNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ExecPinsCache</span><span class="p">);</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ExecPinsCache</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear array of pins</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="c1">// lambda to add another exec pin</span>
<span class="w">        </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AddExecPin</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="p">[</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// remove const modifiers</span>
<span class="w">            </span><span class="c1">// &quot;this&quot; lambda modifier is const so get rid of constness as well</span>
<span class="w">            </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">OwningNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// validation</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">OwningNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ExecPinsCache</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">GetNextExecPinName</span><span class="p">());</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">GenerateExecPins</span><span class="p">();</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ReconstructNode</span><span class="p">();</span><span class="w"> </span><span class="c1">// toggle reconstruction</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="c1">// add menu section for our items</span>
<span class="w">        </span><span class="n">FToolMenuSection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Menu</span><span class="o">-&gt;</span><span class="n">AddSection</span><span class="p">(</span><span class="s">&quot;TypeOperations&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Type Operations&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// add exec pin</span>
<span class="w">        </span><span class="n">Section</span><span class="p">.</span><span class="n">AddMenuEntry</span><span class="p">(</span>
<span class="w">            </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;AddExecPin&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Add Exec Pin&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will add Exec Pin to Node&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">FSlateIcon</span><span class="p">(),</span>
<span class="w">            </span><span class="n">FUIAction</span><span class="p">(</span><span class="n">FExecuteAction</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">AddExecPin</span><span class="p">))</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// reset exec pins</span>
<span class="w">        </span><span class="n">Section</span><span class="p">.</span><span class="n">AddMenuEntry</span><span class="p">(</span>
<span class="w">            </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;ClearExecPins&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Clear Exec Pins&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will clear all Exec Pins&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">FSlateIcon</span><span class="p">(),</span>
<span class="w">            </span><span class="n">FUIAction</span><span class="p">(</span><span class="n">FExecuteAction</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">ClearExecPins</span><span class="p">))</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Я реализовал два пункта в нашем меню. Это <code>Add Exec Pin</code> и <code>Clear Exec Pins</code>. За обработку этих пунктов меню отвечают соответствующие лямбды.</p>
<p><a class="glightbox" href="../images/ff8e22a83759be237ac817981e555b6d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ff8e22a83759be237ac817981e555b6d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ff8e22a83759be237ac817981e555b6d.png" /></a></p>
<p><a class="glightbox" href="../images/768adc8c80c32417a94fe7b5e5a281fd.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="768adc8c80c32417a94fe7b5e5a281fd.png" auto_="auto;" display="block;" margin:="margin:" src="../images/768adc8c80c32417a94fe7b5e5a281fd.png" /></a></p>
<h3 id="wildcard"><code>Wildcard</code> пины и изменение типа пинов "на лету"</h3>
<p>В <code>Unreal Engine</code> есть такие ноды, пины которых зависят от контекста, так, например, работает нода <code>UK2Node_SpawnActorFromClass</code>.
Если передать входному пину <code>Clas</code> этой ноды, то выходной тип объекта - изменится.</p>
<p><a class="glightbox" href="../images/a4dcb34758d5df709638748fabd4272c.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a4dcb34758d5df709638748fabd4272c.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a4dcb34758d5df709638748fabd4272c.png" /></a></p>
<p>Можем ли мы делать нечто похожее?
Да, можем, для этого у каждого пина есть параметр <code>PinType</code> который можно менять "в реальном времени".</p>
<p><a class="glightbox" href="../images/67463898ab4b0a8a4f3e03ce2a18c966.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="67463898ab4b0a8a4f3e03ce2a18c966.png" auto_="auto;" display="block;" margin:="margin:" src="../images/67463898ab4b0a8a4f3e03ce2a18c966.png" /></a></p>
<p>Более того, в движке есть специальный тип пина, который может принимать соединения любых типов. Это <code>Wildcard</code> пины. Их использование вы можете наблюдать в операторе <code>K2Node_PromotableOperator</code>, который создается всякий раз, при операциях с встроенными типами.</p>
<p><a class="glightbox" href="../images/38c53d59679c5b0dbeb054c586396cb1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="38c53d59679c5b0dbeb054c586396cb1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/38c53d59679c5b0dbeb054c586396cb1.png" /></a></p>
<p>Предлагаю создать собственный <code>Wildcard</code> пин и изменить его тип.</p>
<p>Я создал два пина, входной и выходной, которые будут менять свой тип, в зависимости от подключенного объекта.
<div class="highlight"><pre><span></span><code><span class="c1">// Wildcard Input Pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">CreateWildcardPin</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span><span class="p">,</span><span class="w"> </span><span class="n">EGPD_Input</span><span class="p">);</span>
<span class="w">    </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="p">}</span>
<span class="c1">// Wildcard Output Pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">CreateWildcardPin</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span><span class="p">,</span><span class="w"> </span><span class="n">EGPD_Output</span><span class="p">);</span>
<span class="w">    </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="p">}</span>
</code></pre></div>
Далее были реализованы методы <code>SetWcPinType</code> и <code>ResetWcPinType</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// will set wildcard pin type</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::SetWcPinType</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">inPin</span><span class="p">,</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">PinType</span><span class="p">,</span><span class="w"> </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">SubPinType</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">inPin</span><span class="p">);</span><span class="w"> </span><span class="c1">// inPin function arg</span>
<span class="w">    </span><span class="c1">// validation</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SubPins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">RecombinePin</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// set type to pin</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">ContainerType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPinContainerType</span><span class="o">::</span><span class="n">None</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinType</span><span class="p">;</span><span class="w"> </span><span class="c1">//UEdGraphSchema_K2::PC_Int;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SubPinType</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ResetPinToAutogeneratedDefaultValue</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span><span class="w"> </span><span class="c1">// reset default value after type is set</span>
<span class="p">}</span>
<span class="c1">// will wildcard pin type</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::ResetWcPinType</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">inPin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">inPin</span><span class="p">);</span><span class="w"> </span><span class="c1">// inPin function arg</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">BreakAllPinLinks</span><span class="p">();</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ResetPinToAutogeneratedDefaultValue</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SetWcPinType</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span>
<span class="w">        </span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">GetDefaultWildcardPinType</span><span class="p">().</span><span class="n">PinCategory</span><span class="p">,</span>
<span class="w">        </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UScriptStruct</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">GetDefaultWildcardPinType</span><span class="p">().</span><span class="n">PinSubCategoryObject</span><span class="p">.</span><span class="n">Get</span><span class="p">())</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Когда к <code>Wildcard</code> пину подводится новое соединение, необходимо менять тип этого пина. Для реализации этой логики я использовал метод <code>PinConnectionListChanged</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// used to track connections for given pin</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::PinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin connection list changed&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// check if pin not null</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ... rest logics</span>
<span class="w">    </span><span class="c1">// change wildcard pin type depending on connection</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span><span class="p">){</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">FEdGraphPinType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">LastConnectionType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">.</span><span class="n">Last</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Key</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LastConnectionType</span><span class="p">.</span><span class="n">PinCategory</span><span class="p">){</span>
<span class="w">                </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LastConnectionType</span><span class="p">.</span><span class="n">PinCategory</span><span class="p">;</span>
<span class="w">                </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UScriptStruct</span><span class="o">&gt;</span><span class="p">(</span><span class="n">LastConnectionType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// Update pins</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">lPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">                        </span><span class="o">||</span><span class="w"> </span><span class="n">lPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">SetWcPinType</span><span class="p">(</span><span class="n">lPin</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// on disconnect from wildcard</span>
<span class="w">            </span><span class="n">ResetAllWcPins</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PinConnectionListChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Теперь мы можем подвести к пину <code>WcInputPinName</code> любое соединение, чтобы увидеть, как изменится его тип.</p>
<p><a class="glightbox" href="../images/2da2902ffbd2f8847d07da0a050efa57.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2da2902ffbd2f8847d07da0a050efa57.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2da2902ffbd2f8847d07da0a050efa57.png" /></a></p>
<p><a class="glightbox" href="../images/ca928ca196569b82a79f15ae6b9e119b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ca928ca196569b82a79f15ae6b9e119b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ca928ca196569b82a79f15ae6b9e119b.png" /></a></p>
<p><a class="glightbox" href="../images/06e3a4976ed4829dc7a63a0f28b8c33f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="06e3a4976ed4829dc7a63a0f28b8c33f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/06e3a4976ed4829dc7a63a0f28b8c33f.png" /></a></p>
<p>Я решил углубить эту логику и добавить возможность изменения типа <code>Wildcard</code> пина через контекстное меню. Как это сделано у ноды <code>K2Node_PromotableOperator</code>.</p>
<p><a class="glightbox" href="../images/ba8dbdc94501a7b46f6ccdc24e65b0f5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ba8dbdc94501a7b46f6ccdc24e65b0f5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ba8dbdc94501a7b46f6ccdc24e65b0f5.png" /></a></p>
<p>Типы, доступные для преобразования, я разместил внутри массива <code>WcAllowedTypes</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// wildcard pin conversion types</span>
<span class="c1">// pin name -&gt; pin type | sub type</span>
<span class="k">const</span><span class="w"> </span><span class="n">TMultiMap</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WcAllowedTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Vector&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">TBaseStructure</span><span class="o">&lt;</span><span class="n">FVector</span><span class="o">&gt;::</span><span class="n">Get</span><span class="p">()}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Tag&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">()}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CustomStruct&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">()}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;String&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_String</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Class</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Int&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
Далее, в методе <code>GetNodeContextMenuActions</code> была добавлена новая секция, для генерации соответствующих действий.
<div class="highlight"><pre><span></span><code><span class="c1">// used to show and process context menu on node or node pins</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2NodeTest::GetNodeContextMenuActions</span><span class="p">(</span><span class="n">UToolMenu</span><span class="o">*</span><span class="w"> </span><span class="n">Menu</span><span class="p">,</span><span class="w"> </span><span class="n">UGraphNodeContextMenuContext</span><span class="o">*</span><span class="w"> </span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetNodeContextMenuActions</span><span class="p">(</span><span class="n">Menu</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent wih current context</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// we are in Node context</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//.. previous code</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// we are in Pin context</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// lambda to reset wildcard pin types</span>
<span class="w">        </span><span class="c1">// *note args should be const or it won&#39;t compile</span>
<span class="w">        </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ClearPins</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">[</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// remove const modifiers</span>
<span class="w">            </span><span class="c1">// &quot;this&quot; lambda modifier is const so get rid of constness as well</span>
<span class="w">            </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">OwningNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// validation</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">OwningNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// reset all pins</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">                    </span><span class="o">||</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// reset pin type</span>
<span class="w">                    </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ResetWcPinType</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">CurrentWcType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// reset current pin type cache</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ReconstructNode</span><span class="p">();</span><span class="w"> </span><span class="c1">// toggle reconstruction</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="c1">// lambda to set type for given pin</span>
<span class="w">        </span><span class="c1">// *note args should be const or it won&#39;t compile</span>
<span class="w">        </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ApplyPinType</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="w"> </span><span class="n">Type</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// remove const modifiers</span>
<span class="w">            </span><span class="c1">// &quot;this&quot; lambda modifier is const so get rid of constness as well</span>
<span class="w">            </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">OwningNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// validation</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">OwningNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">CurrentWcType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Type</span><span class="p">;</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ApplyAllWcPinsToType</span><span class="p">(</span><span class="n">Type</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ReconstructNode</span><span class="p">();</span><span class="w"> </span><span class="c1">// toggle reconstruction</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="c1">// add menu section for our items</span>
<span class="w">        </span><span class="n">FToolMenuSection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Menu</span><span class="o">-&gt;</span><span class="n">AddSection</span><span class="p">(</span><span class="s">&quot;TypeOperations&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Type Operations&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// add items to work with wildcard pins</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGPD_Input</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// iterate thru all accessible types and generate menu items</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TPair</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WcAllowedTypes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Section</span><span class="p">.</span><span class="n">AddMenuEntry</span><span class="p">(</span>
<span class="w">                    </span><span class="n">Item</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="c1">// make FName menu item identifier from combined string</span>
<span class="w">                    </span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Set Pin Type to %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Item</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">())),</span><span class="w"> </span><span class="c1">// menu item name</span>
<span class="w">                    </span><span class="n">FText</span><span class="o">::</span><span class="n">Format</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will convert Pin type to {0} Type&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">Item</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">())),</span>
<span class="w">                    </span><span class="n">FSlateIcon</span><span class="p">(),</span>
<span class="w">                    </span><span class="c1">// FExecuteAction::CreateUObject requires const function or const uobject refrence. Why? .... ask devs</span>
<span class="w">                    </span><span class="c1">// just use const_cast to add or remove constness of variables,</span>
<span class="w">                    </span><span class="c1">// maybe, in future, this will be fixed, who knows...</span>
<span class="w">                    </span><span class="c1">// *note: i decided to use lambda instead</span>
<span class="w">                    </span><span class="c1">//FUIAction(FExecuteAction::CreateUObject(const_cast&lt;UK2NodeTest*&gt;(this), &amp;UK2NodeTest::SetWcPinType, Context-&gt;Pin, Item.Value.Key, Item.Value.Value))</span>
<span class="w">                    </span><span class="n">FUIAction</span><span class="p">(</span><span class="n">FExecuteAction</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">ApplyPinType</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="p">.</span><span class="n">Value</span><span class="p">))</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// add reset type</span>
<span class="w">            </span><span class="n">Section</span><span class="p">.</span><span class="n">AddMenuEntry</span><span class="p">(</span>
<span class="w">                </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;ResetPinType&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reset Pin Type&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will reset Wildcard Pin type&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="n">FSlateIcon</span><span class="p">(),</span>
<span class="w">                </span><span class="n">FUIAction</span><span class="p">(</span><span class="n">FExecuteAction</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">ClearPins</span><span class="p">))</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Теперь у <code>Wildcard</code> пина есть контекстное меню, позволяющее изменять тип, без подведения соединений.</p>
<p><a class="glightbox" href="../images/bba4391b4a21d2ac5eb0c4acffdd22ed.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="bba4391b4a21d2ac5eb0c4acffdd22ed.png" auto_="auto;" display="block;" margin:="margin:" src="../images/bba4391b4a21d2ac5eb0c4acffdd22ed.png" /></a></p>
<p><a class="glightbox" href="../images/02eb4221f9be8e8a6fc6dceaf05e30a9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="02eb4221f9be8e8a6fc6dceaf05e30a9.png" auto_="auto;" display="block;" margin:="margin:" src="../images/02eb4221f9be8e8a6fc6dceaf05e30a9.png" /></a></p>
<h3 id="pin-boilerplates">Шаблоны пинов, Pin Boilerplates</h3>
<p>Для упрощения жизни себе и читателю - привожу примеры пинов самого разного назначения с установкой значения "по умолчанию" там, где это возможно.
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="c1">// Gameplay Tags</span>
<span class="c1">// *note: don&#39;t forget to add GameplayTags as dependancy in .build.cs file</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayTagContainer.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintGameplayTagLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;NativeGameplayTags.h&quot;</span>
<span class="c1">// Character Refrence</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// this struct is used to show, how to create custom struct pins on K2 nodes</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FTestPinData</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="c1">// constructor is Necessary if we want to be able &quot;split structural pin&quot; of this type of struct in the K2 Node</span>
<span class="w">    </span><span class="c1">// even if there is no reason to set default values here, we anyway Need constructor, this is how UE works</span>
<span class="w">    </span><span class="n">FTestPinData</span><span class="p">(){</span>
<span class="w">        </span><span class="n">Number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">InlineRotator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">InlineVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// just bunch of fields</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="o">=</span><span class="s">&quot;PinData&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="o">=</span><span class="s">&quot;PinData&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PinData&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FRotator</span><span class="w"> </span><span class="n">InlineRotator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PinData&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">InlineVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="p">};</span>
<span class="c1">// static variables can be in private without UPROPERTY and they will be copied just fine</span>
<span class="c1">// pin names</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">BoolPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">StringPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">FloatPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ObjectPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">DataPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TagPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TagContainerPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">VectorPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">RotatorPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">OutExecPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TestStructPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">WcInputPinName</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">WcOutputPinName</span><span class="p">;</span>
<span class="c1">// if this pin is True, then all rest pins will be visible</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ShowExtraPinsPinName</span><span class="p">;</span>
<span class="c1">// pin used to generate pins from class</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ClassPinName</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="c1">// gameplay tags used as &quot;default&quot; values</span>
<span class="c1">// should be defined in beginning of file, after #include section</span>
<span class="n">UE_DEFINE_GAMEPLAY_TAG_STATIC</span><span class="p">(</span><span class="n">TAG_FROZEN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;State.Frozen&quot;</span><span class="p">);</span>
<span class="n">UE_DEFINE_GAMEPLAY_TAG_STATIC</span><span class="p">(</span><span class="n">TAG_STUN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;State.Stun&quot;</span><span class="p">);</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">BoolPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;BooleanInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;IntInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">FloatPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FloatInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">StringPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;StringInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ClassInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ObjectPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ObjectParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InputTag&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagContainerPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;TagContainer&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">VectorPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Vector&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">RotatorPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Rotator&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">OutExecPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;OutExecParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">DataPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ShowHidden&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TestStructPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;TestStruct&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;In&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Out&quot;</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="c1">// another output exec pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">OutExecPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Out Exec Pin Tooltip&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// generate class pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Class</span><span class="p">,</span><span class="w"> </span><span class="n">AActor</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Blueprint&#39;/Game/Characters/BP_ACharacterTestChild.BP_ACharacterTestChild&#39;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// generate ACharacter object pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">,</span><span class="w"> </span><span class="n">ACharacter</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ObjectPinName</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// there is no default value, it&#39;s object pin</span>
<span class="p">}</span>
<span class="c1">// generate DataAsset pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">,</span><span class="w"> </span><span class="n">UDataAsset</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">DataPinName</span><span class="p">);</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/DataAccess.CharacterData&#39;/Game/Characters/Data/DA_Character.DA_Character&#39;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//UDataAsset* Asset = LoadObject&lt;UDataAsset&gt;(NULL, *PinValue);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UKismetSystemLibrary</span><span class="o">::</span><span class="n">MakeSoftObjectPath</span><span class="p">(</span><span class="n">PinValue</span><span class="p">).</span><span class="n">ResolveObject</span><span class="p">();</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="p">}</span>
<span class="c1">// generate int pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">PinParams</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//PinParams.ContainerType = EPinContainerType::Array;</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span><span class="p">,</span><span class="w"> </span><span class="n">PinParams</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// default value</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">//FString::FromInt(3);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Struct pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//InPinParams.ContainerType = EPinContainerType::Set;</span>
<span class="w">    </span><span class="c1">//InPinParams.ValueTerminalType = FEdGraphTerminalType::bTerminalIsUObjectWrapper;</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TestStructPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// default value</span>
<span class="w">    </span><span class="c1">// *note: we can&#39;t directly set default struct values</span>
<span class="w">    </span><span class="c1">// instead we should export struct as i did it below</span>
<span class="w">    </span><span class="n">FTestPinData</span><span class="w"> </span><span class="n">Data</span><span class="p">;</span><span class="w"> </span><span class="c1">// we gonna export this struct variable</span>
<span class="w">    </span><span class="n">Data</span><span class="p">.</span><span class="n">Number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="n">Data</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Data</span><span class="p">.</span><span class="n">InlineRotator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotator</span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">Data</span><span class="p">.</span><span class="n">InlineVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">Struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">();</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">StrStructValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">//string struct value</span>
<span class="w">    </span><span class="c1">// this method will serialize struct fields to string StrStructValue, fields taked from variable Data</span>
<span class="w">    </span><span class="n">Struct</span><span class="o">-&gt;</span><span class="n">ExportText</span><span class="p">(</span><span class="n">StrStructValue</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PPF_ExportsNotFullyQualified</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_Copy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_Delimited</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_IncludeTransient</span><span class="p">),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// pin will automatically deserialize DefaultValue on the node itself</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StrStructValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StrStructValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// string data pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_String</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">StringPinName</span><span class="p">);</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Test String Value&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// boolean data pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">BoolPinName</span><span class="p">);</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// float data pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Real</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Float</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">FloatPinName</span><span class="p">);</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.3&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// GameplayTag pin</span>
<span class="c1">//*note: Add &quot;GameplayTags&quot; as Module Dependancy or this won&#39;t work!</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// default value</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TAG_FROZEN</span><span class="p">.</span><span class="n">GetTag</span><span class="p">().</span><span class="n">ToString</span><span class="p">();</span><span class="w"> </span><span class="c1">//TEXT(&quot;State.Frozen&quot;);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// GameplayTagContainer pin</span>
<span class="c1">//*note: Add &quot;GameplayTags&quot; as Module Dependancy or this won&#39;t work!</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagContainerPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// build container</span>
<span class="w">    </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">Container</span><span class="p">;</span>
<span class="w">    </span><span class="n">Container</span><span class="p">.</span><span class="n">AddTag</span><span class="p">(</span><span class="n">TAG_FROZEN</span><span class="p">);</span>
<span class="w">    </span><span class="n">Container</span><span class="p">.</span><span class="n">AddTag</span><span class="p">(</span><span class="n">TAG_STUN</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// set default value</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Container</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Vector pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">    </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">VectorStruct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TBaseStructure</span><span class="o">&lt;</span><span class="n">FVector</span><span class="o">&gt;::</span><span class="n">Get</span><span class="p">();</span><span class="w"> </span><span class="c1">// well... i&#39;d never expected THIS</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">VectorStruct</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">VectorPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// default value</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1.4, 0.3, 0.0&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Rotator pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">    </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">RotatorStruct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TBaseStructure</span><span class="o">&lt;</span><span class="n">FRotator</span><span class="o">&gt;::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">RotatorStruct</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">RotatorPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// default value</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1.4, 0.3, 0.0&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Test Delegate Pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Delegate</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InDelegate&quot;</span><span class="p">));</span>
<span class="p">}</span>
<span class="c1">// Wildcard Input Pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">CreateWildcardPin</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span><span class="p">,</span><span class="w"> </span><span class="n">EGPD_Input</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Wildcard Output Pin</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">CreateWildcardPin</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span><span class="p">,</span><span class="w"> </span><span class="n">EGPD_Output</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Здесь сразу приведены все типы пинов, до которых я смог додуматься.</p>
<p>Я привел примеры для почти всех случаев пинов, которые смог придумать. К сожалению, создавать и задавать пины не так легко, как кажется. Надеюсь приведенного количества примеров вам хватит.</p>
<p><a class="glightbox" href="../images/0322820a3e83fcdc81b303c1c33867e8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0322820a3e83fcdc81b303c1c33867e8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0322820a3e83fcdc81b303c1c33867e8.png" /></a></p>
<h3 id="_10">Полный код класса</h3>
<p>Описать все изменения я врятли смогу, код класса получился крайне большим, а его написание было связано с множеством трудностей.</p>
<p>Привожу полученный результат:</p>
<h4 id="k2node_testh_1">Файл <code>K2Node_Test.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// Main File</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_EaseFunction.h&quot;</span>
<span class="c1">// EdGraph is part of K2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNode.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNodeUtils.h&quot;</span>
<span class="c1">// Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;KismetCompiler.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/CompilerResultsLog.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/WildcardNodeUtils.h&quot;</span><span class="c1"> // utils for wildcard node type</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/BlueprintEditorUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabaseRegistrar.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/DefaultValueHelper.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintCompilationManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Containers/Map.h&quot;</span><span class="c1"> // map container</span>
<span class="c1">//#include &quot;GameFramework/PlayerController.h&quot;</span>
<span class="c1">// UObject related includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span><span class="c1"> // this will hide warnings from intellisense</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UObjectGlobals.h&quot;</span>
<span class="c1">// Editor Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintNodeSpawner.h&quot;</span>
<span class="c1">// K2 Nodes that we refer to</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CallFunction.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Variable.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Literal.h&quot;</span>
<span class="c1">// Gameplay Tags</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameplayTagContainer.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintGameplayTagLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;NativeGameplayTags.h&quot;</span>
<span class="c1">// Character Refrence</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// Runtime function library</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2RuntimeFunctionsLibrary.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Test.generated.h&quot;</span>
<span class="c1">// this struct is used to show, how to create custom struct pins on K2 nodes</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FTestPinData</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="c1">// constructor is Necessary if we want to be able &quot;split structural pin&quot; of this type of struct in the K2 Node</span>
<span class="w">    </span><span class="c1">// even if there is no reason to set default values here, we anyway Need constructor, this is how UE works</span>
<span class="w">    </span><span class="n">FTestPinData</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">InlineRotator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">InlineVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// just bunch of fields</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="o">=</span><span class="s">&quot;PinData&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="o">=</span><span class="s">&quot;PinData&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FString</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PinData&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FRotator</span><span class="w"> </span><span class="n">InlineRotator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PinData&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">FVector2D</span><span class="w"> </span><span class="n">InlineVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Number</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">String</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">InlineRotator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">InlineRotator</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">InlineVector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">InlineVector</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="c1">// since TPair is not blueprint type, i had to make this struct</span>
<span class="n">USTRUCT</span><span class="p">(</span><span class="n">BlueprintType</span><span class="p">)</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FKeyValuePinType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_USTRUCT_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">FKeyValuePinType</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">inKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NAME_None</span><span class="p">,</span><span class="w"> </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">inValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="p">(</span><span class="n">inKey</span><span class="p">),</span><span class="w"> </span><span class="n">Value</span><span class="p">(</span><span class="n">inValue</span><span class="p">)</span>
<span class="w">    </span><span class="p">{}</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">)</span>
<span class="w">    </span><span class="n">FName</span><span class="w"> </span><span class="n">Key</span><span class="p">;</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">BlueprintReadWrite</span><span class="p">,</span><span class="w"> </span><span class="n">EditAnywhere</span><span class="p">)</span>
<span class="w">    </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">Value</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// use simple AND</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Key</span><span class="p">;</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Other</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * K2 Node Test class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOMEDITOR_API</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UK2Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// variables</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">(</span><span class="n">EditAnywhere</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="o">=</span><span class="s">&quot;Data&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">int32</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UK2NodeTest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//~ Begin UK2Node Interface.</span>
<span class="w">    </span><span class="c1">// will be called during compilation. Allows to perform validation of internal values</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ValidateNodeDuringCompilation</span><span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">FCompilerResultsLog</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MessageLog</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// core method, expands complex node logic to set of simplier nodes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to place this node into add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will set node category in add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// node corner icon</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// return true if we want do show node properties in Details panel</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ShouldShowNodeProperties</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// should return unique node signature</span>
<span class="w">    </span><span class="c1">// if we generate multiple nodes depending on different data, use this to differentiate them by signature</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FBlueprintNodeSignature</span><span class="w"> </span><span class="nf">GetSignature</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">FBlueprintNodeSignature</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//~ End UK2Node Interface</span>
<span class="w">    </span><span class="c1">//~ Begin UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// used to reconnect deprecated pin connections</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="nf">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to determine pin changes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to add pins for node</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AllocateDefaultPins</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to track connections for given pin</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">PinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to change pins in runtime</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to add node title color</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FLinearColor</span><span class="w"> </span><span class="nf">GetNodeTitleColor</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to generate node title</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// for tooltip</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetTooltipText</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// for icon and tint</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="w"> </span><span class="nf">GetIconAndTint</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutColor</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// true if compatible with selected blueprint editor graph</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsCompatibleWithGraph</span><span class="p">(</span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// called after node is pasted to the new graph</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PostPasteNode</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to show and process context menu on node or node pins</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetNodeContextMenuActions</span><span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">UToolMenu</span><span class="o">*</span><span class="w"> </span><span class="n">Menu</span><span class="p">,</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">UGraphNodeContextMenuContext</span><span class="o">*</span><span class="w"> </span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UEdGraphNode Interface.</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// static variables can be in private without UPROPERTY and they will be copied just fine</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">BoolPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">StringPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">IntPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">FloatPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ObjectPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">DataPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TagPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TagContainerPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">VectorPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">RotatorPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">OutExecPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">TestStructPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">WcInputPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">WcOutputPinName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// if this pin is True, then all rest pins will be visible</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ShowExtraPinsPinName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// pin used to generate pins from class</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ClassPinName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// wildcard pin conversion types</span>
<span class="w">    </span><span class="c1">// pin name -&gt; pin type | sub type</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TMultiMap</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">WcAllowedTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                            </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Vector&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">TBaseStructure</span><span class="o">&lt;</span><span class="n">FVector</span><span class="o">&gt;::</span><span class="n">Get</span><span class="p">()}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Tag&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">()}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;CustomStruct&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">()}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;String&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_String</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Class</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                            </span><span class="p">{</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Int&quot;</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">                                        </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// variables cache</span>
<span class="w">    </span><span class="c1">// cache for pins list, generated from ClassPin attached class</span>
<span class="w">    </span><span class="c1">// used to clear generated pins if class changed</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">()</span><span class="w"> </span><span class="c1">// to allow copying and serialisation of this param we should make it UPROPERTY</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ClassPinsCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="c1">// cache for visible pins, that are revealed by checking ShowExtraPins</span>
<span class="w">    </span><span class="c1">// used to remove pins, when ShowExtraPins is Unchecked</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">()</span><span class="w"> </span><span class="c1">// to allow copying and serialisation of this param we should make it UPROPERTY</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExtraPinsCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="c1">// current wildcard pin type, used to determine pin type in node recontruction</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">()</span>
<span class="w">    </span><span class="n">FKeyValuePinType</span><span class="w"> </span><span class="n">CurrentWcType</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// exec pins generated using context menu</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">()</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExecPinsCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="c1">//*note:</span>
<span class="w">    </span><span class="c1">// private variables from K2 node, that are not UPROPERTY, can not be copied between blueprints</span>
<span class="w">    </span><span class="c1">// since UEdGraphPin type not blueprintable, it can&#39;t be UPROPERTY variable</span>
<span class="w">    </span><span class="c1">// this means that we can&#39;t copy this pin from one K2 not to another K2 node</span>
<span class="w">    </span><span class="c1">// so, every time we copy node, we have to ReconstructNode() in PostPasteNode event, to make this cache valid again</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">CurrentClassCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// cache class name to detect changes and reconstruct pins</span>
<span class="w">    </span><span class="c1">// custom functions</span>
<span class="w">    </span><span class="c1">// pin value getter for bExpandNode</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">GetShowExtraPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// pin value gettr for ClassPin</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="nf">GetClassPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will remove pins from provided name array</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">NameList</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will clear class pin and all pins, that was generated by GeneratePinsForClass for current class</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ClearClassPinValue</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will generate pins for given class</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">GeneratePinsForClass</span><span class="p">(</span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will generate extra pins</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">GenerateExtraPins</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will move connections and data from old pin to new pin if possible</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will set wildcard pin type</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetWcPinType</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">PinType</span><span class="p">,</span><span class="w"> </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">SubPinType</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will set all wildcard pins to given type</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ApplyAllWcPinsToType</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinType</span><span class="p">,</span><span class="w"> </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">SubPinType</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will wildcard pin type</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ResetWcPinType</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will reset type of all wildcards</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ResetAllWcPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will generate exec pins by list</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">GenerateExecPins</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will return next exec pin name</span>
<span class="w">    </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetNextExecPinName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="k2node_testcpp_1">Файл <code>K2Node_Test.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Test.h&quot;</span>
<span class="c1">// gameplay tags</span>
<span class="n">UE_DEFINE_GAMEPLAY_TAG_STATIC</span><span class="p">(</span><span class="n">TAG_FROZEN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;State.Frozen&quot;</span><span class="p">);</span>
<span class="n">UE_DEFINE_GAMEPLAY_TAG_STATIC</span><span class="p">(</span><span class="n">TAG_STUN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;State.Stun&quot;</span><span class="p">);</span>
<span class="c1">// will add gen.cpp</span>
<span class="cp">#include UE_INLINE_GENERATED_CPP_BY_NAME(K2Node_Test)</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;K2Node_TestText&quot;</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">BoolPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;BooleanInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;IntInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">FloatPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FloatInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">StringPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;StringInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ClassInputParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ObjectPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ObjectParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InputTag&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagContainerPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;TagContainer&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">VectorPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Vector&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">RotatorPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Rotator&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">OutExecPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;OutExecParam&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">DataPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ShowHidden&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TestStructPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;TestStruct&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;In&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Out&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">UK2NodeTest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Show Extra Node Pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ShowExtraPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">ShowExtraPin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will show extra pins if checked&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">ShowExtraPin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to change pins in runtime</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AllocateDefaultPins</span><span class="p">();</span><span class="w"> </span><span class="c1">// this will load default exec pins</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Reconstruction&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// main function code</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetShowExtraPinValue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">GenerateExtraPins</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// we can read class data from specific pin</span>
<span class="w">        </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClassPinValue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">GeneratePinsForClass</span><span class="p">(</span><span class="n">Source</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// restore pin type</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">                </span><span class="o">||</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">SetWcPinType</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// show exec pins that are made by Context Menu</span>
<span class="w">        </span><span class="n">GenerateExecPins</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// restore pins that was split</span>
<span class="w">    </span><span class="n">RestoreSplitPins</span><span class="p">(</span><span class="n">OldPins</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// code below will remove elements from array of Pins</span>
<span class="w">    </span><span class="c1">// array itself shrinks towards the beginning when elements are removed</span>
<span class="w">    </span><span class="c1">// and if we do loop from index - to Pins.Num() we will have problems with &quot;out of bounds&quot; error</span>
<span class="w">    </span><span class="c1">// so it&#39;s important to do reversed foor loop</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CurrentPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<span class="w">        </span><span class="c1">// if names are same or same+suffix (for expanden pins such as structs)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">BreakAllPinLinks</span><span class="p">();</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">MarkAsGarbage</span><span class="p">();</span>
<span class="w">            </span><span class="c1">//RemovePin(CurrentPin);</span>
<span class="w">            </span><span class="n">Pins</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="w">            </span><span class="n">OnPinRemoved</span><span class="p">(</span><span class="n">CurrentPin</span><span class="p">);</span>
<span class="w">            </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">MarkBlueprintAsModified</span><span class="p">(</span><span class="n">GetBlueprint</span><span class="p">());</span>
<span class="w">    </span><span class="n">GetGraph</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NotifyGraphChanged</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will remove pins from provided name array</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">NameList</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NameList</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">NameList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemovePinByName</span><span class="p">(</span><span class="n">Name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">NameList</span><span class="o">-&gt;</span><span class="n">Empty</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// used to determine pin changes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PinDefaultValueChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// skip null</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// this pin is linked to something, so it should be proessed by PinConnectionListChanged</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">HasAnyConnections</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// just exit</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin default value changed&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="w"> </span><span class="c1">// update node on show-hide extra pins</span>
<span class="w">    </span><span class="o">||</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="w"> </span><span class="c1">// regenerate pins for new class</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ReconstructNode</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// used to track connections for given pin</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">PinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin connection list changed&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="c1">// check if pin not null</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// show / hide pins on node connected to ShowExtraPinsPinName</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetShowExtraPinValue</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if nothing is generated for node yet</span>
<span class="w">                </span><span class="n">GenerateExtraPins</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassPinsCache</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// we can read class data from specific pin</span>
<span class="w">                </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClassPinValue</span><span class="p">();</span>
<span class="w">                </span><span class="n">GeneratePinsForClass</span><span class="p">(</span><span class="n">Source</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ExtraPinsCache</span><span class="p">);</span>
<span class="w">            </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ClassPinsCache</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="c1">// if node disconnected from class pin</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">HasAnyConnections</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ClearClassPinValue</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear old class and it pins, because old data, after reconnection, cannot be obtained</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="c1">// change wildcard pin type depending on connection</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span><span class="p">){</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">FEdGraphPinType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">LastConnectionType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">.</span><span class="n">Last</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Key</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LastConnectionType</span><span class="p">.</span><span class="n">PinCategory</span><span class="p">){</span>
<span class="w">                </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LastConnectionType</span><span class="p">.</span><span class="n">PinCategory</span><span class="p">;</span>
<span class="w">                </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UScriptStruct</span><span class="o">&gt;</span><span class="p">(</span><span class="n">LastConnectionType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// Update pins</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">lPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">                        </span><span class="o">||</span><span class="w"> </span><span class="n">lPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">SetWcPinType</span><span class="p">(</span><span class="n">lPin</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">CurrentWcType</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// on disconnect from wildcard</span>
<span class="w">            </span><span class="n">ResetAllWcPins</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PinConnectionListChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// will clear class pin and all pins, that was generated by GeneratePinsForClass for current class</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClearClassPinValue</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassPin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// order matters!</span>
<span class="w">        </span><span class="c1">// first clear list of old pins</span>
<span class="w">        </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ClassPinsCache</span><span class="p">);</span>
<span class="w">        </span><span class="n">CurrentClassCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// set current class pins cache to null</span>
<span class="w">        </span><span class="c1">// only then change default value since it tirggers PinDefaultValueChanged event</span>
<span class="w">        </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will generate extra pins for given class</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GeneratePinsForClass</span><span class="p">(</span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">InClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear old pins</span>
<span class="w">    </span><span class="c1">// if nothing is passed</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ClearClassPinValue</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear old pins</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// exit</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// if new class passed in replacement of current - clear old pins of old class</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InClass</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CurrentClassCache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ClassPinsCache</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear old pins</span>
<span class="w">        </span><span class="n">CurrentClassCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InClass</span><span class="p">;</span><span class="w"> </span><span class="c1">// update current class</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// search blueprint, that has current K2 node</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetGraph</span><span class="p">();</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Blueprint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// it&#39;s impossible to trigger, but let it be</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ClassDefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InClass</span><span class="o">-&gt;</span><span class="n">GetDefaultObject</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if this object exists in game memory</span>
<span class="w">    </span><span class="c1">// iterate over current blueprint&#39;s fields</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TFieldIterator</span><span class="o">&lt;</span><span class="n">FProperty</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">(</span><span class="n">InClass</span><span class="p">,</span><span class="w"> </span><span class="n">EFieldIteratorFlags</span><span class="o">::</span><span class="n">IncludeSuper</span><span class="p">);</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">PropertyIt</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FProperty</span><span class="o">*</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">PropertyIt</span><span class="p">;</span>
<span class="w">        </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">PropertyClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastChecked</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetOwner</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="p">());</span><span class="w"> </span><span class="c1">// make sure we are on UObject</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsDelegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">IsA</span><span class="p">(</span><span class="n">FMulticastDelegateProperty</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">());</span><span class="w"> </span><span class="c1">// check if is Delegate</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsExposedToSpawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">IsPropertyExposedOnSpawn</span><span class="p">(</span><span class="n">Property</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property marked as Expose to Spawn</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsSettableExternally</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_DisableEditOnInstance</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property can be set externally</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsExposedToSpawn</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_Parm</span><span class="p">)</span><span class="w"> </span><span class="c1">// make sure it&#39;s param</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bIsSettableExternally</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAllPropertyFlags</span><span class="p">(</span><span class="n">CPF_BlueprintVisible</span><span class="p">)</span><span class="w"> </span><span class="c1">// is visible to bp&#39;s</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">bIsDelegate</span><span class="w"> </span><span class="c1">// do not add delegates as pins</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">FindPin</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// make sure this pin dosen&#39;t exist</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">PropertyStillExists</span><span class="p">(</span><span class="n">Property</span><span class="p">))</span><span class="w"> </span><span class="c1">// make sure it&#39;s not pending delete with GC</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// create new pin with property name on it</span>
<span class="w">            </span><span class="c1">// *note: make Output pin</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">NAME_None</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">());</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// initialise created pin with property data</span>
<span class="w">                </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConvertPropertyToPinType</span><span class="p">(</span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">);</span>
<span class="w">                </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">                </span><span class="c1">// copy param default value to pin if object is not initialised</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassDefaultObject</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">PinDefaultValueIsEditable</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">))</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">FString</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">;</span>
<span class="w">                    </span><span class="c1">// read property value</span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bDefaultValueSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">PropertyValueToString</span><span class="p">(</span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">uint8</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">ClassDefaultObject</span><span class="p">),</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">                    </span><span class="n">check</span><span class="p">(</span><span class="n">bDefaultValueSet</span><span class="p">);</span><span class="w"> </span><span class="c1">// assert</span>
<span class="w">                    </span><span class="c1">// set default value</span>
<span class="w">                    </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">SetPinAutogeneratedDefaultValue</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Property Name is %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFullName</span><span class="p">())</span>
<span class="w">                </span><span class="c1">// Copy tooltip from the property.</span>
<span class="w">                </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetToolTipText</span><span class="p">(),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">                </span><span class="n">ClassPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will move connections and data from old pin to new pin if possible</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewPin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// find old pin with same name</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">OldPins</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">OPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="c1">// ToString is necessary, since names don&#39;t have registry sensitivity</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OPin</span><span class="o">-&gt;</span><span class="n">bOrphanedPin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="c1">// make sure it&#39;s orphan data</span>
<span class="w">            </span><span class="c1">//&amp;&amp; OPin-&gt;Direction == EGPD_Input // only input pins can be restored this way. I had very strange bug with output pins connection, but it just disappeared after... so if you have it - uncomment this line.</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">//ReconstructSinglePin(NewPin, OPin, ERedirectType_Name); // don&#39;t use this - it won&#39;t preserve default values, they sohuld be copied, since data on OldPins get&#39;s resetted after pins reallocation</span>
<span class="w">                </span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">CopyPersistentDataFromOldPin</span><span class="p">(</span><span class="o">*</span><span class="n">OPin</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will generate extra pins</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GenerateExtraPins</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// if previously generated pins still exist</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ExtraPinsCache</span><span class="p">);</span><span class="w"> </span><span class="c1">// remove previous pins</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// another output exec pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">OutExecPinName</span><span class="p">);</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Out Exec Pin Tooltip&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// generate class pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Class</span><span class="p">,</span><span class="w"> </span><span class="n">AActor</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">);</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/Engine.Blueprint&#39;/Game/Characters/BP_ACharacterTestChild.BP_ACharacterTestChild&#39;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// generate ACharacter object pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">,</span><span class="w"> </span><span class="n">ACharacter</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ObjectPinName</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// there is no default value, it&#39;s object pin</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// generate DataAsset pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">,</span><span class="w"> </span><span class="n">UDataAsset</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">DataPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;/Script/DataAccess.CharacterData&#39;/Game/Characters/Data/DA_Character.DA_Character&#39;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//UDataAsset* Asset = LoadObject&lt;UDataAsset&gt;(NULL, *PinValue);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UKismetSystemLibrary</span><span class="o">::</span><span class="n">MakeSoftObjectPath</span><span class="p">(</span><span class="n">PinValue</span><span class="p">).</span><span class="n">ResolveObject</span><span class="p">();</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// generate int pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">PinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//PinParams.ContainerType = EPinContainerType::Array;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span><span class="p">,</span><span class="w"> </span><span class="n">PinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">//FString::FromInt(3);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Struct pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.ContainerType = EPinContainerType::Set;</span>
<span class="w">        </span><span class="c1">//InPinParams.ValueTerminalType = FEdGraphTerminalType::bTerminalIsUObjectWrapper;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TestStructPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="c1">// *note: we can&#39;t directly set default struct values</span>
<span class="w">        </span><span class="c1">// instead we should export struct as i did it below</span>
<span class="w">        </span><span class="n">FTestPinData</span><span class="w"> </span><span class="n">Data</span><span class="p">;</span><span class="w"> </span><span class="c1">// we gonna export this struct variable</span>
<span class="w">        </span><span class="n">Data</span><span class="p">.</span><span class="n">Number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">        </span><span class="n">Data</span><span class="p">.</span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Test&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Data</span><span class="p">.</span><span class="n">InlineRotator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FRotator</span><span class="p">{</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="n">Data</span><span class="p">.</span><span class="n">InlineVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FVector2D</span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">Struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FTestPinData</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">();</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">StrStructValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">//string struct value</span>
<span class="w">        </span><span class="c1">// this method will serialize struct fields to string StrStructValue, fields taked from variable Data</span>
<span class="w">        </span><span class="n">Struct</span><span class="o">-&gt;</span><span class="n">ExportText</span><span class="p">(</span><span class="n">StrStructValue</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">PPF_ExportsNotFullyQualified</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_Copy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_Delimited</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">PPF_IncludeTransient</span><span class="p">),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// pin will automatically deserialize DefaultValue on the node itself</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StrStructValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StrStructValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// string data pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_String</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">StringPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Test String Value&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// boolean data pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">BoolPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoolPinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// float data pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Real</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Float</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">FloatPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.3&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// GameplayTag pin</span>
<span class="w">    </span><span class="c1">//*note: Add &quot;GameplayTags&quot; as Module Dependancy or this won&#39;t work!</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTag</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TAG_FROZEN</span><span class="p">.</span><span class="n">GetTag</span><span class="p">().</span><span class="n">ToString</span><span class="p">();</span><span class="w"> </span><span class="c1">//TEXT(&quot;State.Frozen&quot;);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// GameplayTagContainer pin</span>
<span class="w">    </span><span class="c1">//*note: Add &quot;GameplayTags&quot; as Module Dependancy or this won&#39;t work!</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">FGameplayTagContainer</span><span class="o">::</span><span class="n">StaticStruct</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">TagContainerPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// build container</span>
<span class="w">        </span><span class="n">FGameplayTagContainer</span><span class="w"> </span><span class="n">Container</span><span class="p">;</span>
<span class="w">        </span><span class="n">Container</span><span class="p">.</span><span class="n">AddTag</span><span class="p">(</span><span class="n">TAG_FROZEN</span><span class="p">);</span>
<span class="w">        </span><span class="n">Container</span><span class="p">.</span><span class="n">AddTag</span><span class="p">(</span><span class="n">TAG_STUN</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// set default value</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Container</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Vector pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">        </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">VectorStruct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TBaseStructure</span><span class="o">&lt;</span><span class="n">FVector</span><span class="o">&gt;::</span><span class="n">Get</span><span class="p">();</span><span class="w"> </span><span class="c1">// well... i&#39;d never expected THIS</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">VectorStruct</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">VectorPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1.4, 0.3, 0.0&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Rotator pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphNode</span><span class="o">::</span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//InPinParams.bIsReference = true;</span>
<span class="w">        </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">RotatorStruct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TBaseStructure</span><span class="o">&lt;</span><span class="n">FRotator</span><span class="o">&gt;::</span><span class="n">Get</span><span class="p">();</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Struct</span><span class="p">,</span><span class="w"> </span><span class="n">RotatorStruct</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">RotatorPinName</span><span class="p">,</span><span class="w"> </span><span class="n">InPinParams</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// default value</span>
<span class="w">        </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1.4, 0.3, 0.0&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Test Delegate Pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Delegate</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;InDelegate&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Wildcard Input Pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">CreateWildcardPin</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span><span class="p">,</span><span class="w"> </span><span class="n">EGPD_Input</span><span class="p">);</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Wildcard Output Pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">CreateWildcardPin</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span><span class="p">,</span><span class="w"> </span><span class="n">EGPD_Output</span><span class="p">);</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">ExtraPinsCache</span><span class="p">.</span><span class="n">AddUnique</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span><span class="w"> </span><span class="c1">// add pin to cache</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// used to reconnect deprecated pin connections</span>
<span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// reconnect given pin types:</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ERedirectType_Value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ERedirectType_Name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">StringPinName</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">StringPinName</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ERedirectType_Value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IntPinName</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ERedirectType_Value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// core method, expands complex node logic to set of simplier nodes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">BP</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// spawn &quot;call function&quot; k2 node</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">CallFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// set function refrence to the function node</span>
<span class="w">    </span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">        </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">LogNumber</span><span class="p">),</span><span class="w"> </span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">// allocate node pins</span>
<span class="w">    </span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// if node is Expanded</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetShowExtraPinValue</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/*UEdGraphPin* IntPin = FindPin(IntPinName);</span>
<span class="cm">        if (IntPin != nullptr) {</span>
<span class="cm">            UE_LOG(LogTemp, Warning, TEXT(&quot;K2 Int Pin Value is %s&quot;), *IntPin-&gt;GetDefaultAsString())</span>
<span class="cm">            // connect IntPin of editor k2 node (this) to runtime function node&#39;s Number pin</span>
<span class="cm">            UEdGraphPin* TargetIntPin = CallFunction-&gt;FindPinChecked(TEXT(&quot;Number&quot;));</span>
<span class="cm">            check(TargetIntPin != nullptr);</span>
<span class="cm">            // connect pins</span>
<span class="cm">            CompilerContext.CopyPinLinksToIntermediate(*IntPin, *TargetIntPin);</span>
<span class="cm">        }*/</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// move Exec and Then pin addreses from editor node to runtime function node</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// since all connections from this node are forwarded to CallFunction</span>
<span class="w">    </span><span class="c1">// we should disconnect the rest, if any</span>
<span class="w">    </span><span class="c1">// why? because this node will not exist in runtime build</span>
<span class="w">    </span><span class="c1">// in runtime only CallFunction node will exist</span>
<span class="w">    </span><span class="c1">// this is how K2 works, it just replaces one node with another or group of another nodes with some logic</span>
<span class="w">    </span><span class="c1">// since this script is short, here we do only very basic logic of forwarding data, it can be much more complex</span>
<span class="w">    </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// will be called during compilation. Allows to perform validation of internal values</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ValidateNodeDuringCompilation</span><span class="p">(</span><span class="n">FCompilerResultsLog</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MessageLog</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ValidateNodeDuringCompilation</span><span class="p">(</span><span class="n">MessageLog</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    // simple, classic way of working</span>
<span class="cm">    UClass* Action = GetClass();</span>
<span class="cm">    if (ActionRegistrar.IsOpenForRegistration(Action))</span>
<span class="cm">    {</span>
<span class="cm">        UBlueprintNodeSpawner* Spawner = UBlueprintNodeSpawner::Create(GetClass());</span>
<span class="cm">        check(Spawner != nullptr);</span>
<span class="cm">        ActionRegistrar.AddBlueprintAction(Action, Spawner);</span>
<span class="cm">    }*/</span>
<span class="w">    </span><span class="c1">// this lambda used to sync settings between spawned K2 nodes of this type</span>
<span class="w">    </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">UEdGraphNode</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SetupNodeData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">UEdGraphNode</span><span class="o">*</span><span class="w"> </span><span class="n">NewNode</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsTemplateNode</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">MenuNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastChecked</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">&gt;</span><span class="p">(</span><span class="n">NewNode</span><span class="p">);</span>
<span class="w">        </span><span class="n">MenuNode</span><span class="o">-&gt;</span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">;</span><span class="w"> </span><span class="c1">// set new node&#39;s internal value</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">NodeClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">NodeClass</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// as example - register 3 nodes of UK2NodeTest type</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">NodeSpawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">NodeClass</span><span class="p">);</span>
<span class="w">            </span><span class="n">check</span><span class="p">(</span><span class="n">NodeSpawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">            </span><span class="n">NodeSpawner</span><span class="o">-&gt;</span><span class="n">CustomizeNodeDelegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">FCustomizeNodeDelegate</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">SetupNodeData</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">NodeClass</span><span class="p">,</span><span class="w"> </span><span class="n">NodeSpawner</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node|1&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node|2&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NodeNumber</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node|3&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// default</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestK2Node&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// node corner icon</span>
<span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//return TEXT(&quot;Graph.Latent.LatentIcon&quot;);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FontEditor.UpdateAll&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to add node title color</span>
<span class="n">FLinearColor</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetNodeTitleColor</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FLinearColor</span><span class="o">::</span><span class="n">Blue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// used to generate node title</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">Format</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TestNode {0}&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// for tooltip</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetTooltipText</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">Format</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;This is test K2 Node Tooltip. NodeNumber is = {0}.&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">NodeNumber</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// for icon and tint</span>
<span class="n">FSlateIcon</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetIconAndTint</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutColor</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="w"> </span><span class="n">Icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="p">(</span><span class="n">FAppStyle</span><span class="o">::</span><span class="n">GetAppStyleSetName</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;GraphEditor.K2Node_CallFunction&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Icon</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// true if compatible with selected blueprint editor graph</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">IsCompatibleWithGraph</span><span class="p">(</span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">EGraphType</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">GraphType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Graph</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetGraphType</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GraphType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGraphType</span><span class="o">::</span><span class="n">GT_Ubergraph</span><span class="p">);</span><span class="w"> </span><span class="c1">// this is default graph for actor editor</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsCompatible</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">        </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Graph</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// prevent placement of this node in Construction Script</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">IsConstructionScript</span><span class="p">(</span><span class="n">Graph</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//return bIsCompatible;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// pin value gettr for ClassPin</span>
<span class="c1">// *note this method build based on \Engine\Source\Editor\BlueprintGraph\Private\K2Node_ConstructObjectFromClass.cpp</span>
<span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetClassPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// result</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">PinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pins</span><span class="p">;</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// search for class pin</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">TestPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">PinsToSearch</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TestPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">TestPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestPin</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassPin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// pin is found</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">HasAnyConnections</span><span class="p">())</span><span class="w"> </span><span class="c1">// pin not linked, so get default value</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// pin linked so get sub category pin value</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">            </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassSource</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ClassSource</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="p">.</span><span class="n">Get</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ClassResult</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// pin value getter for ShowExtraPinsPinName</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetShowExtraPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">PinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pins</span><span class="p">;</span><span class="w"> </span><span class="c1">// *note: &quot;Pins&quot; is all K2 Node current pins list</span>
<span class="w">    </span><span class="c1">// in given pins list search for desired pin, in our case  is&#39;t ShowExtraPinsPinName</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">TestPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">PinsToSearch</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TestPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">TestPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ShowExtraPinsPinName</span><span class="p">)</span><span class="w"> </span><span class="c1">// if this pin is ExpandNotePin</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestPin</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// exit of loop</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// just extra check in case if previous loop dosen&#39;t found anything</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// no such pin</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">HasAnyConnections</span><span class="p">())</span><span class="w"> </span><span class="c1">// if pin dosen&#39;t linked to anything - just get it&#39;s Default Value</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="p">.</span><span class="n">ToBool</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="c1">// if pin is linked to some logic</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// pin can be linked to variable or function</span>
<span class="w">        </span><span class="c1">// i want to read linked variable or function pin&#39;s default value, and return it as result</span>
<span class="w">        </span><span class="c1">// get first pin that we are linked to</span>
<span class="w">        </span><span class="c1">// connections, linked to pin, can be accessed thru array: Pin-&gt;LinkedTo</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">PinSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c1">// first connection is Pin-&gt;LinkedTo[0]</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PinSource</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// no connected nodes</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// debug</span>
<span class="w">        </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;Source Pin Name = %s&quot;), *PinSource-&gt;PinName.ToString())</span>
<span class="w">        </span><span class="c1">//UE_LOG(LogTemp, Warning, TEXT(&quot;Blueprint Node Name = %s&quot;), *PinSource-&gt;GetOwningNode()-&gt;GetName())</span>
<span class="w">        </span><span class="c1">// search blueprint, that has current K2 node</span>
<span class="w">        </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">PinSource</span><span class="o">-&gt;</span><span class="n">GetOwningNode</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetGraph</span><span class="p">());</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Blueprint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// it&#39;s impossible to trigger, but let it be</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// &quot;blueprint variable&quot; is &quot;blueprint property&quot;</span>
<span class="w">        </span><span class="c1">// we can read any of the variables inside given blueprint</span>
<span class="w">        </span><span class="c1">// we need so, because user can link to our ShowExtraPin any variable, and i want to read linked variable default value</span>
<span class="w">        </span><span class="n">FProperty</span><span class="o">*</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindFProperty</span><span class="o">&lt;</span><span class="n">FProperty</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Blueprint</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span><span class="p">,</span><span class="w"> </span><span class="n">PinSource</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// we dealing with linked boolean property</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Property</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">IsA</span><span class="p">(</span><span class="n">FBoolProperty</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">FString</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// parse variable property and get it&#39;s DefaultValue</span>
<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsVariableLinked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintCompilationManager</span><span class="o">::</span><span class="n">GetDefaultValue</span><span class="p">(</span><span class="n">Blueprint</span><span class="o">-&gt;</span><span class="n">GeneratedClass</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsVariableLinked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// UE_LOG(LogTemp, Warning, TEXT(&quot;Linked Variable Default Value = %s&quot;), *DefaultValueAsString)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">DefaultValueAsString</span><span class="p">.</span><span class="n">ToBool</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// we dealing with function property</span>
<span class="w">            </span><span class="c1">// since all code below dosen&#39;t make sense, just return pin default value</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="p">.</span><span class="n">ToBool</span><span class="p">();</span>
<span class="w">            </span><span class="c1">// even if this dosen&#39;t make sence, it&#39;s still usefull information to read</span>
<span class="w">            </span><span class="c1">// It&#39;s impossible to directly access DefaultValue from blueprint pin</span>
<span class="w">            </span><span class="c1">// we can get node, that connected to our node, in our case it&#39;s function node, but we can&#39;t get pin&#39;s default value</span>
<span class="w">            </span><span class="c1">// *note1: this code dosen&#39;t work with booleans! why so? well, it&#39;s because old bug in the engine</span>
<span class="w">            </span><span class="c1">// *note2: actually, we can evaluate blueprint functions by their names, why not do so?</span>
<span class="w">            </span><span class="c1">// well, because we don&#39;t know exact signature of function, that has currently linked pin</span>
<span class="w">            </span><span class="c1">// which pin is it. is it return pin or any else? what args function has?</span>
<span class="w">            </span><span class="cm">/*UEdGraphNode* Node = PinSource-&gt;GetOwningNode();</span>
<span class="cm">            UK2Node_CallFunction *FunctionCall = Cast&lt;UK2Node_CallFunction&gt;(PinSource-&gt;GetOwningNode());</span>
<span class="cm">            if (FunctionCall != nullptr) {</span>
<span class="cm">                UE_LOG(LogTemp, Warning, TEXT(&quot;This is Function Node&quot;))</span>
<span class="cm">                /*</span>
<span class="cm">                // we can try to get connected function return value by executing it</span>
<span class="cm">                // this won&#39;t work, because bp functions are runtime functions</span>
<span class="cm">                // in Editor space, where  K2 nodes are work in, no WorldObject</span>
<span class="cm">                // so this will just return true no matter what you do</span>
<span class="cm">                UFunction* BoundFunc = FunctionCall-&gt;GetTargetFunction();</span>
<span class="cm">                struct FBoolRetvalArgs</span>
<span class="cm">                {</span>
<span class="cm">                    bool Value;</span>
<span class="cm">                };</span>
<span class="cm">                FBoolRetvalArgs Arguments;</span>
<span class="cm">                Blueprint-&gt;ProcessEvent(BoundFunc, &amp;Arguments);</span>
<span class="cm">                return Arguments.Value;*\/</span>
<span class="cm">                /////////</span>
<span class="cm">                // this is alternative approach where i try to read function node pin itself, as i did with the variables</span>
<span class="cm">                // with no luck, it will anyway return false</span>
<span class="cm">                FProperty* FuncProperty = FunctionCall-&gt;GetTargetFunction()-&gt;GetReturnProperty();</span>
<span class="cm">                if (FuncProperty != nullptr &amp;&amp; FuncProperty-&gt;IsA(FBoolProperty::StaticClass())) {</span>
<span class="cm">                    FString DefaultValueAsString;</span>
<span class="cm">                    bool IsVariableLinked = FBlueprintCompilationManager::GetDefaultValue(Blueprint-&gt;GeneratedClass, FuncProperty, DefaultValueAsString);</span>
<span class="cm">                    if (IsVariableLinked) {</span>
<span class="cm">                        UE_LOG(LogTemp, Warning, TEXT(&quot;Function Return Default Value = %s&quot;), *DefaultValueAsString)</span>
<span class="cm">                        return DefaultValueAsString.ToBool();</span>
<span class="cm">                    }</span>
<span class="cm">                }</span>
<span class="cm">            }*/</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// called after node is pasted to the new graph</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">PostPasteNode</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// since private variables can&#39;t be copied if they aren&#39;t UPROPERTIES</span>
<span class="w">    </span><span class="c1">// in our case it&#39;s variable named &quot;CurrentClassCache&quot;</span>
<span class="w">    </span><span class="c1">// we should re-initialise them after node is copied / duplicated</span>
<span class="w">    </span><span class="c1">// i just do it by calling reconstruct</span>
<span class="w">    </span><span class="n">ReconstructNode</span><span class="p">();</span><span class="w"> </span><span class="c1">// reconstruct node to re-validate variables cache</span>
<span class="p">}</span>
<span class="c1">// used to show and process context menu on node or node pins</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetNodeContextMenuActions</span><span class="p">(</span><span class="n">UToolMenu</span><span class="o">*</span><span class="w"> </span><span class="n">Menu</span><span class="p">,</span><span class="w"> </span><span class="n">UGraphNodeContextMenuContext</span><span class="o">*</span><span class="w"> </span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetNodeContextMenuActions</span><span class="p">(</span><span class="n">Menu</span><span class="p">,</span><span class="w"> </span><span class="n">Context</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent wih current context</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Node</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// we are in Node context</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// lambda to reset exec pins list</span>
<span class="w">        </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ClearExecPins</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">[</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// remove const modifiers</span>
<span class="w">            </span><span class="c1">// &quot;this&quot; lambda modifier is const so get rid of constness as well</span>
<span class="w">            </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">OwningNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// validation</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">OwningNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ExecPinsCache</span><span class="p">);</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ExecPinsCache</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear array of pins</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="c1">// lambda to add another exec pin</span>
<span class="w">        </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AddExecPin</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="p">[</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// remove const modifiers</span>
<span class="w">            </span><span class="c1">// &quot;this&quot; lambda modifier is const so get rid of constness as well</span>
<span class="w">            </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">OwningNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// validation</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">OwningNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ExecPinsCache</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">GetNextExecPinName</span><span class="p">());</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">GenerateExecPins</span><span class="p">();</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ReconstructNode</span><span class="p">();</span><span class="w"> </span><span class="c1">// toggle reconstruction</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="c1">// add menu section for our items</span>
<span class="w">        </span><span class="n">FToolMenuSection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Menu</span><span class="o">-&gt;</span><span class="n">AddSection</span><span class="p">(</span><span class="s">&quot;TypeOperations&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Type Operations&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// add exec pin</span>
<span class="w">        </span><span class="n">Section</span><span class="p">.</span><span class="n">AddMenuEntry</span><span class="p">(</span>
<span class="w">            </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;AddExecPin&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Add Exec Pin&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will add Exec Pin to Node&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">FSlateIcon</span><span class="p">(),</span>
<span class="w">            </span><span class="n">FUIAction</span><span class="p">(</span><span class="n">FExecuteAction</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">AddExecPin</span><span class="p">))</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// reset exec pins</span>
<span class="w">        </span><span class="n">Section</span><span class="p">.</span><span class="n">AddMenuEntry</span><span class="p">(</span>
<span class="w">            </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;ClearExecPins&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Clear Exec Pins&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will clear all Exec Pins&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="n">FSlateIcon</span><span class="p">(),</span>
<span class="w">            </span><span class="n">FUIAction</span><span class="p">(</span><span class="n">FExecuteAction</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">ClearExecPins</span><span class="p">))</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// we are in Pin context</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// lambda to reset wildcard pin types</span>
<span class="w">        </span><span class="c1">// *note args should be const or it won&#39;t compile</span>
<span class="w">        </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ClearPins</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">[</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// remove const modifiers</span>
<span class="w">            </span><span class="c1">// &quot;this&quot; lambda modifier is const so get rid of constness as well</span>
<span class="w">            </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">OwningNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// validation</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">OwningNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// reset all pins</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">                    </span><span class="o">||</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// reset pin type</span>
<span class="w">                    </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ResetWcPinType</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">CurrentWcType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// reset current pin type cache</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ReconstructNode</span><span class="p">();</span><span class="w"> </span><span class="c1">// toggle reconstruction</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="c1">// lambda to set type for given pin</span>
<span class="w">        </span><span class="c1">// *note args should be const or it won&#39;t compile</span>
<span class="w">        </span><span class="n">TFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ApplyPinType</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="p">[</span><span class="k">this</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="w"> </span><span class="n">Type</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// remove const modifiers</span>
<span class="w">            </span><span class="c1">// &quot;this&quot; lambda modifier is const so get rid of constness as well</span>
<span class="w">            </span><span class="n">UK2NodeTest</span><span class="o">*</span><span class="w"> </span><span class="n">OwningNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UK2NodeTest</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// validation</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">OwningNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">CurrentWcType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Type</span><span class="p">;</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ApplyAllWcPinsToType</span><span class="p">(</span><span class="n">Type</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
<span class="w">            </span><span class="n">OwningNode</span><span class="o">-&gt;</span><span class="n">ReconstructNode</span><span class="p">();</span><span class="w"> </span><span class="c1">// toggle reconstruction</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="c1">// add menu section for our items</span>
<span class="w">        </span><span class="n">FToolMenuSection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Menu</span><span class="o">-&gt;</span><span class="n">AddSection</span><span class="p">(</span><span class="s">&quot;TypeOperations&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Type Operations&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// add items to work with wildcard pins</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Context</span><span class="o">-&gt;</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGPD_Input</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// iterate thru all accessible types and generate menu items</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TPair</span><span class="o">&lt;</span><span class="n">FName</span><span class="p">,</span><span class="w"> </span><span class="n">FKeyValuePinType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">WcAllowedTypes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Section</span><span class="p">.</span><span class="n">AddMenuEntry</span><span class="p">(</span>
<span class="w">                    </span><span class="n">Item</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="c1">// make FName menu item identifier from combined string</span>
<span class="w">                    </span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Set Pin Type to %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Item</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">())),</span><span class="w"> </span><span class="c1">// menu item name</span>
<span class="w">                    </span><span class="n">FText</span><span class="o">::</span><span class="n">Format</span><span class="p">(</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will convert Pin type to {0} Type&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">FText</span><span class="o">::</span><span class="n">FromString</span><span class="p">(</span><span class="n">Item</span><span class="p">.</span><span class="n">Key</span><span class="p">.</span><span class="n">ToString</span><span class="p">())),</span>
<span class="w">                    </span><span class="n">FSlateIcon</span><span class="p">(),</span>
<span class="w">                    </span><span class="c1">// FExecuteAction::CreateUObject requires const function or const uobject refrence. Why? .... ask devs</span>
<span class="w">                    </span><span class="c1">// just use const_cast to add or remove constness of variables,</span>
<span class="w">                    </span><span class="c1">// maybe, in future, this will be fixed, who knows...</span>
<span class="w">                    </span><span class="c1">// *note: i decided to use lambda instead</span>
<span class="w">                    </span><span class="c1">//FUIAction(FExecuteAction::CreateUObject(const_cast&lt;UK2NodeTest*&gt;(this), &amp;UK2NodeTest::SetWcPinType, Context-&gt;Pin, Item.Value.Key, Item.Value.Value))</span>
<span class="w">                    </span><span class="n">FUIAction</span><span class="p">(</span><span class="n">FExecuteAction</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">ApplyPinType</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="p">.</span><span class="n">Value</span><span class="p">))</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// add reset type</span>
<span class="w">            </span><span class="n">Section</span><span class="p">.</span><span class="n">AddMenuEntry</span><span class="p">(</span>
<span class="w">                </span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;ResetPinType&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reset Pin Type&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will reset Wildcard Pin type&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="n">FSlateIcon</span><span class="p">(),</span>
<span class="w">                </span><span class="n">FUIAction</span><span class="p">(</span><span class="n">FExecuteAction</span><span class="o">::</span><span class="n">CreateLambda</span><span class="p">(</span><span class="n">ClearPins</span><span class="p">))</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set all wildcard pins to given type</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ApplyAllWcPinsToType</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinType</span><span class="p">,</span><span class="w"> </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">SubPinType</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">BreakAllPinLinks</span><span class="p">();</span>
<span class="w">            </span><span class="n">SetWcPinType</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">PinType</span><span class="p">,</span><span class="w"> </span><span class="n">SubPinType</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set wildcard pin type</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">SetWcPinType</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">inPin</span><span class="p">,</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">PinType</span><span class="p">,</span><span class="w"> </span><span class="n">UScriptStruct</span><span class="o">*</span><span class="w"> </span><span class="n">SubPinType</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">inPin</span><span class="p">);</span><span class="w"> </span><span class="c1">// inPin function arg</span>
<span class="w">    </span><span class="c1">// validation</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SubPins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">RecombinePin</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// set type to pin</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">ContainerType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPinContainerType</span><span class="o">::</span><span class="n">None</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinType</span><span class="p">;</span><span class="w"> </span><span class="c1">//UEdGraphSchema_K2::PC_Int;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SubPinType</span><span class="p">;</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ResetPinToAutogeneratedDefaultValue</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span><span class="w"> </span><span class="c1">// reset default value after type is set</span>
<span class="p">}</span>
<span class="c1">// will wildcard pin type</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ResetWcPinType</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">inPin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">inPin</span><span class="p">);</span><span class="w"> </span><span class="c1">// inPin function arg</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">BreakAllPinLinks</span><span class="p">();</span>
<span class="w">    </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ResetPinToAutogeneratedDefaultValue</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">SetWcPinType</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span>
<span class="w">        </span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">GetDefaultWildcardPinType</span><span class="p">().</span><span class="n">PinCategory</span><span class="p">,</span>
<span class="w">        </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UScriptStruct</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FWildcardNodeUtils</span><span class="o">::</span><span class="n">GetDefaultWildcardPinType</span><span class="p">().</span><span class="n">PinSubCategoryObject</span><span class="p">.</span><span class="n">Get</span><span class="p">())</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// will reset type of all wildcards</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">ResetAllWcPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// reset all pins</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcInputPinName</span>
<span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">WcOutputPinName</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// reset pin type</span>
<span class="w">            </span><span class="n">ResetWcPinType</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">CurrentWcType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// reset current pin type cache</span>
<span class="p">}</span>
<span class="c1">// will return next exec pin name</span>
<span class="n">FName</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GetNextExecPinName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">NameBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Exec Pin&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="n">NameBase</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FName</span><span class="p">(</span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;%s %i&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">NameBase</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">));</span>
<span class="p">}</span>
<span class="c1">// will generate exec pins by list</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2NodeTest</span><span class="o">::</span><span class="n">GenerateExecPins</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear old pins</span>
<span class="w">    </span><span class="c1">//RemoveMultiplePinsByNames(&amp;ExecPinsCache);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// generate new pins</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="o">:</span><span class="w"> </span><span class="n">ExecPinsCache</span><span class="p">){</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">PinName</span><span class="p">);</span>
<span class="w">        </span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">        </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2NodeTestText&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Out Exec Pin&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">SetOwningNode</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h2 id="k2-node-boilerplate-k2">K2 Node Boilerplate, шаблон <code>K2</code> ноды</h2>
<p>Прежде чем двигаться дальше, считаю необходимым сделать некий базовый шаблон <code>K2</code> ноды, который будет очень легко использовать в будущих примерах и разработках.</p>
<p>В этом шаблоне не должно быть никакой сложной логики. Лишь простой набор методов и спискок необходимых <code>#include</code>.</p>
<h3 id="k2node_boilerplateh">Файл <code>K2Node_Boilerplate.h</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// Main File</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_EaseFunction.h&quot;</span>
<span class="c1">// EdGraph is part of K2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNode.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNodeUtils.h&quot;</span>
<span class="c1">// Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;KismetCompiler.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/CompilerResultsLog.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/WildcardNodeUtils.h&quot;</span><span class="c1"> // utils for wildcard node type</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/BlueprintEditorUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabaseRegistrar.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/DefaultValueHelper.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintCompilationManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Containers/Map.h&quot;</span><span class="c1"> // map container</span>
<span class="c1">//#include &quot;GameFramework/PlayerController.h&quot;</span>
<span class="c1">// UObject related includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span><span class="c1"> // this will hide warnings from intellisense</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UObjectGlobals.h&quot;</span>
<span class="c1">// Editor Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintNodeSpawner.h&quot;</span>
<span class="c1">// K2 Nodes that we refer to</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CallFunction.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Variable.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Literal.h&quot;</span>
<span class="c1">// Character Refrence</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// Runtime function library</span>
<span class="c1">//#include &quot;your function library&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Boilerplate.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * K2 Node Boilerplate class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOMEDITOR_API</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UK2Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UK2Node_Boilerplate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//~ Begin UK2Node Interface.</span>
<span class="w">    </span><span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// allows to handle node compilation directly</span>
<span class="w">    </span><span class="c1">// see https://docs.unrealengine.com/5.2/en-US/compiler-overview-for-blueprints-visual-scripting-in-unreal-engine/</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">FNodeHandlingFunctor</span><span class="o">*</span><span class="w"> </span><span class="n">CreateNodeHandler</span><span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to place this node into add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will set node category in add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// node corner icon</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Called when the connection list of one of the pins of this node is changed in the editor, after the pin has had it&#39;s literal cleared</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">NotifyPinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// return true if we want do show node properties in Details panel</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ShouldShowNodeProperties</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// return true if node used as &quot;pure&quot;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsNodePure</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//~ End UK2Node Interface</span>
<span class="w">    </span><span class="c1">//~ Begin UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// used to reconnect deprecated pin connections</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="nf">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to add pins for node</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AllocateDefaultPins</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to change pins in runtime</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to determine pin changes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to track connections for given pin</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">PinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to generate node title</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// for icon and tint on left corner</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="w"> </span><span class="nf">GetIconAndTint</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutColor</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// for tooltip</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetTooltipText</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UEdGraphNode Interface.</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will remove pins from provided name array</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">NameList</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">NumberPinName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to debug spawned node pins</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DebugPrintNodePins</span><span class="p">(</span><span class="n">UK2Node</span><span class="o">*</span><span class="w"> </span><span class="n">Node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin Name = %s, Pin Direction = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">UEnum</span><span class="o">::</span><span class="n">GetValueAsString</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="k2node_boilerplatecpp">Файл <code>K2Node_Boilerplate.cpp</code></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Boilerplate.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;K2Node_Boilerplate&quot;</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">NumberPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Number&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">UK2Node_Boilerplate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="o">:</span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// int data pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FCreatePinParams</span><span class="w"> </span><span class="n">PinParams</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//PinParams.ContainerType = EPinContainerType::Array;</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IntPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">NumberPinName</span><span class="p">,</span><span class="w"> </span><span class="n">PinParams</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">FromInt</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">        </span><span class="n">IntPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">IntPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">ConstructBasicPinTooltip</span><span class="p">(</span><span class="o">*</span><span class="n">IntPin</span><span class="p">,</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2Node_Boilerplate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Int Pin Toolptip&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">IntPin</span><span class="o">-&gt;</span><span class="n">PinToolTip</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// used to change pins in runtime</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AllocateDefaultPins</span><span class="p">();</span><span class="w"> </span><span class="c1">// this will load default exec pins</span>
<span class="w">    </span><span class="c1">// restore pins that was split</span>
<span class="w">    </span><span class="n">RestoreSplitPins</span><span class="p">(</span><span class="n">OldPins</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to determine pin changes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PinDefaultValueChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to track connections for given pin</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">PinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PinConnectionListChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// Called when the connection list of one of the pins of this node is changed in the editor, after the pin has had it&#39;s literal cleared</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">NotifyPinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">NotifyPinConnectionListChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to reconnect deprecated pin connections</span>
<span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">NumberPinName</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">NumberPinName</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ERedirectType_Name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/*UBlueprint* BP = FBlueprintEditorUtils::FindBlueprintForGraph(SourceGraph);</span>
<span class="cm">    ensure(BP);</span>
<span class="cm">    const UEdGraphSchema_K2* Schema = CompilerContext.GetSchema();</span>
<span class="cm">    // spawn &quot;call function&quot; k2 node</span>
<span class="cm">    UK2Node_CallFunction* CallFunction = CompilerContext.SpawnIntermediateNode&lt;UK2Node_CallFunction&gt;(this, SourceGraph);</span>
<span class="cm">    // set function refrence to the function node</span>
<span class="cm">    CallFunction-&gt;FunctionReference.SetExternalMember(</span>
<span class="cm">        GET_FUNCTION_NAME_CHECKED(UK2RuntimeFunctionsLibrary, LogNumber), UK2RuntimeFunctionsLibrary::StaticClass()</span>
<span class="cm">    );</span>
<span class="cm">    // allocate node pins</span>
<span class="cm">    CallFunction-&gt;AllocateDefaultPins();</span>
<span class="cm">    // move Exec and Then pin addreses from editor node to runtime function node</span>
<span class="cm">    CompilerContext.MovePinLinksToIntermediate(*GetExecPin(), *(CallFunction-&gt;GetExecPin()));</span>
<span class="cm">    CompilerContext.MovePinLinksToIntermediate(*GetThenPin(), *(CallFunction-&gt;GetThenPin()));</span>
<span class="cm">    // since all connections from this node are forwarded to CallFunction</span>
<span class="cm">    // we should disconnect the rest, if any</span>
<span class="cm">    // why? because this node will not exist in runtime build</span>
<span class="cm">    // in runtime only CallFunction node will exist</span>
<span class="cm">    // this is how K2 works, it just replaces one node with another or group of another nodes with some logic</span>
<span class="cm">    BreakAllNodeLinks();*/</span>
<span class="p">}</span>
<span class="c1">// allows to handle node compilation directly</span>
<span class="c1">// see https://docs.unrealengine.com/5.2/en-US/compiler-overview-for-blueprints-visual-scripting-in-unreal-engine/</span>
<span class="n">FNodeHandlingFunctor</span><span class="o">*</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">CreateNodeHandler</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FKCHandler_Passthru</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">);</span><span class="w"> </span><span class="c1">// just passthru this node</span>
<span class="w">    </span><span class="c1">//return nullptr;</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// register current class as acessible blueprint node</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">Action</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">Spawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span>
<span class="w">        </span><span class="n">check</span><span class="p">(</span><span class="n">Spawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">Spawner</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// for icon and tint on left corner</span>
<span class="n">FSlateIcon</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">GetIconAndTint</span><span class="p">(</span><span class="n">FLinearColor</span><span class="o">&amp;</span><span class="w"> </span><span class="n">OutColor</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="w"> </span><span class="n">Icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FSlateIcon</span><span class="p">(</span><span class="n">FAppStyle</span><span class="o">::</span><span class="n">GetAppStyleSetName</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;GraphEditor.K2Node_CallFunction&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Icon</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2Node_Boilerplate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2Custom&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to generate node title</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2Node_Boilerplate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2Boilerplate&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// for tooltip</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">GetTooltipText</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2Node_Boilerplate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Just Boilerplate for basic K2 Nodes&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// node corner icon</span>
<span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// latent action icon, if needed</span>
<span class="w">    </span><span class="c1">//return TEXT(&quot;Graph.Latent.LatentIcon&quot;);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">();</span><span class="w"> </span><span class="c1">// in case if you don&#39;t want icon - just call parent</span>
<span class="p">}</span>
<span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// code below will remove elements from array of Pins</span>
<span class="w">    </span><span class="c1">// array itself shrinks towards the beginning when elements are removed</span>
<span class="w">    </span><span class="c1">// and if we do loop from index - to Pins.Num() we will have problems with &quot;out of bounds&quot; error</span>
<span class="w">    </span><span class="c1">// so it&#39;s important to do reversed foor loop</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CurrentPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<span class="w">        </span><span class="c1">// if names are same or same+suffix (for expanden pins such as structs)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">BreakAllPinLinks</span><span class="p">();</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">MarkAsGarbage</span><span class="p">();</span>
<span class="w">            </span><span class="c1">//RemovePin(CurrentPin);</span>
<span class="w">            </span><span class="n">Pins</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="w">            </span><span class="n">OnPinRemoved</span><span class="p">(</span><span class="n">CurrentPin</span><span class="p">);</span>
<span class="w">            </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">MarkBlueprintAsModified</span><span class="p">(</span><span class="n">GetBlueprint</span><span class="p">());</span>
<span class="w">    </span><span class="n">GetGraph</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NotifyGraphChanged</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will remove pins from provided name array</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_Boilerplate</span><span class="o">::</span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">NameList</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NameList</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">NameList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemovePinByName</span><span class="p">(</span><span class="n">Name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">NameList</span><span class="o">-&gt;</span><span class="n">Empty</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h2 id="k2-expandnode">Развертка <code>K2</code> ноды, <code>ExpandNode</code></h2>
<p>Метод <code>ExpandNode</code> позволяет заменить сложную логику вашей <code>K2</code> ноды набором других, более простых нод. В <code>99%</code> случаев этого метода должно быть достаточно для реализации вашего функционала.</p>
<p>Программирование собственной логики внутри метода <code>ExpandNode</code> сильно напоминает создание свернутых <code>blueprint</code> графов. Именно на эти графы мы будем опираться в процессе разработки примеров.</p>
<p><a class="glightbox" href="../images/7ad4b3ac5b149e60a75335d4c33261a5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7ad4b3ac5b149e60a75335d4c33261a5.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7ad4b3ac5b149e60a75335d4c33261a5.png" /></a></p>
<p><a class="glightbox" href="../images/e378c8cc214fd251fbb3b5ce1e44402e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e378c8cc214fd251fbb3b5ce1e44402e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e378c8cc214fd251fbb3b5ce1e44402e.png" /></a></p>
<p>Как и свернутые графы, <code>K2</code> нода может обрабатывать события, иметь входные и выходные <code>Exec</code> пины, а так-же взаимодействовать с другими данными внутри <code>blueprint</code> который эту ноду вызывает.</p>
<p>Давайте рассмотрим ключевые методы, которые доступны внутри <code>Expand Node</code>.</p>
<h3 id="spawnintermediatenode">Метод <code>SpawnIntermediateNode</code></h3>
<p>Данный метод позволяет призвать внутрь нашей ноды любую другую <code>K2</code> ноду.</p>
<p>Например так призывается нода функции:
<div class="highlight"><pre><span></span><code><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">CallFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
</code></pre></div>
Которой затем можно указать саму привязанную функцию:
<div class="highlight"><pre><span></span><code><span class="c1">// spawn &quot;call function&quot; k2 node</span>
<span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">CallFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="c1">// set function refrence to the function node</span>
<span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">    </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">LogNumber</span><span class="p">),</span><span class="w"> </span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="p">);</span>
<span class="c1">// allocate node pins</span>
<span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
</code></pre></div></p>
<h3 id="movepinlinkstointermediate">Метод <code>MovePinLinksToIntermediate</code></h3>
<p>Данный метод позволяет перенести ссылки с пинов собственной <code>K2</code> ноды на ту ноду, которая была сгенерирована методом <code>SpawnIntermediateNode</code>.
Например так выполняется передача пинов <code>Exec</code> и <code>Then</code> с собственной <code>K2</code> ноды на призванную ноду <code>UK2Node_CallFunction</code>:
<div class="highlight"><pre><span></span><code><span class="c1">// move Exec and Then pin addreses from editor node to runtime function node</span>
<span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">CallFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
</code></pre></div></p>
<h3 id="trycreateconnection">Метод <code>TryCreateConnection</code></h3>
<p>Данный метод позволяет соединять между собой пины узлов, сгенерированных через метод <code>SpawnIntermediateNode</code>.
Дело в том, что предыдущий метод <code>MovePinLinksToIntermediate</code> перемещает пины с нашей ноды на призванную ноду, т.е. <code>Intermediate</code>. А метод <code>TryCreateConnection</code> позволяет создавать соединения между призванными <code>Intermediate</code> нодами.
<div class="highlight"><pre><span></span><code><span class="c1">// connect execution chain from Delay Function to Assign Node</span>
<span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">());</span>
<span class="c1">// connect temp variable to assign node</span>
<span class="c1">// this will allow to define variable with value</span>
<span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">(),</span><span class="w"> </span><span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">());</span>
</code></pre></div>
Рассмотрим наиболее полезные примеры развертки в <code>Expand Node</code>.</p>
<h3 id="_11">Развертка простой функции</h3>
<p>В методе <code>ExpandNode</code> разработчик может вызвать собственную функцию  из <code>runtime</code> библиотеки используя ноду <code>UK2Node_CallFunction</code>. Давайте рассмотрим на примере.</p>
<p>Для начала нам нужна функция, в которую мы будем разворачивать ноду. У нас уже есть библиотека функций <code>UK2RuntimeFunctionsLibrary</code>, добавим туда еще один метод.
<div class="highlight"><pre><span></span><code><span class="c1">// will summ two numbers if &#39;checker&#39; is true else return -1</span>
<span class="c1">// *note BlueprintInternalUseOnly - this function not meant to be used in bp&#39;s directly</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BlueprintInternalUseOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">))</span>
<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SummIfTrue</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">checker</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Num1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Num2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">checker</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Num2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/26ce7aba46fef8d82e9f78dbb72326a6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="26ce7aba46fef8d82e9f78dbb72326a6.png" auto_="auto;" display="block;" margin:="margin:" src="../images/26ce7aba46fef8d82e9f78dbb72326a6.png" /></a></p>
<p>Этот метод будет вызываться внутри нашей <code>K2</code> ноды.</p>
<p>Логика будущей ноды может быть описана следующим свернутым графом:</p>
<p><a class="glightbox" href="../images/3c1f1641231731d5c65d83958123ef34.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3c1f1641231731d5c65d83958123ef34.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3c1f1641231731d5c65d83958123ef34.png" /></a></p>
<p><a class="glightbox" href="../images/8c3a8d17bd7a8ea7ae4da2f94ac9d749.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8c3a8d17bd7a8ea7ae4da2f94ac9d749.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8c3a8d17bd7a8ea7ae4da2f94ac9d749.png" /></a></p>
<p>Читатель может заметить, что это очень простая и даже слишком бессмысленная логика. Тем не менее, для демонстрации использования ключевой ноды <code>UK2Node_CallFunction</code> данная логика более чем подходит.</p>
<p>Создаем <code>.h</code> и <code>.cpp</code> файлы будущей ноды. Я решил назвать ее <code>K2Node_ExpandBasicFunction</code>. Для создания ноды использовался опубликованный в предыдущей главе шаблон - <code>K2Node_Boilderplate</code>, который просто был скопирован и подправлен.</p>
<p><a class="glightbox" href="../images/8b0caa2752dcddca019090abd06bc5e3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8b0caa2752dcddca019090abd06bc5e3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8b0caa2752dcddca019090abd06bc5e3.png" /></a></p>
<p><a class="glightbox" href="../images/a8656fd7fa8cefa8d072cd6ba13b3bb8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="a8656fd7fa8cefa8d072cd6ba13b3bb8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/a8656fd7fa8cefa8d072cd6ba13b3bb8.png" /></a></p>
<p>Добавляем код.</p>
<h4 id="k2node_expandbasicfunctionh">Файл <code>K2Node_ExpandBasicFunction.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// Main File</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_EaseFunction.h&quot;</span>
<span class="c1">// EdGraph is part of K2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNode.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNodeUtils.h&quot;</span>
<span class="c1">// Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;KismetCompiler.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/CompilerResultsLog.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/WildcardNodeUtils.h&quot;</span><span class="c1"> // utils for wildcard node type</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/BlueprintEditorUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabaseRegistrar.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/DefaultValueHelper.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintCompilationManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Containers/Map.h&quot;</span><span class="c1"> // map container</span>
<span class="c1">//#include &quot;GameFramework/PlayerController.h&quot;</span>
<span class="c1">// UObject related includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span><span class="c1"> // this will hide warnings from intellisense</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UObjectGlobals.h&quot;</span>
<span class="c1">// Editor Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintNodeSpawner.h&quot;</span>
<span class="c1">// K2 Nodes that we refer to</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CallFunction.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Variable.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Literal.h&quot;</span>
<span class="c1">// Character Refrence</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// Runtime function library</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2RuntimeFunctionsLibrary.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_ExpandBasicFunction.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * K2 Node Boilerplate class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOMEDITOR_API</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UK2Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//~ Begin UK2Node Interface.</span>
<span class="w">    </span><span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to place this node into add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will set node category in add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// return true if we want do show node properties in Details panel</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ShouldShowNodeProperties</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// return true if node used as &quot;pure&quot;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsNodePure</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//~ End UK2Node Interface</span>
<span class="w">    </span><span class="c1">//~ Begin UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// used to reconnect deprecated pin connections</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="nf">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to add pins for node</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AllocateDefaultPins</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to generate node title</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UEdGraphNode Interface.</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">CheckerPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">Num1PinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">Num2PinName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// note* pin names for return value, Exec and Then pins already predefined in UE</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="k2node_expandbasicfunctioncpp">Файл <code>K2Node_ExpandBasicFunction.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_ExpandBasicFunction.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;K2Node_ExpandBasicFunction&quot;</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">CheckerPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Checker&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">Num1PinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Num1&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">Num2PinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Num2&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">UK2Node_ExpandBasicFunction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="o">:</span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// int1 pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">Num1PinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">FromInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// int2 pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">Num2PinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">FromInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// checker pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Boolean</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">CheckerPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// result pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">FromInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// used to reconnect deprecated pin connections</span>
<span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">CheckerPinName</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">CheckerPinName</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ERedirectType_Name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">BP</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">*</span><span class="w"> </span><span class="n">Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">GetSchema</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get refrences to the pins</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Num1Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">Num1PinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Num2Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">Num2PinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CheckerPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">CheckerPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ResultPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">Num1Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Num2Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">CheckerPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ResultPin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// spawn &quot;call function&quot; k2 node</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// set function refrence to the function node</span>
<span class="w">    </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">        </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">SummIfTrue</span><span class="p">),</span><span class="w"> </span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">// allocate node pins</span>
<span class="w">    </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionNum1Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Num1&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionNum2Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Num2&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionCheckerPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;checker&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionResultPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">FunctionNum1Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionNum2Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionCheckerPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionResultPin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// move Exec and Then pin addreses from editor node to runtime function node</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// move other pins as well</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">CheckerPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionCheckerPin</span><span class="p">);</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">Num1Pin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionNum1Pin</span><span class="p">);</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">Num2Pin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionNum2Pin</span><span class="p">);</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">ResultPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionResultPin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// since all connections from this node are forwarded to CallFunction</span>
<span class="w">    </span><span class="c1">// we should disconnect the rest, if any</span>
<span class="w">    </span><span class="c1">// why? because this node will not exist in runtime build</span>
<span class="w">    </span><span class="c1">// in runtime only CallFunction node will exist</span>
<span class="w">    </span><span class="c1">// this is how K2 works, it just replaces one node with another or group of another nodes with some logic</span>
<span class="w">    </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// register current class as acessible blueprint node</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">Action</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">Spawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span>
<span class="w">        </span><span class="n">check</span><span class="p">(</span><span class="n">Spawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">Spawner</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;K2Node_ExpandBasicFunction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2Custom|ExpandNode&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to generate node title</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;K2Node_ExpandBasicFunction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2ExpandBasicFunction&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h4 id="_12">Разбор кода</h4>
<p>После компиляции, вы получите ноду <code>K2ExpandBasicFunction</code>. Я привязал ее вызов к нажатию кнопки <code>1</code>. Если пин <code>Checker</code> установлен в <code>false</code>, то нода возвращает <code>-1</code>, если в <code>true</code> то сумму значений, в пинах <code>Num1</code> и <code>Num2</code>.</p>
<p><a class="glightbox" href="../images/b648e5f10568088849a1daab95c6c143.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b648e5f10568088849a1daab95c6c143.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b648e5f10568088849a1daab95c6c143.png" /></a></p>
<p><a class="glightbox" href="../images/7c485c6c248433c67f1646cfa7b6689e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7c485c6c248433c67f1646cfa7b6689e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7c485c6c248433c67f1646cfa7b6689e.png" /></a></p>
<p><a class="glightbox" href="../images/0fe44175be72c6c49d2d087a0c6ba643.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0fe44175be72c6c49d2d087a0c6ba643.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0fe44175be72c6c49d2d087a0c6ba643.png" /></a></p>
<p><a class="glightbox" href="../images/3bd3b1b3f3f5228cdfa04bfd3c9f997a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3bd3b1b3f3f5228cdfa04bfd3c9f997a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3bd3b1b3f3f5228cdfa04bfd3c9f997a.png" /></a></p>
<p>Код метода <code>ExpandNode</code> выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">UK2Node_ExpandBasicFunction::ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">BP</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">*</span><span class="w"> </span><span class="n">Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">GetSchema</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get refrences to the pins</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Num1Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">Num1PinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Num2Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">Num2PinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CheckerPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_ExpandBasicFunction</span><span class="o">::</span><span class="n">CheckerPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ResultPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">Num1Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Num2Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">CheckerPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ResultPin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// spawn &quot;call function&quot; k2 node</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// set function refrence to the function node</span>
<span class="w">    </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">        </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">SummIfTrue</span><span class="p">),</span><span class="w"> </span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">// allocate node pins</span>
<span class="w">    </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionNum1Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Num1&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionNum2Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Num2&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionCheckerPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;checker&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionResultPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">FunctionNum1Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionNum2Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionCheckerPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionResultPin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// move Exec and Then pin addreses from editor node to runtime function node</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// move other pins as well</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">CheckerPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionCheckerPin</span><span class="p">);</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">Num1Pin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionNum1Pin</span><span class="p">);</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">Num2Pin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionNum2Pin</span><span class="p">);</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">ResultPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionResultPin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// since all connections from this node are forwarded to CallFunction</span>
<span class="w">    </span><span class="c1">// we should disconnect the rest, if any</span>
<span class="w">    </span><span class="c1">// why? because this node will not exist in runtime build</span>
<span class="w">    </span><span class="c1">// in runtime only CallFunction node will exist</span>
<span class="w">    </span><span class="c1">// this is how K2 works, it just replaces one node with another or group of another nodes with some logic</span>
<span class="w">    </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
Как вы видите, я создаю ноду <code>UK2Node_CallFunction</code>, в которую затем размещаю функцию <code>SummIfTrue</code>. Методом <code>AllocateDefaultPins</code> происходит создание пинов. К которым затем переносятся пины от нашей собственной ноды, через <code>MovePinLinksToIntermediate</code>.</p>
<h3 id="intermediate">Как получить список пинов у <code>Intermediate</code> ноды?</h3>
<p>Как были получены названия пинов, которые есть у <code>intermediate</code> ноды <code>SummIfTrueFunction</code>?
<div class="highlight"><pre><span></span><code><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionNum1Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Num1&quot;</span><span class="p">));</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionNum2Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Num2&quot;</span><span class="p">));</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionCheckerPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;checker&quot;</span><span class="p">));</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionResultPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="n">check</span><span class="p">(</span><span class="n">FunctionNum1Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionNum2Pin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionCheckerPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FunctionResultPin</span><span class="p">);</span>
</code></pre></div>
Из определения самой функции.</p>
<p>Напомню, как она выглядит:
<div class="highlight"><pre><span></span><code><span class="c1">// will summ two numbers if &#39;checker&#39; is true else return -1</span>
<span class="c1">// *note BlueprintInternalUseOnly - this function not meant to be used in bp&#39;s directly</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="cm">/*, meta = (BlueprintInternalUseOnly = true)*/</span><span class="p">)</span>
<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SummIfTrue</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">checker</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Num1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Num2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">checker</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Num2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
Однако.</p>
<p>Чтение реализации целевой функции не всегда позволяет получить настоящие названия пинов. В этом случае рекомендую сделать следующий цикл прямо внутри метода <code>ExpandNode</code>:
<div class="highlight"><pre><span></span><code><span class="c1">// debug - print all pins of spawned function node</span>
<span class="c1">// this way we can check pin names if something goes wrong</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">SummIfTrueFunction</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin Name %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></p>
<p><a class="glightbox" href="../images/0e4b6539bbb32ef73eea0886f980098b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="0e4b6539bbb32ef73eea0886f980098b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/0e4b6539bbb32ef73eea0886f980098b.png" /></a></p>
<p>Теперь, в редакторе <code>Unreal Engine</code>, при компиляции кода с этой <code>K2</code> нодой в лог будет печататься список пинов.</p>
<p><a class="glightbox" href="../images/b584705b8ef41c999aae81c2086ef38e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b584705b8ef41c999aae81c2086ef38e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b584705b8ef41c999aae81c2086ef38e.png" /></a></p>
<p><a class="glightbox" href="../images/8c8a7c9190c922f6b3d836a3b0d06dc8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="8c8a7c9190c922f6b3d836a3b0d06dc8.png" auto_="auto;" display="block;" margin:="margin:" src="../images/8c8a7c9190c922f6b3d836a3b0d06dc8.png" /></a></p>
<p>Эти названия пинов затем можно смело использовать.</p>
<p>Я, так-же, обернул приведенный выше код в функцию.
<div class="highlight"><pre><span></span><code><span class="c1">// used to debug spawned node pins</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">DebugPrintNodePins</span><span class="p">(</span><span class="n">UK2Node</span><span class="o">*</span><span class="w"> </span><span class="n">Node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin Name = %s, Pin Direction = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">UEnum</span><span class="o">::</span><span class="n">GetValueAsString</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Эту функцию можно добавить к любой <code>K2</code> ноде и вызвать в методе <code>ExpandNode</code>.
<div class="highlight"><pre><span></span><code><span class="n">DebugPrintNodePins</span><span class="p">(</span><span class="n">IncrementFloatFunc</span><span class="p">);</span>
</code></pre></div>
Тогда при компиляции будет выводиться не только название пина, но так-же его <code>Direction</code>.</p>
<p><a class="glightbox" href="../images/70895f4047f13ef809ab68fcba9b0122.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="70895f4047f13ef809ab68fcba9b0122.png" auto_="auto;" display="block;" margin:="margin:" src="../images/70895f4047f13ef809ab68fcba9b0122.png" /></a></p>
<h3 id="latent-action-delay">Развертка <code>Latent Action Delay</code> и создание временных переменных</h3>
<p>Предлагаю рассмотреть развертку одной из встроенных функций, например функции <code>Delay</code> из <code>KismetSystemLibrary</code>. Это <code>LatentAction</code>, поэтому мне самому очень интересно узнать, как подобная функция поведет себя при развертке.</p>
<p><a class="glightbox" href="../images/3d4ae83d66874ba81122a7b6ca44e443.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="3d4ae83d66874ba81122a7b6ca44e443.png" auto_="auto;" display="block;" margin:="margin:" src="../images/3d4ae83d66874ba81122a7b6ca44e443.png" /></a></p>
<p>Вместо слишком простой логики, которую я использовал в предыдущей главе, предлагаю использовать логику чуть сложнее.</p>
<p>В дополнение к вызову функции <code>Delay</code>, так-же создадим и присвоим значения временным переменным типа <code>int</code> и <code>float</code>, а так-же увеличим значения этих переменных на 1.</p>
<p>Общий граф, по которому будет построена нода, выглядит так:</p>
<p><a class="glightbox" href="../images/7c038748a65b6892b4f488f78dee9602.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7c038748a65b6892b4f488f78dee9602.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7c038748a65b6892b4f488f78dee9602.png" /></a></p>
<p>Ноду я решил назвать <code>K2Node_DelayedIncrement</code>.
На основе заготовленного шаблона создаем файлы <code>K2Node_DelayedIncrement.h</code> и <code>K2Node_DelayedIncrement.cpp</code>.</p>
<p><a class="glightbox" href="../images/b572ab6139771b0007f9b5e9900a4f77.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b572ab6139771b0007f9b5e9900a4f77.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b572ab6139771b0007f9b5e9900a4f77.png" /></a></p>
<p><a class="glightbox" href="../images/1e94229a2b751270f08c4127b746809f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1e94229a2b751270f08c4127b746809f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1e94229a2b751270f08c4127b746809f.png" /></a></p>
<p>Теперь можно приступать к написанию кода.</p>
<p>Для начала я развернул ноду в метод <code>Delay</code> следующим образом:
<div class="highlight"><pre><span></span><code><span class="c1">// spawn &quot;call function&quot; k2 node</span>
<span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">DelayFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="c1">// load Delay function</span>
<span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">    </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UKismetSystemLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">Delay</span><span class="p">),</span><span class="w"> </span><span class="n">UKismetSystemLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="p">);</span>
<span class="c1">// allocate node pins</span>
<span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="c1">// debug - print all pins of spawned function node</span>
<span class="c1">// this way we can check pin names if something goes wrong</span>
<span class="cm">/*</span>
<span class="cm">Output is:</span>
<span class="cm">LogTemp: Warning: Pin Name execute</span>
<span class="cm">LogTemp: Warning: Pin Name then</span>
<span class="cm">LogTemp: Warning: Pin Name self</span>
<span class="cm">LogTemp: Warning: Pin Name WorldContextObject</span>
<span class="cm">LogTemp: Warning: Pin Name Duration</span>
<span class="cm">LogTemp: Warning: Pin Name LatentInfo</span>
<span class="cm">*/</span>
<span class="cm">/*for (UEdGraphPin* Pin : DelayFunction-&gt;Pins) {</span>
<span class="cm">    UE_LOG(LogTemp, Warning, TEXT(&quot;Pin Name %s&quot;), *Pin-&gt;PinName.ToString())</span>
<span class="cm">}*/</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionDurationPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Duration&quot;</span><span class="p">));</span>
<span class="c1">// Connect Exec and Duration pins to Delay node</span>
<span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">DurationPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionDurationPin</span><span class="p">);</span>
<span class="c1">// connect output</span>
<span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
</code></pre></div>
В реализации метода <code>Delay</code>, есть дополнительные параметры: <code>WorldContextObject</code> и <code>LatentInfo</code>.</p>
<p><a class="glightbox" href="../images/43f5b1d1cde48045536aa33ac24e2a12.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="43f5b1d1cde48045536aa33ac24e2a12.png" auto_="auto;" display="block;" margin:="margin:" src="../images/43f5b1d1cde48045536aa33ac24e2a12.png" /></a></p>
<p>Однако, как вы наверное уже знаете, данные параметры отсутствуют при вызове метода <code>Delay</code> в движке.</p>
<p><a class="glightbox" href="../images/b338fe02c1e16ddb4390b47b002e9692.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b338fe02c1e16ddb4390b47b002e9692.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b338fe02c1e16ddb4390b47b002e9692.png" /></a></p>
<p>Дело в том, что <code>LatentInfo</code> и <code>WorldContextObject</code> это параметры, автоматически задаваемые системой. Я уже рассматривал в одной из предыдущих статей как работают функции типа <code>LatentAction</code>.
Поскольку наша <code>K2</code> нода "разворачивается" в ноду <code>Delay</code>, нам не надо указывать приведенные выше параметры.</p>
<p>Пины, которые надо соединять, это <code>Duration</code>, а так-же <code>exec-then</code>.
Давайте проверим будет ли работать наша нода на данном этапе.</p>
<p><a class="glightbox" href="../images/cb4e2e722585ecb84bd4ec62cadff296.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cb4e2e722585ecb84bd4ec62cadff296.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cb4e2e722585ecb84bd4ec62cadff296.png" /></a></p>
<p><a class="glightbox" href="../images/c731ca744ea1b7498af214432690f596.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c731ca744ea1b7498af214432690f596.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c731ca744ea1b7498af214432690f596.png" /></a></p>
<p>Теперь необходимо реализовать логику работы переменных.</p>
<p>За создание временной переменной отвечает нода <code>UK2Node_TemporaryVariable</code>. Чтобы присвоить значение созданной нами переменной, используется нода <code>UK2Node_AssignmentStatement</code>.
Чтобы увеличить значение переменной на заданное число можно использовать, в случае с <code>float</code>, вызов встроенной в движок функции <code>Add_FloatFloat</code>, которую можно найти в библиотеке функций <code>UKismetMathLibrary</code>.
Таким образом, для присвоения значения переменной, а потом для увеличения этого значения, используется следующий граф:</p>
<p><a class="glightbox" href="../images/75a5aeb7bb15672bb11ce6407174459e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="75a5aeb7bb15672bb11ce6407174459e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/75a5aeb7bb15672bb11ce6407174459e.png" /></a></p>
<p>В коде метода <code>ExpandNode</code> это выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">/////////////////////////////////////////////////////</span>
<span class="c1">// now let&#39;s look at creation of temporal variables//</span>
<span class="c1">/////////////////////////////////////////////////////</span>
<span class="c1">// Create temp float variable</span>
<span class="n">UK2Node_TemporaryVariable</span><span class="o">*</span><span class="w"> </span><span class="n">TempVariableNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_TemporaryVariable</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">VariableType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Real</span><span class="p">;</span>
<span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">VariableType</span><span class="p">.</span><span class="n">PinSubCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Float</span><span class="p">;</span>
<span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="c1">// now we need to assing default value to our TempVariableNode</span>
<span class="c1">// to do so - spawn UK2Node_AssignmentStatement node</span>
<span class="n">UK2Node_AssignmentStatement</span><span class="o">*</span><span class="w"> </span><span class="n">AssignTempVarNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_AssignmentStatement</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="c1">// connect execution chain from Delay Function to Assign Node</span>
<span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">());</span>
<span class="c1">// connect temp variable to assign node</span>
<span class="c1">// this will allow to define variable with value</span>
<span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">(),</span><span class="w"> </span><span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">());</span>
<span class="c1">// assign value to temp variable</span>
<span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetValuePin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;0.0&quot;</span><span class="p">);</span>
<span class="c1">// now increment default value in our temp variable</span>
<span class="c1">// to do so we will use function Add_FloatFloat from UKismetMathLibrary</span>
<span class="c1">// we will load this function into UK2Node_CallFunction node</span>
<span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">AddFloatFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="c1">// load Add_FloatFloat function</span>
<span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">    </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UKismetMathLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">Add_FloatFloat</span><span class="p">),</span><span class="w"> </span><span class="n">UKismetMathLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="p">);</span>
<span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="c1">// set Add value to 1, it will be equal to increment</span>
<span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">);</span>
<span class="c1">// connect increment A with variable node pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IncrementFloatPinA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">));</span>
<span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">(),</span><span class="w"> </span><span class="n">IncrementFloatPinA</span><span class="p">);</span>
<span class="c1">// get return value</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IncrementFloatOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="c1">// connect our node&#39;s FloatRes pin with IncrementFloatOutput pin</span>
<span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">FloatResPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">IncrementFloatOutput</span><span class="p">);</span>
</code></pre></div>
Довольно путаный код, с этим нельзя поспорить, но если вы помните граф, на основе которого этот код был создан, все становится куда понятнее.</p>
<p>Разумеется, по всем видам <code>K2</code> нод не получится построить такой простой граф. Например для ноды <code>UK2Node_TemporaryVariable</code> нет никакого представления в движке. Именно поэтому вместо нее я использовал <code>MakeLiteralFloat</code>.</p>
<p><a class="glightbox" href="../images/b885af30b991a32064ee58508f55b914.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b885af30b991a32064ee58508f55b914.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b885af30b991a32064ee58508f55b914.png" /></a></p>
<p>Система <code>K2</code> открывает доступ разработчика к куда большему набору нод, нежели <code>blueprint</code>.
Аналогичный код будет и для создания, а так-же присвоения значения переменной типа <code>int</code>.</p>
<h4 id="k2node_delayedincrementh">Файл <code>K2Node_DelayedIncrement.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// Main File</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_EaseFunction.h&quot;</span>
<span class="c1">// EdGraph is part of K2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNode.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNodeUtils.h&quot;</span>
<span class="c1">// Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;KismetCompiler.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/CompilerResultsLog.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/WildcardNodeUtils.h&quot;</span><span class="c1"> // utils for wildcard node type</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/BlueprintEditorUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabaseRegistrar.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/DefaultValueHelper.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintCompilationManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetMathLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Containers/Map.h&quot;</span><span class="c1"> // map container</span>
<span class="c1">//#include &quot;GameFramework/PlayerController.h&quot;</span>
<span class="c1">// UObject related includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span><span class="c1"> // this will hide warnings from intellisense</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UObjectGlobals.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UnrealTypePrivate.h&quot;</span>
<span class="c1">// Editor Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintNodeSpawner.h&quot;</span>
<span class="c1">// K2 Nodes that we refer to</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CallFunction.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_TemporaryVariable.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_AssignmentStatement.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Literal.h&quot;</span>
<span class="c1">// Character Refrence</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// Runtime function library</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2RuntimeFunctionsLibrary.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_DelayedIncrement.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * K2 Node Boilerplate class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOMEDITOR_API</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UK2Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UK2Node_DelayedIncrement</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//~ Begin UK2Node Interface.</span>
<span class="w">    </span><span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to place this node into add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will set node category in add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// return true if we want do show node properties in Details panel</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ShouldShowNodeProperties</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// return true if node used as &quot;pure&quot;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsNodePure</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// node corner icon</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UK2Node Interface</span>
<span class="w">    </span><span class="c1">//~ Begin UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// used to add pins for node</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AllocateDefaultPins</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to generate node title</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UEdGraphNode Interface.</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">DurationPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">IntResPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">FloatResName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// note* pin names for return value, Exec and Then pins already predefined in UE</span>
<span class="w">    </span><span class="c1">// used to debug spawned node pins</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DebugPrintNodePins</span><span class="p">(</span><span class="n">UK2Node</span><span class="o">*</span><span class="w"> </span><span class="n">Node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin Name = %s, Pin Direction = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">UEnum</span><span class="o">::</span><span class="n">GetValueAsString</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="k2node_delayedincrementcpp">Файл <code>K2Node_DelayedIncrement.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_DelayedIncrement.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;K2Node_DelayedIncrement&quot;</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">DurationPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Duration&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">IntResPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;IntRes&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">FloatResName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FloatRes&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">UK2Node_DelayedIncrement</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Duration pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Real</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Float</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">DurationPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.3&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// IntRes pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">IntResPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">FromInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// FloatRes pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Real</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Float</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">FloatResName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.0&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cm">/*// LatentInfo pin</span>
<span class="cm">    {</span>
<span class="cm">        CreatePin(EGPD_Input, UEdGraphSchema_K2::PC_Struct, FLatentActionInfo::StaticStruct(), FBlueprintMetadata::MD_LatentInfo);</span>
<span class="cm">    }</span>
<span class="cm">    // WorldContext pin</span>
<span class="cm">    {</span>
<span class="cm">        CreatePin(EGPD_Input, UEdGraphSchema_K2::PC_Object, UObject::StaticClass(), FBlueprintMetadata::MD_WorldContext);</span>
<span class="cm">    }*/</span>
<span class="p">}</span>
<span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">BP</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">*</span><span class="w"> </span><span class="n">Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">GetSchema</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get refrences to the pins</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IntResPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">IntResPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FloatResPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">FloatResName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">DurationPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">DurationPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">IntResPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FloatResPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">DurationPin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">////////////////////////////////////////////////////////////////////////</span>
<span class="w">    </span><span class="c1">// let&#39;s look at spawning latent action Delay inside CallFunction node//</span>
<span class="w">    </span><span class="c1">////////////////////////////////////////////////////////////////////////</span>
<span class="w">    </span><span class="c1">// spawn &quot;call function&quot; k2 node</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">DelayFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// load Delay function</span>
<span class="w">    </span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">        </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UKismetSystemLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">Delay</span><span class="p">),</span><span class="w"> </span><span class="n">UKismetSystemLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="c1">// allocate node pins</span>
<span class="w">    </span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// connect input duration pin value with delay node pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionDurationPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Duration&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">DurationPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FunctionDurationPin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Connect Exec pin to Delay node</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">/////////////////////////////////////////////////////</span>
<span class="w">    </span><span class="c1">// now let&#39;s look at creation of temporal variables//</span>
<span class="w">    </span><span class="c1">/////////////////////////////////////////////////////</span>
<span class="w">    </span><span class="c1">// Create temp float variable</span>
<span class="w">    </span><span class="n">UK2Node_TemporaryVariable</span><span class="o">*</span><span class="w"> </span><span class="n">TempVariableNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_TemporaryVariable</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">VariableType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Real</span><span class="p">;</span>
<span class="w">    </span><span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">VariableType</span><span class="p">.</span><span class="n">PinSubCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Float</span><span class="p">;</span>
<span class="w">    </span><span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// now we need to assing default value to our TempVariableNode</span>
<span class="w">    </span><span class="c1">// to do so - spawn UK2Node_AssignmentStatement node</span>
<span class="w">    </span><span class="n">UK2Node_AssignmentStatement</span><span class="o">*</span><span class="w"> </span><span class="n">AssignTempVarNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_AssignmentStatement</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// connect execution chain from Delay Function to Assign Node</span>
<span class="w">    </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">DelayFunction</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// connect temp variable to assign node</span>
<span class="w">    </span><span class="c1">// this will allow to define variable with value</span>
<span class="w">    </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">(),</span><span class="w"> </span><span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// assign value to temp variable</span>
<span class="w">    </span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetValuePin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;0.0&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// now increment default value in our temp variable</span>
<span class="w">    </span><span class="c1">// to do so we will use function Add_FloatFloat from UKismetMathLibrary</span>
<span class="w">    </span><span class="c1">// we will load this function into UK2Node_CallFunction node</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">AddFloatFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// load Add_FloatFloat function</span>
<span class="w">    </span><span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">        </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UKismetMathLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">Add_FloatFloat</span><span class="p">),</span><span class="w"> </span><span class="n">UKismetMathLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// set Add value to 1, it will be equal to increment</span>
<span class="w">    </span><span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// connect increment A with variable node pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IncrementFloatPinA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">TempVariableNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">(),</span><span class="w"> </span><span class="n">IncrementFloatPinA</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// get return value</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IncrementFloatOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AddFloatFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// connect our node&#39;s FloatRes pin with IncrementFloatOutput pin</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">FloatResPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">IncrementFloatOutput</span><span class="p">);</span>
<span class="w">    </span><span class="c1">/////////////////////////////////////////////////</span>
<span class="w">    </span><span class="c1">// now let&#39;s look at creation of basic variable//</span>
<span class="w">    </span><span class="c1">/////////////////////////////////////////////////</span>
<span class="w">    </span><span class="c1">// spawn Variable node</span>
<span class="w">    </span><span class="n">UK2Node_TemporaryVariable</span><span class="o">*</span><span class="w"> </span><span class="n">IntVariableNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_TemporaryVariable</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">IntVariableNode</span><span class="o">-&gt;</span><span class="n">VariableType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">;</span>
<span class="w">    </span><span class="n">IntVariableNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// now we need to assing default value to our TempFloatVar</span>
<span class="w">    </span><span class="c1">// to do so - spawn UK2Node_AssignmentStatement node</span>
<span class="w">    </span><span class="n">UK2Node_AssignmentStatement</span><span class="o">*</span><span class="w"> </span><span class="n">AssignVariableNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_AssignmentStatement</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">AssignVariableNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// connect execution chain from DelayAssignTempVarNode to AssignVariableNode</span>
<span class="w">    </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">AssignTempVarNode</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="n">AssignVariableNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// connect IntVariableNode to AssignVariableNode</span>
<span class="w">    </span><span class="c1">// this will allow to define variable with value</span>
<span class="w">    </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">AssignVariableNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">(),</span><span class="w"> </span><span class="n">IntVariableNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// assign value to temp variable</span>
<span class="w">    </span><span class="n">AssignVariableNode</span><span class="o">-&gt;</span><span class="n">GetValuePin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// now increment default value in our variable</span>
<span class="w">    </span><span class="c1">// to do so we will use function Add_IntInt from UKismetMathLibrary</span>
<span class="w">    </span><span class="c1">// we will load this function into UK2Node_CallFunction node</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">AddIntFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// load Add_IntInt function</span>
<span class="w">    </span><span class="n">AddIntFunc</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span>
<span class="w">        </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UKismetMathLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">Add_IntInt</span><span class="p">),</span><span class="w"> </span><span class="n">UKismetMathLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="n">AddIntFunc</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// set Add value to 1, it will be equal to increment</span>
<span class="w">    </span><span class="n">AddIntFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// connect increment A with variable node pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IncrementIntPinA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AddIntFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">IntVariableNode</span><span class="o">-&gt;</span><span class="n">GetVariablePin</span><span class="p">(),</span><span class="w"> </span><span class="n">IncrementIntPinA</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// get return value</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">IncrementIntOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AddIntFunc</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// connect our node&#39;s IntRes pin with IncrementIntOutput pin</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">IntResPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">IncrementIntOutput</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//DebugPrintNodePins(AssignVariableNode);</span>
<span class="w">    </span><span class="c1">// connect output</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">AssignVariableNode</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// register current class as acessible blueprint node</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">Action</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">Spawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span>
<span class="w">        </span><span class="n">check</span><span class="p">(</span><span class="n">Spawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">Spawner</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;K2Node_DelayedIncrement&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2Custom|DelayedIncrement&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to generate node title</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;K2Node_DelayedIncrement&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2DelayedIncrement&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// node corner icon</span>
<span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_DelayedIncrement</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// latent action icon, if needed</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Graph.Latent.LatentIcon&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//return Super::GetCornerIcon(); // in case if you don&#39;t want icon - just call parent</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h4 id="_13">Результат</h4>
<p>После компиляции мы получаем ноду, которая, после заданной задержки, возвращает два числа <code>int</code> и <code>float</code> со значениями: <code>1</code> и <code>1.0</code> соответственно.</p>
<p><a class="glightbox" href="../images/850cec786d913d7dfc54f3ba795bb0e0.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="850cec786d913d7dfc54f3ba795bb0e0.png" auto_="auto;" display="block;" margin:="margin:" src="../images/850cec786d913d7dfc54f3ba795bb0e0.png" /></a></p>
<p><a class="glightbox" href="../images/d1fb1e4781280fade9f8dd75f9db70ff.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="d1fb1e4781280fade9f8dd75f9db70ff.png" auto_="auto;" display="block;" margin:="margin:" src="../images/d1fb1e4781280fade9f8dd75f9db70ff.png" /></a></p>
<h3 id="exec">Развертка события в <code>Exec</code> пин</h3>
<p>К помощью <code>K2</code> можно разворачивать обработку событий в набор <code>exec</code> пинов.</p>
<p>Для работы нам трубуется функция, которая будет генерировать событие. Я реализовал следующую функцию внутри библиотеки <code>UK2RuntimeFunctionsLibrary</code>:
<div class="highlight"><pre><span></span><code><span class="c1">// will create thread and freeze it for given amount of time, then call ResultDelegate</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;K2RuntimeModule&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DelayDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;3.0&quot;</span><span class="p">))</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">MakeThreadedDelay</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DelayDuration</span><span class="p">,</span><span class="w"> </span><span class="n">FCallResultDelegate</span><span class="w"> </span><span class="n">ResultDelegate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// make async thread</span>
<span class="w">    </span><span class="n">Async</span><span class="p">(</span><span class="n">EAsyncExecution</span><span class="o">::</span><span class="n">Thread</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]()</span><span class="o">-&gt;</span><span class="n">FString</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FPlatformProcess</span><span class="o">::</span><span class="n">Sleep</span><span class="p">(</span><span class="n">DelayDuration</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Thread Finished&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="c1">// call Then after thread is done.</span>
<span class="w">    </span><span class="c1">// *note: Delegates can&#39;t be used in lambdas directly, we should Move them in lambda scope</span>
<span class="w">    </span><span class="p">.</span><span class="n">Then</span><span class="p">([</span><span class="n">Delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MoveTemp</span><span class="p">(</span><span class="n">ResultDelegate</span><span class="p">)](</span><span class="n">TFuture</span><span class="o">&lt;</span><span class="n">FString</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Result</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Result</span><span class="p">.</span><span class="n">IsValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Make Sure result valid</span>
<span class="w">            </span><span class="n">Delegate</span><span class="p">.</span><span class="n">ExecuteIfBound</span><span class="p">(</span><span class="n">Result</span><span class="p">.</span><span class="n">Get</span><span class="p">());</span><span class="w"> </span><span class="c1">// call bound event</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
С ней и будем работать.
<code>Dynamic</code> делегат функции может быть развернут в <code>blueprint</code> событие. Мы можем использовать эту особенность движка, чтобы перенаправить пин полученного события в <code>Exec</code> пин нашей ноды.</p>
<p>Вот как это выглядит внутри свернутого графа:</p>
<p><a class="glightbox" href="../images/7b8c677bccf48f7672818812661ba8be.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7b8c677bccf48f7672818812661ba8be.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7b8c677bccf48f7672818812661ba8be.png" /></a></p>
<p><a class="glightbox" href="../images/7d7e10dfee6ed48705c644011d13bf96.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7d7e10dfee6ed48705c644011d13bf96.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7d7e10dfee6ed48705c644011d13bf96.png" /></a></p>
<p>Реализуем схожую логику внутри <code>K2</code> ноды, я решил назвать ее <code>K2Node_ThreadedDelay</code>.
Создадим файлы для будущей ноды.</p>
<p><a class="glightbox" href="../images/cd20d84b1b0254eed683ba0a60b17535.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="cd20d84b1b0254eed683ba0a60b17535.png" auto_="auto;" display="block;" margin:="margin:" src="../images/cd20d84b1b0254eed683ba0a60b17535.png" /></a></p>
<p><a class="glightbox" href="../images/e39cc63de6cd742c087cb541b9ac5cc7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="e39cc63de6cd742c087cb541b9ac5cc7.png" auto_="auto;" display="block;" margin:="margin:" src="../images/e39cc63de6cd742c087cb541b9ac5cc7.png" /></a></p>
<p>Мне повезло и я сумел найти в исходниках движка пример реализации развертки события. Он может быть найден внутри ноды <code>K2Node_LoadAsset</code> по пути <code>\Source\Editor\BlueprintGraph\Private\K2Node_LoadAsset.cpp</code>.</p>
<p><a class="glightbox" href="../images/56134a60db0cb62ba3cf213b5703d492.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="56134a60db0cb62ba3cf213b5703d492.png" auto_="auto;" display="block;" margin:="margin:" src="../images/56134a60db0cb62ba3cf213b5703d492.png" /></a></p>
<p>Повторим данную реализацию в применении к нашей собственной функции.</p>
<h4 id="k2node_threadeddelayh">Файл <code>K2Node_ThreadedDelay.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// Main File</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_EaseFunction.h&quot;</span>
<span class="c1">// EdGraph is part of K2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNode.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNodeUtils.h&quot;</span>
<span class="c1">// Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;KismetCompiler.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/CompilerResultsLog.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/WildcardNodeUtils.h&quot;</span><span class="c1"> // utils for wildcard node type</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/BlueprintEditorUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabaseRegistrar.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/DefaultValueHelper.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintCompilationManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Containers/Map.h&quot;</span><span class="c1"> // map container</span>
<span class="c1">//#include &quot;GameFramework/PlayerController.h&quot;</span>
<span class="c1">// UObject related includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span><span class="c1"> // this will hide warnings from intellisense</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UObjectGlobals.h&quot;</span>
<span class="c1">// Editor Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintNodeSpawner.h&quot;</span>
<span class="c1">// K2 Nodes that we refer to</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CallFunction.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Variable.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Literal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CustomEvent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_AddDelegate.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="c1">// Character Refrence</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// Runtime function library</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2RuntimeFunctionsLibrary.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_ThreadedDelay.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * K2 Node Boilerplate class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOMEDITOR_API</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UK2Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UK2Node_ThreadedDelay</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//~ Begin UK2Node Interface.</span>
<span class="w">    </span><span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to place this node into add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will set node category in add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// node corner icon</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// return true if we want do show node properties in Details panel</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ShouldShowNodeProperties</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// return true if node used as &quot;pure&quot;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsNodePure</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//~ End UK2Node Interface</span>
<span class="w">    </span><span class="c1">//~ Begin UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// determine if a node of this type can be created for the specified graph.</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsCompatibleWithGraph</span><span class="p">(</span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to add pins for node</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AllocateDefaultPins</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to generate node title</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UEdGraphNode Interface.</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">DonePinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">DelayDurationPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">FinishMessagePinName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to debug spawned node pins</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DebugPrintNodePins</span><span class="p">(</span><span class="n">UK2Node</span><span class="o">*</span><span class="w"> </span><span class="n">Node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin Name = %s, Pin Direction = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">UEnum</span><span class="o">::</span><span class="n">GetValueAsString</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="k2node_threadeddelaycpp">Файл <code>K2Node_ThreadedDelay.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_ThreadedDelay.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;K2Node_ThreadedDelay&quot;</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">DelayDurationPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;DelayDuration&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">DonePinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">FinishMessagePinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FinishMessage&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">UK2Node_ThreadedDelay</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="o">:</span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Done Pin</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">DonePinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Duration pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Real</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Float</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">DelayDurationPinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.3&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Finish Message Pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_String</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">FinishMessagePinName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">BP</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">*</span><span class="w"> </span><span class="n">Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">GetSchema</span><span class="p">();</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsErrorFree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// get pin refrences</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">DurationPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">DelayDurationPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">FinishMessagePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">FinishMessagePinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">DonePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">DonePinName</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// spawn &quot;call function&quot; k2 node</span>
<span class="w">    </span><span class="n">FName</span><span class="w"> </span><span class="n">FunctionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">MakeThreadedDelay</span><span class="p">);</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">FunctionNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">FunctionNode</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span><span class="w"> </span><span class="n">FunctionName</span><span class="p">,</span><span class="w"> </span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">FunctionNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// move Exec and Then pin addreses from editor node to runtime function node</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">FunctionNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">FunctionNode</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// move links from duration pin to DelayDuration function param</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">DurationPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">FunctionNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">FName</span><span class="p">(</span><span class="s">&quot;DelayDuration&quot;</span><span class="p">))));</span>
<span class="w">    </span><span class="c1">// get delegate pin</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">DelegatePinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ResultDelegate&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">CallFunctionDelegatePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FunctionNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">DelegatePinName</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//*note: code below based on: \Source\Editor\BlueprintGraph\Private\K2Node_LoadAsset.cpp</span>
<span class="w">    </span><span class="n">UK2Node_CustomEvent</span><span class="o">*</span><span class="w"> </span><span class="n">CustomEventNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateEventNode</span><span class="o">&lt;</span><span class="n">UK2Node_CustomEvent</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">CallFunctionDelegatePin</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">CustomEventNode</span><span class="o">-&gt;</span><span class="n">CustomFunctionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;OnDelayDone_%s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">GetGuid</span><span class="p">(</span><span class="n">FunctionNode</span><span class="p">));</span>
<span class="w">    </span><span class="n">CustomEventNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get delegate signature from function node</span>
<span class="w">    </span><span class="c1">// first get target UFunction</span>
<span class="w">    </span><span class="n">UFunction</span><span class="o">*</span><span class="w"> </span><span class="n">DelayTargetFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FunctionNode</span><span class="o">-&gt;</span><span class="n">GetTargetFunction</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// then get UFunction property with name DelegatePinName</span>
<span class="w">    </span><span class="n">FDelegateProperty</span><span class="o">*</span><span class="w"> </span><span class="n">DoneDelegateProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DelayTargetFunction</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">FindFProperty</span><span class="o">&lt;</span><span class="n">FDelegateProperty</span><span class="o">&gt;</span><span class="p">(</span><span class="n">DelayTargetFunction</span><span class="p">,</span><span class="w"> </span><span class="n">DelegatePinName</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// then get found delegate property signature</span>
<span class="w">    </span><span class="n">UFunction</span><span class="o">*</span><span class="w"> </span><span class="n">DoneDelegateSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoneDelegateProperty</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">DoneDelegateProperty</span><span class="o">-&gt;</span><span class="n">SignatureFunction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">DoneDelegateSignature</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if signature is found</span>
<span class="w">    </span><span class="c1">// make new pins in CustomEventNode node based on found delegate signature</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TFieldIterator</span><span class="o">&lt;</span><span class="n">FProperty</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PropIt</span><span class="p">(</span><span class="n">DoneDelegateSignature</span><span class="p">);</span><span class="w"> </span><span class="n">PropIt</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">PropIt</span><span class="o">-&gt;</span><span class="n">PropertyFlags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">CPF_Parm</span><span class="p">);</span><span class="w"> </span><span class="o">++</span><span class="n">PropIt</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FProperty</span><span class="o">*</span><span class="w"> </span><span class="n">Param</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">PropIt</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Param</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_OutParm</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Param</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_ReferenceParm</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">FEdGraphPinType</span><span class="w"> </span><span class="n">PinType</span><span class="p">;</span>
<span class="w">            </span><span class="n">bIsErrorFree</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">ConvertPropertyToPinType</span><span class="p">(</span><span class="n">Param</span><span class="p">,</span><span class="w"> </span><span class="cm">/*out*/</span><span class="w"> </span><span class="n">PinType</span><span class="p">);</span>
<span class="w">            </span><span class="n">bIsErrorFree</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="p">(</span><span class="k">nullptr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CustomEventNode</span><span class="o">-&gt;</span><span class="n">CreateUserDefinedPin</span><span class="p">(</span><span class="n">Param</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">(),</span><span class="w"> </span><span class="n">PinType</span><span class="p">,</span><span class="w"> </span><span class="n">EGPD_Output</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// now we can see new pins in custom event</span>
<span class="w">    </span><span class="c1">//DebugPrintNodePins(CustomEventNode);</span>
<span class="w">    </span><span class="c1">// connect custom event node with function delegate pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">EventDelegatePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CustomEventNode</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_CustomEvent</span><span class="o">::</span><span class="n">DelegateOutputName</span><span class="p">);</span>
<span class="w">        </span><span class="n">bIsErrorFree</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">CallFunctionDelegatePin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">EventDelegatePin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">CallFunctionDelegatePin</span><span class="p">,</span><span class="w"> </span><span class="n">EventDelegatePin</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsErrorFree</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MessageLog</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="o">*</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;InternalConnectionError&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2Node_ThreadedDelay: Internal connection error. @@&quot;</span><span class="p">).</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// connect Done exec pin with CustomEventNode&#39;s Then pin</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">DonePin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">CustomEventNode</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// connect Finish Message pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="w"> </span><span class="o">*</span><span class="n">FinishMessageCustomNodePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CustomEventNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;FinishMessage&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">FinishMessagePin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">FinishMessageCustomNodePin</span><span class="p">);</span>
<span class="w">    </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// determine if a node of this type can be created for the specified graph.</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">IsCompatibleWithGraph</span><span class="p">(</span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">EGraphType</span><span class="w"> </span><span class="n">GraphType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Graph</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetGraphType</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// this node compatible only with Ubergraph and Macro Graph</span>
<span class="w">    </span><span class="c1">// function graphs are not allowed</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GraphType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGraphType</span><span class="o">::</span><span class="n">GT_Ubergraph</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">GraphType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGraphType</span><span class="o">::</span><span class="n">GT_Macro</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">IsCompatibleWithGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// register current class as acessible blueprint node</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">Action</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">Spawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span>
<span class="w">        </span><span class="n">check</span><span class="p">(</span><span class="n">Spawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">Spawner</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2Node_ThreadedDelay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2Custom|Delay&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to generate node title</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2Node_ThreadedDelay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2ThreadedDelay&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// node corner icon</span>
<span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ThreadedDelay</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// latent action icon, if needed</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Graph.Latent.LatentIcon&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//return Super::GetCornerIcon(); // in case if you don&#39;t want icon - just call parent</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h4 id="_14">Результат</h4>
<p>После компиляции мы получаем ноду <code>K2ThreadedDelay</code>.</p>
<p><a class="glightbox" href="../images/ef3abea23b7a32773fb9b7b8030b0b82.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ef3abea23b7a32773fb9b7b8030b0b82.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ef3abea23b7a32773fb9b7b8030b0b82.png" /></a></p>
<p>Данная нода, после заданной задержки, возвращает текст <code>Thread Finished</code>, при этом задержка просчитывается через дополнительный поток, а не через <code>tick</code>.</p>
<p><a class="glightbox" href="../images/29dd021ee34be2c033e454e24a995171.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="29dd021ee34be2c033e454e24a995171.png" auto_="auto;" display="block;" margin:="margin:" src="../images/29dd021ee34be2c033e454e24a995171.png" /></a></p>
<h4 id="_15">Запрет на добавление ноды в определенные графы</h4>
<p>Как вы знаете, внутри тела <code>blueprint</code> функций создание ноды <code>CustomEvent</code> не возможно.</p>
<p><a class="glightbox" href="../images/40b5ec65d6c1acee999e5bb612df5382.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="40b5ec65d6c1acee999e5bb612df5382.png" auto_="auto;" display="block;" margin:="margin:" src="../images/40b5ec65d6c1acee999e5bb612df5382.png" /></a></p>
<p>Поэтому любая попытка вызова <code>K2ThreadedDelay</code> внутри функции приведет к ошибке.</p>
<p><a class="glightbox" href="../images/f2bd5091dbeaeb967f963045ba252c1b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="f2bd5091dbeaeb967f963045ba252c1b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/f2bd5091dbeaeb967f963045ba252c1b.png" /></a></p>
<p>Чтобы избежать такого рода ошибок - надо запретить создание нод типа <code>UK2Node_ThreadedDelay</code> в функциях.</p>
<p>Для этой цели существует переопределяемый метод - <code>IsCompatibleWithGraph</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// determine if a node of this type can be created for the specified graph.</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">UK2Node_ThreadedDelay::IsCompatibleWithGraph</span><span class="p">(</span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">Graph</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">EGraphType</span><span class="w"> </span><span class="n">GraphType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Graph</span><span class="o">-&gt;</span><span class="n">GetSchema</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetGraphType</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// this node compatible only with Ubergraph and Macro Graph</span>
<span class="w">    </span><span class="c1">// function graphs are not allowed</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GraphType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGraphType</span><span class="o">::</span><span class="n">GT_Ubergraph</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">GraphType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGraphType</span><span class="o">::</span><span class="n">GT_Macro</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bIsCompatible</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">IsCompatibleWithGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
После добавления этого кода разработчик не сможет добавлять ноды типа <code>UK2Node_ThreadedDelay</code> в функции ни через копирование, ни через меню выбора.</p>
<p><a class="glightbox" href="../images/af1b76dd93555445e9e5c5858033d53e.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="af1b76dd93555445e9e5c5858033d53e.png" auto_="auto;" display="block;" margin:="margin:" src="../images/af1b76dd93555445e9e5c5858033d53e.png" /></a></p>
<h3 id="ifthenelse-promotableoperator">Развертка условия <code>IfThenElse</code>, а так-же <code>PromotableOperator</code></h3>
<p>Не плохой идеей будет рассмотреть развертку ноды <code>Branch</code> или-же <code>IfThenElse</code>. Хотя пример будет слишком простым, но крайне полезным, потому что эта нода - одна из наиболее востребованных при работе.</p>
<p>Развернем следующий граф:</p>
<p><a class="glightbox" href="../images/ccf11e7c37df8878800cb799f0b3375d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="ccf11e7c37df8878800cb799f0b3375d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/ccf11e7c37df8878800cb799f0b3375d.png" /></a></p>
<p><a class="glightbox" href="../images/63cbe715e0dd9036cdb7196613607ac1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="63cbe715e0dd9036cdb7196613607ac1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/63cbe715e0dd9036cdb7196613607ac1.png" /></a></p>
<p>В работе нам поможет <code>KismetMathLibrary</code>.</p>
<p><a class="glightbox" href="../images/9a8064f8bd165a080cdcd3c7caa4ce39.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9a8064f8bd165a080cdcd3c7caa4ce39.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9a8064f8bd165a080cdcd3c7caa4ce39.png" /></a></p>
<p>Создаем файлы. Я решил назвать новую ноду <code>K2Node_BranchTest</code>.</p>
<h4 id="k2node_branchtesth">Файл <code>K2Node_BranchTest.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// Main File</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_EaseFunction.h&quot;</span>
<span class="c1">// EdGraph is part of K2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNode.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNodeUtils.h&quot;</span>
<span class="c1">// Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;KismetCompiler.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/CompilerResultsLog.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/WildcardNodeUtils.h&quot;</span><span class="c1"> // utils for wildcard node type</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/BlueprintEditorUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabaseRegistrar.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/DefaultValueHelper.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintCompilationManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetMathLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Containers/Map.h&quot;</span><span class="c1"> // map container</span>
<span class="c1">//#include &quot;GameFramework/PlayerController.h&quot;</span>
<span class="c1">// UObject related includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span><span class="c1"> // this will hide warnings from intellisense</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UObjectGlobals.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UnrealTypePrivate.h&quot;</span>
<span class="c1">// Editor Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintNodeSpawner.h&quot;</span>
<span class="c1">// K2 Nodes that we refer to</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CallFunction.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_TemporaryVariable.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_AssignmentStatement.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_IfThenElse.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_PromotableOperator.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Literal.h&quot;</span>
<span class="c1">// Character Refrence</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_BranchTest.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * K2 Node Boilerplate class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOMEDITOR_API</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UK2Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UK2Node_BranchTest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//~ Begin UK2Node Interface.</span>
<span class="w">    </span><span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to place this node into add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will set node category in add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// return true if we want do show node properties in Details panel</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ShouldShowNodeProperties</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// return true if node used as &quot;pure&quot;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsNodePure</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// node corner icon</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UK2Node Interface</span>
<span class="w">    </span><span class="c1">//~ Begin UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// used to add pins for node</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AllocateDefaultPins</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to generate node title</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UEdGraphNode Interface.</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ValuePinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">GreaterPinName</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">SmallerPinName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// note* pin names for return value, Exec and Then pins already predefined in UE</span>
<span class="w">    </span><span class="c1">// used to debug spawned node pins</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DebugPrintNodePins</span><span class="p">(</span><span class="n">UK2Node</span><span class="o">*</span><span class="w"> </span><span class="n">Node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin Name = %s, Pin Direction = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">UEnum</span><span class="o">::</span><span class="n">GetValueAsString</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="k2node_branchtestcpp">Файл <code>K2Node_BranchTest.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_BranchTest.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;K2Node_DelayedIncrement&quot;</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">ValuePinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Value&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">GreaterPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&gt;0&quot;</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">SmallerPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;&lt;=0&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">UK2Node_BranchTest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// we don&#39;t need then pin</span>
<span class="w">    </span><span class="c1">//CreatePin(EGPD_Output, UEdGraphSchema_K2::PC_Exec, UEdGraphSchema_K2::PN_Then);</span>
<span class="w">    </span><span class="c1">// greater exec pin</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">GreaterPinName</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// smaller exec pin</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">SmallerPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// ValuePinName pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">,</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">ValuePinName</span><span class="p">);</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">FString</span><span class="w"> </span><span class="n">PinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FString</span><span class="o">::</span><span class="n">FromInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PinValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">BP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">BP</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">*</span><span class="w"> </span><span class="n">Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">GetSchema</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// get refrences to the pins</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ValuePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">ValuePinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">GreaterPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">GreaterPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">SmallerPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">SmallerPinName</span><span class="p">);</span>
<span class="w">    </span><span class="n">UK2Node_IfThenElse</span><span class="o">*</span><span class="w"> </span><span class="n">BranchCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_IfThenElse</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">BranchCheck</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//DebugPrintNodePins(BranchCheck);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ValuePin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">ValuePin</span><span class="o">-&gt;</span><span class="n">DoesDefaultValueMatchAutogenerated</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// spawn PromotableOperator and load Greater_IntInt function in it</span>
<span class="w">        </span><span class="n">UK2Node_PromotableOperator</span><span class="o">*</span><span class="w"> </span><span class="n">ComparsionFunctionNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_PromotableOperator</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">        </span><span class="n">UFunction</span><span class="o">*</span><span class="w"> </span><span class="n">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UKismetMathLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindFunctionByName</span><span class="p">(</span><span class="w"> </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UKismetMathLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">Greater_IntInt</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">SetFromFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">);</span>
<span class="w">        </span><span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">APin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">BPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// convert wildcard pins to accept int values</span>
<span class="w">        </span><span class="n">FEdGraphPinType</span><span class="w"> </span><span class="n">IntPinType</span><span class="p">;</span>
<span class="w">        </span><span class="n">IntPinType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">;</span>
<span class="w">        </span><span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">ConvertPinType</span><span class="p">(</span><span class="n">APin</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinType</span><span class="p">);</span>
<span class="w">        </span><span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">ConvertPinType</span><span class="p">(</span><span class="n">BPin</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinType</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// connect pin A with value</span>
<span class="w">        </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">ValuePin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">APin</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//DebugPrintNodePins(ComparsionFunctionNode);</span>
<span class="w">        </span><span class="c1">// connect condition pin</span>
<span class="w">        </span><span class="n">Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">BranchCheck</span><span class="o">-&gt;</span><span class="n">GetConditionPin</span><span class="p">(),</span><span class="w"> </span><span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">GetReturnValuePin</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">BranchCheck</span><span class="o">-&gt;</span><span class="n">GetConditionPin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// connect input branches</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">BranchCheck</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// connect output branches</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">SmallerPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">BranchCheck</span><span class="o">-&gt;</span><span class="n">GetElsePin</span><span class="p">()));</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GreaterPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">BranchCheck</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// register current class as acessible blueprint node</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">Action</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">Spawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span>
<span class="w">        </span><span class="n">check</span><span class="p">(</span><span class="n">Spawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">Spawner</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;K2Node_BranchTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2Custom|BranchTest&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to generate node title</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;K2Node_BranchTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2BranchTest&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// node corner icon</span>
<span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_BranchTest</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">();</span><span class="w"> </span><span class="c1">// in case if you don&#39;t want icon - just call parent</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h4 id="_16">Результат</h4>
<p><a class="glightbox" href="../images/6d53bc26a686d7a47466e78479ea2367.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="6d53bc26a686d7a47466e78479ea2367.png" auto_="auto;" display="block;" margin:="margin:" src="../images/6d53bc26a686d7a47466e78479ea2367.png" /></a></p>
<p><a class="glightbox" href="../images/849818a1a25116d3b1cfa49c58d1b081.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="849818a1a25116d3b1cfa49c58d1b081.png" auto_="auto;" display="block;" margin:="margin:" src="../images/849818a1a25116d3b1cfa49c58d1b081.png" /></a></p>
<p>Для проверки типа ноды я использовал оператор <code>UK2Node_PromotableOperator</code>. Он представляет собой обертку над классом <code>UK2Node_CallFunction</code>. Данный оператор имеет вместо обычных пинов - <code>Wildcard</code> пины.</p>
<p><a class="glightbox" href="../images/15a42c7d58d830c3a9530aa4a5893cca.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="15a42c7d58d830c3a9530aa4a5893cca.png" auto_="auto;" display="block;" margin:="margin:" src="../images/15a42c7d58d830c3a9530aa4a5893cca.png" /></a></p>
<p>Данный оператор добавляется следующим образом:
<div class="highlight"><pre><span></span><code><span class="c1">// spawn PromotableOperator and load Greater_IntInt function in it</span>
<span class="n">UK2Node_PromotableOperator</span><span class="o">*</span><span class="w"> </span><span class="n">ComparsionFunctionNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_PromotableOperator</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="n">UFunction</span><span class="o">*</span><span class="w"> </span><span class="n">Function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UKismetMathLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindFunctionByName</span><span class="p">(</span><span class="w"> </span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UKismetMathLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">Greater_IntInt</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">SetFromFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">);</span>
<span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
</code></pre></div>
Пины конвертируются так <code>Int</code>.
<div class="highlight"><pre><span></span><code><span class="c1">// convert wildcard pins to accept int values</span>
<span class="n">FEdGraphPinType</span><span class="w"> </span><span class="n">IntPinType</span><span class="p">;</span>
<span class="n">IntPinType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Int</span><span class="p">;</span>
<span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">ConvertPinType</span><span class="p">(</span><span class="n">APin</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinType</span><span class="p">);</span>
<span class="n">ComparsionFunctionNode</span><span class="o">-&gt;</span><span class="n">ConvertPinType</span><span class="p">(</span><span class="n">BPin</span><span class="p">,</span><span class="w"> </span><span class="n">IntPinType</span><span class="p">);</span>
</code></pre></div></p>
<h3 id="exec_1">Развертка делегатов в <code>Exec</code> пины</h3>
<p>Средствами системы <code>K2</code> можно развернуть любой класс <code>UObject</code> с делегатами, в ноду с <code>Exec</code> пинами.</p>
<p>Это небольшая демонстрация такого подхода, вы можете углубить ее, при желании.</p>
<p>Для начала давайте создадим класс нашего будущего объекта.</p>
<p>Идем <code>Tools -&gt; New C++ Class -&gt; All Classes -&gt; Object</code>.</p>
<p><a class="glightbox" href="../images/487eade6653b9ccbb2e75d5702be394d.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="487eade6653b9ccbb2e75d5702be394d.png" auto_="auto;" display="block;" margin:="margin:" src="../images/487eade6653b9ccbb2e75d5702be394d.png" /></a></p>
<p>Добавляем наш объект в модуль <code>K2Custom</code>, который мы создали в главе "подготовка к работе". Я назвал базовый класс для будущих объектов - <code>ConstructibleObject</code>.</p>
<p><a class="glightbox" href="../images/c595b0285bf9f99fa8d694c985bcc0da.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c595b0285bf9f99fa8d694c985bcc0da.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c595b0285bf9f99fa8d694c985bcc0da.png" /></a></p>
<p>Нам особого функционала внутри объекта не нужно. Нужно лишь два события: <code>Init</code>, которое срабатывает, когда объект появляется в памяти, и событие <code>BeginPlay</code>, которое вызывается непосредственно из самой <code>K2</code> ноды.</p>
<p>Итого, класс выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">//.h</span>
<span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/NoExportTypes.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ConstructibleObject.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * Constructible Object Class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">(</span><span class="n">Abstract</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintType</span><span class="p">,</span><span class="w"> </span><span class="n">Blueprintable</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOM_API</span><span class="w"> </span><span class="n">UConstructibleObject</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UObject</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// Override PostInitProperties to make BeginPlay</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">PostInitProperties</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UConstructibleObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Begin Play event is called directly and only from our K2Node_ConstructibleObject</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BeginPlay&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ReceiveBeginPlay</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// _Implementation is function that spawned by &quot;Add Call To Parent Function&quot;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ReceiveBeginPlay_Implementation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* Nothing Here */</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// Init event in Blueprint</span>
<span class="w">    </span><span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="p">,</span><span class="w"> </span><span class="n">BlueprintNativeEvent</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DisplayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Init&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ReceiveInit</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// _Implementation is function that spawned by &quot;Add Call To Parent Function&quot;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ReceiveInit_Implementation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* Nothing Here */</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// Init event is called after this object is constructed</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// call bp version of the BeginPlay</span>
<span class="w">        </span><span class="n">ReceiveInit</span><span class="p">();</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>
<span class="c1">//...</span>
<span class="c1">//.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ConstructibleObject.h&quot;</span>
<span class="c1">// constructor</span>
<span class="n">UConstructibleObject</span><span class="o">::</span><span class="n">UConstructibleObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="c1">// Override PostInitProperties to make BeginPlay</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UConstructibleObject</span><span class="o">::</span><span class="n">PostInitProperties</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PostInitProperties</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// only after this we can tick. it&#39;s &quot;BeginPlay&quot;.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GetOuter</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">GetOuter</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetWorld</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Init</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Данный класс добавляется в <code>Runtime</code> модуль.</p>
<p><a class="glightbox" href="../images/4cb5ae52cd3c17895c84e2b39bfbac75.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="4cb5ae52cd3c17895c84e2b39bfbac75.png" auto_="auto;" display="block;" margin:="margin:" src="../images/4cb5ae52cd3c17895c84e2b39bfbac75.png" /></a></p>
<p>После компиляции мы сможем создавать объекты данного типа.</p>
<p>Идем в <code>Content Browser -&gt; Add -&gt; Blueprint Class</code>.</p>
<p><a class="glightbox" href="../images/c3eaef48df4987eb3589c8f88a06a358.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c3eaef48df4987eb3589c8f88a06a358.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c3eaef48df4987eb3589c8f88a06a358.png" /></a></p>
<p>В появившемся окне выбираем новый класс - <code>ConstructibleObject</code>.</p>
<p><a class="glightbox" href="../images/983cbb37d3ffdc68f0816e6f432bde25.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="983cbb37d3ffdc68f0816e6f432bde25.png" auto_="auto;" display="block;" margin:="margin:" src="../images/983cbb37d3ffdc68f0816e6f432bde25.png" /></a></p>
<p><a class="glightbox" href="../images/b659c775df6d3db92e7169c6015918ee.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="b659c775df6d3db92e7169c6015918ee.png" auto_="auto;" display="block;" margin:="margin:" src="../images/b659c775df6d3db92e7169c6015918ee.png" /></a></p>
<p>Открываем созданный файл и добавляем туда пару диспетчеров событий.</p>
<p>Я сделал следующую логику:</p>
<p><a class="glightbox" href="../images/15c0e566226eaf737ca64aaf858c1793.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="15c0e566226eaf737ca64aaf858c1793.png" auto_="auto;" display="block;" margin:="margin:" src="../images/15c0e566226eaf737ca64aaf858c1793.png" /></a></p>
<p>Теперь сделаем новую <code>K2</code> ноду на основе заготовленного шаблона.</p>
<p>Добавляем файлы <code>K2Node_ConstructibleObject.h</code> и  <code>K2Node_ConstructibleObject.cpp</code> в модуль <code>K2CustomEditor</code>.</p>
<p><a class="glightbox" href="../images/80f20f90e723620480ee4e459480f0e4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="80f20f90e723620480ee4e459480f0e4.png" auto_="auto;" display="block;" margin:="margin:" src="../images/80f20f90e723620480ee4e459480f0e4.png" /></a></p>
<p>Внутри этой ноды будем реализовывать следующую логику:</p>
<p><a class="glightbox" href="../images/253c8747d81ffdc6c1686b3b25ca138f.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="253c8747d81ffdc6c1686b3b25ca138f.png" auto_="auto;" display="block;" margin:="margin:" src="../images/253c8747d81ffdc6c1686b3b25ca138f.png" /></a></p>
<p><a class="glightbox" href="../images/c03bdcac99723e19494930a5e288b7d3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c03bdcac99723e19494930a5e288b7d3.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c03bdcac99723e19494930a5e288b7d3.png" /></a></p>
<p>Для сборки объекта используется функция <code>MakeObject</code>, которая выглядит так:
<div class="highlight"><pre><span></span><code><span class="c1">// very simple function to help instanciate object</span>
<span class="c1">// necessary, because NewObject method is not blueprintable template</span>
<span class="n">UFUNCTION</span><span class="p">(</span><span class="n">BlueprintCallable</span><span class="cm">/*, meta = (BlueprintInternalUseOnly = true)*/</span><span class="p">)</span>
<span class="k">static</span><span class="w"> </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="n">MakeObject</span><span class="p">(</span><span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="n">Owner</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NewObject</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Owner</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="k2node_constructibleobjecth">Файл <code>K2Node_ConstructibleObject.h</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#pragma once</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;CoreMinimal.h&quot;</span>
<span class="c1">// Main File</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_EaseFunction.h&quot;</span>
<span class="c1">// EdGraph is part of K2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNode.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EdGraph/EdGraphNodeUtils.h&quot;</span>
<span class="c1">// Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;KismetCompiler.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/CompilerResultsLog.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/WildcardNodeUtils.h&quot;</span><span class="c1"> // utils for wildcard node type</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet2/BlueprintEditorUtils.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabaseRegistrar.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Misc/DefaultValueHelper.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintCompilationManager.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Kismet/KismetSystemLibrary.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Containers/Map.h&quot;</span><span class="c1"> // map container</span>
<span class="c1">//#include &quot;GameFramework/PlayerController.h&quot;</span>
<span class="c1">// UObject related includes</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/ObjectMacros.h&quot;</span><span class="c1"> // this will hide warnings from intellisense</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;UObject/UObjectGlobals.h&quot;</span>
<span class="c1">// Editor Blueprint Utilities</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintActionDatabase.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BlueprintNodeSpawner.h&quot;</span>
<span class="c1">// K2 Nodes that we refer to</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CallFunction.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_MacroInstance.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_CustomEvent.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_ConstructObjectFromClass.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_AddDelegate.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_TemporaryVariable.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Self.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_Literal.h&quot;</span>
<span class="c1">// Character Refrence</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GameFramework/Character.h&quot;</span>
<span class="c1">// Constructible Object base class</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ConstructibleObject.h&quot;</span>
<span class="c1">// Runtime Functions Library</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2RuntimeFunctionsLibrary.h&quot;</span>
<span class="c1">// .generated.h</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_ConstructibleObject.generated.h&quot;</span>
<span class="cm">/**</span>
<span class="cm"> * K2 Node Constructible Object class</span>
<span class="cm"> */</span>
<span class="n">UCLASS</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">K2CUSTOMEDITOR_API</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">UK2Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">GENERATED_BODY</span><span class="p">()</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// constructor</span>
<span class="w">    </span><span class="n">UK2Node_ConstructibleObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//~ Begin UK2Node Interface.</span>
<span class="w">    </span><span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to place this node into add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will set node category in add blueprint node popup</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// node corner icon</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="nf">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Called when the connection list of one of the pins of this node is changed in the editor, after the pin has had it&#39;s literal cleared</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">NotifyPinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// return true if we want do show node properties in Details panel</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ShouldShowNodeProperties</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// return true if node used as &quot;pure&quot;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsNodePure</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//~ End UK2Node Interface</span>
<span class="w">    </span><span class="c1">//~ Begin UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// used to reconnect deprecated pin connections</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="nf">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to add pins for node</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">AllocateDefaultPins</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to change pins in runtime</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to determine pin changes</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to track connections for given pin</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">PinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to generate node title</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">FText</span><span class="w"> </span><span class="nf">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//~ End UEdGraphNode Interface.</span>
<span class="w">    </span><span class="c1">// Get the blueprint input pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="nf">GetClassPin</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Get the result output pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="nf">GetResultPin</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// variables cache</span>
<span class="w">    </span><span class="c1">// cache for pins list, generated from ClassPin attached class</span>
<span class="w">    </span><span class="c1">// used to clear generated pins if class changed</span>
<span class="w">    </span><span class="n">UPROPERTY</span><span class="p">()</span><span class="w"> </span><span class="c1">// to allow copying and serialisation of this param we should make it UPROPERTY</span>
<span class="w">    </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ClassPinsCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="c1">// cache class name to detect changes and reconstruct pins</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">CurrentClassCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will remove pins from provided name array</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">NameList</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will clear class pin and all pins, that was generated by GeneratePinsForClass for current class</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ClearClassPinValue</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// will generate pins for given class</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">GeneratePinsForClass</span><span class="p">(</span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// will move connections and data from old pin to new pin if possible</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// pin value gettr for ClassPin</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="nf">GetClassPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="c1">// pin names</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">ClassPinName</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// used to debug spawned node pins</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DebugPrintNodePins</span><span class="p">(</span><span class="n">UK2Node</span><span class="o">*</span><span class="w"> </span><span class="n">Node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="o">-&gt;</span><span class="n">Pins</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span><span class="w"> </span><span class="n">Warning</span><span class="p">,</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Pin Name = %s, Pin Direction = %s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">UEnum</span><span class="o">::</span><span class="n">GetValueAsString</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="k2node_constructibleobjectcpp">Файл <code>K2Node_ConstructibleObject.cpp</code></h4>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;K2Node_ConstructibleObject.h&quot;</span>
<span class="cp">#define LOCTEXT_NAMESPACE &quot;K2Node_ConstructibleObject&quot;</span>
<span class="c1">// pin name default values</span>
<span class="k">const</span><span class="w"> </span><span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClassPinName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ConstructibleClass&quot;</span><span class="p">);</span>
<span class="c1">// constructor</span>
<span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">UK2Node_ConstructibleObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FObjectInitializer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="o">:</span><span class="n">Super</span><span class="p">(</span><span class="n">ObjectInitializer</span><span class="p">)</span>
<span class="p">{}</span>
<span class="c1">// used to add pins for node</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Add execution pins</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Execute</span><span class="p">);</span>
<span class="w">    </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Then</span><span class="p">);</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// generate class pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Input</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Class</span><span class="p">,</span><span class="w"> </span><span class="n">UObject</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// return pin</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">,</span><span class="w"> </span><span class="n">UConstructibleObject</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// used to change pins in runtime</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ReallocatePinsDuringReconstruction</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AllocateDefaultPins</span><span class="p">();</span><span class="w"> </span><span class="c1">// this will load default exec pins</span>
<span class="w">    </span><span class="c1">// we can read class data from specific pin</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClassPinValue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">    </span><span class="n">GeneratePinsForClass</span><span class="p">(</span><span class="n">Source</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">OldPins</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// restore pins that was split</span>
<span class="w">    </span><span class="n">RestoreSplitPins</span><span class="p">(</span><span class="n">OldPins</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to determine pin changes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">PinDefaultValueChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PinDefaultValueChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// skip null</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// this pin is linked to something, so it should be proessed by PinConnectionListChanged</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">HasAnyConnections</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// just exit</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// regenerate pins for new class</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClassPinName</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ReconstructNode</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// used to track connections for given pin</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">PinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">PinConnectionListChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// skip null</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="c1">// this pin is linked to something, so it should be proessed by PinConnectionListChanged</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">HasAnyConnections</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// just exit</span>
<span class="p">}</span>
<span class="c1">// regenerate pins for new class or connection</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ReconstructNode</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Called when the connection list of one of the pins of this node is changed in the editor, after the pin has had it&#39;s literal cleared</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">NotifyPinConnectionListChanged</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">NotifyPinConnectionListChanged</span><span class="p">(</span><span class="n">Pin</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// check if pin not null</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// if node disconnected from class pin</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClassPinName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">HasAnyConnections</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ClearClassPinValue</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear old class and it pins, because old data, after reconnection, cannot be obtained</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// used to reconnect deprecated pin connections</span>
<span class="n">UK2Node</span><span class="o">::</span><span class="n">ERedirectType</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">DoPinsMatchForReconstruction</span><span class="p">(</span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="n">NewPinIndex</span><span class="p">,</span><span class="w"> </span><span class="n">OldPin</span><span class="p">,</span><span class="w"> </span><span class="n">OldPinIndex</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// expands complex node logic to set of simplier nodes</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">FKismetCompilerContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraph</span><span class="o">*</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">ExpandNode</span><span class="p">(</span><span class="n">CompilerContext</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// search blueprint, that has current K2 node</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetGraph</span><span class="p">();</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">    </span><span class="n">UK2Node</span><span class="o">*</span><span class="w"> </span><span class="n">LatestConnectedNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// we will chain nodes together using last node refrence</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Blueprint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// it&#39;s impossible to trigger, but let it be</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">SourceClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClassPinValue</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClassPin</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ResultPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetResultPin</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">SourceClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MessageLog</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="o">*</span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;ConstructibleObjectError&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2Node_ConstructibleObject: No Class is set&quot;</span><span class="p">).</span><span class="n">ToString</span><span class="p">());</span>
<span class="w">        </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// instantiate NewObject in MakeObject function that attached to the UK2Node_CallFunction node</span>
<span class="w">    </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">ClassNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">    </span><span class="n">ClassNode</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetExternalMember</span><span class="p">(</span><span class="n">GET_FUNCTION_NAME_CHECKED</span><span class="p">(</span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="p">,</span><span class="w"> </span><span class="n">MakeObject</span><span class="p">),</span><span class="w"> </span><span class="n">UK2RuntimeFunctionsLibrary</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">());</span>
<span class="w">    </span><span class="n">ClassNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">    </span><span class="n">ensure</span><span class="p">(</span><span class="n">ClassNode</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//DebugPrintNodePins(ClassNode);</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassNodeClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Class&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">ClassPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ClassNodeClassPin</span><span class="p">);</span><span class="w"> </span><span class="c1">// connect class pin</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// we need to deal with owner of the MakeObject function, if it&#39;s not set - engine will crash</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassNodeOwnerPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Owner&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="c1">// we need to pass Self refrence as Owner of the NewObject</span>
<span class="w">        </span><span class="c1">// *error: Object is not Packaged for classes, set &quot;by default&quot;</span>
<span class="w">        </span><span class="n">UK2Node_Self</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SelfNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_Self</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">        </span><span class="n">SelfNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">        </span><span class="n">ensure</span><span class="p">(</span><span class="n">SelfNode</span><span class="p">);</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">SelfPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SelfNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Self</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// send refrence</span>
<span class="w">        </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">SelfPin</span><span class="p">,</span><span class="w"> </span><span class="n">ClassNodeOwnerPin</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// connect exec pins</span>
<span class="w">    </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">ClassNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">()));</span>
<span class="w">    </span><span class="c1">// now class loaded in ClassNode, so we get it&#39;s instance pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassInstancePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassNode</span><span class="o">-&gt;</span><span class="n">GetReturnValuePin</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// result pin type should be same as class pin type or delegate will not bind</span>
<span class="w">    </span><span class="c1">// we, ofc, can spawn Cast node, but simplier and easier way is just construct pin type based on input class</span>
<span class="w">    </span><span class="n">ClassInstancePin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Object</span><span class="p">;</span>
<span class="w">    </span><span class="n">ClassInstancePin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceClass</span><span class="o">-&gt;</span><span class="n">GetAuthoritativeClass</span><span class="p">();</span>
<span class="w">    </span><span class="n">LatestConnectedNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassNode</span><span class="p">;</span><span class="w"> </span><span class="c1">// refrence to latest connected node</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ClassDefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SourceClass</span><span class="o">-&gt;</span><span class="n">GetDefaultObject</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if this object exists in game memory</span>
<span class="w">    </span><span class="c1">// iterate over current blueprint&#39;s fields</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TFieldIterator</span><span class="o">&lt;</span><span class="n">FProperty</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">(</span><span class="n">SourceClass</span><span class="p">,</span><span class="w"> </span><span class="n">EFieldIteratorFlags</span><span class="o">::</span><span class="n">IncludeSuper</span><span class="p">);</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">PropertyIt</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FProperty</span><span class="o">*</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">PropertyIt</span><span class="p">;</span>
<span class="w">        </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">PropertyClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastChecked</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetOwner</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="p">());</span><span class="w"> </span><span class="c1">// make sure we are on UObject</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsDelegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">IsA</span><span class="p">(</span><span class="n">FMulticastDelegateProperty</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">());</span><span class="w"> </span><span class="c1">// check if is Delegate</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsExposedToSpawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">IsPropertyExposedOnSpawn</span><span class="p">(</span><span class="n">Property</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property marked as Expose to Spawn</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsSettableExternally</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_DisableEditOnInstance</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property can be set externally</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">PropertyStillExists</span><span class="p">(</span><span class="n">Property</span><span class="p">)</span><span class="w"> </span><span class="c1">// if pin property dosen&#39;t exist</span>
<span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAllPropertyFlags</span><span class="p">(</span><span class="n">CPF_BlueprintVisible</span><span class="p">)</span><span class="w"> </span><span class="c1">// or if property dosen&#39;t visible to bp&#39;s</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// handle delegates</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsDelegate</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//FString PinName = FString::Printf(TEXT(&quot;EventData_%s&quot;), *Property-&gt;GetFName().ToString());</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">DelegateExecPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">());</span>
<span class="w">            </span><span class="c1">// make sure we have proper exec pin that matches the delegate name</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">DelegateExecPin</span>
<span class="w">                </span><span class="o">||</span><span class="w"> </span><span class="n">DelegateExecPin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinCategory</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// create output pins for every delegate sub pins signature</span>
<span class="w">            </span><span class="n">FMulticastDelegateProperty</span><span class="o">*</span><span class="w"> </span><span class="n">CastedProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastFieldChecked</span><span class="o">&lt;</span><span class="n">FMulticastDelegateProperty</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Property</span><span class="p">);</span>
<span class="w">            </span><span class="n">UFunction</span><span class="o">*</span><span class="w"> </span><span class="n">DelegateSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastedProperty</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">CastedProperty</span><span class="o">-&gt;</span><span class="n">SignatureFunction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="n">ensure</span><span class="p">(</span><span class="n">DelegateSignature</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if signature is found</span>
<span class="w">            </span><span class="c1">// we need to put our delegate refrence into UK2Node_AddDelegate, because we need to connect to this delegate</span>
<span class="w">            </span><span class="n">UK2Node_AddDelegate</span><span class="o">*</span><span class="w"> </span><span class="n">DelegateRefrenceNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_AddDelegate</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">            </span><span class="n">DelegateRefrenceNode</span><span class="o">-&gt;</span><span class="n">SetFromProperty</span><span class="p">(</span><span class="n">Property</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetOwnerClass</span><span class="p">());</span><span class="w"> </span><span class="c1">// set refrence from property</span>
<span class="w">            </span><span class="n">DelegateRefrenceNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">            </span><span class="c1">//DebugPrintNodePins(DelegateRefrenceNode);</span>
<span class="w">            </span><span class="c1">// delegate node should be connected</span>
<span class="w">            </span><span class="c1">// *error: This blueprint (self) is not a ConstructibleObjectInstance_C, therefore &#39; Target &#39; must have a connection.</span>
<span class="w">            </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">DelegateRefrenceNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Self</span><span class="p">),</span><span class="w"> </span><span class="n">ClassInstancePin</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// build connections chain</span>
<span class="w">            </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">LatestConnectedNode</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="n">DelegateRefrenceNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">());</span>
<span class="w">            </span><span class="n">LatestConnectedNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DelegateRefrenceNode</span><span class="p">;</span><span class="w"> </span><span class="c1">// update latest node in chain</span>
<span class="w">            </span><span class="c1">// get delegate pin refrence</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">DelegatePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DelegateRefrenceNode</span><span class="o">-&gt;</span><span class="n">GetDelegatePin</span><span class="p">();</span>
<span class="w">            </span><span class="c1">// make new Custom Event node, that will be bound to our delegate</span>
<span class="w">            </span><span class="n">UK2Node_CustomEvent</span><span class="o">*</span><span class="w"> </span><span class="n">DelegateCustomEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateEventNode</span><span class="o">&lt;</span><span class="n">UK2Node_CustomEvent</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">DelegateRefrenceNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">(),</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">            </span><span class="n">DelegateCustomEvent</span><span class="o">-&gt;</span><span class="n">EventReference</span><span class="p">.</span><span class="n">SetFromField</span><span class="o">&lt;</span><span class="n">UFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">DelegateSignature</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">            </span><span class="n">DelegateCustomEvent</span><span class="o">-&gt;</span><span class="n">CustomFunctionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">FString</span><span class="o">::</span><span class="n">Printf</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;%s_%s&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">GetGuid</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
<span class="w">            </span><span class="n">DelegateCustomEvent</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">            </span><span class="c1">//DebugPrintNodePins(DelegateCustomEvent);</span>
<span class="w">            </span><span class="c1">// connect custom event node with function delegate pin</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CEventDelegatePin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DelegateCustomEvent</span><span class="o">-&gt;</span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_CustomEvent</span><span class="o">::</span><span class="n">DelegateOutputName</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">DelegatePin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">CEventDelegatePin</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">DelegatePin</span><span class="p">,</span><span class="w"> </span><span class="n">CEventDelegatePin</span><span class="p">);</span>
<span class="w">                </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="n">DelegateExecPin</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">DelegateCustomEvent</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// now we need to call Begin Play event on our ConstructibleObject, so add another &quot;UK2Node_CallFunction&quot;</span>
<span class="w">        </span><span class="n">UK2Node_CallFunction</span><span class="o">*</span><span class="w"> </span><span class="n">BeginPlayNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">SpawnIntermediateNode</span><span class="o">&lt;</span><span class="n">UK2Node_CallFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SourceGraph</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// load function ReceiveBeginPlay from UConstructibleObject</span>
<span class="w">        </span><span class="n">UFunction</span><span class="o">*</span><span class="w"> </span><span class="n">BeginPlayFunctionSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindFieldChecked</span><span class="o">&lt;</span><span class="n">UFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">UConstructibleObject</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">(),</span><span class="w"> </span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;ReceiveBeginPlay&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">BeginPlayNode</span><span class="o">-&gt;</span><span class="n">FunctionReference</span><span class="p">.</span><span class="n">SetFromField</span><span class="o">&lt;</span><span class="n">UFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">BeginPlayFunctionSignature</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">BeginPlayNode</span><span class="o">-&gt;</span><span class="n">AllocateDefaultPins</span><span class="p">();</span>
<span class="w">        </span><span class="n">ensure</span><span class="p">(</span><span class="n">BeginPlayNode</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// send refrence of class instance as self pin</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">BPSelfPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeginPlayNode</span><span class="o">-&gt;</span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_Self</span><span class="p">);</span>
<span class="w">        </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">BPSelfPin</span><span class="p">,</span><span class="w"> </span><span class="n">ClassInstancePin</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//DebugPrintNodePins(BeginPlayNode);</span>
<span class="w">        </span><span class="c1">// connect BeginPlayNode in our chain</span>
<span class="w">        </span><span class="n">K2Schema</span><span class="o">-&gt;</span><span class="n">TryCreateConnection</span><span class="p">(</span><span class="n">LatestConnectedNode</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">(),</span><span class="w"> </span><span class="n">BeginPlayNode</span><span class="o">-&gt;</span><span class="n">GetExecPin</span><span class="p">());</span>
<span class="w">        </span><span class="n">LatestConnectedNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeginPlayNode</span><span class="p">;</span><span class="w"> </span><span class="c1">// continue chain</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// connect latest node with output</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LatestConnectedNode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CompilerContext</span><span class="p">.</span><span class="n">MovePinLinksToIntermediate</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">LatestConnectedNode</span><span class="o">-&gt;</span><span class="n">GetThenPin</span><span class="p">()),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">GetThenPin</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">BreakAllNodeLinks</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// will generate extra pins for given class</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">GeneratePinsForClass</span><span class="p">(</span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">InClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// clear old pins</span>
<span class="w">    </span><span class="c1">// if nothing is passed</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ClearClassPinValue</span><span class="p">();</span><span class="w"> </span><span class="c1">// clear old pins</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// exit</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// if new class passed in replacement of current - clear old pins of old class</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">InClass</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CurrentClassCache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ClassPinsCache</span><span class="p">);</span><span class="w"> </span><span class="c1">// clear old pins</span>
<span class="w">        </span><span class="n">CurrentClassCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InClass</span><span class="p">;</span><span class="w"> </span><span class="c1">// update current class</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// search blueprint, that has current K2 node</span>
<span class="w">    </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">UEdGraph</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetGraph</span><span class="p">();</span>
<span class="w">    </span><span class="n">UBlueprint</span><span class="o">*</span><span class="w"> </span><span class="n">Blueprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">FindBlueprintForGraph</span><span class="p">(</span><span class="n">Graph</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Blueprint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// it&#39;s impossible to trigger, but let it be</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">UObject</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ClassDefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InClass</span><span class="o">-&gt;</span><span class="n">GetDefaultObject</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if this object exists in game memory</span>
<span class="w">    </span><span class="c1">// iterate over current blueprint&#39;s fields</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">TFieldIterator</span><span class="o">&lt;</span><span class="n">FProperty</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">(</span><span class="n">InClass</span><span class="p">,</span><span class="w"> </span><span class="n">EFieldIteratorFlags</span><span class="o">::</span><span class="n">IncludeSuper</span><span class="p">);</span><span class="w"> </span><span class="n">PropertyIt</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">PropertyIt</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">FProperty</span><span class="o">*</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">PropertyIt</span><span class="p">;</span>
<span class="w">        </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">PropertyClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastChecked</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetOwner</span><span class="o">&lt;</span><span class="n">UObject</span><span class="o">&gt;</span><span class="p">());</span><span class="w"> </span><span class="c1">// make sure we are on UObject</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsDelegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">IsA</span><span class="p">(</span><span class="n">FMulticastDelegateProperty</span><span class="o">::</span><span class="n">StaticClass</span><span class="p">());</span><span class="w"> </span><span class="c1">// check if is Delegate</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsExposedToSpawn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">IsPropertyExposedOnSpawn</span><span class="p">(</span><span class="n">Property</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property marked as Expose to Spawn</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">bIsSettableExternally</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAnyPropertyFlags</span><span class="p">(</span><span class="n">CPF_DisableEditOnInstance</span><span class="p">);</span><span class="w"> </span><span class="c1">// is property can be set externally</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">FindPin</span><span class="p">(</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="c1">// if pin already exists</span>
<span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">PropertyStillExists</span><span class="p">(</span><span class="n">Property</span><span class="p">)</span><span class="w"> </span><span class="c1">// or if pin property dosen&#39;t exist</span>
<span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">HasAllPropertyFlags</span><span class="p">(</span><span class="n">CPF_BlueprintVisible</span><span class="p">)</span><span class="w"> </span><span class="c1">// or if property dosen&#39;t visible to bp&#39;s</span>
<span class="w">        </span><span class="p">){</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="c1">// skip</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// handle delegates</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsDelegate</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// create output exec pin for every delegate</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePin</span><span class="p">(</span><span class="n">EGPD_Output</span><span class="p">,</span><span class="w"> </span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PC_Exec</span><span class="p">,</span><span class="w"> </span><span class="n">Property</span><span class="o">-&gt;</span><span class="n">GetFName</span><span class="p">());</span>
<span class="w">            </span><span class="c1">// create output pins for every delegate sub pins signature</span>
<span class="w">            </span><span class="n">FMulticastDelegateProperty</span><span class="o">*</span><span class="w"> </span><span class="n">CastedProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastFieldChecked</span><span class="o">&lt;</span><span class="n">FMulticastDelegateProperty</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Property</span><span class="p">);</span>
<span class="w">            </span><span class="n">UFunction</span><span class="o">*</span><span class="w"> </span><span class="n">DelegateSignature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CastedProperty</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">CastedProperty</span><span class="o">-&gt;</span><span class="n">SignatureFunction</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="n">ensure</span><span class="p">(</span><span class="n">DelegateSignature</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if signature is found</span>
<span class="w">            </span><span class="cm">/*</span>
<span class="cm">            // make new pins in CustomEventNode node based on found delegate signature</span>
<span class="cm">            for (TFieldIterator&lt;FProperty&gt; PropIt(DelegateSignature); PropIt &amp;&amp; (PropIt-&gt;PropertyFlags &amp; CPF_Parm); ++PropIt)</span>
<span class="cm">            {</span>
<span class="cm">                const FProperty* Param = *PropIt;</span>
<span class="cm">                if (!Param-&gt;HasAnyPropertyFlags(CPF_OutParm) || Param-&gt;HasAnyPropertyFlags(CPF_ReferenceParm))</span>
<span class="cm">                {</span>
<span class="cm">                    // add delegate pin</span>
<span class="cm">                    FString PinName = FString::Printf(TEXT(&quot;EventData_%s&quot;), *Property-&gt;GetFName().ToString());</span>
<span class="cm">                    UEdGraphPin* DelegatePin = CreatePin(EGPD_Output, NAME_None, FName(PinName));</span>
<span class="cm">                    K2Schema-&gt;ConvertPropertyToPinType(Param, DelegatePin-&gt;PinType);</span>
<span class="cm">                }</span>
<span class="cm">            }</span>
<span class="cm">            */</span>
<span class="w">        </span><span class="p">}</span><span class="cm">/* else</span>
<span class="cm">        // you can also expand properties, if it&#39;s necessary</span>
<span class="cm">        if (!Property-&gt;HasAnyPropertyFlags(CPF_Parm) // handle properties</span>
<span class="cm">            &amp;&amp; bIsSettableExternally</span>
<span class="cm">        ){</span>
<span class="cm">            // create new pin with property name on it</span>
<span class="cm">            // *note: make Output pin</span>
<span class="cm">            UEdGraphPin* Pin = nullptr;</span>
<span class="cm">            if (bIsExposedToSpawn) { // handle input properties</span>
<span class="cm">                Pin = CreatePin(EGPD_Input, NAME_None, Property-&gt;GetFName());</span>
<span class="cm">            }</span>
<span class="cm">            else</span>
<span class="cm">            if (Property-&gt;GetFName().ToString().Contains(&quot;Output&quot;)) {  // handle output properties</span>
<span class="cm">                Pin = CreatePin(EGPD_Output, NAME_None, Property-&gt;GetFName());</span>
<span class="cm">            }</span>
<span class="cm">            if (Pin != nullptr)</span>
<span class="cm">            {</span>
<span class="cm">                // initialise created pin with property data</span>
<span class="cm">                K2Schema-&gt;ConvertPropertyToPinType(Property, Pin-&gt;PinType);</span>
<span class="cm">                InitialiseNewPinWithOldData(Pin, OldPins);</span>
<span class="cm">                // copy param default value to pin if object is not initialised</span>
<span class="cm">                if (ClassDefaultObject &amp;&amp; K2Schema-&gt;PinDefaultValueIsEditable(*Pin))</span>
<span class="cm">                {</span>
<span class="cm">                    FString DefaultValueAsString;</span>
<span class="cm">                    // read property value</span>
<span class="cm">                    const bool bDefaultValueSet = FBlueprintEditorUtils::PropertyValueToString(Property, reinterpret_cast&lt;const uint8*&gt;(ClassDefaultObject), DefaultValueAsString, this);</span>
<span class="cm">                    check(bDefaultValueSet); // assert</span>
<span class="cm">                    // set default value</span>
<span class="cm">                    K2Schema-&gt;SetPinAutogeneratedDefaultValue(Pin, DefaultValueAsString);</span>
<span class="cm">                }</span>
<span class="cm">                UE_LOG(LogTemp, Warning, TEXT(&quot;Property Name is %s&quot;), *Property-&gt;GetFullName())</span>
<span class="cm">                // Copy tooltip from the property.</span>
<span class="cm">                K2Schema-&gt;ConstructBasicPinTooltip(*Pin, Property-&gt;GetToolTipText(), Pin-&gt;PinToolTip);</span>
<span class="cm">                ClassPinsCache.AddUnique(Pin-&gt;PinName);</span>
<span class="cm">            }</span>
<span class="cm">        }*/</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Change class of output pin</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ResultPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">ResultPin</span><span class="p">);</span>
<span class="w">    </span><span class="n">ResultPin</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InClass</span><span class="o">-&gt;</span><span class="n">GetAuthoritativeClass</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// used to place this node into add blueprint node popup</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">FBlueprintActionDatabaseRegistrar</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ActionRegistrar</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Super</span><span class="o">::</span><span class="n">GetMenuActions</span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">);</span><span class="w"> </span><span class="c1">// call parent</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetClass</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// register current class as acessible blueprint node</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">IsOpenForRegistration</span><span class="p">(</span><span class="n">Action</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">UBlueprintNodeSpawner</span><span class="o">*</span><span class="w"> </span><span class="n">Spawner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UBlueprintNodeSpawner</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="n">GetClass</span><span class="p">());</span>
<span class="w">        </span><span class="n">check</span><span class="p">(</span><span class="n">Spawner</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">        </span><span class="n">ActionRegistrar</span><span class="p">.</span><span class="n">AddBlueprintAction</span><span class="p">(</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">Spawner</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will set node category in add blueprint node popup</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">GetMenuCategory</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;ConstructibleObject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Object&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// used to generate node title</span>
<span class="n">FText</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">GetNodeTitle</span><span class="p">(</span><span class="n">ENodeTitleType</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">TitleType</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LOCTEXT</span><span class="p">(</span><span class="s">&quot;UK2Node_Boilerplate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;K2ConstructibleObject&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// node corner icon</span>
<span class="n">FName</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// latent action icon, if needed</span>
<span class="w">    </span><span class="c1">//return TEXT(&quot;Graph.Latent.LatentIcon&quot;);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Super</span><span class="o">::</span><span class="n">GetCornerIcon</span><span class="p">();</span><span class="w"> </span><span class="c1">// in case if you don&#39;t want icon - just call parent</span>
<span class="p">}</span>
<span class="c1">// will remove pin and all it&#39;s subpins by name</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">RemovePinByName</span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">PinName</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// code below will remove elements from array of Pins</span>
<span class="w">    </span><span class="c1">// array itself shrinks towards the beginning when elements are removed</span>
<span class="w">    </span><span class="c1">// and if we do loop from index - to Pins.Num() we will have problems with &quot;out of bounds&quot; error</span>
<span class="w">    </span><span class="c1">// so it&#39;s important to do reversed foor loop</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">CurrentPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pins</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<span class="w">        </span><span class="c1">// if names are same or same+suffix (for expanden pins such as structs)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">BreakAllPinLinks</span><span class="p">();</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">CurrentPin</span><span class="o">-&gt;</span><span class="n">MarkAsGarbage</span><span class="p">();</span>
<span class="w">            </span><span class="c1">//RemovePin(CurrentPin);</span>
<span class="w">            </span><span class="n">Pins</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="w">            </span><span class="n">OnPinRemoved</span><span class="p">(</span><span class="n">CurrentPin</span><span class="p">);</span>
<span class="w">            </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">FBlueprintEditorUtils</span><span class="o">::</span><span class="n">MarkBlueprintAsModified</span><span class="p">(</span><span class="n">GetBlueprint</span><span class="p">());</span>
<span class="w">    </span><span class="n">GetGraph</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NotifyGraphChanged</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will remove pins from provided name array</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FName</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">NameList</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NameList</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Pins</span><span class="p">.</span><span class="n">Num</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FName</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">NameList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RemovePinByName</span><span class="p">(</span><span class="n">Name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">NameList</span><span class="o">-&gt;</span><span class="n">Empty</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// pin value gettr for ClassPin</span>
<span class="c1">// *note this method build based on \Engine\Source\Editor\BlueprintGraph\Private\K2Node_ConstructObjectFromClass.cpp</span>
<span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">GetClassPinValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UClass</span><span class="o">*</span><span class="w"> </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// result</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">PinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pins</span><span class="p">;</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// search for class pin</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">TestPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">PinsToSearch</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TestPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">TestPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestPin</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassPin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// pin is found</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">HasAnyConnections</span><span class="p">())</span><span class="w"> </span><span class="c1">// pin not linked, so get default value</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// pin linked so get sub category pin value</span>
<span class="w">            </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">LinkedTo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">            </span><span class="n">ClassResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassSource</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">Cast</span><span class="o">&lt;</span><span class="n">UClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ClassSource</span><span class="o">-&gt;</span><span class="n">PinType</span><span class="p">.</span><span class="n">PinSubCategoryObject</span><span class="p">.</span><span class="n">Get</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ClassResult</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// will move connections and data from old pin to new pin if possible</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">InitialiseNewPinWithOldData</span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">NewPin</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">OldPins</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">NewPin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OldPins</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">UEdGraphSchema_K2</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">K2Schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDefault</span><span class="o">&lt;</span><span class="n">UEdGraphSchema_K2</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// find old pin with same name</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">OPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">OldPins</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">OPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span><span class="w"> </span><span class="c1">// ToString is necessary, since names don&#39;t have registry sensitivity</span>
<span class="w">                </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">OPin</span><span class="o">-&gt;</span><span class="n">bOrphanedPin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="c1">// make sure it&#39;s orphan data</span>
<span class="w">                </span><span class="c1">//&amp;&amp; OPin-&gt;Direction == EGPD_Input // only input pins can be restored this way. I had very strange bug with output pins connection, but it just disappeared after... so if you have it - uncomment this line.</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">//ReconstructSinglePin(NewPin, OPin, ERedirectType_Name); // don&#39;t use this - it won&#39;t preserve default values, they sohuld be copied, since data on OldPins get&#39;s resetted after pins reallocation</span>
<span class="w">                </span><span class="n">NewPin</span><span class="o">-&gt;</span><span class="n">CopyPersistentDataFromOldPin</span><span class="p">(</span><span class="o">*</span><span class="n">OPin</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// will clear class pin and all pins, that was generated by GeneratePinsForClass for current class</span>
<span class="kt">void</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClearClassPinValue</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">ClassPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPin</span><span class="p">(</span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ClassPin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// order matters!</span>
<span class="w">        </span><span class="c1">// first clear list of old pins</span>
<span class="w">        </span><span class="n">RemoveMultiplePinsByNames</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ClassPinsCache</span><span class="p">);</span>
<span class="w">        </span><span class="n">CurrentClassCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="c1">// set current class pins cache to null</span>
<span class="w">        </span><span class="c1">// only then change default value since it tirggers PinDefaultValueChanged event</span>
<span class="w">        </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">DefaultObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">        </span><span class="n">ClassPin</span><span class="o">-&gt;</span><span class="n">AutogeneratedDefaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Get the result output pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">GetResultPin</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindPinChecked</span><span class="p">(</span><span class="n">UEdGraphSchema_K2</span><span class="o">::</span><span class="n">PN_ReturnValue</span><span class="p">);</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGPD_Output</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Pin</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Get the blueprint input pin</span>
<span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">GetClassPin</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="cm">/*= NULL*/</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">UEdGraphPin</span><span class="o">*&gt;*</span><span class="w"> </span><span class="n">PinsToSearch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">InPinsToSearch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pins</span><span class="p">;</span>
<span class="w">    </span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UEdGraphPin</span><span class="o">*</span><span class="w"> </span><span class="n">TestPin</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">PinsToSearch</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TestPin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">TestPin</span><span class="o">-&gt;</span><span class="n">PinName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UK2Node_ConstructibleObject</span><span class="o">::</span><span class="n">ClassPinName</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestPin</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">check</span><span class="p">(</span><span class="n">Pin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Direction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EGPD_Input</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Pin</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#undef LOCTEXT_NAMESPACE</span>
</code></pre></div>
<h4 id="_17">Разбор кода</h4>
<p>Полученная <code>K2</code> нода выглядит так:</p>
<p><a class="glightbox" href="../images/189a5ca05342e9f2705218e7a9053bdb.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="189a5ca05342e9f2705218e7a9053bdb.png" auto_="auto;" display="block;" margin:="margin:" src="../images/189a5ca05342e9f2705218e7a9053bdb.png" /></a></p>
<p>Доступ к переменным класса возможен из пина <code>ReturnValue</code>. При этом каждый новый добавленный делегат будет появляться в ноде, в виде отдельного пина.</p>
<p><a class="glightbox" href="../images/c15b5ceab775a903827a8c950109347b.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="c15b5ceab775a903827a8c950109347b.png" auto_="auto;" display="block;" margin:="margin:" src="../images/c15b5ceab775a903827a8c950109347b.png" /></a></p>
<p><a class="glightbox" href="../images/7021f130ee5a53b563332c84e67d0064.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="7021f130ee5a53b563332c84e67d0064.png" auto_="auto;" display="block;" margin:="margin:" src="../images/7021f130ee5a53b563332c84e67d0064.png" /></a></p>
<p>Делегаты можно вызывать напрямую из кода самой ноды.</p>
<p><a class="glightbox" href="../images/9e14e482478a7eea9240c02678effe94.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="9e14e482478a7eea9240c02678effe94.png" auto_="auto;" display="block;" margin:="margin:" src="../images/9e14e482478a7eea9240c02678effe94.png" /></a></p>
<p>При этом вызов делегата будет активировать созданный <code>Exec</code> пин.</p>
<p><a class="glightbox" href="../images/2a421de277c38bbb5b635ef1d0d7f20a.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="2a421de277c38bbb5b635ef1d0d7f20a.png" auto_="auto;" display="block;" margin:="margin:" src="../images/2a421de277c38bbb5b635ef1d0d7f20a.png" /></a></p>
<p>Генерация пинов для каждого из делегатов делается в методе <code>GeneratePinsForClass</code>, который вызывается непосредственно в <code>ReallocatePinsDuringReconstruction</code>.
При обновлении ноды, цикл проходит по всем параметрам класса, выбирает там делегаты и генерирует для каждого делегата отдельный <code>Exec</code> пин.</p>
<p><a class="glightbox" href="../images/50c5fedd11376474705391de0410eca1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="50c5fedd11376474705391de0410eca1.png" auto_="auto;" display="block;" margin:="margin:" src="../images/50c5fedd11376474705391de0410eca1.png" /></a></p>
<p>Далее, в методе <code>ExpandNode</code> осуществляется присоединение созданных <code>Exec</code> пинов к событиям, полученным при развертке делегатов, по аналогии с тем, как это делается в <code>blueprint</code> коде.</p>
<p><a class="glightbox" href="../images/1a0dcd4ca83602da89a8e850785de317.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img 0="0" align="center;" alt="1a0dcd4ca83602da89a8e850785de317.png" auto_="auto;" display="block;" margin:="margin:" src="../images/1a0dcd4ca83602da89a8e850785de317.png" /></a></p>
<h2 id="links">Links</h2>
<p>Обязательно обратите внимание на следующие примеры:</p>
<ol>
<li>Very Good example of native foreach, go there and study it: https://github.com/MagForceSeven/UE-K2-Nodes/blob/main/K2Node_NativeForEach.cpp</li>
<li>K2 Node Pins Customisation example: https://github.com/NansPellicari/UE4-HowTo-CustomPin/blob/master/Plugins/CustomPin/Source/CustomPin/Public/CustomPinFactory.h</li>
<li>Short Article on UE Community Wiki: https://nerivec.github.io/old-ue4-wiki/pages/create-custom-k2-node-for-blueprint.html</li>
<li>Another good example of K2 nodes, this time made using <code>CreatenodeHandler</code>: https://github.com/nFerrar/K2Node_Intro/blob/master/PSK2Node_GetObjectVarByName.cpp</li>
<li>Kismet Compiler documentation: https://docs.unrealengine.com/5.2/en-US/compiler-overview-for-blueprints-visual-scripting-in-unreal-engine/</li>
</ol>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            К началу
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      aftamat4ik
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "toc.follow"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "search.result.more.one": "\u0415\u0449\u0451 1 \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.more.other": "\u0415\u0449\u0451 # \u043d\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439: #", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.term.missing": "\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442", "select.version": "\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0435\u0440\u0441\u0438\u044e"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>